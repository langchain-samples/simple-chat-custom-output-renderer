[
  {
    "role": "user",
    "id": "8740e545-5aea-4f9a-b95b-73a274ae5e7d",
    "content": "\u0414\u0435\u0442\u0430\u043b\u044c\u043d\u043e \u043f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 CODE \u0438 DEBUG \u0438 \u0432\u044b\u044f\u0432\u0438 \u043f\u0440\u0438\u0447\u0438\u043d\u0443 \nCODE 1\n<<<\n\"\"\"Unified base class for architectural agents.\n\nThis module provides the foundational base class for all architectural agents\nin the multi-agent system. It handles:\n- Runtime configuration and overrides\n- MCP client management\n- Error handling with automatic fallback (supports multiple error domains)\n- Graph caching and lifecycle\n\"\"\"\n\nfrom __future__ import annotations\n\nimport logging\nimport uuid\nfrom abc import ABC, abstractmethod\nfrom typing import Any, Dict, Callable, List, Mapping, MutableMapping, Optional, TypeAlias, Union, Type, Self, Tuple, cast\n\nimport anyio\nfrom langchain_core.runnables import Runnable, RunnableConfig, RunnableLambda\nfrom langchain_mcp_adapters.client import MultiServerMCPClient\n\nfrom shared.config.configuration import Configuration\nfrom shared.config.conifg_base import MCPClientConfig, ModelConfig\nfrom shared.config.utils import config_signature\nfrom shared.memory_manager import GraphMemoryRuntime\nfrom shared.graph_identity import GraphIdentity\nfrom shared.runtime_utils import wrap_compiled_graph\nfrom policies.errors_handling.llm.utils import apply_retry_policy\nfrom shared.config.long_memory import LongMemory\nfrom policies.errors_handling import (\n    LLMErrorHandler,\n    RateLimitError,\n    ResolutionResult,\n    CompositeErrorHandler,\n    ErrorHandlerList,\n)\nfrom policies.errors_handling.llm.handlers import ComponentAwareLLMHandler\nfrom pydantic import BaseModel\nfrom langgraph.graph import StateGraph, START, END\nfrom langgraph.graph.state import CompiledStateGraph\n\nfrom shared.exceptions.component_errors import ComponentLLMError\nfrom shared.types.components import ComponentName\n\ntry:  # Optional dependency for Google providers.\n    from google.api_core.exceptions import ResourceExhausted as GoogleResourceExhausted\nexcept Exception:  # pragma: no cover - optional import\n    GoogleResourceExhausted = None\n\nlogger = logging.getLogger(__name__)\n\nStateDict: TypeAlias = MutableMapping[str, Any]\nResultDict: TypeAlias = Mapping[str, Any]\nContextPayload: TypeAlias = Any\nAssistantGraph: TypeAlias = Any\nRuntimeOverrideMap: TypeAlias = Dict[str, Any]\nResultStateKey: TypeAlias = str\nRetryableRunnable: TypeAlias = Runnable\nUserId: TypeAlias = str\nWorkerId: TypeAlias = str\nThreadId: TypeAlias = str\nBeforeInvokeResult: TypeAlias = (\n    tuple[\n        StateDict | None,\n        RunnableConfig | None,\n        ContextPayload | None,\n    ]\n    | None\n)\n\n\nclass ArchitecturalAgentBase(ABC):\n    \"\"\"Base class that centralises runtime configuration for architectural agents.\n    \n    This class provides:\n    - Configuration management with runtime overrides\n    - MCP client lifecycle management\n    - Automatic error handling with model/provider fallback (multi-domain support)\n    - Assistant graph caching\n    \n    Subclasses must implement:\n    - STEP_CONFIG_KEY: Configuration key for the step\n    - RESULT_STATE_KEY: State key for storing results\n    - _build_graph: Method to construct the LangGraph graph\n    \n    Error Handling:\n    The base class automatically handles LLM provider errors (500, 502, 503)\n    by attempting fallback to alternative models or providers. This behavior\n    can be configured via Configuration.errors_handling.llm_fallback or by providing\n    a list of handlers via error_handlers parameter.\n    \n    For multi-domain error handling, use error_handlers:\n        agent = MyAgent(error_handlers=[\n            LLMErrorHandler(FallbackConfig()),\n            # NetworkErrorHandler(retry_config),  # Future\n        ])\n    \n    For LLM-only error handling (backward compatible):\n        cfg = Configuration()\n        cfg.errors_handling.llm_fallback = FallbackConfig()\n        agent = MyAgent(configuration=cfg)\n    \"\"\"\n\n    STEP_CONFIG_KEY: str = \"\"\n    RESULT_STATE_KEY: Optional[ResultStateKey] = None\n\n    def __init__(\n        self,\n        *,\n        configuration: Optional[ModelConfig] = None,\n        mcp_client: Optional[MultiServerMCPClient] = None,\n        mcp_configuration: Optional[MCPClientConfig] = None,\n        error_handlers: Optional[ErrorHandlerList] = None,\n    ) -> None:\n        \"\"\"Initialize the architectural agent.\n        \n        Args:\n            configuration: Step-specific model configuration\n            mcp_client: Optional pre-configured MCP client\n            mcp_configuration: MCP client configuration\n            error_handlers: List of error handlers for multi-domain support.\n                           If provided, takes precedence over fallback_config.\n        \"\"\"\n        defaults = Configuration.from_runnable_config(None)\n        if not self.STEP_CONFIG_KEY:\n            raise ValueError(\"STEP_CONFIG_KEY must be defined on the agent class.\")\n        if not self.RESULT_STATE_KEY:\n            raise ValueError(\"RESULT_STATE_KEY must be defined on the agent class.\")\n\n        default_step_config: ModelConfig = getattr(defaults, self.STEP_CONFIG_KEY)\n        if isinstance(configuration, Configuration):\n            provided_config: Optional[ModelConfig] = getattr(\n                configuration, self.STEP_CONFIG_KEY\n            )\n        else:\n            provided_config = configuration\n\n        self.configuration: ModelConfig = provided_config or default_step_config\n        self._assistant_graph: Optional[AssistantGraph] = None\n        # Deterministic graph_id used for checkpoint metadata scoping of the assistant graph.\n        # This is set when compiling the assistant graph and later injected into RunnableConfig.metadata.\n        self._assistant_graph_id: Optional[str] = None\n        self._config_signature: str = config_signature(self.configuration)\n\n        self._mcp_configuration: MCPClientConfig = mcp_configuration or defaults.mcp\n        self._mcp_config_signature: str = config_signature(self._mcp_configuration)\n        self.mcp_client: Optional[MultiServerMCPClient] = mcp_client\n        self._owns_mcp_client: bool = mcp_client is None\n        if self._owns_mcp_client:\n            self._setup_mcp_client()\n        \n        # Initialize error handler for automatic fallback (always composite)\n        # Use step-specific errors_handling from configuration which already has proper CONFIG_PREFIX\n        # Each step config (e.g., WideFunnelConfig, SelectionConfig) has errors_handling field\n        # with step-specific type (e.g., WideFunnelErrorsHandlingConfig) that has correct CONFIG_PREFIX\n        # for parsing environment variables like WIDE_FUNNEL_FALLBACK_LLM_PROVIDER_PRIORITY\n        if hasattr(self.configuration, \"errors_handling\") and self.configuration.errors_handling:\n            errors_cfg = self.configuration.errors_handling\n        else:\n            # Fallback: if step config doesn't have errors_handling, create one with step prefix\n            from shared.config.policy.errors_handling.config import ErrorsHandlingConfig\n            step_prefix = self.STEP_CONFIG_KEY.upper()\n            errors_cfg = ErrorsHandlingConfig.for_step(step_prefix)\n\n        errors_cfg = errors_cfg.scoped_copy(\"agent\")\n        self._agent_fallback_config = errors_cfg.llm_fallback\n        self._extractor_fallback_config = errors_cfg.llm_extractor_fallback\n        self._llm_retry_config = errors_cfg.llm_retry\n        self._fallback_config = self._agent_fallback_config\n        self._agent_llm_handler = LLMErrorHandler(self._agent_fallback_config)\n        self._extractor_llm_handler = LLMErrorHandler(self._extractor_fallback_config)\n        self._component_llm_handler = ComponentAwareLLMHandler(\n            agent_handler=self._agent_llm_handler,\n            extractor_handler=self._extractor_llm_handler,\n        )\n\n        # Persist extra handlers (excluding LLM) so worker forks can reuse them.\n        provided_handlers: ErrorHandlerList = list(error_handlers or [])\n        self._extra_error_handlers: ErrorHandlerList = [\n            handler\n            for handler in provided_handlers\n            if getattr(handler, \"domain\", None) != self._component_llm_handler.domain\n        ]\n\n        handler_set: ErrorHandlerList = [\n            self._component_llm_handler,\n            *self._extra_error_handlers,\n        ]\n        self._error_handler = CompositeErrorHandler(handler_set)\n        self._graph_lock: anyio.Lock = anyio.Lock()\n        # Optional execution-scope identifier used to disambiguate checkpoint metadata\n        # when multiple workers share the same root thread_id.\n        self._graph_instance_worker_id: Optional[str] = None\n        # Context snapshot used while compiling graphs before runtime context exists.\n        self._graph_build_context: Optional[Any] = None\n\n    def _resolve_graph_memory_runtime(\n        self,\n        *,\n        context: Optional[Any],\n    ) -> GraphMemoryRuntime:\n        \"\"\"Resolve the shared GraphMemoryRuntime from LangGraph runtime context.\n\n        Production contract:\n        - A single GraphMemoryRuntime instance is created at the root graph and is\n          available via `get_runtime().context.graph_memory_runtimer`.\n        - Nested components must reuse that instance (no ad-hoc construction).\n        \"\"\"\n\n        effective_context = context or self._graph_build_context\n\n        if effective_context is not None and hasattr(effective_context, \"graph_memory_runtimer\"):\n            runtime_helper = getattr(effective_context, \"graph_memory_runtimer\", None)\n            if isinstance(runtime_helper, GraphMemoryRuntime):\n                return runtime_helper\n\n        from langgraph.runtime import get_runtime\n\n        try:\n            runtime = get_runtime()\n        except Exception as exc:  # pragma: no cover\n            raise RuntimeError(\n                \"GraphMemoryRuntime is missing from LangGraph runtime context. \"\n                \"Invoke graphs with `context=ContextTravelGuideAgent(...)` (or ensure \"\n                \"`context_schema=ContextTravelGuideAgent` is used when compiling).\"\n            ) from exc\n\n        runtime_context = getattr(runtime, \"context\", None)\n        if runtime_context is not None and hasattr(runtime_context, \"graph_memory_runtimer\"):\n            runtime_helper = getattr(runtime_context, \"graph_memory_runtimer\", None)\n            if isinstance(runtime_helper, GraphMemoryRuntime):\n                return runtime_helper\n\n        raise RuntimeError(\n            \"GraphMemoryRuntime is missing from LangGraph runtime context. \"\n            \"Invoke graphs with `context=ContextTravelGuideAgent(...)` (or ensure \"\n            \"`context_schema=ContextTravelGuideAgent` is used when compiling).\"\n        )\n\n    def fork(\n        self,\n        *,\n        configuration: Optional[ModelConfig] = None,\n        worker_id: Optional[WorkerId] = None,\n    ) -> Self:\n        \"\"\"Create an isolated agent instance for worker-scoped execution.\n\n        Distributed workflows execute multiple workers concurrently. The default\n        agent implementation mutates configuration and resets graph caches when\n        fallback occurs, which must not leak across workers. This helper creates\n        a new instance of the same agent class with independent caches while\n        reusing shared infrastructure like MCP client and extra error handlers.\n        \"\"\"\n\n        cloned_configuration = configuration or self.configuration\n        cloned = self.__class__(  # type: ignore[call-arg, return-value]\n            configuration=cloned_configuration,\n            mcp_client=self.mcp_client,\n            mcp_configuration=self._mcp_configuration,\n            error_handlers=list(self._extra_error_handlers),\n        )\n        cloned._graph_instance_worker_id = worker_id\n        return cloned\n\n    def _decorate_graph_name(self, base_name: str) -> str:\n        \"\"\"Return a deterministic graph name for checkpoint metadata scoping.\"\"\"\n\n        step_name = self.STEP_CONFIG_KEY or \"unknown_step\"\n        identity = GraphIdentity(\n            base_name=str(base_name),\n            step_key=step_name,\n            worker_id=self._graph_instance_worker_id,\n        )\n        return identity.get_name()\n\n\n    async def run(\n        self,\n        state: StateDict,\n        config: Optional[RunnableConfig] = None,\n        context: Optional[ContextPayload] = None,\n    ) -> ResultDict:\n        \"\"\"Apply overrides, build the assistant graph, and execute it.\n        \n        This method includes automatic error handling with fallback to\n        alternative models or providers when LLM errors occur.\n        \n        Args:\n            state: Current agent state\n            config: Optional RunnableConfig with overrides\n            context: Optional context payload\n            \n        Returns:\n            Result dictionary from graph execution\n            \n        Raises:\n            Exception: Re-raised if error cannot be resolved by fallback\n        \"\"\"\n        remaining_attempts: Dict[ComponentName, int] = {\n            \"agent\": self._get_component_fallback_config(\"agent\").max_fallback_attempts,\n            \"extractor\": self._get_component_fallback_config(\"extractor\").max_fallback_attempts,\n        }\n        last_error: Optional[Exception] = None\n        \n        resume_from_checkpoint = False\n        while True:\n            try:\n                graph_memory = self._resolve_graph_memory_runtime(context=context)\n                self._apply_runtime_overrides(config)\n                config = self._ensure_long_memory_config(config=config)\n                config = self._ensure_thread_config(\n                    config=config,\n                    context=context,\n                )\n\n                can_resume = False\n                if resume_from_checkpoint:\n                    can_resume = await graph_memory.has_persisted_checkpoint(\n                        config=config,\n                    )\n\n                if not can_resume:\n                    before_result = await self._before_run(state, config, context)\n                    if before_result is not None:\n                        state, config, context = before_result\n                        config = self._ensure_long_memory_config(config=config)\n                        config = self._ensure_thread_config(\n                            config=config,\n                            context=context,\n                        )\n\n                previous_build_context = self._graph_build_context\n                self._graph_build_context = context\n                try:\n                    await self._ensure_graph()\n                finally:\n                    self._graph_build_context = previous_build_context\n\n                result = await self._invoke_graph_from_checkpoint(\n                    graph_input=state,\n                    config=config,\n                    context=context,\n                )\n                self._merge_state_in_place(state, result)\n\n                await self._after_run(state, config, context, result)\n                return result\n                \n            except Exception as e:\n                component: ComponentName = \"agent\"\n                original_error: Exception = e\n                if isinstance(e, ComponentLLMError):\n                    component = e.component\n                    original_error = e.original_error\n                normalized_error = self._normalize_llm_error(original_error)\n                last_error = normalized_error\n                \n                # Skip error handling if fallback is disabled or this is the last attempt\n                component_config = self._get_component_fallback_config(component)\n                if not component_config.fallback_enabled:\n                    logger.warning(\n                        f\"Error in {self.STEP_CONFIG_KEY} ({component}), fallback disabled: {normalized_error}\"\n                    )\n                    raise normalized_error\n                remaining = remaining_attempts.get(component, 0)\n                if remaining <= 0:\n                    logger.error(\n                        f\"Error in {self.STEP_CONFIG_KEY} ({component}), no fallback attempts remaining.\"\n                    )\n                    raise normalized_error\n                remaining_attempts[component] = remaining - 1\n                \n                # Extract worker_id for distributed mode isolation\n                worker_id = self._extract_worker_id(\n                    config=config, context=context, state=state\n                )\n                config = self._ensure_long_memory_config(config=config)\n                config = self._ensure_thread_config(\n                    config=config,\n                    context=context,\n                )\n                if worker_id:\n                    logger.debug(\n                        f\"Distributed mode detected for {self.STEP_CONFIG_KEY}, \"\n                        f\"using worker_id={worker_id} for fallback isolation\"\n                    )\n\n                # Note: we do NOT pre-restore state before a durable resume attempt.\n                # LangGraph will replay prior writes when resuming; pre-merging the\n                # snapshot into `state` can lead to duplicate add_messages writes.\n                \n                # Attempt to resolve the error                \n                resolution = self._error_handler.handle(\n                    error=normalized_error,\n                    current_model=self._get_current_model(component=component),\n                    current_api_key=self._get_current_api_key(component=component),\n                    step_name=self.STEP_CONFIG_KEY,\n                    worker_id=worker_id,\n                    config=config,\n                    component=component,\n                )\n                \n                if not resolution.resolved:\n                    logger.error(\n                        f\"Error in {self.STEP_CONFIG_KEY} could not be resolved: \"\n                        f\"{resolution.message}\"\n                    )\n                    # Best-effort: hydrate caller state with latest checkpoint so the\n                    # caller sees the most recent progress on terminal failure.\n                    try:\n                        await graph_memory.restore_state_from_latest_checkpoint(\n                            state=state,\n                            config=config,\n                            local_graph=self._assistant_graph,\n                        )\n                    except Exception:\n                        pass\n                    raise normalized_error\n                \n                # Apply fallback configuration and retry\n                logger.info(\n                    f\"Applying fallback in {self.STEP_CONFIG_KEY} ({component}): {resolution.message}\"\n                )\n                self._apply_fallback_config(resolution, component=component)\n                self.reset_graph_cache()  # Force rebuild with new config\n                resume_from_checkpoint = True  # retry via durable replay when possible\n        \n        # Should not reach here, but raise last error if it does\n        if last_error:\n            raise last_error\n        raise RuntimeError(f\"Unexpected state in {self.STEP_CONFIG_KEY} ainvoke\")\n\n    async def _before_run(\n        self,\n        state: StateDict,\n        config: Optional[RunnableConfig],\n        context: Optional[ContextPayload],\n    ) -> BeforeInvokeResult:\n        \"\"\"Hook for subclasses to mutate or replace state/config/context before execution.\"\"\"\n    \n    async def _after_run(\n        self,\n        state: StateDict,\n        config: Optional[RunnableConfig],\n        context: Optional[ContextPayload],\n        result: Optional[ResultDict] = None,\n    ) -> None:\n        \"\"\"Hook for subclasses to mutate state after the assistant graph runs.\"\"\"\n\n        self._propagate_result_payload(state, result)\n\n    def _propagate_result_payload(\n        self,\n        state: StateDict,\n        result: Optional[ResultDict],\n    ) -> None:\n        \"\"\"Ensure typed result keys mirror the agent's typed output field.\"\"\"\n\n        result_key = self.RESULT_STATE_KEY\n        if not result_key:\n            return\n\n        payload = self._extract_result_payload(state, result)\n        if payload is None:\n            return\n\n        self._assign_result_key(state, result_key, payload)\n        if isinstance(result, MutableMapping):\n            self._assign_result_key(result, result_key, payload)\n\n    def _extract_result_payload(\n        self,\n        state: StateDict,\n        result: Optional[ResultDict],\n    ) -> Any:\n        result_key = self.RESULT_STATE_KEY\n        if result_key:\n            if result_key in state:\n                return state.get(result_key)\n            if isinstance(result, Mapping):\n                payload = result.get(result_key)\n                if payload is not None:\n                    return payload\n        return None\n\n    @staticmethod\n    def _assign_result_key(\n        target: MutableMapping[str, Any],\n        key: str,\n        value: Any,\n    ) -> None:\n        target[key] = value\n\n    def update_configuration(self, configuration: ModelConfig) -> bool:\n        \"\"\"Replace the active configuration and clear caches when it changes.\"\"\"\n\n        signature = config_signature(configuration)\n        if signature == self._config_signature:\n            return False\n\n        self.configuration = configuration\n        self._config_signature = signature\n        self.reset_graph_cache()\n        return True\n\n    def reset_graph_cache(self) -> None:\n        \"\"\"Clear assistant graph + subclass caches.\"\"\"\n\n        self._assistant_graph = None\n        self.reset_cached_artifacts()\n\n    def reset_cached_artifacts(self) -> None:\n        \"\"\"Subclasses can override to drop additional cached resources.\"\"\"\n\n    def _ensure_configuration_signature(self) -> None:\n        \"\"\"Rebuild caches if configuration has been mutated externally.\"\"\"\n\n        current_signature = config_signature(self.configuration)\n        if current_signature != self._config_signature:\n            self._config_signature = current_signature\n            self.reset_graph_cache()\n\n    async def _ensure_graph(\n        self,\n    ) -> None:\n        \"\"\"Build the assistant graph lazily.\"\"\"\n\n        async with self._graph_lock:\n            self._ensure_configuration_signature()\n            if self._assistant_graph is None:\n                await self._build_graph()\n                if self._assistant_graph is None:\n                    raise RuntimeError(\n                        f\"{self.__class__.__name__}._build_graph() did not set _assistant_graph\"\n                    )\n\n    def _resolve_graph_checkpointer(self) -> Any:\n        \"\"\"Return the checkpointer used for assistant graphs (async-safe).\"\"\"\n        graph_memory = self._resolve_graph_memory_runtime(context=None)\n        return graph_memory.checkpointer\n\n    def _resolve_graph_store(self) -> Any:\n        \"\"\"Return the store used for assistant graphs (may be None).\"\"\"\n        graph_memory = self._resolve_graph_memory_runtime(context=None)\n        return graph_memory.store\n\n    def _compile_assistant_state_graph(\n        self,\n        graph: StateGraph,\n        *,\n        name: str,\n    ) -> AssistantGraph:\n        \"\"\"Compile a StateGraph with dev/prod backends resolved via base class.\n\n        - In development/tests: pass local checkpointer/store if configured.\n        - In production/platform: compile without passing backends (platform injects).\n        \"\"\"\n\n        decorated_name = self._decorate_graph_name(name)\n        # Persist the graph_id used for checkpoint metadata scoping.\n        self._assistant_graph_id = decorated_name\n        compile_kwargs: Dict[str, Any] = {\"name\": decorated_name}\n\n        store = self._resolve_graph_store()\n        if store is not None:\n            compile_kwargs[\"store\"] = store\n\n        checkpointer = self._resolve_graph_checkpointer()\n        if checkpointer is not None:\n            compile_kwargs[\"checkpointer\"] = checkpointer\n\n        try:\n            return wrap_compiled_graph(graph.compile(**compile_kwargs))\n        except TypeError:\n            # Older LangGraph versions may not accept store kwarg; retry without it.\n            compile_kwargs.pop(\"store\", None)\n            try:\n                return wrap_compiled_graph(graph.compile(**compile_kwargs))\n            except TypeError:\n                # As a last resort, compile with only the name (no backends).\n                return wrap_compiled_graph(\n                    graph.compile(name=self._decorate_graph_name(name))\n                )\n\n    async def _invoke_graph_from_checkpoint(\n        self,\n        *,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[ContextPayload],\n        durability: str = \"sync\",\n    ) -> ResultDict:\n        \"\"\"Invoke the assistant graph using checkpoint-aware semantics.\n        \n        IMPORTANT: When invoked as a node within an agent-judge workflow, the assistant\n        graph should use the parent workflow's graph_id for checkpoint lookup, not its own.\n        This ensures checkpoints written by the workflow can be found when the assistant\n        attempts to restore state.\n        \"\"\"\n\n        if self._assistant_graph is None:\n            raise RuntimeError(\"Assistant graph is not initialized\")\n\n        graph_id = self._assistant_graph_id\n        if graph_id is None:\n            fallback_name = getattr(self._assistant_graph, \"name\", f\"{self.__class__.__name__}_assistant_graph\")\n            graph_id = self._decorate_graph_name(str(fallback_name))\n            self._assistant_graph_id = graph_id\n\n        # #region agent log\n        import json\n        checkpoint_ns = \"\"\n        thread_id = \"\"\n        if config:\n            configurable = config.get(\"configurable\", {})\n            if isinstance(configurable, dict):\n                checkpoint_ns = str(configurable.get(\"checkpoint_ns\", \"\"))\n                thread_id = str(configurable.get(\"thread_id\", \"\"))\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"agent.py:607\",\"message\":\"_invoke_graph_from_checkpoint entry\",\"data\":{\"graph_id\":graph_id,\"checkpoint_ns\":checkpoint_ns,\"thread_id\":thread_id,\"step_config_key\":self.STEP_CONFIG_KEY},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        graph_memory = self._resolve_graph_memory_runtime(context=context)\n        # #region agent log\n        import json  # type: ignore[import-not-found]\n        ctx_present = context is not None\n        graph_runner = getattr(context, \"graph_runner\", None) if ctx_present else None\n        runner_graph = getattr(graph_runner, \"graph\", None) if graph_runner is not None else None\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"agent.py:620\",\"message\":\"assistant context snapshot access\",\"data\":{\"graph_id\":graph_id,\"has_context\":ctx_present,\"has_graph_runner\":graph_runner is not None,\"has_runner_graph\":runner_graph is not None},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n        # GraphMemoryRuntime now gates durability per runnable; always route invocations\n        # through `ainvoke_from_checkpoint` so AsyncPregel loops stay consistent.\n        result = await graph_memory.ainvoke_from_checkpoint(\n            graph=self._assistant_graph,\n            graph_id=graph_id,\n            graph_input=graph_input,\n            config=config,\n            context=context,\n            durability=durability,\n        )\n        \n        # #region agent log\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"agent.py:617\",\"message\":\"_invoke_graph_from_checkpoint exit\",\"data\":{\"graph_id\":graph_id,\"result_keys\":list(result.keys()) if isinstance(result,dict) else \"not_dict\"},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n        \n        return result\n\n    @abstractmethod\n    def _build_graph(\n        self,\n    ) -> None:\n        \"\"\"Subclasses must assemble and return a compiled LangGraph runnable.\"\"\"\n\n    def _setup_mcp_client(self) -> None:\n        \"\"\"Instantiate (or clear) the MCP client based on the stored config.\"\"\"\n\n        servers = self._mcp_configuration.build_servers()\n        if not servers:\n            self.mcp_client = None\n            return\n\n        self.mcp_client = MultiServerMCPClient(servers)\n\n    def _merge_runnable_overrides(\n        self, config: Optional[RunnableConfig]\n    ) -> RuntimeOverrideMap:\n        if not config:\n            return {}\n\n        configurable = config.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            return {}\n\n        merged: Dict[str, Any] = {}\n        default_overrides = configurable.get(\"default\")\n        if isinstance(default_overrides, Mapping):\n            merged.update(default_overrides)\n        step_overrides = configurable.get(self.STEP_CONFIG_KEY)\n        if isinstance(step_overrides, Mapping):\n            merged.update(step_overrides)\n        return merged\n\n    def _apply_runtime_overrides(self, config: Optional[RunnableConfig]) -> None:\n        \"\"\"Merge RunnableConfig overrides into step + MCP configurations.\"\"\"\n\n        overrides = self._merge_runnable_overrides(config)\n        if overrides:\n            updated_config = self.configuration.model_copy(update=overrides)\n            self.update_configuration(updated_config)  # type: ignore[arg-type]\n\n        if not config:\n            return\n\n        configurable: Dict[str, Dict[str, Any]] = config.get(\"configurable\", {})  # type: ignore[assignment]\n        mcp_overrides: Dict[str, Any] = configurable.get(\"mcp\", {})\n        if mcp_overrides:\n            updated_mcp = self._mcp_configuration.model_copy(update=mcp_overrides)\n            signature = config_signature(updated_mcp)\n            if signature != self._mcp_config_signature:\n                self._mcp_configuration = updated_mcp\n                self._mcp_config_signature = signature\n                self._setup_mcp_client()\n                self._owns_mcp_client = True\n\n    # Error handling helper methods\n    \n    def _get_current_model(self, component: ComponentName = \"agent\") -> str:\n        \"\"\"Get the current model identifier from configuration.\n        \n        Looks for step-specific model field first, then falls back to base_model.\n        \n        Returns:\n            Full model identifier (e.g., 'google_genai:gemini-2.5-flash')\n        \"\"\"\n        # Try step-specific model field\n        if component == \"extractor\":\n            step_model_field = f\"{self.STEP_CONFIG_KEY}_structured_output_model\"\n        else:\n            step_model_field = f\"{self.STEP_CONFIG_KEY}_base_model\"\n        model = getattr(self.configuration, step_model_field, None)\n        \n        if not model:\n            # Fall back to generic base_model\n            model = getattr(self.configuration, \"base_model\", \"\")\n        \n        return model or \"\"\n\n    def _get_current_api_key(self, component: ComponentName = \"agent\") -> str:\n        \"\"\"Get the current API key from configuration.\n        \n        Looks for step-specific API key field first, then falls back to model_base_api_key.\n        \n        Returns:\n            API key string\n        \"\"\"\n        # Try step-specific API key field\n        if component == \"extractor\":\n            step_api_key_field = f\"{self.STEP_CONFIG_KEY}_structured_output_api_key\"\n        else:\n            step_api_key_field = f\"{self.STEP_CONFIG_KEY}_model_base_api_key\"\n        api_key = getattr(self.configuration, step_api_key_field, None)\n        \n        if not api_key:\n            # Fall back to generic model_base_api_key\n            api_key = getattr(self.configuration, \"model_base_api_key\", \"\")\n        \n        return api_key or \"\"\n\n    def _with_retry(self, runnable: RetryableRunnable) -> RetryableRunnable:\n        \"\"\"Attach the configured retry policy to a fully-initialized runnable.\n\n        The callable passed here must already include any tool bindings,\n        structured output adapters, or compiled LangGraph logic to ensure\n        downstream APIs keep access to the original BaseChatModel methods.\n        \"\"\"\n\n        return apply_retry_policy(runnable, self._llm_retry_config)\n\n    def _wrap_component_node(\n        self,\n        node: RetryableRunnable | Callable[..., Any],\n        *,\n        component: ComponentName,\n    ) -> RetryableRunnable:\n        \"\"\"Wrap a callable node with retry semantics and component-aware errors.\"\"\"\n\n        if isinstance(node, Runnable):\n            base_runnable: RetryableRunnable = node\n        else:\n            def _call(\n                state: StateDict,\n                *,\n                config: Optional[RunnableConfig] = None,\n                context: Optional[ContextPayload] = None,\n                **kwargs: Any,\n            ) -> Any:\n                return node(state, config=config, context=context, **kwargs)\n\n            base_runnable = RunnableLambda(_call)\n\n        retryable = self._with_retry(base_runnable)\n\n        async def _runner(\n            state: StateDict,\n            *,\n            config: Optional[RunnableConfig] = None,\n            context: Optional[ContextPayload] = None,\n            **kwargs: Any,\n        ) -> Any:\n            try:\n                return await retryable.ainvoke(\n                    state,\n                    config=config,\n                    context=context,\n                    **kwargs,\n                )\n            except ComponentLLMError:\n                raise\n            except Exception as exc:\n                raise ComponentLLMError(component=component, original_error=exc) from exc\n\n        return RunnableLambda(_runner)\n\n    def _extract_worker_id(\n        self,\n        config: Optional[RunnableConfig] = None,\n        context: Optional[ContextPayload] = None,\n        state: Optional[StateDict] = None,\n    ) -> Optional[str]:\n        \"\"\"Extract worker identifier from config, context, or state for distributed mode isolation.\n        \n        Checks multiple sources in order:\n        1. RunnableConfig metadata (config[\"metadata\"].get(\"worker_id\"))\n        2. RunnableConfig configurable (config[\"configurable\"].get(\"worker_id\"))\n        3. Context scope if available (context.distribution_scope.get(\"batch_index\"))\n        4. State scope if available (state.get(\"distribution_scope\", {}).get(\"batch_index\"))\n        \n        Args:\n            config: Optional RunnableConfig\n            context: Optional context payload (may contain distribution scope)\n            state: Optional state dictionary (may contain distribution scope)\n            \n        Returns:\n            Worker ID string or None if not in distributed mode\n        \"\"\"\n        # Try config metadata first\n        if config:\n            metadata = config.get(\"metadata\", {})\n            if isinstance(metadata, dict):\n                worker_id = metadata.get(\"worker_id\")\n                if worker_id:\n                    return str(worker_id)\n            \n            # Try configurable section\n            configurable = config.get(\"configurable\", {})\n            if isinstance(configurable, dict):\n                worker_id = configurable.get(\"worker_id\")\n                if worker_id:\n                    return str(worker_id)\n        \n        # Try state distribution_scope first (most reliable in distribution workflows)\n        # Distribution workflows put scope in payload as \"distribution_scope\"\n        if state:\n            dist_scope = state.get(\"distribution_scope\")\n            if isinstance(dist_scope, dict):\n                batch_index = dist_scope.get(\"batch_index\")\n                if batch_index is not None:\n                    return str(batch_index)\n        \n        # Try context scope (distribution workflows sometimes pass scope here)\n        if context and hasattr(context, \"distribution_scope\"):\n            scope = getattr(context, \"distribution_scope\", None)\n            if isinstance(scope, dict):\n                batch_index = scope.get(\"batch_index\")\n                if batch_index is not None:\n                    return str(batch_index)\n        \n        return None\n\n    @staticmethod\n    def _clone_runnable_config(config: Optional[RunnableConfig]) -> RunnableConfig:\n        \"\"\"Create a shallow copy of RunnableConfig preserving nested mappings.\"\"\"\n\n        if config is None:\n            return {}\n\n        cloned: Dict[str, Any] = dict(config)\n        configurable = config.get(\"configurable\")\n        if isinstance(configurable, Mapping):\n            cloned[\"configurable\"] = dict(configurable)\n        metadata = config.get(\"metadata\")\n        if isinstance(metadata, Mapping):\n            cloned[\"metadata\"] = dict(metadata)\n        return cast(RunnableConfig, cloned)\n\n    def _ensure_long_memory_config(\n        self,\n        *,\n        config: Optional[RunnableConfig],\n    ) -> RunnableConfig:\n        \"\"\"Ensure configurable.user_id exists for long-memory namespacing.\"\"\"\n\n        from shared.config.long_memory import LongMemory\n\n        merged = self._clone_runnable_config(config)\n        configurable = merged.setdefault(\"configurable\", {})\n        if not isinstance(configurable, MutableMapping):\n            configurable = dict(configurable) if isinstance(configurable, Mapping) else {}\n            merged[\"configurable\"] = configurable\n\n        if not configurable.get(\"user_id\"):\n            configurable[\"user_id\"] = LongMemory().user_id\n\n        return merged\n\n    def _build_long_memory_tools(self) -> list[Any]:\n        \"\"\"Build LongMemory tools for ReAct-based agents.\"\"\"\n\n        from shared.tools.long_memory_tools import build_long_memory_tools\n\n        return build_long_memory_tools()\n\n    def _ensure_thread_config(\n        self,\n        *,\n        config: Optional[RunnableConfig],\n        context: Optional[ContextPayload],\n    ) -> RunnableConfig:\n        \"\"\"Ensure thread_id/checkpoint namespace exist for durable execution.\"\"\"\n\n        merged = self._clone_runnable_config(config)\n        graph_memory = self._resolve_graph_memory_runtime(context=context)\n        merged, _ = graph_memory.ensure_thread_id(merged)\n        return merged\n\n    @staticmethod\n    def _merge_state_in_place(\n        state: StateDict,\n        updates: Mapping[str, Any],\n    ) -> None:\n        \"\"\"Merge updates into the caller-owned state mapping.\n\n        This is critical for retry/fallback behavior: the LangGraph compiled graph\n        returns a *new* state mapping and does not mutate the input mapping.\n        Without merging, retries would lose accumulated messages/progress.\n        \"\"\"\n\n        for key, value in updates.items():\n            state[key] = value\n\n    def _normalize_llm_error(self, error: Exception) -> Exception:\n        \"\"\"Convert provider-specific errors into typed policy exceptions.\"\"\"\n\n        if isinstance(error, RateLimitError):\n            return error\n\n        if GoogleResourceExhausted is not None and isinstance(error, GoogleResourceExhausted):\n            retry_after = getattr(error, \"retry_after\", None)\n            return RateLimitError(\n                str(error),\n                original_error=error,\n                retry_after=retry_after,\n                provider=\"google_genai\",\n                status_code=getattr(error, \"code\", 429),\n            )\n\n        return error\n\n    def _apply_fallback_config(\n        self,\n        resolution: ResolutionResult,\n        *,\n        component: ComponentName = \"agent\",\n    ) -> None:\n        \"\"\"Apply fallback configuration from a resolution result.\n        \n        Updates the agent's configuration with the new model and API key\n        from the resolution result.\n        \n        Args:\n            resolution: ResolutionResult with new model/key info\n        \"\"\"\n        if not resolution.resolved:\n            return\n        \n        updates: Dict[str, Any] = {}\n        \n        if resolution.new_model:\n            # Get the appropriate model field name\n            step_model_field = resolution.retry_config_update.get(\n                \"step_model_field\",\n                self._default_model_field_for_component(component),\n            )\n            updates[step_model_field] = resolution.new_model\n            if component == \"agent\":\n                updates[\"base_model\"] = resolution.new_model\n        \n        if resolution.new_api_key:\n            # Get the appropriate API key field name\n            step_api_key_field = resolution.retry_config_update.get(\n                \"step_api_key_field\",\n                self._default_api_key_field_for_component(component),\n            )\n            updates[step_api_key_field] = resolution.new_api_key\n            if component == \"agent\":\n                updates[\"model_base_api_key\"] = resolution.new_api_key\n        \n        if updates:\n            logger.info(f\"Applying fallback config updates: {list(updates.keys())}\")\n            updated_config = self.configuration.model_copy(update=updates)\n            self.update_configuration(updated_config)  # type: ignore[arg-type]\n\n    def _default_model_field_for_component(self, component: ComponentName) -> str:\n        if component == \"extractor\":\n            return f\"{self.STEP_CONFIG_KEY}_structured_output_model\"\n        return f\"{self.STEP_CONFIG_KEY}_base_model\"\n\n    def _default_api_key_field_for_component(self, component: ComponentName) -> str:\n        if component == \"extractor\":\n            return f\"{self.STEP_CONFIG_KEY}_structured_output_api_key\"\n        return f\"{self.STEP_CONFIG_KEY}_model_base_api_key\"\n\n    def _get_component_fallback_config(self, component: ComponentName):\n        if component == \"extractor\":\n            return self._extractor_fallback_config\n        # Preserve legacy overrides that mutate `_fallback_config`\n        if hasattr(self, \"_fallback_config\"):\n            return self._fallback_config  # type: ignore[attr-defined]\n        return self._agent_fallback_config\n\n\n__all__ = [\n    \"ArchitecturalAgentBase\",\n    \"AssistantGraph\",\n    \"ContextPayload\",\n    \"ResultDict\",\n    \"RuntimeOverrideMap\",\n    \"StateDict\",\n    \"ErrorHandlerList\",\n]\n\n\n\n>>>\nCODE 2 \n<<<\n\nfrom __future__ import annotations\n\nimport uuid\nimport os\nfrom datetime import datetime\nfrom typing import Any, Mapping, MutableMapping, Optional, Sequence, TypeAlias, Protocol, runtime_checkable, cast\n\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom langchain.embeddings import init_embeddings\nfrom shared.project_settings import ProjectSettings\n\ntry:\n    from pydantic_core import core_schema\nexcept ImportError:\n    core_schema = None  # type: ignore\n\ntry:\n    from langgraph.store.memory import InMemoryStore  # type: ignore\nexcept Exception:  # pragma: no cover\n    InMemoryStore = None  # type: ignore\n\n_CHECKPOINTER_SYNC: Optional[Any] = None\n_CHECKPOINTER_ASYNC: Optional[Any] = None\n_STORE: Optional[Any] = None\n\nThreadId: TypeAlias = str\nGraphId: TypeAlias = str\nCheckpointId: TypeAlias = str\nStateDict: TypeAlias = MutableMapping[str, Any]\n\n\n@runtime_checkable\nclass _SupportsGraphCheckpoint(Protocol):\n    \"\"\"Minimal protocol describing compiled LangGraph runnables we inspect for durability support.\"\"\"\n\n    checkpointer: Any | None\n    _pregel: Any | None\n    app: Any | None\n    name: str\n\n\nGraphRunnableWithPregel: TypeAlias = _SupportsGraphCheckpoint\n\n\ndef _extract_graph_checkpointer(graph: Any) -> Any:\n    \"\"\"Return the checkpointer bound directly to a compiled runnable, if any.\"\"\"\n\n    if graph is None:\n        return None\n\n    candidate = getattr(graph, \"checkpointer\", None)\n    if candidate is not None:\n        return candidate\n\n    pregel = getattr(graph, \"_pregel\", None)\n    if pregel is not None:\n        inner = getattr(pregel, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    app = getattr(graph, \"app\", None)\n    if app is not None:\n        inner = getattr(app, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    loop = getattr(graph, \"_loop\", None)\n    if loop is not None:\n        inner = getattr(loop, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    return None\n\n\ndef _graph_supports_durability(graph: Any) -> bool:\n    \"\"\"Return True if the runnable was compiled with a checkpointer.\"\"\"\n\n    return _extract_graph_checkpointer(graph) is not None\n\n\ndef _resolve_local_checkpointer(graph: Any, override: Optional[Any]) -> Optional[Any]:\n    \"\"\"Prefer explicit override, otherwise inspect the runnable for a bound saver.\"\"\"\n\n    if override is not None:\n        return override\n    return _extract_graph_checkpointer(graph)\n\n\ndef resolve_graph_checkpointer(*, async_mode: bool) -> Any:\n    \"\"\"Return a checkpointer compatible with the chosen execution mode.\n\n    Important:\n    - Async LangGraph execution expects async checkpointer methods. If only a\n      sync checkpointer is available (e.g., SqliteSaver), we fall back to the\n      async-safe InMemorySaver to keep `.ainvoke()` reliable.\n    - Production deployments can replace this with an async-capable durable\n      backend (Postgres/SQLite async) without touching graph code.\n    \"\"\"\n\n    global _CHECKPOINTER_SYNC, _CHECKPOINTER_ASYNC\n    CHECKPOINTER_DATABASE_URL = os.getenv(\"CHECKPOINTER_DATABASE_URL\")\n\n    # In production, LangGraph Platform injects the checkpointer automatically.\n    # We keep local checkpointers disabled to avoid shadowing the platform backend.\n    if ProjectSettings().mode == \"production\":\n        return None\n\n\n    if async_mode:\n        if _CHECKPOINTER_ASYNC is None:\n            _CHECKPOINTER_ASYNC = InMemorySaver()\n        return _CHECKPOINTER_ASYNC\n\n    if _CHECKPOINTER_SYNC is None:\n        _CHECKPOINTER_SYNC =  InMemorySaver()\n    return _CHECKPOINTER_SYNC\n\n\ndef resolve_graph_store() -> Any:\n    \"\"\"Return a store implementation for dev/tests; None in production/platform.\n\n    In production, LangGraph Platform injects the store automatically at runtime\n    (via ToolRuntime). We keep local stores disabled to avoid shadowing the\n    platform backend.\n    \"\"\"\n\n    global _STORE\n    if ProjectSettings().mode == \"production\":\n        return None\n    if InMemoryStore is None:\n        return None\n    if _STORE is not None:\n        return _STORE\n\n    # In development/tests we prefer an in-process store. Vector indexing is optional;\n    # if embeddings cannot be initialised (missing deps/keys), fall back to a plain store.\n    try:\n        _STORE = InMemoryStore(\n            index={\n                \"embed\": init_embeddings(\"openai:text-embedding-3-small\"),\n                \"dims\": 1536,\n                \"fields\": [\"content\"],\n            }\n        )\n    except Exception:\n        _STORE = InMemoryStore(index=None)\n    return _STORE\n\n\nclass GraphMemoryRuntime:\n    \"\"\"Encapsulates durable-checkpoint + long-memory access for dev and platform production.\n\n    This class centralizes:\n    - thread_id extraction\n    - platform SDK fallback for checkpoint state/history (no local checkpointer needed)\n    - local (dev) graph/checkpointer checkpoint inspection\n    \"\"\"\n    THREAD_ID_KEY: str = \"thread_id\"\n\n    @classmethod\n    def __get_pydantic_core_schema__(\n        cls,\n        source_type: Any,\n        handler: Any,\n    ) -> Any:\n        \"\"\"Provide Pydantic schema for GraphMemoryRuntime to allow arbitrary types.\n\n        This enables GraphMemoryRuntime to be used in Pydantic models (e.g., when\n        ContextTravelGuideAgent is used as context_schema in StateGraph).\n        \n        Since GraphMemoryRuntime is a runtime helper (not meant for serialization),\n        we use any_schema() to allow it without validation.\n        \"\"\"\n        if core_schema is None:\n            # pydantic_core should always be available in this project\n            raise ImportError(\"pydantic_core is required but not available\")\n        \n        # Use any_schema() to allow GraphMemoryRuntime without validation\n        # This is appropriate since it's a runtime helper with init=False\n        return core_schema.any_schema()\n\n    def __init__(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        # These are intentionally mutable bindings:\n        # - Root graph wiring binds the single checkpointer/store once per process/run.\n        # - Nested graphs MUST reuse the bound instance via runtime context.\n        self.checkpointer: Optional[Any] = checkpointer\n        self.store: Optional[Any] = store\n\n    def bind(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        \"\"\"Bind durable backends onto this runtime helper.\n\n        Idempotent by design: does not overwrite existing non-null bindings unless\n        explicitly provided.\n        \"\"\"\n\n        if checkpointer is not None:\n            self.checkpointer = checkpointer\n        if store is not None:\n            self.store = store\n\n    def is_production_mode(self) -> bool:\n        return ProjectSettings().mode == \"production\"\n\n    def ensure_thread_id(\n        self,\n        config: Optional[RunnableConfig],\n    ) -> tuple[RunnableConfig, ThreadId]:\n        \"\"\"Ensure ``configurable.thread_id`` exists and return ``(config, thread_id)``.\n\n        Contract (required by project checkpointing rules):\n        - One thread_id should be used for the *entire* root graph run.\n        - If caller did not provide a thread_id, we generate a new one from:\n          ``user_id`` (from RunnableConfig.configurable.user_id) + UUID4 suffix.\n        - Callers must reuse the returned config to keep the thread_id stable.\n        \"\"\"\n\n        from shared.config.long_memory import LongMemory\n\n        merged: RunnableConfig = dict(config) if config else {}\n        configurable = merged.get(\"configurable\", {})\n        if not isinstance(configurable, MutableMapping):\n            configurable = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable = dict(configurable)\n\n        existing = configurable.get(self.THREAD_ID_KEY)\n        if existing:\n            thread_id: ThreadId = str(existing)\n            configurable[self.THREAD_ID_KEY] = thread_id\n            merged[\"configurable\"] = configurable\n            return merged, thread_id\n\n        long_memory = LongMemory.from_runnable_config(merged)\n        user_id = long_memory.user_id\n        if not configurable.get(\"user_id\"):\n            configurable[\"user_id\"] = user_id\n\n        thread_id = f\"user_{user_id}_{uuid.uuid4().hex}\"\n        configurable[self.THREAD_ID_KEY] = thread_id\n        merged[\"configurable\"] = configurable\n        return merged, thread_id\n\n    async def list_thread_checkpoints(\n        self,\n        *,\n        config: RunnableConfig,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> list[Any]:\n        \"\"\"Return raw checkpoint records for the given thread config.\n\n        Notes:\n        - In production (LangGraph Platform), we fall back to the SDK thread history.\n        - In dev/tests, we prefer the provided ``local_checkpointer`` (or the default dev\n          checkpointer) to list checkpoints, because it exposes metadata (`graph_id`).\n        - As a last resort, we attempt to list state snapshots via ``graph.get_state_history``.\n        \"\"\"\n\n        thread_id = self.extract_thread_id(config)\n        if not thread_id:\n            return []\n\n        if self.is_production_mode():\n            try:\n                from langgraph_sdk import get_client  # type: ignore\n            except Exception:\n                return []\n            try:\n                client = get_client()\n                history = await client.threads.get_history(thread_id)\n                return list(history)\n            except Exception:\n                return []\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if checkpointer is not None:\n            lister = getattr(checkpointer, \"list\", None)\n            if callable(lister):\n                try:\n                    return list(lister(config))\n                except Exception:\n                    return []\n\n        if local_graph is not None:\n            getter_async = getattr(local_graph, \"aget_state_history\", None)\n            if callable(getter_async):\n                try:\n                    return [snapshot async for snapshot in getter_async(config)]\n                except Exception:\n                    return []\n            getter_sync = getattr(local_graph, \"get_state_history\", None)\n            if callable(getter_sync):\n                try:\n                    return list(getter_sync(config))\n                except Exception:\n                    return []\n\n        return []\n\n    @staticmethod\n    def _extract_checkpoint_metadata(record: Any) -> Mapping[str, Any]:\n        candidate = getattr(record, \"metadata\", None)\n        if isinstance(candidate, Mapping):\n            return cast(Mapping[str, Any], candidate)\n        if isinstance(record, Mapping):\n            meta = record.get(\"metadata\")\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            meta = getattr(checkpoint, \"metadata\", None)\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        return {}\n\n    @staticmethod\n    def _extract_checkpoint_id(record: Any) -> Optional[CheckpointId]:\n        candidate = getattr(record, \"checkpoint_id\", None)\n        if candidate:\n            return str(candidate)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            inner = getattr(checkpoint, \"checkpoint_id\", None)\n            if inner:\n                return str(inner)\n            inner = getattr(checkpoint, \"id\", None)\n            if inner:\n                return str(inner)\n        if isinstance(record, Mapping):\n            candidate = record.get(\"checkpoint_id\") or record.get(\"id\")\n            if candidate:\n                return str(candidate)\n            cfg = record.get(\"config\")\n            if isinstance(cfg, Mapping):\n                conf = cfg.get(\"configurable\")\n                if isinstance(conf, Mapping):\n                    candidate = conf.get(\"checkpoint_id\")\n                    if candidate:\n                        return str(candidate)\n        cfg = getattr(record, \"config\", None)\n        if isinstance(cfg, Mapping):\n            conf = cfg.get(\"configurable\")\n            if isinstance(conf, Mapping):\n                candidate = conf.get(\"checkpoint_id\")\n                if candidate:\n                    return str(candidate)\n        return None\n\n    @staticmethod\n    def _extract_created_at(record: Any) -> Optional[datetime]:\n        candidate = getattr(record, \"created_at\", None)\n        if isinstance(candidate, datetime):\n            return candidate\n        if isinstance(record, Mapping):\n            candidate = record.get(\"created_at\")\n            if isinstance(candidate, datetime):\n                return candidate\n        return None\n\n    @classmethod\n    def _matches_graph_id(cls, record: Any, graph_id: GraphId) -> bool:\n        metadata = cls._extract_checkpoint_metadata(record)\n        candidate = metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")\n        return str(candidate) == str(graph_id) if candidate else False\n\n    @staticmethod\n    def _extract_checkpoint_ns(record: Any) -> Optional[str]:\n        def _from_config(cfg: Any) -> Optional[str]:\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n                if isinstance(configurable, Mapping):\n                    candidate = configurable.get(\"checkpoint_ns\")\n                    if candidate is not None:\n                        return str(candidate)\n            return None\n\n        cfg = getattr(record, \"config\", None)\n        ns = _from_config(cfg)\n        if ns:\n            return ns\n\n        if isinstance(record, Mapping):\n            ns = _from_config(record.get(\"config\"))\n            if ns:\n                return ns\n\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            ns = _from_config(getattr(checkpoint, \"config\", None))\n            if ns:\n                return ns\n\n        metadata = GraphMemoryRuntime._extract_checkpoint_metadata(record)\n        checkpoint_ns = metadata.get(\"checkpoint_ns\")\n        return str(checkpoint_ns) if checkpoint_ns is not None else None\n\n    @staticmethod\n    def _normalize_config_like(config_like: Any) -> Optional[RunnableConfig]:\n        if config_like is None:\n            return None\n        if isinstance(config_like, Mapping):\n            normalized = dict(config_like)\n        else:\n            normalized = None\n            for attr in (\"model_dump\", \"dict\"):\n                dumper = getattr(config_like, attr, None)\n                if callable(dumper):\n                    try:\n                        normalized = dumper()\n                        break\n                    except Exception:\n                        normalized = None\n            if normalized is None:\n                try:\n                    normalized = dict(config_like)  # type: ignore[arg-type]\n                except Exception:\n                    return None\n\n        configurable = normalized.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            configurable = dict(configurable) if configurable is not None else {}\n        normalized[\"configurable\"] = dict(configurable)\n\n        metadata = normalized.get(\"metadata\", {})\n        if not isinstance(metadata, Mapping):\n            metadata = dict(metadata) if metadata is not None else {}\n        normalized[\"metadata\"] = dict(metadata)\n        return normalized  # type: ignore[return-value]\n\n    @classmethod\n    def _extract_task_entries(cls, record: Any) -> list[Mapping[str, Any]]:\n        extracted: list[Mapping[str, Any]] = []\n        visited_snapshots: set[int] = set()\n\n        def _coerce_metadata(value: Any) -> Optional[Mapping[str, Any]]:\n            if value is None:\n                return None\n            if isinstance(value, Mapping):\n                return value\n            try:\n                return dict(value)\n            except Exception:\n                return None\n\n        def _as_sequence(value: Any) -> Optional[Sequence[Any]]:\n            if isinstance(value, Sequence) and not isinstance(value, (str, bytes)):\n                return value\n            return None\n\n        def _record_entry(config_like: Any, metadata_like: Any, state_like: Any) -> None:\n            normalized_config = cls._normalize_config_like(config_like)\n            normalized_metadata = _coerce_metadata(metadata_like)\n            entry: dict[str, Any] = {}\n            if normalized_config:\n                entry[\"config\"] = normalized_config\n            if normalized_metadata:\n                entry[\"metadata\"] = normalized_metadata\n            if state_like is not None:\n                entry[\"state\"] = state_like\n            if entry:\n                extracted.append(entry)\n\n        def _visit_snapshot(snapshot: Any) -> None:\n            if snapshot is None:\n                return\n            snapshot_id = id(snapshot)\n            if snapshot_id in visited_snapshots:\n                return\n            visited_snapshots.add(snapshot_id)\n\n            tasks = None\n            if isinstance(snapshot, Mapping):\n                tasks = _as_sequence(snapshot.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(snapshot, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        def _visit_task(task: Any) -> None:\n            if task is None:\n                return\n            if isinstance(task, Mapping):\n                _record_entry(task.get(\"config\"), task.get(\"metadata\"), task.get(\"state\"))\n                nested_tasks = _as_sequence(task.get(\"tasks\"))\n                if nested_tasks:\n                    for nested in nested_tasks:\n                        _visit_task(nested)\n                _visit_snapshot(task.get(\"state\"))\n                _visit_snapshot(task.get(\"result\"))\n                return\n\n            _record_entry(\n                getattr(task, \"config\", None),\n                getattr(task, \"metadata\", None),\n                getattr(task, \"state\", None),\n            )\n            _visit_snapshot(getattr(task, \"state\", None))\n            _visit_snapshot(getattr(task, \"result\", None))\n            nested_attr = _as_sequence(getattr(task, \"tasks\", None))\n            if nested_attr:\n                for nested in nested_attr:\n                    _visit_task(nested)\n\n        for source in (record, getattr(record, \"checkpoint\", None)):\n            if source is None:\n                continue\n            _visit_snapshot(source)\n            tasks = None\n            if isinstance(source, Mapping):\n                tasks = _as_sequence(source.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(source, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        return extracted\n\n    async def find_latest_checkpoint_id(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Return the latest checkpoint_id for ``graph_id`` within the given thread.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n\n        # #region agent log\n        import json\n        record_summaries: list[dict[str, str | None]] = []\n        for idx, record in enumerate(checkpoints[:3]):\n            metadata = self._extract_checkpoint_metadata(record)\n            cfg = getattr(record, \"config\", None)\n            configurable = None\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n            checkpoint_ns = None\n            if isinstance(configurable, Mapping):\n                checkpoint_ns = str(configurable.get(\"checkpoint_ns\"))\n            record_summaries.append(\n                {\n                    \"idx\": str(idx),\n                    \"meta_graph_id\": str(metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")),\n                    \"checkpoint_id\": self._extract_checkpoint_id(record),\n                    \"checkpoint_ns\": checkpoint_ns,\n                }\n            )\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"B\",\"location\":\"memory_manager.py:395\",\"message\":\"find_latest_checkpoint_id checkpoints listed\",\"data\":{\"graph_id\":graph_id,\"thread_id\":str(config.get(\"configurable\",{}).get(\"thread_id\",\"\")), \"count\":len(checkpoints),\"records\":record_summaries},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if not checkpoints:\n            return None\n\n        # Collect matches with their timestamps (if provided by the backend).\n        matches: list[tuple[Optional[datetime], Any]] = []\n        for record in checkpoints:\n            if self._matches_graph_id(record, graph_id):\n                matches.append((self._extract_created_at(record), record))\n\n        target_checkpoint_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_checkpoint_ns = str(candidate_ns)\n\n        if not matches and target_checkpoint_ns:\n            for record in checkpoints:\n                if self._extract_checkpoint_ns(record) == target_checkpoint_ns:\n                    matches.append((self._extract_created_at(record), record))\n\n        if not matches:\n            return None\n\n        # If the backend provides created_at, prefer the most recent by timestamp.\n        if any(created_at is not None for created_at, _ in matches):\n            matches.sort(\n                key=lambda item: item[0] or datetime.min,\n                reverse=True,\n            )\n            return self._extract_checkpoint_id(matches[0][1])\n\n        # Otherwise, rely on the backend list order. InMemorySaver and Platform history\n        # return newest-first, so the first matching record is the latest.\n        return self._extract_checkpoint_id(matches[0][1])\n\n    async def _load_checkpoint_record(\n        self,\n        *,\n        config: RunnableConfig,\n        checkpoint_id: CheckpointId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[Any]:\n        \"\"\"Return the checkpoint record with the specified ID.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n        for record in checkpoints:\n            record_id = self._extract_checkpoint_id(record)\n            if record_id == checkpoint_id:\n                return record\n        return None\n\n    @staticmethod\n    def _materialize_checkpoint_values(\n        base_values: Mapping[str, Any],\n        record: Optional[Any],\n        *,\n        graph_id: Optional[str] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Merge stored writes from the checkpoint record into snapshot values.\"\"\"\n\n        if record is None:\n            return base_values\n\n        materialized: dict[str, Any] = dict(base_values)\n\n        checkpoint_obj = getattr(record, \"checkpoint\", record)\n        writes = getattr(checkpoint_obj, \"writes\", None)\n        if writes is None and isinstance(checkpoint_obj, Mapping):\n            writes = checkpoint_obj.get(\"writes\")\n\n        summary: list[dict[str, Any]] = []\n\n        if isinstance(writes, Sequence):\n            for idx, write_entry in enumerate(writes):\n                node_name = None\n                write_payload = None\n                if isinstance(write_entry, Mapping):\n                    node_name = write_entry.get(\"node\") or write_entry.get(\"name\")\n                    candidate = write_entry.get(\"writes\") or write_entry.get(\"values\")\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n                else:\n                    node_name = getattr(write_entry, \"node\", None) or getattr(write_entry, \"name\", None)\n                    candidate = getattr(write_entry, \"writes\", None)\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n\n                if isinstance(write_payload, Mapping):\n                    for key, value in write_payload.items():\n                        materialized.setdefault(key, value)\n                    if idx < 3:\n                        summary.append(\n                            {\n                                \"node\": str(node_name),\n                                \"keys\": list(write_payload.keys()),\n                            }\n                        )\n\n        # #region agent log\n        if summary:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:324\",\n                            \"message\": \"checkpoint writes merged\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"writes\": summary,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        # #endregion\n\n        return materialized\n\n    async def _find_subgraph_resume_config(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        checkpoints: Sequence[Any],\n    ) -> Optional[tuple[RunnableConfig, Any]]:\n        target_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_ns = str(candidate_ns)\n\n        for record_idx, record in enumerate(checkpoints):\n            task_entries = self._extract_task_entries(record)\n            if not task_entries:\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:562\",\"message\":\"checkpoint missing task entries\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"parent_checkpoint_id\":self._extract_checkpoint_id(record)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n                continue\n            for task_idx, task in enumerate(task_entries[:2]):\n                task_metadata = task.get(\"metadata\")\n                normalized_metadata: Mapping[str, Any] = {}\n                if isinstance(task_metadata, Mapping):\n                    normalized_metadata = task_metadata\n                task_graph_id = normalized_metadata.get(\"graph_id\") or normalized_metadata.get(\"langgraph_graph_id\")\n\n                raw_config = task.get(\"config\")\n                normalized_config = self._normalize_config_like(raw_config)\n                if not normalized_config:\n                    continue\n                task_configurable = normalized_config.get(\"configurable\", {})\n                task_ns = None\n                if isinstance(task_configurable, Mapping):\n                    candidate = task_configurable.get(\"checkpoint_ns\")\n                    if candidate:\n                        task_ns = str(candidate)\n\n                ns_matches = target_ns and task_ns == target_ns\n                graph_matches = task_graph_id and str(task_graph_id) == str(graph_id)\n\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:581\",\"message\":\"task entry inspected\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"task_index\":task_idx,\"task_graph_id\":task_graph_id,\"task_ns\":task_ns},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n\n                if graph_matches or ns_matches:\n                    resume_state = task.get(\"state\")\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            json.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"D\",\n                                    \"location\": \"memory_manager.py:520\",\n                                    \"message\": \"subgraph resume config located\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"matched_ns\": task_ns,\n                                        \"matched_graph_id\": task_graph_id,\n                                        \"parent_checkpoint_id\": self._extract_checkpoint_id(record),\n                                        \"has_state\": resume_state is not None,\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return normalized_config, resume_state\n\n        return None\n\n    async def _get_graph_snapshot(\n        self,\n        *,\n        graph: Any,\n        cfg: RunnableConfig,\n        subgraphs: bool = False,\n    ) -> Any:\n        getter_async = getattr(graph, \"aget_state\", None)\n        params = {\"subgraphs\": True} if subgraphs else {}\n        try:\n            if callable(getter_async):\n                return await getter_async(cfg, **params)\n        except TypeError:\n            # Fallback for LangGraph versions that don't support subgraphs kwarg.\n            try:\n                return await getter_async(cfg)\n            except Exception:\n                pass\n        except Exception:\n            pass\n\n        getter_sync = getattr(graph, \"get_state\", None)\n        if callable(getter_sync):\n            try:\n                return getter_sync(cfg, **params)\n            except TypeError:\n                try:\n                    return getter_sync(cfg)\n                except Exception:\n                    return None\n            except Exception:\n                return None\n        return None\n\n    async def ainvoke_from_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str = \"sync\",\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph resuming from the latest checkpoint when available.\"\"\"\n\n        merged, _ = self.ensure_thread_id(config)\n        # SAFETY: Ignore any caller-supplied checkpoint_id.\n        #\n        # In this architecture, checkpoint selection is *graph_id-scoped* and managed\n        # exclusively by this runtime helper. Allowing external checkpoint_id values\n        # could cause cross-graph leakage within a shared thread_id.\n\n        merged_conf = merged.get(\"configurable\", {})\n        if isinstance(merged_conf, Mapping):\n            merged_conf_dict = dict(merged_conf)\n            merged_conf_dict.pop(\"checkpoint_id\", None)\n            original_ns = merged_conf_dict.get(\"checkpoint_ns\", \"\")\n            merged_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            merged[\"configurable\"] = merged_conf_dict\n            \n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"E\",\"location\":\"memory_manager.py:445\",\"message\":\"ainvoke_from_checkpoint setting checkpoint_ns\",\"data\":{\"graph_id\":graph_id,\"original_ns\":str(original_ns),\"new_ns\":str(merged_conf_dict.get(\"checkpoint_ns\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n        # Ensure the checkpoint records are scoping-friendly in LangGraph v1.\n        meta = merged.get(\"metadata\")\n        if not isinstance(meta, Mapping):\n            meta = {}\n        meta_dict = dict(meta)\n        meta_dict.setdefault(\"graph_id\", str(graph_id))\n        merged[\"metadata\"] = meta_dict\n\n        effective_local_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n\n        # #region agent log\n        import json\n        final_ns = merged.get(\"configurable\", {}).get(\"checkpoint_ns\", \"\")\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:458\",\"message\":\"ainvoke_from_checkpoint calling find_latest_checkpoint_id\",\"data\":{\"graph_id\":graph_id,\"checkpoint_ns\":str(final_ns),\"thread_id\":str(merged.get(\"configurable\",{}).get(\"thread_id\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=effective_local_checkpointer,\n            local_graph=graph,\n        )\n        checkpoint_record: Optional[Any] = None\n        subgraph_resume: Optional[tuple[RunnableConfig, Any]] = None\n        if checkpoint_id is None:\n            snapshot_sources: list[Any] = []\n\n            if context is not None:\n                runner = getattr(context, \"graph_runner\", None)\n                graph_runtime = getattr(runner, \"graph\", None)\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:711\",\"message\":\"parent context inspection\",\"data\":{\"graph_id\":graph_id,\"has_context\":True,\"has_runner\":runner is not None,\"has_graph\":graph_runtime is not None},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n                if graph_runtime is not None:\n                    try:\n                        parent_snapshot = await self._get_graph_snapshot(\n                            graph=graph_runtime,\n                            cfg=merged,\n                            subgraphs=True,\n                        )\n                        if parent_snapshot is not None:\n                            snapshot_sources.append(parent_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:715\",\"message\":\"parent snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":parent_snapshot is not None,\"has_tasks\":bool(getattr(parent_snapshot,\"tasks\",None)),\"has_next\":bool(getattr(parent_snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                    except Exception:\n                        parent_snapshot = None\n                else:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:724\",\"message\":\"parent snapshot skipped\",\"data\":{\"graph_id\":graph_id,\"reason\":\"graph_runner_missing\" if runner is None else \"graph_attr_missing\"},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:729\",\"message\":\"parent context absent\",\"data\":{\"graph_id\":graph_id},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n\n            root_graph = getattr(context, \"root_graph\", None) if context is not None else None\n            if root_graph is not None:\n                try:\n                    root_snapshot = await self._get_graph_snapshot(\n                        graph=root_graph,\n                        cfg=merged,\n                        subgraphs=True,\n                    )\n                    if root_snapshot is not None:\n                        snapshot_sources.append(root_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:738\",\"message\":\"root snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":root_snapshot is not None,\"has_tasks\":bool(getattr(root_snapshot,\"tasks\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                except Exception:\n                    root_snapshot = None\n\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=merged,\n                subgraphs=True,\n            )\n            if snapshot is not None:\n                snapshot_sources.append(snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:727\",\"message\":\"assistant snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":bool(getattr(snapshot,\"tasks\",None)),\"has_next\":bool(getattr(snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            checkpoints_snapshot = await self.list_thread_checkpoints(\n                config=merged,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n            snapshot_sources.extend(checkpoints_snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:734\",\"message\":\"thread checkpoints snapshot collected\",\"data\":{\"graph_id\":graph_id,\"count\":len(checkpoints_snapshot)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            subgraph_resume = await self._find_subgraph_resume_config(\n                config=merged,\n                graph_id=graph_id,\n                checkpoints=snapshot_sources,\n            )\n            if subgraph_resume is not None:\n                resume_config, _ = subgraph_resume\n                metadata = resume_config.get(\"metadata\", {})\n                if not isinstance(metadata, Mapping):\n                    metadata = dict(metadata) if metadata is not None else {}\n                metadata = dict(metadata)\n                metadata.setdefault(\"graph_id\", str(graph_id))\n                resume_config[\"metadata\"] = metadata  # type: ignore[index]\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:743\",\"message\":\"subgraph resume config missing\",\"data\":{\"graph_id\":graph_id,\"snapshot_sources\":len(snapshot_sources)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n        \n        # #region agent log\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:464\",\"message\":\"ainvoke_from_checkpoint checkpoint_id result\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":str(checkpoint_id) if checkpoint_id else None,\"checkpoint_ns\":str(final_ns)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if checkpoint_id:\n            checkpoint_record = await self._load_checkpoint_record(\n                config=merged,\n                checkpoint_id=checkpoint_id,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n\n            cfg: RunnableConfig = dict(merged)\n            configurable = cfg.get(\"configurable\", {})\n            configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n            configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n            configurable_dict[\"checkpoint_id\"] = checkpoint_id\n            cfg[\"configurable\"] = configurable_dict\n\n            # If the checkpoint represents an in-progress run (has pending `next`),\n            # we resume via `invoke(None, checkpoint_id=...)`. If the run is already\n            # complete (no pending next nodes), we \"restart\" from the persisted\n            # snapshot values as a fresh invocation. This is the required behavior\n            # for refinement: patch values \u2192 re-run from patched state.\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=cfg,\n                subgraphs=True,\n            )\n\n            # #region agent log\n            import json\n            snapshot_has_tasks = bool(getattr(snapshot, \"tasks\", None))\n            snapshot_next = getattr(snapshot, \"next\", None)\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"C\",\"location\":\"memory_manager.py:504\",\"message\":\"ainvoke_from_checkpoint snapshot inspection\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":checkpoint_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":snapshot_has_tasks,\"pending_next\":bool(snapshot_next)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            next_nodes = getattr(snapshot, \"next\", None)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(next_nodes, Sequence) and next_nodes:\n                return await self.ainvoke_with_durability(\n                    graph=graph,\n                    graph_input=None,\n                    config=cfg,\n                    context=context,\n                    durability=durability,\n                    local_checkpointer=effective_local_checkpointer,\n                )\n\n            # IMPORTANT:\n            # If the checkpoint is COMPLETE (no pending next nodes), we DO NOT attempt to\n            # \"restart\" the graph by invoking without checkpoint_id. In a shared thread_id\n            # architecture (multiple graphs in the same thread), dropping checkpoint_id\n            # would cause LangGraph to load the latest checkpoint for the thread+ns,\n            # which may belong to a different graph_id \u2192 cross-graph contamination.\n            #\n            # Callers that need to re-run a completed checkpoint should first \"arm\" it\n            # via `graph.update_state(..., as_node=\"__start__\")` (e.g., our refinement\n            # injection path does this), which produces a checkpoint with pending next nodes.\n            if isinstance(values, Mapping):\n                materialized_values = self._materialize_checkpoint_values(\n                    values,\n                    checkpoint_record,\n                    graph_id=str(graph_id),\n                )\n                # #region agent log\n                import json as _json_resume\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(\n                        _json_resume.dumps(\n                            {\n                                \"sessionId\": \"debug-session\",\n                                \"runId\": \"pre-fix\",\n                                \"hypothesisId\": \"J\",\n                                \"location\": \"memory_manager.py:944\",\n                                \"message\": \"returning checkpoint values\",\n                                \"data\": {\n                                    \"graph_id\": graph_id,\n                                    \"keys\": list(materialized_values.keys()),\n                                },\n                                \"timestamp\": __import__(\"time\").time() * 1000,\n                            }\n                        )\n                        + \"\\n\"\n                    )\n                # #endregion\n                return dict(materialized_values)\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=None,\n                config=cfg,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        if subgraph_resume is not None:\n            # #region agent log\n            import json\n            resume_config, resume_state = subgraph_resume\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"D\",\n                            \"location\": \"memory_manager.py:610\",\n                            \"message\": \"resuming assistant via subgraph config\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"checkpoint_ns\": resume_config.get(\"configurable\", {}).get(\"checkpoint_ns\") if isinstance(resume_config.get(\"configurable\"), Mapping) else None,\n                                \"has_state\": resume_state is not None,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n            # #endregion\n            resume_input = graph_input\n            if resume_state is not None:\n                values = getattr(resume_state, \"values\", None)\n                if isinstance(values, Mapping):\n                    resume_input = dict(values)\n                elif isinstance(resume_state, Mapping):\n                    maybe_values = resume_state.get(\"values\")\n                    if isinstance(maybe_values, Mapping):\n                        resume_input = dict(maybe_values)\n                    else:\n                        resume_input = resume_state\n                else:\n                    resume_input = resume_state\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=resume_input,\n                config=resume_config,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        # SAFETY: Never allow a caller-supplied checkpoint_id to influence execution\n        # when we are NOT explicitly resuming from a checkpoint for this graph_id.\n        #\n        # Without this, a foreign checkpoint_id (from another graph_id in the same\n        # thread) could be accidentally consumed by LangGraph, violating isolation.\n        fresh_cfg: RunnableConfig = dict(merged)\n        fresh_conf = fresh_cfg.get(\"configurable\", {})\n        if isinstance(fresh_conf, Mapping):\n            fresh_conf_dict = dict(fresh_conf)\n            fresh_conf_dict.pop(\"checkpoint_id\", None)\n            # Keep checkpoint_ns stable (LangGraph may assume the key exists).\n            fresh_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            fresh_cfg[\"configurable\"] = fresh_conf_dict\n\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=graph_input,\n            config=fresh_cfg,\n            context=context,\n            durability=durability,\n            local_checkpointer=effective_local_checkpointer,\n        )\n\n    async def append_messages_to_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        new_messages: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Append messages to the latest checkpoint for ``graph_id`` and return new checkpoint id.\n\n        This uses ``graph.update_state`` / ``graph.aupdate_state`` so reducers (e.g. `add_messages`)\n        are honored. The update is applied as a fork of the latest checkpoint for ``graph_id``.\n        \"\"\"\n\n        if not new_messages:\n            return None\n\n        merged, _ = self.ensure_thread_id(config)\n        resolved_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n        latest_checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n        \n        if not latest_checkpoint_id:\n            return None\n        \n        patch_config: RunnableConfig = dict(merged)\n        configurable = patch_config.get(\"configurable\", {})\n        configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n        configurable_dict[\"checkpoint_id\"] = latest_checkpoint_id\n        patch_config[\"configurable\"] = configurable_dict\n\n        # Ensure patched checkpoints remain discoverable by metadata scoping.\n        metadata = patch_config.get(\"metadata\")\n        if not isinstance(metadata, Mapping):\n            metadata = {}\n        metadata_dict = dict[str, Any](metadata)\n        metadata_dict.setdefault(\"graph_id\", str(graph_id))\n        patch_config[\"metadata\"] = metadata_dict\n\n\n        # Best-effort idempotency: avoid appending messages already present in the checkpoint.\n        # This is critical for durable resume where refinement planning may be replayed.\n        filtered_messages: list[Any] = list(new_messages)\n        try:\n            snapshot = None\n            getter_async = getattr(graph, \"aget_state\", None)\n            if callable(getter_async):\n                snapshot = await getter_async(patch_config)\n            if snapshot is None:\n                getter_sync = getattr(graph, \"get_state\", None)\n                if callable(getter_sync):\n                    snapshot = getter_sync(patch_config)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(values, Mapping):\n                existing = values.get(\"messages\")\n                if isinstance(existing, Sequence) and not isinstance(existing, (str, bytes)):\n                    existing_contents: set[str] = set()\n                    for message in existing:\n                        content = getattr(message, \"content\", None)\n                        if content:\n                            existing_contents.add(str(content))\n                    if existing_contents:\n                        filtered_messages = [\n                            message\n                            for message in filtered_messages\n                            if str(getattr(message, \"content\", \"\")) not in existing_contents\n                        ]\n        except Exception:\n            filtered_messages = list(new_messages)\n\n        if not filtered_messages:\n            return latest_checkpoint_id\n\n        updates: dict[str, Any] = {\"messages\": filtered_messages}\n\n        updater_async = getattr(graph, \"aupdate_state\", None)\n        updater_sync = getattr(graph, \"update_state\", None)\n        resolved_as_node = as_node or \"__start__\"\n        try:\n            if callable(updater_async):\n                await updater_async(patch_config, updates, as_node=resolved_as_node)\n            elif callable(updater_sync):\n                updater_sync(patch_config, updates, as_node=resolved_as_node)\n            else:\n                return None\n        except Exception as e:\n            return None\n\n        return await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n\n    async def inject_distribution_refinement_messages(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        requests: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Patch a graph checkpoint by appending refinement instruction messages.\n\n        Mirrors the extraction rules used by `_distribution_inject_refinement_messages`:\n        each request may carry `payload.messages` items shaped like\n        `{ \"content\": \"...\", \"metadata\": {...} }`.\n        \"\"\"\n\n        try:\n            from langchain_core.messages import HumanMessage\n        except Exception:\n            return None\n\n        injected: list[Any] = []\n        seen_contents: set[str] = set()\n        for request in requests:\n            payload = getattr(request, \"payload\", None)\n            if not isinstance(payload, Mapping):\n                payload = payload if isinstance(payload, dict) else {}\n            messages_payload = payload.get(\"messages\") or []\n            if not isinstance(messages_payload, Sequence) or isinstance(\n                messages_payload, (str, bytes)\n            ):\n                continue\n            for message in messages_payload:\n                if not isinstance(message, Mapping):\n                    continue\n                content = message.get(\"content\")\n                if not content:\n                    continue\n                content_str = str(content)\n                if content_str in seen_contents:\n                    continue\n                metadata = message.get(\"metadata\") or {}\n                additional_kwargs = dict(metadata) if isinstance(metadata, Mapping) else {}\n                injected.append(\n                    HumanMessage(content=content_str, additional_kwargs=additional_kwargs)\n                )\n                seen_contents.add(content_str)\n\n        if not injected:\n            return None\n\n        return await self.append_messages_to_checkpoint(\n            graph=graph,\n            graph_id=graph_id,\n            config=config,\n            new_messages=injected,\n            as_node=as_node,\n            local_checkpointer=local_checkpointer,\n        )\n\n    @staticmethod\n    def extract_thread_id(config: Optional[RunnableConfig]) -> Optional[ThreadId]:\n        if not config:\n            return None\n        configurable = config.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            return None\n        thread_id = configurable.get(\"thread_id\")\n        return str(thread_id) if thread_id else None\n\n    async def aget_platform_thread_state(self, *, thread_id: ThreadId) -> Optional[Any]:\n        \"\"\"Get latest persisted state from platform via LangGraph SDK (if available).\"\"\"\n\n        try:\n            from langgraph_sdk import get_client  # type: ignore\n        except Exception:\n            return None\n\n        try:\n            client = get_client()\n            return await client.threads.get_state(thread_id)\n        except Exception:\n            return None\n\n\n    async def has_persisted_checkpoint(\n        self,\n        *,\n        config: Optional[RunnableConfig],\n        local_checkpointer: Optional[Any] = None,\n    ) -> bool:\n        \"\"\"Return True if a checkpoint exists for config (platform or local).\"\"\"\n\n        if config is None:\n            return False\n\n        if self.is_production_mode():\n            thread_id = self.extract_thread_id(config)\n            if not thread_id:\n                return False\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n            values = getattr(snapshot, \"values\", None)\n            return isinstance(values, Mapping)\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if not checkpointer:\n            return False\n\n        getter_async = getattr(checkpointer, \"aget_tuple\", None)\n        try:\n            if callable(getter_async):\n                checkpoint_tuple = await getter_async(config)\n            else:\n                getter_sync = getattr(checkpointer, \"get_tuple\", None)\n                if not callable(getter_sync):\n                    return False\n                checkpoint_tuple = getter_sync(config)\n        except Exception:\n            return False\n\n        return checkpoint_tuple is not None\n\n    async def restore_state_from_latest_checkpoint(\n        self,\n        *,\n        state: StateDict,\n        config: Optional[RunnableConfig],\n        local_graph: Optional[Any],\n    ) -> bool:\n        \"\"\"Merge latest persisted state into the caller-owned `state` mapping.\"\"\"\n\n        if config is None:\n            return False\n\n        snapshot = None\n        thread_id = self.extract_thread_id(config)\n        if self.is_production_mode() and thread_id:\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n\n        if snapshot is None and local_graph is not None:\n            getter = getattr(local_graph, \"aget_state\", None)\n            if callable(getter):\n                try:\n                    snapshot = await getter(config)\n                except Exception:\n                    snapshot = None\n            if snapshot is None:\n                getter_sync = getattr(local_graph, \"get_state\", None)\n                if callable(getter_sync):\n                    try:\n                        snapshot = getter_sync(config)\n                    except Exception:\n                        snapshot = None\n\n        values = getattr(snapshot, \"values\", None)\n        if not isinstance(values, Mapping):\n            return False\n\n        for key, value in values.items():\n            state[key] = value\n        return True\n\n    async def ainvoke_with_durability(\n        self,\n        *,\n        graph: Any,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph with durability when supported.\"\"\"\n\n        # In production mode, platform may inject durability backends automatically.\n        # In dev mode, only attempt durability when the runnable itself was compiled\n        # with a checkpointer so LangGraph sets up its AsyncPregel loop correctly.\n        graph_bound_checkpointer = _extract_graph_checkpointer(graph)\n        resolved_local_checkpointer = local_checkpointer or graph_bound_checkpointer\n        checkpointer = resolved_local_checkpointer or self.checkpointer\n\n        if self.is_production_mode():\n            use_durability = durability\n        else:\n            use_durability = durability if (checkpointer and _graph_supports_durability(graph)) else None\n        try:\n            if use_durability:\n                return await graph.ainvoke(\n                    graph_input,\n                    config=config,\n                    context=context,\n                    durability=use_durability,\n                )\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n        except (TypeError, AttributeError):\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n\n\n__all__ = [\n    \"resolve_graph_checkpointer\",\n    \"resolve_graph_store\",\n    \"GraphMemoryRuntime\",\n]\n>>>\n\n\nDEBUG\n<<<\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:fec3439d-510e-beff-a6f0-8c9be9e03ac4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:759597a0\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766170526629.916}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766170526630.014}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:fec3439d-510e-beff-a6f0-8c9be9e03ac4\", \"new_ns\": \"user_preferences:fec3439d-510e-beff-a6f0-8c9be9e03ac4\"}, \"timestamp\": 1766170526630.062}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:fec3439d-510e-beff-a6f0-8c9be9e03ac4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:759597a0\"}, \"timestamp\": 1766170526630.1}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:759597a0\", \"count\": 0, \"records\": []}, \"timestamp\": 1766170526630.41}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766170526630.445}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766170526630.514}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766170526630.559}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766170526630.6}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766170526630.836}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766170526630.958}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766170526630.996}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766170526631.057}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:fec3439d-510e-beff-a6f0-8c9be9e03ac4\"}, \"timestamp\": 1766170526631.0872}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766170533192.225}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:4dc6fe18-e1f0-3397-ee32-66d494153593\", \"new_ns\": \"route_drafting:4dc6fe18-e1f0-3397-ee32-66d494153593\"}, \"timestamp\": 1766170533198.333}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:4dc6fe18-e1f0-3397-ee32-66d494153593\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:759597a0\"}, \"timestamp\": 1766170533198.413}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:759597a0\", \"count\": 0, \"records\": []}, \"timestamp\": 1766170533198.7031}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766170533198.7542}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766170533198.829}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766170533198.882}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766170533198.932}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766170533199.179}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766170533199.2332}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766170533199.323}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766170533199.369}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:4dc6fe18-e1f0-3397-ee32-66d494153593\"}, \"timestamp\": 1766170533199.41}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:4dc6fe18-e1f0-3397-ee32-66d494153593|graph:2562536e-ce4d-4f0f-4e87-d69813361acb\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:759597a0\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766170533366.771}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766170533366.9062}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:4dc6fe18-e1f0-3397-ee32-66d494153593|graph:2562536e-ce4d-4f0f-4e87-d69813361acb\", \"new_ns\": \"route_drafting:4dc6fe18-e1f0-3397-ee32-66d494153593|graph:2562536e-ce4d-4f0f-4e87-d69813361acb\"}, \"timestamp\": 1766170533366.966}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:4dc6fe18-e1f0-3397-ee32-66d494153593|graph:2562536e-ce4d-4f0f-4e87-d69813361acb\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:759597a0\"}, \"timestamp\": 1766170533367.014}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:759597a0\", \"count\": 0, \"records\": []}, \"timestamp\": 1766170533367.458}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766170533367.538}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766170533367.6182}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766170533367.869}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766170533367.9658}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766170533368.0159}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:4dc6fe18-e1f0-3397-ee32-66d494153593|graph:2562536e-ce4d-4f0f-4e87-d69813361acb\"}, \"timestamp\": 1766170533368.0918}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766170547276.332}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\", \"new_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"}, \"timestamp\": 1766170547357.675}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:759597a0\"}, \"timestamp\": 1766170547357.8171}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:759597a0\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c5-4575-6370-8002-53ae450fa6e5\", \"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"}, {\"idx\": \"1\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c5-4572-694a-8001-a898da80d872\", \"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"}]}, \"timestamp\": 1766170547363.571}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd0c5-4575-6370-8002-53ae450fa6e5\", \"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"}, \"timestamp\": 1766170547363.6658}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd0c5-4575-6370-8002-53ae450fa6e5\", \"snapshot_present\": true, \"has_tasks\": false, \"pending_next\": false}, \"timestamp\": 1766170547365.101}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\", \"new_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"}, \"timestamp\": 1766170547511.864}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:759597a0\"}, \"timestamp\": 1766170547512.034}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:759597a0\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c5-4575-6370-8002-53ae450fa6e5\", \"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"}, {\"idx\": \"1\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c5-4572-694a-8001-a898da80d872\", \"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"}]}, \"timestamp\": 1766170547514.945}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd0c5-4575-6370-8002-53ae450fa6e5\", \"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"}, \"timestamp\": 1766170547515.023}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd0c5-4575-6370-8002-53ae450fa6e5\", \"snapshot_present\": true, \"has_tasks\": false, \"pending_next\": false}, \"timestamp\": 1766170547516.413}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\", \"new_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"}, \"timestamp\": 1766170547576.546}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:759597a0\"}, \"timestamp\": 1766170547576.704}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:759597a0\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c5-4575-6370-8002-53ae450fa6e5\", \"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"}, {\"idx\": \"1\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c5-4572-694a-8001-a898da80d872\", \"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"}]}, \"timestamp\": 1766170547579.9912}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd0c5-4575-6370-8002-53ae450fa6e5\", \"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"}, \"timestamp\": 1766170547580.093}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd0c5-4575-6370-8002-53ae450fa6e5\", \"snapshot_present\": true, \"has_tasks\": false, \"pending_next\": false}, \"timestamp\": 1766170547581.498}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\", \"new_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"}, \"timestamp\": 1766170547640.0298}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:759597a0\"}, \"timestamp\": 1766170547640.18}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:759597a0\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c5-4575-6370-8002-53ae450fa6e5\", \"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"}, {\"idx\": \"1\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c5-4572-694a-8001-a898da80d872\", \"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"}]}, \"timestamp\": 1766170547643.5718}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": \"1f0dd0c5-4575-6370-8002-53ae450fa6e5\", \"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"}, \"timestamp\": 1766170547643.69}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": \"1f0dd0c5-4575-6370-8002-53ae450fa6e5\", \"snapshot_present\": true, \"has_tasks\": false, \"pending_next\": false}, \"timestamp\": 1766170547645.4822}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:fc9d1cf6-b2f5-d2c9-e681-d6a793e95840\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766170551085.081}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766170551085.251}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:fc9d1cf6-b2f5-d2c9-e681-d6a793e95840\", \"new_ns\": \"user_preferences:fc9d1cf6-b2f5-d2c9-e681-d6a793e95840\"}, \"timestamp\": 1766170551085.36}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:fc9d1cf6-b2f5-d2c9-e681-d6a793e95840\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\"}, \"timestamp\": 1766170551085.4568}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\", \"count\": 0, \"records\": []}, \"timestamp\": 1766170551085.757}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766170551085.803}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766170551085.8691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766170551085.9158}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766170551086.061}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766170551086.382}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766170551086.441}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766170551086.484}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766170551086.524}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:fc9d1cf6-b2f5-d2c9-e681-d6a793e95840\"}, \"timestamp\": 1766170551086.557}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766170559003.7273}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:c1fbb0f2-f211-3da7-f955-6861339d45bb\", \"new_ns\": \"route_drafting:c1fbb0f2-f211-3da7-f955-6861339d45bb\"}, \"timestamp\": 1766170559007.89}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:c1fbb0f2-f211-3da7-f955-6861339d45bb\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\"}, \"timestamp\": 1766170559007.96}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\", \"count\": 0, \"records\": []}, \"timestamp\": 1766170559008.237}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766170559008.28}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766170559008.343}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766170559008.395}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766170559008.449}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766170559008.713}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766170559008.759}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766170559008.8389}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766170559008.897}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:c1fbb0f2-f211-3da7-f955-6861339d45bb\"}, \"timestamp\": 1766170559008.939}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:c1fbb0f2-f211-3da7-f955-6861339d45bb|graph:057ab945-92b4-7daa-03ff-1fc1685cf984\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766170559114.819}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766170559114.957}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:c1fbb0f2-f211-3da7-f955-6861339d45bb|graph:057ab945-92b4-7daa-03ff-1fc1685cf984\", \"new_ns\": \"route_drafting:c1fbb0f2-f211-3da7-f955-6861339d45bb|graph:057ab945-92b4-7daa-03ff-1fc1685cf984\"}, \"timestamp\": 1766170559115.4539}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:c1fbb0f2-f211-3da7-f955-6861339d45bb|graph:057ab945-92b4-7daa-03ff-1fc1685cf984\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\"}, \"timestamp\": 1766170559115.5278}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\", \"count\": 0, \"records\": []}, \"timestamp\": 1766170559115.873}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766170559115.9192}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766170559116.008}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766170559116.2778}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766170559116.332}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766170559116.369}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:c1fbb0f2-f211-3da7-f955-6861339d45bb|graph:057ab945-92b4-7daa-03ff-1fc1685cf984\"}, \"timestamp\": 1766170559116.4019}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766170586103.8599}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"new_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586191.649}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\"}, \"timestamp\": 1766170586191.82}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, {\"idx\": \"1\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7bb-6924-8001-59b3abcbccf8\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}]}, \"timestamp\": 1766170586195.689}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586195.861}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"snapshot_present\": true, \"has_tasks\": false, \"pending_next\": false}, \"timestamp\": 1766170586197.341}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"new_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586257.3472}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\"}, \"timestamp\": 1766170586257.475}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, {\"idx\": \"1\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7bb-6924-8001-59b3abcbccf8\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}]}, \"timestamp\": 1766170586260.4438}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586260.579}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"snapshot_present\": true, \"has_tasks\": false, \"pending_next\": false}, \"timestamp\": 1766170586261.9883}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"new_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586320.665}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\"}, \"timestamp\": 1766170586320.801}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, {\"idx\": \"1\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7bb-6924-8001-59b3abcbccf8\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}]}, \"timestamp\": 1766170586323.878}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586323.979}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"snapshot_present\": true, \"has_tasks\": false, \"pending_next\": false}, \"timestamp\": 1766170586325.399}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"new_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586385.459}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\"}, \"timestamp\": 1766170586385.636}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, {\"idx\": \"1\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7bb-6924-8001-59b3abcbccf8\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}]}, \"timestamp\": 1766170586388.755}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586388.922}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"snapshot_present\": true, \"has_tasks\": false, \"pending_next\": false}, \"timestamp\": 1766170586390.435}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"original_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"new_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586449.0503}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\"}, \"timestamp\": 1766170586449.155}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, {\"idx\": \"1\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7bb-6924-8001-59b3abcbccf8\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}]}, \"timestamp\": 1766170586452.686}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586452.7942}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"snapshot_present\": true, \"has_tasks\": false, \"pending_next\": false}, \"timestamp\": 1766170586454.308}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"original_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"new_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586518.5989}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\"}, \"timestamp\": 1766170586518.821}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, {\"idx\": \"1\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7bb-6924-8001-59b3abcbccf8\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}]}, \"timestamp\": 1766170586522.114}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586522.208}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"snapshot_present\": true, \"has_tasks\": false, \"pending_next\": false}, \"timestamp\": 1766170586523.597}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"original_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"new_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586581.474}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\"}, \"timestamp\": 1766170586581.6052}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, {\"idx\": \"1\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7bb-6924-8001-59b3abcbccf8\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}]}, \"timestamp\": 1766170586585.1562}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586585.3499}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"snapshot_present\": true, \"has_tasks\": false, \"pending_next\": false}, \"timestamp\": 1766170586586.8389}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"original_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"new_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586647.959}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\"}, \"timestamp\": 1766170586648.074}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, {\"idx\": \"1\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7bb-6924-8001-59b3abcbccf8\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}]}, \"timestamp\": 1766170586651.1848}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586651.285}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"snapshot_present\": true, \"has_tasks\": false, \"pending_next\": false}, \"timestamp\": 1766170586652.8572}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"original_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"new_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586713.7559}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\"}, \"timestamp\": 1766170586714.005}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:df8832f7\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, {\"idx\": \"1\", \"meta_graph_id\": \"None\", \"checkpoint_id\": \"1f0dd0c6-b7bb-6924-8001-59b3abcbccf8\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}]}, \"timestamp\": 1766170586717.386}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"checkpoint_ns\": \"wide_funnel:5c7e8ff4-b4b4-7898-0fc3-e897cb16a024\"}, \"timestamp\": 1766170586717.501}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"checkpoint_id\": \"1f0dd0c6-b7be-685e-8002-8f3481bd8f78\", \"snapshot_present\": true, \"has_tasks\": false, \"pending_next\": false}, \"timestamp\": 1766170586719.067}\n>>>"
  },
  {
    "role": "assistant",
    "tool_calls": [
      {
        "type": "function",
        "id": "396bcb89-e040-440e-b038-52a033954ca0",
        "function": {
          "name": "SearchDocsByLangChain",
          "arguments": "{\"query\": \"persistence\"}"
        }
      },
      {
        "type": "function",
        "id": "6fc06406-a9c4-4de4-85cb-5dda9bcc0bd2",
        "function": {
          "name": "search_support_articles",
          "arguments": "{\"collections\": \"OSS (LangChain and LangGraph),LangSmith Deployment,Troubleshooting\"}"
        }
      }
    ],
    "id": "lc_run--019b37f9-eea0-7831-832b-166b4e6f594b",
    "content": ""
  },
  {
    "role": "tool",
    "name": "SearchDocsByLangChain",
    "tool_call_id": "396bcb89-e040-440e-b038-52a033954ca0",
    "id": "cd9382a8-80bc-4824-8ce5-b9196addcc60",
    "content": "Result 1:\nTitle: Build a multi-source knowledge base with routing\nLink: https://docs.langchain.comoss/javascript/langchain/multi-agent/router-knowledge-base\nContent: Full persistence approach\nIf you need the router itself to maintain state\u2014for example, to use previous search results in routing decisions\u2014use persistence to store message history at the router level. Stateful routers add complexity. When routing to different agents across turns, conversations may feel inconsistent if agents have different tones or prompts. Consider the handoffs pattern or subagents pattern instead\u2014both provide clearer semantics for multi-turn conversations with different agents.\n\n9. Advanced: Stateful routers\nThe router we've built so far is stateless \u2014each request is handled independently with no memory between calls. For multi-turn conversations, you need a stateful approach.\n\nTool wrapper approach\nThe simplest way to add conversation memory is to wrap the stateless router as a tool that a conversational agent can call: import { MemorySaver } from \"@langchain/langgraph\";\n\nconst searchKnowledgeBase = tool(\n  async ({ query }) => {\n    const result = await workflow.invoke({ query });\n    return result.finalAnswer;\n  },\n  {\n    name: \"search_knowledge_base\",\n    description: `Search across multiple knowledge sources (GitHub, Notion, Slack).\nUse this to find information about code, documentation, or team discussions.`,\n    schema: z.object({\n      query: z.string().describe(\"The search query\"),\n    }),\n  }\n);\n\nconst conversationalAgent = createAgent({\n  model: llm,\n  tools: [searchKnowledgeBase],\n  systemPrompt: `\nYou are a helpful assistant that answers questions about our organization.\nUse the search_knowledge_base tool to find information across our code,\ndocumentation, and team discussions.\n  `.trim(),\n  checkpointer: new MemorySaver(),\n});\n\n---\n\nResult 2:\nTitle: Build a multi-source knowledge base with routing\nLink: https://docs.langchain.comoss/python/langchain/multi-agent/router-knowledge-base\nContent: Full persistence approach\nIf you need the router itself to maintain state\u2014for example, to use previous search results in routing decisions\u2014use persistence to store message history at the router level. Stateful routers add complexity. When routing to different agents across turns, conversations may feel inconsistent if agents have different tones or prompts. Consider the handoffs pattern or subagents pattern instead\u2014both provide clearer semantics for multi-turn conversations with different agents.\n\n9. Advanced: Stateful routers\nThe router we've built so far is stateless \u2014each request is handled independently with no memory between calls. For multi-turn conversations, you need a stateful approach.\n\nTool wrapper approach\nThe simplest way to add conversation memory is to wrap the stateless router as a tool that a conversational agent can call: from langgraph.checkpoint.memory import InMemorySaver\n\n\n@tool\ndef search_knowledge_base(query: str) -> str:\n    \"\"\"Search across multiple knowledge sources (GitHub, Notion, Slack).\n\n    Use this to find information about code, documentation, or team discussions.\n    \"\"\"\n    result = workflow.invoke({\"query\": query})\n    return result[\"final_answer\"]\n\n\nconversational_agent = create_agent(\n    model,\n    tools=[search_knowledge_base],\n    system_prompt=(\n        \"You are a helpful assistant that answers questions about our organization. \"\n        \"Use the search_knowledge_base tool to find information across our code, \"\n        \"documentation, and team discussions.\"\n    ),\n    checkpointer=InMemorySaver(),\n)\n\n---\n\nResult 3:\nTitle: Persistence\nLink: https://docs.langchain.comoss/python/langgraph/persistence\nContent: Persistence\nPersistence\nLangGraph has a built-in persistence layer, implemented through checkpointers. When you compile a graph with a checkpointer, the checkpointer saves a checkpoint of the graph state at every super-step. Those checkpoints are saved to a thread , which can be accessed after graph execution. Because threads allow access to graph's state after execution, several powerful capabilities including human-in-the-loop, memory, time travel, and fault-tolerance are all possible. Below, we'll discuss each of these concepts in more detail. Agent Server handles checkpointing automatically When using the Agent Server , you don't need to implement or configure checkpointers manually. The server handles all persistence infrastructure for you behind the scenes.\n\nPersistence\nLangGraph has a built-in persistence layer, implemented through checkpointers. When you compile a graph with a checkpointer, the checkpointer saves a checkpoint of the graph state at every super-step. Those checkpoints are saved to a thread , which can be accessed after graph execution. Because threads allow access to graph's state after execution, several powerful capabilities including human-in-the-loop, memory, time travel, and fault-tolerance are all possible. Below, we'll discuss each of these concepts in more detail. Agent Server handles checkpointing automatically When using the Agent Server , you don't need to implement or configure checkpointers manually. The server handles all persistence infrastructure for you behind the scenes.\n\nMemory Store\nA state schema specifies a set of keys that are populated as a graph is executed. As discussed above, state can be written by a checkpointer to a thread at each graph step, enabling state persistence. But, what if we want to retain some information across threads ? Consider the case of a chatbot where we want to retain specific information about the user across all chat conversations (e.g., threads) with that user! With checkpointers alone, we cannot share information across threads. This motivates the need for the Store interface. As an illustration, we can define an InMemoryStore to store information about a user across threads. We simply compile our graph with a checkpointer, as before, and with our new in_memory_store variable. LangGraph API handles stores automatically When using the LangGraph API, you don't need to implement or configure stores manually. The API handles all storage infrastructure for you behind the scenes.\n"
  },
  {
    "role": "tool",
    "name": "search_support_articles",
    "tool_call_id": "6fc06406-a9c4-4de4-85cb-5dda9bcc0bd2",
    "id": "2d6bdd7b-2eee-405f-a7b4-733637e30b22",
    "content": "{\n  \"collections\": \"OSS (LangChain and LangGraph),LangSmith Deployment,Troubleshooting\",\n  \"total\": 15,\n  \"articles\": [\n    {\n      \"id\": \"bb651320-775e-4dfa-a054-c955cc3a0d5d\",\n      \"title\": \"Why Do Pydantic\\u00a0date\\u00a0Fields Fail in LangGraph State?\",\n      \"url\": \"https://support.langchain.com/articles/7196116702-why-do-pydantic-date-fields-fail-in-langgraph-state\",\n      \"collection\": \"OSS (LangChain and LangGraph)\"\n    },\n    {\n      \"id\": \"ae959c68-a996-4426-8c8e-ef3fa1dd88cc\",\n      \"title\": \"How do I connect JIRA, Slack, and Confluence MCPs with LangChain?\",\n      \"url\": \"https://support.langchain.com/articles/3473375007-how-do-i-connect-jira-slack-and-confluence-mcps-with-langchain\",\n      \"collection\": \"OSS (LangChain and LangGraph)\"\n    },\n    {\n      \"id\": \"9e06b53a-7b85-4793-b7b6-e179c0c8d815\",\n      \"title\": \"Isolating Subgraph State When Calling Graphs from Tools\",\n      \"url\": \"https://support.langchain.com/articles/6131002418-isolating-subgraph-state-when-calling-graphs-from-tools\",\n      \"collection\": \"OSS (LangChain and LangGraph)\"\n    },\n    {\n      \"id\": \"61f0452e-5198-4524-9c94-a9cf476ea5bc\",\n      \"title\": \"How to Create a Locked-Down Deployment with Restricted Access\",\n      \"url\": \"https://support.langchain.com/articles/5382256129-how-to-create-a-locked-down-deployment-with-restricted-access\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"365a0d3f-d784-407d-b741-fe51fa8356d4\",\n      \"title\": \"LangSmith Deployments not working with Valkey\",\n      \"url\": \"https://support.langchain.com/articles/2265174426-why-are-my-langgraph-requests-hanging-when-using-aws-elasticache-with-valkey\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"55a2c6fe-adf8-4b55-bcb9-969b465241b7\",\n      \"title\": \"Why are my agent threads getting deleted automatically?\",\n      \"url\": \"https://support.langchain.com/articles/7993792111-why-are-my-threads-being-marked-as-temporary-and-getting-deleted-automatically\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"5f2572a3-9086-4d92-8d15-69f7b8e4c8be\",\n      \"title\": \"MCP Server Runtime in Google Colab / Jupyter Notebook\",\n      \"url\": \"https://support.langchain.com/articles/1061688976-mcp-server-runtime-in-google-colab-jupyter-notebook\",\n      \"collection\": \"OSS (LangChain and LangGraph)\"\n    },\n    {\n      \"id\": \"3cec875c-3c8d-4951-b83b-0ac5b8ba7c7c\",\n      \"title\": \"LangSmith Deployments agent is running, but the UI shows it as \\u201cUnsuccessful\\u201d\",\n      \"url\": \"https://support.langchain.com/articles/8394994213-langsmith-deployments-agent-is-running-but-the-ui-shows-it-as-unsuccessful\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"b740be98-677d-486f-ba77-12258712f70a\",\n      \"title\": \"How do I use the LangSmith Control Plane API to manage deployments?\",\n      \"url\": \"https://support.langchain.com/articles/8184800662-how-do-i-use-the-langgraph-platform-control-plane-api-to-manage-deployments\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"52d389ff-3918-46a8-9ccf-55fe972077bf\",\n      \"title\": \"Why is my LangSmith agent queue Deployment timing out after 600 seconds?\",\n      \"url\": \"https://support.langchain.com/articles/7898522976-why-is-my-queue-deployment-timing-out-after-600-seconds\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"c6c77d41-4376-4452-b7a0-fd42c1428242\",\n      \"title\": \"How do I deploy an MCP server on LangSmith Deployments with my agent?\",\n      \"url\": \"https://support.langchain.com/articles/8743137454-how-do-i-deploy-an-mcp-server-on-langsmith-deployments-with-my-agent\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"ebea1a08-4488-4cac-9c65-75442f3de254\",\n      \"title\": \"Adding FastAPI dependency for custom middleware in LangGraph Platform\",\n      \"url\": \"https://support.langchain.com/articles/7593416758-adding-fastapi-dependency-for-custom-middleware-in-langgraph-platform\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"d37491ce-7f3c-4575-91d5-09c62129248e\",\n      \"title\": \"How do I resolve ChatGoogleGenerativeAI blocking errors in LangGraph?\",\n      \"url\": \"https://support.langchain.com/articles/8574277609-how-do-i-resolve-chatgooglegenerativeai-blocking-errors-in-langgraph\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"0b6ce386-e341-47a1-8be9-ae350de16843\",\n      \"title\": \"How do I resolve ChatGoogleGenerativeAI blocking errors in LangGraph?\",\n      \"url\": \"https://support.langchain.com/articles/3873263156-how-do-i-resolve-chatgooglegenerativeai-blocking-errors-in-langgraph\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"f7dc0a0c-fa3f-4319-b820-ae470d89877f\",\n      \"title\": \"Why is token-by-token streaming not working after upgrading LangGraph?\",\n      \"url\": \"https://support.langchain.com/articles/7150806184-why-is-token-by-token-streaming-not-working-after-upgrading-langgraph\",\n      \"collection\": \"LangSmith Deployment\"\n    }\n  ],\n  \"note\": \"All articles listed are public and have content. Use IDs to fetch full content.\"\n}"
  },
  {
    "role": "assistant",
    "tool_calls": [
      {
        "type": "function",
        "id": "2dbbdcb1-28c1-4648-b7a8-4240600abadf",
        "function": {
          "name": "get_article_content",
          "arguments": "{\"article_id\": \"9e06b53a-7b85-4793-b7b6-e179c0c8d815\"}"
        }
      }
    ],
    "id": "lc_run--019b37fa-21c9-7c00-8e44-3f27365ffa77",
    "content": ""
  },
  {
    "role": "tool",
    "name": "get_article_content",
    "tool_call_id": "2dbbdcb1-28c1-4648-b7a8-4240600abadf",
    "id": "7cff9d05-83a9-416c-a560-beb691b5dc26",
    "content": "ID: 9e06b53a-7b85-4793-b7b6-e179c0c8d815\nTitle: Isolating Subgraph State When Calling Graphs from Tools\nURL: https://support.langchain.com/articles/6131002418-isolating-subgraph-state-when-calling-graphs-from-tools\nCollection: Customer Support Knowledge Base\n\nContent:\n<h2 style=\"padding-left: 0px!important;\" level=\"2\" id=\"\">Problem</h2><p style=\"padding-left: 0px!important;\">When Graph A calls Graph B from a tool, their states get merged if they share the same checkpointer and thread_id.</p><h2 style=\"padding-left: 0px!important;\" level=\"2\" id=\"\">Solution</h2><p style=\"padding-left: 0px!important;\">Give each graph its own checkpointer instance. This allows them to share the same thread_id (conversation_id) while keeping states isolated.</p><div data-active-tab=\"0\" data-show-line-numbers=\"false\" data-tabs-enabled=\"false\" data-type=\"code-block-group\"><pre data-language=\"python\"><code class=\"language-python\">from typing import Annotated\nfrom langchain_core.messages import AIMessage, HumanMessage\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.tools import tool\nfrom langgraph.checkpoint.memory import MemorySaver\nfrom langgraph.graph import StateGraph\nfrom langgraph.graph.message import add_messages\nfrom langgraph.prebuilt import create_react_agent\nfrom langchain_anthropic import ChatAnthropic\nfrom dotenv import load_dotenv\nfrom typing_extensions import TypedDict\n\nload_dotenv()\n\n# === Graph B (subagent) ===\nclass GraphBState(TypedDict):\n    messages: Annotated[list, add_messages]\n\ndef graph_b_node(state: GraphBState):\n    return {\"messages\": [AIMessage(content=\"[GRAPH_B] Response\")]}\n\ncheckpointer_b = MemorySaver()  # Own checkpointer\ngraph_b = StateGraph(GraphBState)\ngraph_b.add_node(\"node\", graph_b_node)\ngraph_b.set_entry_point(\"node\")\ngraph_b.set_finish_point(\"node\")\ngraph_b = graph_b.compile(checkpointer=checkpointer_b)\n\n\n# === Tool that calls Graph B ===\n@tool\ndef call_graph_b(query: str, config: RunnableConfig) -&gt; str:\n    \"\"\"Call Graph B subagent.\"\"\"\n    thread_id = config.get(\"configurable\", {}).get(\"thread_id\")\n    result = graph_b.invoke(\n        {\"messages\": [HumanMessage(content=query)]},\n        {\"configurable\": {\"thread_id\": thread_id}}\n    )\n    return f\"Done\"\n\n\n# === Graph A (parent agent) ===\ncheckpointer_a = MemorySaver()  # Own checkpointer\nagent = create_react_agent(\n    model=ChatAnthropic(model=\"claude-sonnet-4-20250514\"),\n    tools=[call_graph_b],\n    checkpointer=checkpointer_a,\n)\n\n\n# === Run ===\nthread_id = \"conv_12345\"\nconfig = {\"configurable\": {\"thread_id\": thread_id}}\n\nagent.invoke({\"messages\": [HumanMessage(content=\"call graph_b with 'hello'\")]}, config)\n\ngraph_a_state = agent.get_state(config)\ngraph_b_state = graph_b.get_state({\"configurable\": {\"thread_id\": thread_id}})\n\nprint(f\"Graph A thread_id: {graph_a_state.config['configurable']['thread_id']}\")\nprint(f\"Graph B thread_id: {graph_b_state.config['configurable']['thread_id']}\")\nprint()\nprint(f\"Graph A messages: {len(graph_a_state.values['messages'])}\")\nprint(f\"Graph B messages: {len(graph_b_state.values['messages'])}\")\nprint()\nprint(f\"States isolated: {not any('[GRAPH_B]' in str(m.content) for m in graph_a_state.values['messages'])}\")\n</code></pre></div><p style=\"padding-left: 0px!important;\"></p>"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b37fa-29f6-7eb2-9e8f-31d9888e376e",
    "content": "**\u041f\u0440\u0438\u0447\u0438\u043d\u0430 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b \u2014 \u043d\u0430\u0440\u0443\u0448\u0435\u043d\u0438\u0435 \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u0438 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439 (State Contamination) \u043c\u0435\u0436\u0434\u0443 \u0432\u043e\u0440\u043a\u0435\u0440\u0430\u043c\u0438 \u0432 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c \u0440\u0430\u0431\u043e\u0447\u0435\u043c \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0435 `wide_funnel`.**\n\n\u0410\u043d\u0430\u043b\u0438\u0437 \u043b\u043e\u0433\u043e\u0432 \u0438 \u043a\u043e\u0434\u0430 \u0432\u044b\u044f\u0432\u0438\u043b, \u0447\u0442\u043e \u0432\u043e\u0440\u043a\u0435\u0440\u044b \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u0439 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, `worker=1`, `worker=2` \u0438 \u0442.\u0434.) \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442 \u043e\u0434\u0438\u043d \u0438 \u0442\u043e\u0442 \u0436\u0435 `thread_id` \u0438 `checkpoint_ns`, \u043d\u043e \u043f\u0440\u0438 \u044d\u0442\u043e\u043c \u0432 \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0445 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u043e\u0432 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u0433\u0440\u0430\u0444\u0430 (`graph_id`).\n\n### \u041c\u0435\u0445\u0430\u043d\u0438\u0437\u043c \u0432\u043e\u0437\u043d\u0438\u043a\u043d\u043e\u0432\u0435\u043d\u0438\u044f \u043e\u0448\u0438\u0431\u043a\u0438:\n\n1.  **\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435 `graph_id` \u0432 \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0445:** \u0412 \u043b\u043e\u0433\u0430\u0445 \u0434\u043b\u044f \u0448\u0430\u0433\u0430 `wide_funnel` \u0432\u0438\u0434\u043d\u043e, \u0447\u0442\u043e \u0437\u0430\u043f\u0438\u0441\u0438 \u0438\u043c\u0435\u044e\u0442 `\"meta_graph_id\": \"None\"`. \u042d\u0442\u043e \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e \u043f\u0440\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0438 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0432\u043e\u0440\u043a\u0435\u0440\u0430 \u043d\u0435 \u043f\u043e\u043f\u0430\u043b \u0432 \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430.\n2.  **\u041e\u043f\u0430\u0441\u043d\u044b\u0439 Fallback \u0432 `find_latest_checkpoint_id`:** \u041c\u0435\u0442\u043e\u0434 `find_latest_checkpoint_id` \u0432 `memory_manager.py` \u0441\u043d\u0430\u0447\u0430\u043b\u0430 \u0438\u0449\u0435\u0442 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435 \u043f\u043e `graph_id`. \u0415\u0441\u043b\u0438 \u043e\u043d\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e (\u043a\u0430\u043a \u0432 \u043d\u0430\u0448\u0435\u043c \u0441\u043b\u0443\u0447\u0430\u0435), \u043e\u043d \u043e\u0442\u043a\u0430\u0442\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043a \u043f\u043e\u0438\u0441\u043a\u0443 \u043f\u043e `checkpoint_ns`:\n    ```python\n    if not matches and target_checkpoint_ns:\n        for record in checkpoints:\n            if self._extract_checkpoint_ns(record) == target_checkpoint_ns:\n                matches.append(...)\n    ```\n3.  **\u041a\u043e\u043b\u043b\u0438\u0437\u0438\u044f \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439:** \u041f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u0432\u0441\u0435 \u0432\u043e\u0440\u043a\u0435\u0440\u044b \u0448\u0430\u0433\u0430 `wide_funnel` \u0434\u0435\u043b\u044f\u0442 \u043e\u0434\u043d\u043e \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e \u0438\u043c\u0435\u043d (`wide_funnel:d5cf9adc...`), \u043a\u0430\u0436\u0434\u044b\u0439 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0432\u043e\u0440\u043a\u0435\u0440 \u043d\u0430\u0445\u043e\u0434\u0438\u0442 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0433\u043e \u0432\u043e\u0440\u043a\u0435\u0440\u0430 \u043a\u0430\u043a \u00ab\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0430\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0439\u00bb \u0438 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442 \u0435\u0433\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0432\u043c\u0435\u0441\u0442\u043e \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u043d\u0430\u0447\u0430\u0442\u044c \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0437\u0430\u043d\u043e\u0432\u043e \u0438\u043b\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u0432\u043e\u044e \u0432\u0435\u0442\u043a\u0443.\n\n\u042d\u0442\u043e \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442\u0441\u044f \u0442\u0435\u043c, \u0447\u0442\u043e \u0432 \u043b\u043e\u0433\u0430\u0445 `worker=1`, `worker=2` \u0438 `worker=3` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044e\u0442 \u043e\u0434\u0438\u043d \u0438 \u0442\u043e\u0442 \u0436\u0435 `checkpoint_id`: `1f0dd0c5-4575-6370-8002-53ae450fa6e5`.\n\n### \u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u043e\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435:\n\n\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0442\u044c \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c `checkpoint_ns` \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0432\u043e\u0440\u043a\u0435\u0440\u0430 \u0438\u043b\u0438 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c `graph_id` \u0432 \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u0438 \u043a\u043e\u043c\u043f\u0438\u043b\u044f\u0446\u0438\u0438. \u0421\u0430\u043c\u044b\u0439 \u043d\u0430\u0434\u0435\u0436\u043d\u044b\u0439 \u0441\u043f\u043e\u0441\u043e\u0431 \u2014 \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u044c `worker_id` \u0432 \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0438\u043c\u0435\u043d \u0432 `ArchitecturalAgentBase`:\n\n```python\ndef _decorate_graph_name(self, base_name: str) -> str:\n    # \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 worker_id \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 namespace \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0432\u043e\u0440\u043a\u0435\u0440\u0430\n    identity = GraphIdentity(\n        base_name=str(base_name),\n        step_key=self.STEP_CONFIG_KEY,\n        worker_id=self._graph_instance_worker_id, # \u0414\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0443\u043d\u0438\u043a\u0430\u043b\u0435\u043d \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u0432\u0435\u0442\u043a\u0438\n    )\n    return identity.get_name()\n```\n\n\u0422\u0430\u043a\u0436\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435, \u0447\u0442\u043e \u043f\u0440\u0438 \u0432\u044b\u0437\u043e\u0432\u0435 `graph.compile()` \u0432 `_compile_assistant_state_graph` \u043f\u0435\u0440\u0435\u0434\u0430\u044e\u0442\u0441\u044f \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0435 \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 LangGraph \u0441\u043c\u043e\u0436\u0435\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c.\n\n**Relevant docs:**\n\n- [Persistence in LangGraph](https://docs.langchain.com/oss/python/langgraph/persistence)\n- [Isolating Subgraph State](https://support.langchain.com/articles/6131002418-isolating-subgraph-state-when-calling-graphs-from-tools)"
  },
  {
    "role": "user",
    "id": "896d71de-d5ec-4f6e-97b2-3e1424336e2c",
    "content": "\u0423\u0432\u0435\u0440\u0435\u043d ? "
  },
  {
    "role": "assistant",
    "tool_calls": [
      {
        "type": "function",
        "id": "ab821cf6-2754-4c17-9812-1d3c80718138",
        "function": {
          "name": "SearchDocsByLangChain",
          "arguments": "{\"query\": \"subgraphs\"}"
        }
      },
      {
        "type": "function",
        "id": "b71bf9cf-a48b-4629-8462-8d9336dc565e",
        "function": {
          "name": "SearchDocsByLangChain",
          "arguments": "{\"query\": \"checkpointing\"}"
        }
      }
    ],
    "id": "lc_run--019b37fa-da47-7652-bbac-f3f4d06ce3ca",
    "content": ""
  },
  {
    "role": "tool",
    "name": "SearchDocsByLangChain",
    "tool_call_id": "ab821cf6-2754-4c17-9812-1d3c80718138",
    "id": "af6ad920-4c9a-470c-9b28-81c8fae64989",
    "content": "Result 1:\nTitle: Subgraphs\nLink: https://docs.langchain.comoss/javascript/langgraph/use-subgraphs\nContent: This guide explains the mechanics of using subgraphs. A subgraph is a [graph](/oss/javascript/langgraph/graph-api#graphs) that is used as a [node](/oss/javascript/langgraph/graph-api#nodes) in another graph.\n\nSubgraphs are useful for:\n\n* Building [multi-agent systems](/oss/javascript/langchain/multi-agent)\n* Re-using a set of nodes in multiple graphs\n* Distributing development: when you want different teams to work on different parts of the graph independently, you can define each part as a subgraph, and as long as the subgraph interface (the input and output schemas) is respected, the parent graph can be built without knowing any details of the subgraph\n\nWhen adding subgraphs, you need to define how the parent graph and the subgraph communicate:\n\n* [Invoke a graph from a node](#invoke-a-graph-from-a-node) \u2014 subgraphs are called from inside a node in the parent graph\n* [Add a graph as a node](#add-a-graph-as-a-node) \u2014 a subgraph is added directly as a node in the parent and **shares [state keys](/oss/javascript/langgraph/graph-api#state)** with the parent\n\n## Setup\n\n```bash  theme={null}\nnpm install @langchain/langgraph\n```\n\n<Tip>\n  **Set up LangSmith for LangGraph development**\n  Sign up for [LangSmith](https://smith.langchain.com) to quickly spot issues and improve the performance of your LangGraph projects. LangSmith lets you use trace data to debug, test, and monitor your LLM apps built with LangGraph \u2014 read more about how to get started [here](https://docs.smith.langchain.com).\n</Tip>\n\n## Invoke a graph from a node\n\nA simple way to implement a subgraph is to invoke a graph from inside the node of another graph. In this case subgraphs can have **completely different schemas** from the parent graph (no shared keys). For example, you might want to keep a private message history for each of the agents in a [multi-agent](/oss/javascript/langchain/multi-agent) system.\n\nIf that's the case for your application, you need to define a node **function that invokes the subgraph**. This function needs to transform the input (parent) state to the subgraph state before invoking the subgraph, and transform the results back to the parent state before returning the state update from the node.\n\n```typescript  theme={null}\nimport { StateGraph, START } from \"@langchain/langgraph\";\nimport * as z from \"zod\";\n\nconst SubgraphState = z.object({\n  bar: z.string(),\n});\n\n// Subgraph\nconst subgraphBuilder = new StateGraph(SubgraphState)\n  .addNode(\"subgraphNode1\", (state) => {\n    return { bar: \"hi! \" + state.bar };\n  })\n  .addEdge(START, \"subgraphNode1\");\n\nconst subgraph = subgraphBuilder.compile();\n\n// Parent graph\nconst State = z.object({\n  foo: z.string(),\n});\n\n// Transform the state to the subgraph state and back\nconst builder = new StateGraph(State)\n  .addNode(\"node1\", async (state) => {\n    const subgraphOutput = await subgraph.invoke({ bar: state.foo });\n    return { foo: subgraphOutput.bar };\n  })\n  .addEdge(START, \"node1\");\n\nconst graph = builder.compile();\n```\n\n<Accordion title=\"Full example: different state schemas\">\n  ```typescript  theme={null}\n  import { StateGraph, START } from \"@langchain/langgraph\";\n  import * as z from \"zod\";\n\n  // Define subgraph\n  const SubgraphState = z.object({\n    // note that none of these keys are shared with the parent graph state\n    bar: z.string(),\n    baz: z.string(),\n  });\n\n  const subgraphBuilder = new StateGraph(SubgraphState)\n    .addNode(\"subgraphNode1\", (state) => {\n      return { baz: \"baz\" };\n    })\n    .addNode(\"subgraphNode2\", (state) => {\n      return { bar: state.bar + state.baz };\n    })\n    .addEdge(START, \"subgraphNode1\")\n    .addEdge(\"subgraphNode1\", \"subgraphNode2\");\n\n  const subgraph = subgraphBuilder.compile();\n\n  // Define parent graph\n  const ParentState = z.object({\n    foo: z.string(),\n  });\n\n  const builder = new StateGraph(ParentState)\n    .addNode(\"node1\", (state) => {\n      return { foo: \"hi! \" + state.foo };\n    })\n    .addNode(\"node2\", async (state) => {\n      const response = await subgraph.invoke({ bar: state.foo });   // [!code highlight]\n      return { foo: response.bar };   // [!code highlight]\n    })\n    .addEdge(START, \"node1\")\n    .addEdge(\"node1\", \"node2\");\n\n  const graph = builder.compile();\n\n  for await (const chunk of await graph.stream(\n    { foo: \"foo\" },\n    { subgraphs: true }\n  )) {\n    console.log(chunk);\n  }\n  ```\n\n  1. Transform the state to the subgraph state\n  2. Transform response back to the parent state\n\n  ```\n  [[], { node1: { foo: 'hi! foo' } }]\n  [['node2:9c36dd0f-151a-cb42-cbad-fa2f851f9ab7'], { subgraphNode1: { baz: 'baz' } }]\n  [['node2:9c36dd0f-151a-cb42-cbad-fa2f851f9ab7'], { subgraphNode2: { bar: 'hi! foobaz' } }]\n  [[], { node2: { foo: 'hi! foobaz' } }]\n  ```\n</Accordion>\n\n<Accordion title=\"Full example: different state schemas (two levels of subgraphs)\">\n  This is an example with two levels of subgraphs: parent -> child -> grandchild.\n\n  ```typescript  theme={null}\n  import { StateGraph, START, END } from \"@langchain/langgraph\";\n  import * as z from \"zod\";\n\n  // Grandchild graph\n  const GrandChildState = z.object({\n    myGrandchildKey: z.string(),\n  });\n\n  const grandchild = new StateGraph(GrandChildState)\n    .addNode(\"grandchild1\", (state) => {\n      // NOTE: child or parent keys will not be accessible here\n      return { myGrandchildKey: state.myGrandchildKey + \", how are you\" };\n    })\n    .addEdge(START, \"grandchild1\")\n    .addEdge(\"grandchild1\", END);\n\n  const grandchildGraph = grandchild.compile();\n\n  // Child graph\n  const ChildState = z.object({\n    myChildKey: z.string(),\n  });\n\n  const child = new StateGraph(ChildState)\n    .addNode(\"child1\", async (state) => {\n      // NOTE: parent or grandchild keys won't be accessible here\n      const grandchildGraphInput = { myGrandchildKey: state.myChildKey };   // [!code highlight]\n      const grandchildGraphOutput = await grandchildGraph.invoke(grandchildGraphInput);\n      return { myChildKey: grandchildGraphOutput.myGrandchildKey + \" today?\" };   // [!code highlight]\n    })   // [!code highlight]\n    .addEdge(START, \"child1\")\n    .addEdge(\"child1\", END);\n\n  const childGraph = child.compile();\n\n  // Parent graph\n  const ParentState = z.object({\n    myKey: z.string(),\n  });\n\n  const parent = new StateGraph(ParentState)\n    .addNode(\"parent1\", (state) => {\n      // NOTE: child or grandchild keys won't be accessible here\n      return { myKey: \"hi \" + state.myKey };\n    })\n    .addNode(\"child\", async (state) => {\n      const childGraphInput = { myChildKey: state.myKey };   // [!code highlight]\n      const childGraphOutput = await childGraph.invoke(childGraphInput);\n      return { myKey: childGraphOutput.myChildKey };   // [!code highlight]\n    })   // [!code highlight]\n    .addNode(\"parent2\", (state) => {\n      return { myKey: state.myKey + \" bye!\" };\n    })\n    .addEdge(START, \"parent1\")\n    .addEdge(\"parent1\", \"child\")\n    .addEdge(\"child\", \"parent2\")\n    .addEdge(\"parent2\", END);\n\n  const parentGraph = parent.compile();\n\n  for await (const chunk of await parentGraph.stream(\n    { myKey: \"Bob\" },\n    { subgraphs: true }\n  )) {\n    console.log(chunk);\n  }\n  ```\n\n  1. We're transforming the state from the child state channels (`myChildKey`) to the grandchild state channels (`myGrandchildKey`)\n  2. We're transforming the state from the grandchild state channels (`myGrandchildKey`) back to the child state channels (`myChildKey`)\n  3. We're passing a function here instead of just compiled graph (`grandchildGraph`)\n  4. We're transforming the state from the parent state channels (`myKey`) to the child state channels (`myChildKey`)\n  5. We're transforming the state from the child state channels (`myChildKey`) back to the parent state channels (`myKey`)\n  6. We're passing a function here instead of just a compiled graph (`childGraph`)\n\n  ```\n  [[], { parent1: { myKey: 'hi Bob' } }]\n  [['child:2e26e9ce-602f-862c-aa66-1ea5a4655e3b', 'child1:781bb3b1-3971-84ce-810b-acf819a03f9c'], { grandchild1: { myGrandchildKey: 'hi Bob, how are you' } }]\n  [['child:2e26e9ce-602f-862c-aa66-1ea5a4655e3b'], { child1: { myChildKey: 'hi Bob, how are you today?' } }]\n  [[], { child: { myKey: 'hi Bob, how are you today?' } }]\n  [[], { parent2: { myKey: 'hi Bob, how are you today? bye!' } }]\n  ```\n</Accordion>\n\n## Add a graph as a node\n\nWhen the parent graph and subgraph can communicate over a shared state key (channel) in the [schema](/oss/javascript/langgraph/graph-api#state), you can add a graph as a [node](/oss/javascript/langgraph/graph-api#nodes) in another graph. For example, in [multi-agent](/oss/javascript/langchain/multi-agent) systems, the agents often communicate over a shared [messages](/oss/javascript/langgraph/graph-api#why-use-messages) key.\n\n<img src=\"https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=c280df5c968cd4237b0b5d03823d8946\" alt=\"SQL agent graph\" style={{ height: \"450px\" }} data-og-width=\"1177\" width=\"1177\" data-og-height=\"818\" height=\"818\" data-path=\"oss/images/subgraph.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=280&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=e3d08dae8fb81e15b4d8069a48999eac 280w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=560&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=8d8942031ba051119e0cb772ef697e0b 560w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=840&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=0d5285bd104c542fe660bc09fed53e5e 840w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=1100&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=32bc8ffa0eda13a0f3bb163631774a60 1100w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=1650&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=6a511f3b9dc44383614803d32390875a 1650w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=2500&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=169d55e154e5ea0146a57373235f768e 2500w\" />\n\nIf your subgraph shares state keys with the parent graph, you can follow these steps to add it to your graph:\n\n1. Define the subgraph workflow (`subgraphBuilder` in the example below) and compile it\n2. Pass compiled subgraph to the `.addNode` method when defining the parent graph workflow\n\n```typescript  theme={null}\nimport { StateGraph, START } from \"@langchain/langgraph\";\nimport * as z from \"zod\";\n\nconst State = z.object({\n  foo: z.string(),\n});\n\n// Subgraph\nconst subgraphBuilder = new StateGraph(State)\n  .addNode(\"subgraphNode1\", (state) => {\n    return { foo: \"hi! \" + state.foo };\n  })\n  .addEdge(START, \"subgraphNode1\");\n\nconst subgraph = subgraphBuilder.compile();\n\n// Parent graph\nconst builder = new StateGraph(State)\n  .addNode(\"node1\", subgraph)\n  .addEdge(START, \"node1\");\n\nconst graph = builder.compile();\n```\n\n<Accordion title=\"Full example: shared state schemas\">\n  ```typescript  theme={null}\n  import { StateGraph, START } from \"@langchain/langgraph\";\n  import * as z from \"zod\";\n\n  // Define subgraph\n  const SubgraphState = z.object({\n    foo: z.string(),    // [!code highlight]\n    bar: z.string(),    // [!code highlight]\n  });\n\n  const subgraphBuilder = new StateGraph(SubgraphState)\n    .addNode(\"subgraphNode1\", (state) => {\n      return { bar: \"bar\" };\n    })\n    .addNode(\"subgraphNode2\", (state) => {\n      // note that this node is using a state key ('bar') that is only available in the subgraph\n      // and is sending update on the shared state key ('foo')\n      return { foo: state.foo + state.bar };\n    })\n    .addEdge(START, \"subgraphNode1\")\n    .addEdge(\"subgraphNode1\", \"subgraphNode2\");\n\n  const subgraph = subgraphBuilder.compile();\n\n  // Define parent graph\n  const ParentState = z.object({\n    foo: z.string(),\n  });\n\n  const builder = new StateGraph(ParentState)\n    .addNode(\"node1\", (state) => {\n      return { foo: \"hi! \" + state.foo };\n    })\n    .addNode(\"node2\", subgraph)\n    .addEdge(START, \"node1\")\n    .addEdge(\"node1\", \"node2\");\n\n  const graph = builder.compile();\n\n  for await (const chunk of await graph.stream({ foo: \"foo\" })) {\n    console.log(chunk);\n  }\n  ```\n\n  1. This key is shared with the parent graph state\n  2. This key is private to the `SubgraphState` and is not visible to the parent graph\n\n  ```\n  { node1: { foo: 'hi! foo' } }\n  { node2: { foo: 'hi! foobar' } }\n  ```\n</Accordion>\n\n## Add persistence\n\nYou only need to **provide the checkpointer when compiling the parent graph**. LangGraph will automatically propagate the checkpointer to the child subgraphs.\n\n```typescript  theme={null}\nimport { StateGraph, START, MemorySaver } from \"@langchain/langgraph\";\nimport * as z from \"zod\";\n\nconst State = z.object({\n  foo: z.string(),\n});\n\n// Subgraph\nconst subgraphBuilder = new StateGraph(State)\n  .addNode(\"subgraphNode1\", (state) => {\n    return { foo: state.foo + \"bar\" };\n  })\n  .addEdge(START, \"subgraphNode1\");\n\nconst subgraph = subgraphBuilder.compile();\n\n// Parent graph\nconst builder = new StateGraph(State)\n  .addNode(\"node1\", subgraph)\n  .addEdge(START, \"node1\");\n\nconst checkpointer = new MemorySaver();\nconst graph = builder.compile({ checkpointer });\n```\n\nIf you want the subgraph to **have its own memory**, you can compile it with the appropriate checkpointer option. This is useful in [multi-agent](/oss/javascript/langchain/multi-agent) systems, if you want agents to keep track of their internal message histories:\n\n```typescript  theme={null}\nconst subgraphBuilder = new StateGraph(...)\nconst subgraph = subgraphBuilder.compile({ checkpointer: true });\n```\n\n## View subgraph state\n\nWhen you enable [persistence](/oss/javascript/langgraph/persistence), you can [inspect the graph state](/oss/javascript/langgraph/persistence#checkpoints) (checkpoint) via the appropriate method. To view the subgraph state, you can use the subgraphs option.\n\nYou can inspect the graph state via `graph.getState(config)`. To view the subgraph state, you can use `graph.getState(config, { subgraphs: true })`.\n\n<Warning>\n  **Available **only** when interrupted**\n  Subgraph state can only be viewed **when the subgraph is interrupted**. Once you resume the graph, you won't be able to access the subgraph state.\n</Warning>\n\n<Accordion title=\"View interrupted subgraph state\">\n  ```typescript  theme={null}\n  import { StateGraph, START, MemorySaver, interrupt, Command } from \"@langchain/langgraph\";\n  import * as z from \"zod\";\n\n  const State = z.object({\n    foo: z.string(),\n  });\n\n  // Subgraph\n  const subgraphBuilder = new StateGraph(State)\n    .addNode(\"subgraphNode1\", (state) => {\n      const value = interrupt(\"Provide value:\");\n      return { foo: state.foo + value };\n    })\n    .addEdge(START, \"subgraphNode1\");\n\n  const subgraph = subgraphBuilder.compile();\n\n  // Parent graph\n  const builder = new StateGraph(State)\n    .addNode(\"node1\", subgraph)\n    .addEdge(START, \"node1\");\n\n  const checkpointer = new MemorySaver();\n  const graph = builder.compile({ checkpointer });\n\n  const config = { configurable: { thread_id: \"1\" } };\n\n  await graph.invoke({ foo: \"\" }, config);\n  const parentState = await graph.getState(config);\n  const subgraphState = (await graph.getState(config, { subgraphs: true })).tasks[0].state;   // [!code highlight]\n\n  // resume the subgraph\n  await graph.invoke(new Command({ resume: \"bar\" }), config);\n  ```\n</Accordion>\n\n## Stream subgraph outputs\n\nTo include outputs from subgraphs in the streamed outputs, you can set the subgraphs option in the stream method of the parent graph. This will stream outputs from both the parent graph and any subgraphs.\n\n```typescript  theme={null}\nfor await (const chunk of await graph.stream(\n  { foo: \"foo\" },\n  {\n    subgraphs: true,   // [!code highlight]\n    streamMode: \"updates\",\n  }\n)) {\n  console.log(chunk);\n}\n```\n\n1. Set `subgraphs: true` to stream outputs from subgraphs.\n\n<Accordion title=\"Stream from subgraphs\">\n  ```typescript  theme={null}\n  import { StateGraph, START } from \"@langchain/langgraph\";\n  import * as z from \"zod\";\n\n  // Define subgraph\n  const SubgraphState = z.object({\n    foo: z.string(),\n    bar: z.string(),\n  });\n\n  const subgraphBuilder = new StateGraph(SubgraphState)\n    .addNode(\"subgraphNode1\", (state) => {\n      return { bar: \"bar\" };\n    })\n    .addNode(\"subgraphNode2\", (state) => {\n      // note that this node is using a state key ('bar') that is only available in the subgraph\n      // and is sending update on the shared state key ('foo')\n      return { foo: state.foo + state.bar };\n    })\n    .addEdge(START, \"subgraphNode1\")\n    .addEdge(\"subgraphNode1\", \"subgraphNode2\");\n\n  const subgraph = subgraphBuilder.compile();\n\n  // Define parent graph\n  const ParentState = z.object({\n    foo: z.string(),\n  });\n\n  const builder = new StateGraph(ParentState)\n    .addNode(\"node1\", (state) => {\n      return { foo: \"hi! \" + state.foo };\n    })\n    .addNode(\"node2\", subgraph)\n    .addEdge(START, \"node1\")\n    .addEdge(\"node1\", \"node2\");\n\n  const graph = builder.compile();\n\n  for await (const chunk of await graph.stream(\n    { foo: \"foo\" },\n    {\n      streamMode: \"updates\",\n      subgraphs: true,   // [!code highlight]\n    }\n  )) {\n    console.log(chunk);\n  }\n  ```\n\n  1. Set `subgraphs: true` to stream outputs from subgraphs.\n\n  ```\n  [[], { node1: { foo: 'hi! foo' } }]\n  [['node2:e58e5673-a661-ebb0-70d4-e298a7fc28b7'], { subgraphNode1: { bar: 'bar' } }]\n  [['node2:e58e5673-a661-ebb0-70d4-e298a7fc28b7'], { subgraphNode2: { foo: 'hi! foobar' } }]\n  [[], { node2: { foo: 'hi! foobar' } }]\n  ```\n</Accordion>\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/oss/langgraph/use-subgraphs.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n\n---\n\nResult 2:\nTitle: Persistence\nLink: https://docs.langchain.comoss/python/langgraph/persistence\nContent: Persistence\nPersistence\nLangGraph has a built-in persistence layer, implemented through checkpointers. When you compile a graph with a checkpointer, the checkpointer saves a checkpoint of the graph state at every super-step. Those checkpoints are saved to a thread , which can be accessed after graph execution. Because threads allow access to graph's state after execution, several powerful capabilities including human-in-the-loop, memory, time travel, and fault-tolerance are all possible. Below, we'll discuss each of these concepts in more detail. Agent Server handles checkpointing automatically When using the Agent Server , you don't need to implement or configure checkpointers manually. The server handles all persistence infrastructure for you behind the scenes.\n\nPersistence\nLangGraph has a built-in persistence layer, implemented through checkpointers. When you compile a graph with a checkpointer, the checkpointer saves a checkpoint of the graph state at every super-step. Those checkpoints are saved to a thread , which can be accessed after graph execution. Because threads allow access to graph's state after execution, several powerful capabilities including human-in-the-loop, memory, time travel, and fault-tolerance are all possible. Below, we'll discuss each of these concepts in more detail. Agent Server handles checkpointing automatically When using the Agent Server , you don't need to implement or configure checkpointers manually. The server handles all persistence infrastructure for you behind the scenes.\n\nMemory Store\nA state schema specifies a set of keys that are populated as a graph is executed. As discussed above, state can be written by a checkpointer to a thread at each graph step, enabling state persistence. But, what if we want to retain some information across threads ? Consider the case of a chatbot where we want to retain specific information about the user across all chat conversations (e.g., threads) with that user! With checkpointers alone, we cannot share information across threads. This motivates the need for the Store interface. As an illustration, we can define an InMemoryStore to store information about a user across threads. We simply compile our graph with a checkpointer, as before, and with our new in_memory_store variable. LangGraph API handles stores automatically When using the LangGraph API, you don't need to implement or configure stores manually. The API handles all storage infrastructure for you behind the scenes.\n\n---\n\nResult 3:\nTitle: Subgraphs\nLink: https://docs.langchain.comoss/python/langgraph/use-subgraphs\nContent: This guide explains the mechanics of using subgraphs. A subgraph is a [graph](/oss/python/langgraph/graph-api#graphs) that is used as a [node](/oss/python/langgraph/graph-api#nodes) in another graph.\n\nSubgraphs are useful for:\n\n* Building [multi-agent systems](/oss/python/langchain/multi-agent)\n* Re-using a set of nodes in multiple graphs\n* Distributing development: when you want different teams to work on different parts of the graph independently, you can define each part as a subgraph, and as long as the subgraph interface (the input and output schemas) is respected, the parent graph can be built without knowing any details of the subgraph\n\nWhen adding subgraphs, you need to define how the parent graph and the subgraph communicate:\n\n* [Invoke a graph from a node](#invoke-a-graph-from-a-node) \u2014 subgraphs are called from inside a node in the parent graph\n* [Add a graph as a node](#add-a-graph-as-a-node) \u2014 a subgraph is added directly as a node in the parent and **shares [state keys](/oss/python/langgraph/graph-api#state)** with the parent\n\n## Setup\n\n<CodeGroup>\n  ```bash pip theme={null}\n  pip install -U langgraph\n  ```\n\n  ```bash uv theme={null}\n  uv add langgraph\n  ```\n</CodeGroup>\n\n<Tip>\n  **Set up LangSmith for LangGraph development**\n  Sign up for [LangSmith](https://smith.langchain.com) to quickly spot issues and improve the performance of your LangGraph projects. LangSmith lets you use trace data to debug, test, and monitor your LLM apps built with LangGraph \u2014 read more about how to get started [here](https://docs.smith.langchain.com).\n</Tip>\n\n## Invoke a graph from a node\n\nA simple way to implement a subgraph is to invoke a graph from inside the node of another graph. In this case subgraphs can have **completely different schemas** from the parent graph (no shared keys). For example, you might want to keep a private message history for each of the agents in a [multi-agent](/oss/python/langchain/multi-agent) system.\n\nIf that's the case for your application, you need to define a node **function that invokes the subgraph**. This function needs to transform the input (parent) state to the subgraph state before invoking the subgraph, and transform the results back to the parent state before returning the state update from the node.\n\n```python  theme={null}\nfrom typing_extensions import TypedDict\nfrom langgraph.graph.state import StateGraph, START\n\nclass SubgraphState(TypedDict):\n    bar: str\n\n# Subgraph\n\ndef subgraph_node_1(state: SubgraphState):\n    return {\"bar\": \"hi! \" + state[\"bar\"]}\n\nsubgraph_builder = StateGraph(SubgraphState)\nsubgraph_builder.add_node(subgraph_node_1)\nsubgraph_builder.add_edge(START, \"subgraph_node_1\")\nsubgraph = subgraph_builder.compile()\n\n# Parent graph\n\nclass State(TypedDict):\n    foo: str\n\ndef call_subgraph(state: State):\n    # Transform the state to the subgraph state\n    subgraph_output = subgraph.invoke({\"bar\": state[\"foo\"]})  # [!code highlight]\n    # Transform response back to the parent state\n    return {\"foo\": subgraph_output[\"bar\"]}\n\nbuilder = StateGraph(State)\nbuilder.add_node(\"node_1\", call_subgraph)\nbuilder.add_edge(START, \"node_1\")\ngraph = builder.compile()\n```\n\n<Accordion title=\"Full example: different state schemas\">\n  ```python  theme={null}\n  from typing_extensions import TypedDict\n  from langgraph.graph.state import StateGraph, START\n\n  # Define subgraph\n  class SubgraphState(TypedDict):\n      # note that none of these keys are shared with the parent graph state\n      bar: str\n      baz: str\n\n  def subgraph_node_1(state: SubgraphState):\n      return {\"baz\": \"baz\"}\n\n  def subgraph_node_2(state: SubgraphState):\n      return {\"bar\": state[\"bar\"] + state[\"baz\"]}\n\n  subgraph_builder = StateGraph(SubgraphState)\n  subgraph_builder.add_node(subgraph_node_1)\n  subgraph_builder.add_node(subgraph_node_2)\n  subgraph_builder.add_edge(START, \"subgraph_node_1\")\n  subgraph_builder.add_edge(\"subgraph_node_1\", \"subgraph_node_2\")\n  subgraph = subgraph_builder.compile()\n\n  # Define parent graph\n  class ParentState(TypedDict):\n      foo: str\n\n  def node_1(state: ParentState):\n      return {\"foo\": \"hi! \" + state[\"foo\"]}\n\n  def node_2(state: ParentState):\n      # Transform the state to the subgraph state\n      response = subgraph.invoke({\"bar\": state[\"foo\"]})\n      # Transform response back to the parent state\n      return {\"foo\": response[\"bar\"]}\n\n\n  builder = StateGraph(ParentState)\n  builder.add_node(\"node_1\", node_1)\n  builder.add_node(\"node_2\", node_2)\n  builder.add_edge(START, \"node_1\")\n  builder.add_edge(\"node_1\", \"node_2\")\n  graph = builder.compile()\n\n  for chunk in graph.stream({\"foo\": \"foo\"}, subgraphs=True):\n      print(chunk)\n  ```\n\n  ```\n  ((), {'node_1': {'foo': 'hi! foo'}})\n  (('node_2:9c36dd0f-151a-cb42-cbad-fa2f851f9ab7',), {'grandchild_1': {'my_grandchild_key': 'hi Bob, how are you'}})\n  (('node_2:9c36dd0f-151a-cb42-cbad-fa2f851f9ab7',), {'grandchild_2': {'bar': 'hi! foobaz'}})\n  ((), {'node_2': {'foo': 'hi! foobaz'}})\n  ```\n</Accordion>\n\n<Accordion title=\"Full example: different state schemas (two levels of subgraphs)\">\n  This is an example with two levels of subgraphs: parent -> child -> grandchild.\n\n  ```python  theme={null}\n  # Grandchild graph\n  from typing_extensions import TypedDict\n  from langgraph.graph.state import StateGraph, START, END\n\n  class GrandChildState(TypedDict):\n      my_grandchild_key: str\n\n  def grandchild_1(state: GrandChildState) -> GrandChildState:\n      # NOTE: child or parent keys will not be accessible here\n      return {\"my_grandchild_key\": state[\"my_grandchild_key\"] + \", how are you\"}\n\n\n  grandchild = StateGraph(GrandChildState)\n  grandchild.add_node(\"grandchild_1\", grandchild_1)\n\n  grandchild.add_edge(START, \"grandchild_1\")\n  grandchild.add_edge(\"grandchild_1\", END)\n\n  grandchild_graph = grandchild.compile()\n\n  # Child graph\n  class ChildState(TypedDict):\n      my_child_key: str\n\n  def call_grandchild_graph(state: ChildState) -> ChildState:\n      # NOTE: parent or grandchild keys won't be accessible here\n      grandchild_graph_input = {\"my_grandchild_key\": state[\"my_child_key\"]}\n      grandchild_graph_output = grandchild_graph.invoke(grandchild_graph_input)\n      return {\"my_child_key\": grandchild_graph_output[\"my_grandchild_key\"] + \" today?\"}\n\n  child = StateGraph(ChildState)\n  # We're passing a function here instead of just compiled graph (`grandchild_graph`)\n  child.add_node(\"child_1\", call_grandchild_graph)\n  child.add_edge(START, \"child_1\")\n  child.add_edge(\"child_1\", END)\n  child_graph = child.compile()\n\n  # Parent graph\n  class ParentState(TypedDict):\n      my_key: str\n\n  def parent_1(state: ParentState) -> ParentState:\n      # NOTE: child or grandchild keys won't be accessible here\n      return {\"my_key\": \"hi \" + state[\"my_key\"]}\n\n  def parent_2(state: ParentState) -> ParentState:\n      return {\"my_key\": state[\"my_key\"] + \" bye!\"}\n\n  def call_child_graph(state: ParentState) -> ParentState:\n      child_graph_input = {\"my_child_key\": state[\"my_key\"]}\n      child_graph_output = child_graph.invoke(child_graph_input)\n      return {\"my_key\": child_graph_output[\"my_child_key\"]}\n\n  parent = StateGraph(ParentState)\n  parent.add_node(\"parent_1\", parent_1)\n  # We're passing a function here instead of just a compiled graph (`child_graph`)\n  parent.add_node(\"child\", call_child_graph)\n  parent.add_node(\"parent_2\", parent_2)\n\n  parent.add_edge(START, \"parent_1\")\n  parent.add_edge(\"parent_1\", \"child\")\n  parent.add_edge(\"child\", \"parent_2\")\n  parent.add_edge(\"parent_2\", END)\n\n  parent_graph = parent.compile()\n\n  for chunk in parent_graph.stream({\"my_key\": \"Bob\"}, subgraphs=True):\n      print(chunk)\n  ```\n\n  ```\n  ((), {'parent_1': {'my_key': 'hi Bob'}})\n  (('child:2e26e9ce-602f-862c-aa66-1ea5a4655e3b', 'child_1:781bb3b1-3971-84ce-810b-acf819a03f9c'), {'grandchild_1': {'my_grandchild_key': 'hi Bob, how are you'}})\n  (('child:2e26e9ce-602f-862c-aa66-1ea5a4655e3b',), {'child_1': {'my_child_key': 'hi Bob, how are you today?'}})\n  ((), {'child': {'my_key': 'hi Bob, how are you today?'}})\n  ((), {'parent_2': {'my_key': 'hi Bob, how are you today? bye!'}})\n  ```\n</Accordion>\n\n## Add a graph as a node\n\nWhen the parent graph and subgraph can communicate over a shared state key (channel) in the [schema](/oss/python/langgraph/graph-api#state), you can add a graph as a [node](/oss/python/langgraph/graph-api#nodes) in another graph. For example, in [multi-agent](/oss/python/langchain/multi-agent) systems, the agents often communicate over a shared [messages](/oss/python/langgraph/graph-api#why-use-messages) key.\n\n<img src=\"https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=c280df5c968cd4237b0b5d03823d8946\" alt=\"SQL agent graph\" style={{ height: \"450px\" }} data-og-width=\"1177\" width=\"1177\" data-og-height=\"818\" height=\"818\" data-path=\"oss/images/subgraph.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=280&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=e3d08dae8fb81e15b4d8069a48999eac 280w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=560&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=8d8942031ba051119e0cb772ef697e0b 560w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=840&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=0d5285bd104c542fe660bc09fed53e5e 840w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=1100&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=32bc8ffa0eda13a0f3bb163631774a60 1100w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=1650&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=6a511f3b9dc44383614803d32390875a 1650w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=2500&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=169d55e154e5ea0146a57373235f768e 2500w\" />\n\nIf your subgraph shares state keys with the parent graph, you can follow these steps to add it to your graph:\n\n1. Define the subgraph workflow (`subgraph_builder` in the example below) and compile it\n2. Pass compiled subgraph to the [`add_node`](https://reference.langchain.com/python/langgraph/graphs/#langgraph.graph.state.StateGraph.add_node) method when defining the parent graph workflow\n\n```python  theme={null}\nfrom typing_extensions import TypedDict\nfrom langgraph.graph.state import StateGraph, START\n\nclass State(TypedDict):\n    foo: str\n\n# Subgraph\n\ndef subgraph_node_1(state: State):\n    return {\"foo\": \"hi! \" + state[\"foo\"]}\n\nsubgraph_builder = StateGraph(State)\nsubgraph_builder.add_node(subgraph_node_1)\nsubgraph_builder.add_edge(START, \"subgraph_node_1\")\nsubgraph = subgraph_builder.compile()\n\n# Parent graph\n\nbuilder = StateGraph(State)\nbuilder.add_node(\"node_1\", subgraph)  # [!code highlight]\nbuilder.add_edge(START, \"node_1\")\ngraph = builder.compile()\n```\n\n<Accordion title=\"Full example: shared state schemas\">\n  ```python  theme={null}\n  from typing_extensions import TypedDict\n  from langgraph.graph.state import StateGraph, START\n\n  # Define subgraph\n  class SubgraphState(TypedDict):\n      foo: str  # shared with parent graph state\n      bar: str  # private to SubgraphState\n\n  def subgraph_node_1(state: SubgraphState):\n      return {\"bar\": \"bar\"}\n\n  def subgraph_node_2(state: SubgraphState):\n      # note that this node is using a state key ('bar') that is only available in the subgraph\n      # and is sending update on the shared state key ('foo')\n      return {\"foo\": state[\"foo\"] + state[\"bar\"]}\n\n  subgraph_builder = StateGraph(SubgraphState)\n  subgraph_builder.add_node(subgraph_node_1)\n  subgraph_builder.add_node(subgraph_node_2)\n  subgraph_builder.add_edge(START, \"subgraph_node_1\")\n  subgraph_builder.add_edge(\"subgraph_node_1\", \"subgraph_node_2\")\n  subgraph = subgraph_builder.compile()\n\n  # Define parent graph\n  class ParentState(TypedDict):\n      foo: str\n\n  def node_1(state: ParentState):\n      return {\"foo\": \"hi! \" + state[\"foo\"]}\n\n  builder = StateGraph(ParentState)\n  builder.add_node(\"node_1\", node_1)\n  builder.add_node(\"node_2\", subgraph)\n  builder.add_edge(START, \"node_1\")\n  builder.add_edge(\"node_1\", \"node_2\")\n  graph = builder.compile()\n\n  for chunk in graph.stream({\"foo\": \"foo\"}):\n      print(chunk)\n  ```\n\n  ```\n  {'node_1': {'foo': 'hi! foo'}}\n  {'node_2': {'foo': 'hi! foobar'}}\n  ```\n</Accordion>\n\n## Add persistence\n\nYou only need to **provide the checkpointer when compiling the parent graph**. LangGraph will automatically propagate the checkpointer to the child subgraphs.\n\n```python  theme={null}\nfrom langgraph.graph import START, StateGraph\nfrom langgraph.checkpoint.memory import MemorySaver\nfrom typing_extensions import TypedDict\n\nclass State(TypedDict):\n    foo: str\n\n# Subgraph\n\ndef subgraph_node_1(state: State):\n    return {\"foo\": state[\"foo\"] + \"bar\"}\n\nsubgraph_builder = StateGraph(State)\nsubgraph_builder.add_node(subgraph_node_1)\nsubgraph_builder.add_edge(START, \"subgraph_node_1\")\nsubgraph = subgraph_builder.compile()\n\n# Parent graph\n\nbuilder = StateGraph(State)\nbuilder.add_node(\"node_1\", subgraph)\nbuilder.add_edge(START, \"node_1\")\n\ncheckpointer = MemorySaver()\ngraph = builder.compile(checkpointer=checkpointer)\n```\n\nIf you want the subgraph to **have its own memory**, you can compile it with the appropriate checkpointer option. This is useful in [multi-agent](/oss/python/langchain/multi-agent) systems, if you want agents to keep track of their internal message histories:\n\n```python  theme={null}\nsubgraph_builder = StateGraph(...)\nsubgraph = subgraph_builder.compile(checkpointer=True)\n```\n\n## View subgraph state\n\nWhen you enable [persistence](/oss/python/langgraph/persistence), you can [inspect the graph state](/oss/python/langgraph/persistence#checkpoints) (checkpoint) via the appropriate method. To view the subgraph state, you can use the subgraphs option.\n\nYou can inspect the graph state via `graph.get_state(config)`. To view the subgraph state, you can use `graph.get_state(config, subgraphs=True)`.\n\n<Warning>\n  **Available **only** when interrupted**\n  Subgraph state can only be viewed **when the subgraph is interrupted**. Once you resume the graph, you won't be able to access the subgraph state.\n</Warning>\n\n<Accordion title=\"View interrupted subgraph state\">\n  ```python  theme={null}\n  from langgraph.graph import START, StateGraph\n  from langgraph.checkpoint.memory import MemorySaver\n  from langgraph.types import interrupt, Command\n  from typing_extensions import TypedDict\n\n  class State(TypedDict):\n      foo: str\n\n  # Subgraph\n\n  def subgraph_node_1(state: State):\n      value = interrupt(\"Provide value:\")\n      return {\"foo\": state[\"foo\"] + value}\n\n  subgraph_builder = StateGraph(State)\n  subgraph_builder.add_node(subgraph_node_1)\n  subgraph_builder.add_edge(START, \"subgraph_node_1\")\n\n  subgraph = subgraph_builder.compile()\n\n  # Parent graph\n\n  builder = StateGraph(State)\n  builder.add_node(\"node_1\", subgraph)\n  builder.add_edge(START, \"node_1\")\n\n  checkpointer = MemorySaver()\n  graph = builder.compile(checkpointer=checkpointer)\n\n  config = {\"configurable\": {\"thread_id\": \"1\"}}\n\n  graph.invoke({\"foo\": \"\"}, config)\n  parent_state = graph.get_state(config)\n\n  # This will be available only when the subgraph is interrupted.\n  # Once you resume the graph, you won't be able to access the subgraph state.\n  subgraph_state = graph.get_state(config, subgraphs=True).tasks[0].state\n\n  # resume the subgraph\n  graph.invoke(Command(resume=\"bar\"), config)\n  ```\n\n  1. This will be available only when the subgraph is interrupted. Once you resume the graph, you won't be able to access the subgraph state.\n</Accordion>\n\n## Stream subgraph outputs\n\nTo include outputs from subgraphs in the streamed outputs, you can set the subgraphs option in the stream method of the parent graph. This will stream outputs from both the parent graph and any subgraphs.\n\n```python  theme={null}\nfor chunk in graph.stream(\n    {\"foo\": \"foo\"},\n    subgraphs=True, # [!code highlight]\n    stream_mode=\"updates\",\n):\n    print(chunk)\n```\n\n<Accordion title=\"Stream from subgraphs\">\n  ```python  theme={null}\n  from typing_extensions import TypedDict\n  from langgraph.graph.state import StateGraph, START\n\n  # Define subgraph\n  class SubgraphState(TypedDict):\n      foo: str\n      bar: str\n\n  def subgraph_node_1(state: SubgraphState):\n      return {\"bar\": \"bar\"}\n\n  def subgraph_node_2(state: SubgraphState):\n      # note that this node is using a state key ('bar') that is only available in the subgraph\n      # and is sending update on the shared state key ('foo')\n      return {\"foo\": state[\"foo\"] + state[\"bar\"]}\n\n  subgraph_builder = StateGraph(SubgraphState)\n  subgraph_builder.add_node(subgraph_node_1)\n  subgraph_builder.add_node(subgraph_node_2)\n  subgraph_builder.add_edge(START, \"subgraph_node_1\")\n  subgraph_builder.add_edge(\"subgraph_node_1\", \"subgraph_node_2\")\n  subgraph = subgraph_builder.compile()\n\n  # Define parent graph\n  class ParentState(TypedDict):\n      foo: str\n\n  def node_1(state: ParentState):\n      return {\"foo\": \"hi! \" + state[\"foo\"]}\n\n  builder = StateGraph(ParentState)\n  builder.add_node(\"node_1\", node_1)\n  builder.add_node(\"node_2\", subgraph)\n  builder.add_edge(START, \"node_1\")\n  builder.add_edge(\"node_1\", \"node_2\")\n  graph = builder.compile()\n\n  for chunk in graph.stream(\n      {\"foo\": \"foo\"},\n      stream_mode=\"updates\",\n      subgraphs=True, # [!code highlight]\n  ):\n      print(chunk)\n  ```\n\n  ```\n  ((), {'node_1': {'foo': 'hi! foo'}})\n  (('node_2:e58e5673-a661-ebb0-70d4-e298a7fc28b7',), {'subgraph_node_1': {'bar': 'bar'}})\n  (('node_2:e58e5673-a661-ebb0-70d4-e298a7fc28b7',), {'subgraph_node_2': {'foo': 'hi! foobar'}})\n  ((), {'node_2': {'foo': 'hi! foobar'}})\n  ```\n</Accordion>\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/oss/langgraph/use-subgraphs.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n"
  },
  {
    "role": "tool",
    "name": "SearchDocsByLangChain",
    "tool_call_id": "b71bf9cf-a48b-4629-8462-8d9336dc565e",
    "id": "8204fb16-0f9e-452d-80ff-82bd090e3ceb",
    "content": "Result 1:\nTitle: Configure LangSmith Agent Server for scale\nLink: https://docs.langchain.comlangsmith/agent-server-scale\nContent: The default configuration for LangSmith Agent Server is designed to handle substantial read and write load across a variety of different workloads. By following the best practices outlined below, you can tune your Agent Server to perform optimally for your specific workload. This page describes scaling considerations for the Agent Server and provides examples to help configure your deployment.\n\nFor some example self-hosted configurations, refer to the [Example Agent Server configurations for scale](#example-agent-server-configurations-for-scale) section.\n\n## Scaling for write load\n\nWrite load is primarily driven by the following factors:\n\n* Creation of new [runs](/langsmith/background-run)\n* Creation of new checkpoints during run execution\n* Writing to long term memory\n* Creation of new [threads](/langsmith/use-threads)\n* Creation of new [assistants](/langsmith/assistants)\n* Deletion of runs, checkpoints, threads, assistants and cron jobs\n\nThe following components are primarily responsible for handling write load:\n\n* API server: Handles initial request and persistence of data to the database.\n* Queue worker: Handles the execution of runs.\n* Redis: Handles the storage of ephemeral data about on-going runs.\n* Postgres: Handles the storage of all data, including run, thread, assistant, cron job, checkpointing and long term memory.\n\n### Best practices for scaling the write path\n\n#### Change `N_JOBS_PER_WORKER` based on assistant characteristics\n\nThe default value of [`N_JOBS_PER_WORKER`](/langsmith/env-var#n-jobs-per-worker) is 10. You can change this value to scale the maximum number of runs that can be executed at a time by a single queue worker based on the characteristics of your assistant.\n\nSome general guidelines for changing `N_JOBS_PER_WORKER`:\n\n* If your assistant is CPU bounded, the default value of 10 is likely sufficient. You might lower `N_JOBS_PER_WORKER` if you notice excessive CPU usage on queue workers or delays in run execution.\n* If your assistant is IO bounded, increase `N_JOBS_PER_WORKER` to handle more concurrent runs per worker.\n\nThere is no upper limit to `N_JOBS_PER_WORKER`. However, queue workers are greedy when fetching new runs, which means they will try to pick up as many runs as they have available jobs and begin executing them immediately. Setting `N_JOBS_PER_WORKER` too high in environments with bursty traffic can lead to uneven worker utilization and increased run execution times.\n\n#### Avoid synchronous blocking operations\n\nAvoid synchronous blocking operations in your code and prefer asynchronous operations. Long synchronous operations can block the main event loop, causing longer request and run execution times and potential timeouts.\n\nFor example, consider an application that needs to sleep for 1 second. Instead of using synchronous code like this:\n\n```python  theme={null}\nimport time\n\ndef my_function():\n    time.sleep(1)\n```\n\nPrefer asynchronous code like this:\n\n```python  theme={null}\nimport asyncio\n\nasync def my_function():\n    await asyncio.sleep(1)\n```\n\nIf an assistant requires synchronous blocking operations, set [`BG_JOB_ISOLATED_LOOPS`](/langsmith/env-var#bg-job-isolated-loops) to `True` to execute each run in a separate event loop.\n\n#### Minimize redundant checkpointing\n\nMinimize redundant checkpointing by setting [`durability`](/oss/python/langgraph/durable-execution#durability-modes) to the minimum value necessary to ensure your data is durable.\n\nThe default durability mode is `\"async\", meaning checkpoints are written after each step asynchronously. If an assistant needs to persist only the final state of the run, `durability`can be set to`\"exit\"\\`, storing only the final state of the run. This can be set when creating the run:\n\n```python  theme={null}\nfrom langgraph_sdk import get_client\n\nclient = get_client(url=<DEPLOYMENT_URL>)\nthread = await client.threads.create()\nrun = await client.runs.create(\n    thread_id=thread[\"thread_id\"],\n    assistant_id=\"agent\",\n    durability=\"exit\"\n)\n```\n\n#### Self-hosted\n\n<Note>\n  These settings are only required for [self-hosted](/langsmith/self-hosted) deployments. By default, [cloud](/langsmith/cloud) deployments already have these best practices enabled.\n</Note>\n\n##### Enable the use of queue workers\n\nBy default, the API server manages the queue and does not use queue workers. You can enable the use of queue workers by setting the `queue.enabled` configuration to `true`.\n\n```yaml  theme={null}\nqueue:\n  enabled: true\n```\n\nThis will allow the API server to offload the queue management to the queue workers, significantly reducing the load on the API server and allowing it to focus on handling requests.\n\n##### Support a number of jobs equal to expected throughput\n\nThe more runs you execute in parallel, the more jobs you will need to handle the load. There are two main parameters to scale the available jobs:\n\n* `number_of_queue_workers`: The number of queue workers provisioned.\n* `N_JOBS_PER_WORKER`: The number of runs that a single queue work can execute at a time. Defaults to 10.\n\nYou can calculate the available jobs with the following equation:\n\n```\navailable_jobs = number_of_queue_workers * `N_JOBS_PER_WORKER`\n```\n\nThroughput is then the number of runs that can be executed per second by the available jobs:\n\n```\nthroughput_per_second = available_jobs / average_run_execution_time_seconds\n```\n\nTherefore, the minimum number of queue workers you should provision to support your expected steady state throughput is:\n\n```\nnumber_of_queue_workers = throughput_per_second * average_run_execution_time_seconds / `N_JOBS_PER_WORKER`\n```\n\n##### Configure autoscaling for bursty workloads\n\nAutoscaling is disabled by default, but should be configured for bursty workloads. Using the same calculations as the [previous section](#support-a-number-of-jobs-equal-to-expected-throughput), you can determine the maximum number of queue workers you should allow the autoscaler to scale to based on maximum expected throughput.\n\n## Scaling for read load\n\nRead load is primarily driven by the following factors:\n\n* Getting the results of a [run](/langsmith/background-run)\n* Getting the state of a [thread](/langsmith/use-threads)\n* Searching for [runs](/langsmith/background-run), [threads](/langsmith/use-threads), [cron jobs](/langsmith/cron-jobs) and [assistants](/langsmith/assistants)\n* Retrieving checkpoints and long term memory\n\nThe following components are primarily responsible for handling read load:\n\n* API server: Handles the request and direct retrieval of data from the database.\n* Postgres: Handles the storage of all data, including run, thread, assistant, cron job, checkpointing and long term memory.\n* Redis: Handles the storage of ephemeral data about on-going runs, including streaming messages from queue workers to api servers.\n\n### Best practices for scaling the read path\n\n#### Use filtering to reduce the number of resources returned per request\n\n[Agent Server](/langsmith/agent-server) provides a search API for each resource type. These APIs implement pagination by default and offer many filtering options. Use filtering to reduce the number of resources returned per request and improve performance.\n\n#### Set a TTLs to automatically delete old data\n\nSet a [TTL on threads](/langsmith/configure-ttl) to automatically clean up old data. Runs and checkpoints are automatically deleted when the associated thread is deleted.\n\n#### Avoid polling and use /join to monitor the state of a run\n\nAvoid polling the state of a run by using the `/join` API endpoint. This method returns the final state of the run once the run is complete.\n\nIf you need to monitor the output of a run in real-time, use the `/stream` API endpoint. This method streams the run output including the final state of the run.\n\n#### Self-hosted\n\n<Note>\n  These settings are only required for [self-hosted](/langsmith/self-hosted) deployments. By default, [cloud](/langsmith/cloud) deployments already have these best practices enabled.\n</Note>\n\n##### Configure autoscaling for bursty workloads\n\nAutoscaling is disabled by default, but should be configured for bursty workloads. You can determine the maximum number of api servers you should allow the autoscaler to scale to based on maximum expected throughput. The default for [cloud](/langsmith/cloud) deployments is a maximum of 10 API servers.\n\n## Example self-hosted Agent Server configurations\n\n<Note>\n  The exact optimal configuration depends on your application complexity, request patterns, and data requirements. Use the following examples in combination with the information in the previous sections and your specific usage to update your deployment configuration as needed. If you have any questions, contact support via [support.langchain.com](https://support.langchain.com).\n</Note>\n\nThe following table provides an overview comparing different LangSmith Agent Server configurations for various load patterns (read requests per second / write requests per second) and standard assistant characteristics (average run execution time of 1 second, moderate CPU and memory usage):\n\n|                                                                                                                          | **[Low / low](#low-reads-low-writes)** | **[Low / high](#low-reads-high-writes)** | **[High / low](#high-reads-low-writes)** | [Medium / medium](#medium-reads-medium-writes) | [High / high](#high-reads-high-writes) |\n| :----------------------------------------------------------------------------------------------------------------------- | :------------------------------------- | :--------------------------------------- | :--------------------------------------- | :--------------------------------------------- | :------------------------------------- |\n| <Tooltip tip=\"Number of write requests being processed by the deployment per second\">Write requests per second</Tooltip> | 5                                      | 5                                        | 500                                      | 50                                             | 500                                    |\n| <Tooltip tip=\"Number of read requests being processed by the deployment per second\">Read requests per second</Tooltip>   | 5                                      | 500                                      | 5                                        | 50                                             | 500                                    |\n| **API servers**<br />(1 CPU, 2Gi per server)                                                                             | 1 (default)                            | 6                                        | 10                                       | 3                                              | 15                                     |\n| **Queue workers**<br />(1 CPU, 2Gi per worker)                                                                           | 1 (default)                            | 10                                       | 1 (default)                              | 5                                              | 10                                     |\n| **`N_JOBS_PER_WORKER`**                                                                                                  | 10 (default)                           | 50                                       | 10                                       | 10                                             | 50                                     |\n| **Redis resources**                                                                                                      | 2 Gi (default)                         | 2 Gi (default)                           | 2 Gi (default)                           | 2 Gi (default)                                 | 2 Gi (default)                         |\n| **Postgres resources**                                                                                                   | 2 CPU<br />8 Gi (default)              | 4 CPU<br />16 Gi memory                  | 4 CPU<br />16 Gi                         | 4 CPU<br />16 Gi memory                        | 8 CPU<br />32 Gi memory                |\n\nThe following sample configurations enable each of these setups. Load levels are defined as:\n\n* Low means approximately 5 requests per second\n* Medium means approximately 50 requests per second\n* High means approximately 500 requests per second\n\n### Low reads, low writes <a name=\"low-reads-low-writes\" />\n\nThe default [LangSmith Deployment](/langsmith/deployments) configuration will handle this load. No custom resource configuration is needed here.\n\n### Low reads, high writes <a name=\"low-reads-high-writes\" />\n\nYou have a high volume of write requests (500 per second) being processed by your deployment, but relatively few read requests (5 per second).\n\nFor this, we recommend a configuration like this:\n\n```yaml  theme={null}\n# Example configuration for low reads, high writes (5 read/500 write requests per second)\napi:\n  replicas: 6\n  resources:\n    requests:\n      cpu: \"1\"\n      memory: \"2Gi\"\n    limits:\n      cpu: \"2\"\n      memory: \"4Gi\"\n\nqueue:\n  replicas: 10\n  resources:\n    requests:\n      cpu: \"1\"\n      memory: \"2Gi\"\n    limits:\n      cpu: \"2\"\n      memory: \"4Gi\"\n\nconfig:\n  numberOfJobsPerWorker: 50\n\nredis:\n  resources:\n    requests:\n      memory: \"2Gi\"\n    limits:\n      memory: \"2Gi\"\n\npostgres:\n  resources:\n    requests:\n      cpu: \"4\"\n      memory: \"16Gi\"\n    limits:\n      cpu: \"8\"\n      memory: \"32Gi\"\n```\n\n### High reads, low writes <a name=\"high-reads-low-writes\" />\n\nYou have a high volume of read requests (500 per second) but relatively few write requests (5 per second).\n\nFor this, we recommend a configuration like this:\n\n```yaml  theme={null}\n# Example configuration for high reads, low writes (500 read/5 write requests per second)\napi:\n  replicas: 10\n  resources:\n    requests:\n      cpu: \"1\"\n      memory: \"2Gi\"\n    limits:\n      cpu: \"2\"\n      memory: \"4Gi\"\n\nqueue:\n  replicas: 1  # Default, minimal write load\n  resources:\n    requests:\n      cpu: \"1\"\n      memory: \"2Gi\"\n    limits:\n      cpu: \"2\"\n      memory: \"4Gi\"\n\nredis:\n  resources:\n    requests:\n      memory: \"2Gi\"\n    limits:\n      memory: \"2Gi\"\n\npostgres:\n  resources:\n    requests:\n      cpu: \"4\"\n      memory: \"16Gi\"\n    limits:\n      cpu: \"8\"\n      memory: \"32Gi\"\n  # Consider read replicas for high read scenarios\n  readReplicas: 2\n```\n\n### Medium reads, medium writes <a name=\"medium-reads-medium-writes\" />\n\nThis is a balanced configuration that should handle moderate read and write loads (50 read/50 write requests per second).\n\nFor this, we recommend a configuration like this:\n\n```yaml  theme={null}\n# Example configuration for medium reads, medium writes (50 read/50 write requests per second)\napi:\n  replicas: 3\n  resources:\n    requests:\n      cpu: \"1\"\n      memory: \"2Gi\"\n    limits:\n      cpu: \"2\"\n      memory: \"4Gi\"\n\nqueue:\n  replicas: 5\n  resources:\n    requests:\n      cpu: \"1\"\n      memory: \"2Gi\"\n    limits:\n      cpu: \"2\"\n      memory: \"4Gi\"\n\nredis:\n  resources:\n    requests:\n      memory: \"2Gi\"\n    limits:\n      memory: \"2Gi\"\n\npostgres:\n  resources:\n    requests:\n      cpu: \"4\"\n      memory: \"16Gi\"\n    limits:\n      cpu: \"8\"\n      memory: \"32Gi\"\n```\n\n### High reads, high writes <a name=\"high-reads-high-writes\" />\n\nYou have high volumes of both read and write requests (500 read/500 write requests per second).\n\nFor this, we recommend a configuration like this:\n\n```yaml  theme={null}\n# Example configuration for high reads, high writes (500 read/500 write requests per second)\napi:\n  replicas: 15\n  resources:\n    requests:\n      cpu: \"1\"\n      memory: \"2Gi\"\n    limits:\n      cpu: \"2\"\n      memory: \"4Gi\"\n\nqueue:\n  replicas: 10\n  resources:\n    requests:\n      cpu: \"1\"\n      memory: \"2Gi\"\n    limits:\n      cpu: \"2\"\n      memory: \"4Gi\"\n\nconfig:\n  numberOfJobsPerWorker: 50\n\nredis:\n  resources:\n    requests:\n      memory: \"2Gi\"\n    limits:\n      memory: \"2Gi\"\n\npostgres:\n  resources:\n    requests:\n      cpu: \"8\"\n      memory: \"32Gi\"\n    limits:\n      cpu: \"16\"\n      memory: \"64Gi\"\n```\n\n### Autoscaling\n\nIf your deployment experiences bursty traffic, you can enable autoscaling to scale the number of API servers and queue workers to handle the load.\n\nHere is a sample configuration for autoscaling for high reads and high writes:\n\n```yaml  theme={null}\napi:\n  autoscaling:\n    enabled: true\n    minReplicas: 15\n    maxReplicas: 25\n\nqueue:\n  autoscaling:\n    enabled: true\n    minReplicas: 10\n    maxReplicas: 20\n```\n\n<Note>\n  Ensure that your deployment environment has sufficient resources to scale to the recommended size. Monitor your applications and infrastructure to ensure optimal performance. Consider implementing monitoring and alerting to track resource usage and application performance.\n</Note>\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/langsmith/agent-server-scale.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n\n---\n\nResult 2:\nTitle: Persistence\nLink: https://docs.langchain.comoss/javascript/langgraph/persistence\nContent: Checkpointer libraries\nUnder the hood, checkpointing is powered by checkpointer objects that conform to BaseCheckpointSaver interface. LangGraph provides several checkpointer implementations, all implemented via standalone, installable libraries: @langchain/langgraph-checkpoint : The base interface for checkpointer savers ( BaseCheckpointSaver ) and serialization/deserialization interface ( SerializerProtocol ). Includes in-memory checkpointer implementation ( MemorySaver ) for experimentation. LangGraph comes with @langchain/langgraph-checkpoint included. @langchain/langgraph-checkpoint-sqlite : An implementation of LangGraph checkpointer that uses SQLite database ( SqliteSaver ). Ideal for experimentation and local workflows. Needs to be installed separately. @langchain/langgraph-checkpoint-postgres : An advanced checkpointer that uses Postgres database ( PostgresSaver ), used in LangSmith. Ideal for using in production. Needs to be installed separately.\n\nHuman-in-the-loop\nFirst, checkpointers facilitate human-in-the-loop workflows by allowing humans to inspect, interrupt, and approve graph steps. Checkpointers are needed for these workflows as the human has to be able to view the state of a graph at any point in time, and the graph has to be to resume execution after the human has made any updates to the state. See the how-to guides for examples.\n\nTime Travel\nThird, checkpointers allow for \"time travel\" , allowing users to replay prior graph executions to review and / or debug specific graph steps. In addition, checkpointers make it possible to fork the graph state at arbitrary checkpoints to explore alternative trajectories.\n\n---\n\nResult 3:\nTitle: Persistence\nLink: https://docs.langchain.comoss/python/langgraph/persistence\nContent: Checkpointer libraries\nUnder the hood, checkpointing is powered by checkpointer objects that conform to BaseCheckpointSaver interface. LangGraph provides several checkpointer implementations, all implemented via standalone, installable libraries: langgraph-checkpoint : The base interface for checkpointer savers ( BaseCheckpointSaver ) and serialization/deserialization interface ( SerializerProtocol ). Includes in-memory checkpointer implementation ( InMemorySaver ) for experimentation. LangGraph comes with langgraph-checkpoint included. langgraph-checkpoint-sqlite : An implementation of LangGraph checkpointer that uses SQLite database ( SqliteSaver / AsyncSqliteSaver ). Ideal for experimentation and local workflows. Needs to be installed separately. langgraph-checkpoint-postgres : An advanced checkpointer that uses Postgres database ( PostgresSaver / AsyncPostgresSaver ), used in LangSmith. Ideal for using in production. Needs to be installed separately.\n\nCheckpoints\nThe state of a thread at a particular point in time is called a checkpoint. Checkpoint is a snapshot of the graph state saved at each super-step and is represented by StateSnapshot object with the following key properties: config : Config associated with this checkpoint. metadata : Metadata associated with this checkpoint. values : Values of the state channels at this point in time. next A tuple of the node names to execute next in the graph. tasks : A tuple of PregelTask objects that contain information about next tasks to be executed. If the step was previously attempted, it will include error information. If a graph was interrupted dynamically from within a node, tasks will contain additional data associated with interrupts. Checkpoints are persisted and can be used to restore the state of a thread at a later time. Let's see what checkpoints are saved when a simple graph is invoked as follows: After we run the graph, we expect to see exactly 4 checkpoints: Empty checkpoint with START as the next node to be executed Checkpoint with the user input {'foo': '', 'bar': []} and node_a as the next node to be executed Checkpoint with the outputs of node_a {'foo': 'a', 'bar': ['a']} and node_b as the next node to be executed Checkpoint with the outputs of node_b {'foo': 'b', 'bar': ['a', 'b']} and no next nodes to be executed Note that we bar channel values contain outputs from both nodes as we have a reducer for bar channel.\n\nCheckpoints\nThe state of a thread at a particular point in time is called a checkpoint. Checkpoint is a snapshot of the graph state saved at each super-step and is represented by StateSnapshot object with the following key properties: config : Config associated with this checkpoint. metadata : Metadata associated with this checkpoint. values : Values of the state channels at this point in time. next A tuple of the node names to execute next in the graph. tasks : A tuple of PregelTask objects that contain information about next tasks to be executed. If the step was previously attempted, it will include error information. If a graph was interrupted dynamically from within a node, tasks will contain additional data associated with interrupts. Checkpoints are persisted and can be used to restore the state of a thread at a later time. Let's see what checkpoints are saved when a simple graph is invoked as follows: from langgraph.graph import StateGraph, START, END\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom langchain_core.runnables import RunnableConfig\nfrom typing import Annotated\nfrom typing_extensions import TypedDict\nfrom operator import add\n\nclass State(TypedDict):\n    foo: str\n    bar: Annotated[list[str], add]\n\ndef node_a(state: State):\n    return {\"foo\": \"a\", \"bar\": [\"a\"]}\n\ndef node_b(state: State):\n    return {\"foo\": \"b\", \"bar\": [\"b\"]}\n\n\nworkflow = StateGraph(State)\nworkflow.add_node(node_a)\nworkflow.add_node(node_b)\nworkflow.add_edge(START, \"node_a\")\nworkflow.add_edge(\"node_a\", \"node_b\")\nworkflow.add_edge(\"node_b\", END)\n\ncheckpointer = InMemorySaver()\ngraph = workflow.compile(checkpointer=checkpointer)\n\nconfig: RunnableConfig = {\"configurable\": {\"thread_id\": \"1\"}}\ngraph.invoke({\"foo\": \"\", \"bar\":[]}, config)\n"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b37fb-0d37-7230-9afb-456fe6f3e3c0",
    "content": "**\u0414\u0430, \u044f \u0443\u0432\u0435\u0440\u0435\u043d.** \u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 \u043a\u0440\u043e\u0435\u0442\u0441\u044f \u0432 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u043e\u043c \u043a\u043e\u043d\u0444\u043b\u0438\u043a\u0442\u0435 \u043c\u0435\u0436\u0434\u0443 \u0442\u0435\u043c, \u043a\u0430\u043a LangGraph \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430\u043c\u0438 \u0438\u043c\u0435\u043d (namespaces), \u0438 \u0442\u0435\u043c, \u043a\u0430\u043a \u0432\u0430\u0448\u0430 \u043e\u0431\u0435\u0440\u0442\u043a\u0430 `ArchitecturalAgentBase` \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u0438\u0437\u043e\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0432\u0440\u0443\u0447\u043d\u0443\u044e.\n\n\u0414\u0435\u0442\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u0437\u0431\u043e\u0440 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0443\u044e \u0446\u0435\u043f\u043e\u0447\u043a\u0443 \u043f\u0440\u0438\u0447\u0438\u043d\u043d\u043e-\u0441\u043b\u0435\u0434\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0439 \u0441\u0432\u044f\u0437\u0438:\n\n### 1. \u041a\u043e\u043b\u043b\u0438\u0437\u0438\u044f `checkpoint_ns` (\u041f\u0435\u0440\u0432\u0438\u0447\u043d\u0430\u044f \u043f\u0440\u0438\u0447\u0438\u043d\u0430)\n\u0412 LangGraph `checkpoint_ns` \u2014 \u044d\u0442\u043e \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u043a\u043b\u044e\u0447 \u0434\u043b\u044f \u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439 \u0432\u043d\u0443\u0442\u0440\u0438 \u043e\u0434\u043d\u043e\u0433\u043e `thread_id`. \u0421\u0443\u0434\u044f \u043f\u043e \u043b\u043e\u0433\u0430\u043c \u0434\u043b\u044f `wide_funnel` (\u0432\u043e\u0440\u043a\u0435\u0440\u044b 1\u20139), \u0432\u0441\u0435 \u043e\u043d\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442 **\u0438\u0434\u0435\u043d\u0442\u0438\u0447\u043d\u044b\u0439** `checkpoint_ns`:\n`wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d`\n\n\u041a\u043e\u0433\u0434\u0430 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u044b\u0445 \u0432\u0435\u0442\u043e\u043a (\u0432\u043e\u0440\u043a\u0435\u0440\u043e\u0432) \u043f\u0438\u0448\u0443\u0442 \u0432 \u043e\u0434\u0438\u043d \u0438 \u0442\u043e\u0442 \u0436\u0435 `checkpoint_ns`, \u043e\u043d\u0438 \u0431\u0443\u043a\u0432\u0430\u043b\u044c\u043d\u043e \u00ab\u0434\u0435\u0440\u0443\u0442\u0441\u044f\u00bb \u0437\u0430 \u043e\u0434\u043d\u0443 \u0438 \u0442\u0443 \u0436\u0435 \u044f\u0447\u0435\u0439\u043a\u0443 \u043f\u0430\u043c\u044f\u0442\u0438 \u0432 \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u043e\u0432.\n\n### 2. \u0421\u0431\u043e\u0439 \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u0438 \u043f\u043e `graph_id` (\u0412\u0442\u043e\u0440\u0438\u0447\u043d\u0430\u044f \u043f\u0440\u0438\u0447\u0438\u043d\u0430)\n\u0412\u0430\u0448 `GraphMemoryRuntime` \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u0440\u0435\u0448\u0438\u0442\u044c \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0443 \u043a\u043e\u043b\u043b\u0438\u0437\u0438\u0438 \u0447\u0435\u0440\u0435\u0437 \u043a\u0430\u0441\u0442\u043e\u043c\u043d\u0443\u044e \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044e \u043f\u043e \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u043c (`graph_id`). \u041e\u0434\u043d\u0430\u043a\u043e \u043b\u043e\u0433\u0438 `DEBUG` \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u044e\u0442, \u0447\u0442\u043e \u044d\u0442\u043e\u0442 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c \u043d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442:\n`\"meta_graph_id\": \"None\"`\n\n\u042d\u0442\u043e \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e \u043f\u0440\u0438 \u0437\u0430\u043f\u0438\u0441\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430 \u043f\u043e\u043b\u0435 `graph_id` **\u043d\u0435 \u043f\u043e\u043f\u0430\u0434\u0430\u0435\u0442 \u0432 \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435** \u0438\u043b\u0438 \u0441\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e. \u0412 \u043a\u043e\u0434\u0435 `memory_manager.py`:\n```python\n# \u041b\u0438\u043d\u0438\u044f 455 \u0432 memory_manager.py\nmeta_dict.setdefault(\"graph_id\", str(graph_id))\nmerged[\"metadata\"] = meta_dict\n```\n\u0425\u043e\u0442\u044f \u0432\u044b \u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0435 `graph_id` \u0432 `config[\"metadata\"]`, \u043f\u0440\u0438 \u0447\u0442\u0435\u043d\u0438\u0438 \u0441\u043f\u0438\u0441\u043a\u0430 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u043e\u0432 (`find_latest_checkpoint_id`) \u0432\u044b \u0432\u0438\u0434\u0438\u0442\u0435 `None`. \u042d\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u043f\u043e\u0442\u043e\u043c\u0443, \u0447\u0442\u043e \u0432\u043e\u0440\u043a\u0435\u0440\u044b \u043d\u0430\u0445\u043e\u0434\u044f\u0442 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u044b, \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u044b\u0435 **\u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u043c \u0433\u0440\u0430\u0444\u043e\u043c** \u0438\u043b\u0438 \u0434\u0440\u0443\u0433\u0438\u043c\u0438 \u0443\u0437\u043b\u0430\u043c\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0435 \u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u044e\u0442 \u044d\u0442\u043e\u0442 \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u0435\u0441\u043a\u0438\u0439 `graph_id`, \u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442 \u0442\u043e\u0442 \u0436\u0435 `checkpoint_ns`.\n\n### 3. \u041e\u043f\u0430\u0441\u043d\u044b\u0439 Fallback \u0432 \u043b\u043e\u0433\u0438\u043a\u0435 \u043f\u043e\u0438\u0441\u043a\u0430\n\u041a\u043e\u0433\u0434\u0430 \u0444\u0438\u043b\u044c\u0442\u0440 \u043f\u043e `graph_id` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 `None` (\u0430 \u043e\u043d \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0435\u0433\u043e \u0432\u0441\u0435\u0433\u0434\u0430, \u0442\u0430\u043a \u043a\u0430\u043a \u043d\u0430\u0445\u043e\u0434\u0438\u0442 \u00ab\u0447\u0443\u0436\u0438\u0435\u00bb \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u044b), \u0441\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442 \u043b\u043e\u0433\u0438\u043a\u0430 \u043e\u0442\u043a\u0430\u0442\u0430 (fallback):\n```python\n# \u041b\u0438\u043d\u0438\u044f 416 \u0432 memory_manager.py\nif not matches and target_checkpoint_ns:\n    for record in checkpoints:\n        if self._extract_checkpoint_ns(record) == target_checkpoint_ns:\n            matches.append(...)\n```\n\u041f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 `checkpoint_ns` \u0443 \u0432\u0441\u0435\u0445 \u0432\u043e\u0440\u043a\u0435\u0440\u043e\u0432 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0435\u0442, \u043e\u043d\u0438 \u0432\u0441\u0435 \u043d\u0430\u0445\u043e\u0434\u044f\u0442 \u043e\u0434\u0438\u043d \u0438 \u0442\u043e\u0442 \u0436\u0435 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 (\u043e\u0442 \u0432\u043e\u0440\u043a\u0435\u0440\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0437\u0430\u043f\u0438\u0441\u0430\u043b \u0435\u0433\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u043c, \u0438\u043b\u0438 \u043e\u0442 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044f) \u0438 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u044e\u0442 \u0435\u0433\u043e.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043a\u0440\u0438\u0442\u0438\u0447\u043d\u043e \u0434\u043b\u044f `wide_funnel`?\n\u0412 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c \u0440\u0435\u0436\u0438\u043c\u0435 (`distributed mode`) \u043a\u0430\u0436\u0434\u044b\u0439 \u0432\u043e\u0440\u043a\u0435\u0440 \u0434\u043e\u043b\u0436\u0435\u043d \u0438\u043c\u0435\u0442\u044c \u0441\u0432\u043e\u044e \u0438\u0437\u043e\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0443\u044e \u043b\u0438\u043d\u0438\u044e \u0432\u0440\u0435\u043c\u0435\u043d\u0438. \u0421\u0435\u0439\u0447\u0430\u0441 \u043e\u043d\u0438 \u0432\u0441\u0435 \u043f\u044b\u0442\u0430\u044e\u0442\u0441\u044f \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c \u043e\u0434\u043d\u0443 \u0438 \u0442\u0443 \u0436\u0435 \u043b\u0438\u043d\u0438\u044e \u0432\u0440\u0435\u043c\u0435\u043d\u0438.\n\n**\u0427\u0442\u043e \u043d\u0443\u0436\u043d\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c:**\n1.  **\u0423\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c `checkpoint_ns`:** \u0412 \u043c\u0435\u0442\u043e\u0434\u0435 `ArchitecturalAgentBase.run` \u0438\u043b\u0438 `_ensure_thread_config` \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c `worker_id` \u043f\u0440\u044f\u043c\u043e \u0432 `checkpoint_ns`, \u0430 \u043d\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435.\n2.  **\u0412\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f \u0437\u0430\u043f\u0438\u0441\u0438 \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0445:** \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435, \u043f\u043e\u0447\u0435\u043c\u0443 `InMemorySaver` \u043d\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u0438\u043b\u0438 \u043d\u0435 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 `graph_id`. \u0412\u043e\u0437\u043c\u043e\u0436\u043d\u043e, \u0441\u0442\u043e\u0438\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0439 \u043a\u043b\u044e\u0447 `langgraph_graph_id`.\n\n**Relevant docs:**\n- [Subgraphs and Persistence](https://docs.langchain.com/oss/python/langgraph/use-subgraphs#add-persistence)\n- [Checkpoint Metadata Structure](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)"
  },
  {
    "role": "user",
    "id": "16d25b80-fc72-484f-8624-8e7920e839e3",
    "content": "\u041a\u0430\u043a \u0440\u0435\u0448\u0438\u0442\u044c \u0431\u043e\u043b\u0435\u0435 \u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e ? "
  },
  {
    "role": "assistant",
    "tool_calls": [
      {
        "type": "function",
        "id": "e49ff6a6-4c0b-4a91-9d0c-ceabcc2387c9",
        "function": {
          "name": "SearchDocsByLangChain",
          "arguments": "{\"query\": \"checkpoint_ns isolation\"}"
        }
      },
      {
        "type": "function",
        "id": "986f60c1-45de-4990-b7d6-16052422f953",
        "function": {
          "name": "search_support_articles",
          "arguments": "{\"collections\": \"OSS (LangChain and LangGraph),LangSmith Deployment,Troubleshooting\"}"
        }
      }
    ],
    "id": "lc_run--019b37fc-52f0-75a2-92b3-e718f4d35970",
    "content": ""
  },
  {
    "role": "tool",
    "name": "SearchDocsByLangChain",
    "tool_call_id": "e49ff6a6-4c0b-4a91-9d0c-ceabcc2387c9",
    "id": "9d56fc31-0157-48e8-baae-60e2250ae96d",
    "content": "Result 1:\nTitle: Use time-travel\nLink: https://docs.langchain.comoss/javascript/langgraph/use-time-travel\nContent: When working with non-deterministic systems that make model-based decisions (e.g., agents powered by LLMs), it can be useful to examine their decision-making process in detail:\n\n1. <Icon icon=\"lightbulb\" size={16} /> **Understand reasoning**: Analyze the steps that led to a successful result.\n2. <Icon icon=\"bug\" size={16} /> **Debug mistakes**: Identify where and why errors occurred.\n3. <Icon icon=\"magnifying-glass\" size={16} /> **Explore alternatives**: Test different paths to uncover better solutions.\n\nLangGraph provides [time travel](/oss/javascript/langgraph/use-time-travel) functionality to support these use cases. Specifically, you can resume execution from a prior checkpoint \u2014 either replaying the same state or modifying it to explore alternatives. In all cases, resuming past execution produces a new fork in the history.\n\nTo use [time-travel](/oss/javascript/langgraph/use-time-travel) in LangGraph:\n\n1. [Run the graph](#1-run-the-graph) with initial inputs using [`invoke`](https://reference.langchain.com/javascript/classes/_langchain_langgraph.index.CompiledStateGraph.html#invoke) or [`stream`](https://reference.langchain.com/javascript/classes/_langchain_langgraph.index.CompiledStateGraph.html#stream) methods.\n2. [Identify a checkpoint in an existing thread](#2-identify-a-checkpoint): Use the [`getStateHistory`](https://reference.langchain.com/javascript/classes/_langchain_langgraph.pregel.Pregel.html#getStateHistory) method to retrieve the execution history for a specific `thread_id` and locate the desired `checkpoint_id`.\n   Alternatively, set a [breakpoint](/oss/javascript/langgraph/interrupts) before the node(s) where you want execution to pause. You can then find the most recent checkpoint recorded up to that breakpoint.\n3. [Update the graph state (optional)](#3-update-the-state-optional): Use the [`updateState`](https://reference.langchain.com/javascript/classes/_langchain_langgraph.pregel.Pregel.html#updateState) method to modify the graph's state at the checkpoint and resume execution from alternative state.\n4. [Resume execution from the checkpoint](#4-resume-execution-from-the-checkpoint): Use the `invoke` or `stream` methods with an input of `null` and a configuration containing the appropriate `thread_id` and `checkpoint_id`.\n\n<Tip>\n  For a conceptual overview of time-travel, see [Time travel](/oss/javascript/langgraph/use-time-travel).\n</Tip>\n\n## In a workflow\n\nThis example builds a simple LangGraph workflow that generates a joke topic and writes a joke using an LLM. It demonstrates how to run the graph, retrieve past execution checkpoints, optionally modify the state, and resume execution from a chosen checkpoint to explore alternate outcomes.\n\n### Setup\n\nFirst we need to install the packages required\n\n```bash  theme={null}\nnpm install @langchain/langgraph @langchain/anthropic\n```\n\nNext, we need to set API keys for Anthropic (the LLM we will use)\n\n```typescript  theme={null}\nprocess.env.ANTHROPIC_API_KEY = \"YOUR_API_KEY\";\n```\n\n<Tip>\n  Sign up for [LangSmith](https://smith.langchain.com) to quickly spot issues and improve the performance of your LangGraph projects. LangSmith lets you use trace data to debug, test, and monitor your LLM apps built with LangGraph.\n</Tip>\n\n```typescript  theme={null}\nimport { v4 as uuidv4 } from \"uuid\";\nimport * as z from \"zod\";\nimport { StateGraph, START, END } from \"@langchain/langgraph\";\nimport { ChatAnthropic } from \"@langchain/anthropic\";\nimport { MemorySaver } from \"@langchain/langgraph\";\n\nconst State = z.object({\n  topic: z.string().optional(),\n  joke: z.string().optional(),\n});\n\nconst model = new ChatAnthropic({\n  model: \"claude-sonnet-4-5-20250929\",\n  temperature: 0,\n});\n\n// Build workflow\nconst workflow = new StateGraph(State)\n  // Add nodes\n  .addNode(\"generateTopic\", async (state) => {\n    // LLM call to generate a topic for the joke\n    const msg = await model.invoke(\"Give me a funny topic for a joke\");\n    return { topic: msg.content };\n  })\n  .addNode(\"writeJoke\", async (state) => {\n    // LLM call to write a joke based on the topic\n    const msg = await model.invoke(`Write a short joke about ${state.topic}`);\n    return { joke: msg.content };\n  })\n  // Add edges to connect nodes\n  .addEdge(START, \"generateTopic\")\n  .addEdge(\"generateTopic\", \"writeJoke\")\n  .addEdge(\"writeJoke\", END);\n\n// Compile\nconst checkpointer = new MemorySaver();\nconst graph = workflow.compile({ checkpointer });\n```\n\n### 1. Run the graph\n\n```typescript  theme={null}\nconst config = {\n  configurable: {\n    thread_id: uuidv4(),\n  },\n};\n\nconst state = await graph.invoke({}, config);\n\nconsole.log(state.topic);\nconsole.log();\nconsole.log(state.joke);\n```\n\n**Output:**\n\n```\nHow about \"The Secret Life of Socks in the Dryer\"? You know, exploring the mysterious phenomenon of how socks go into the laundry as pairs but come out as singles. Where do they go? Are they starting new lives elsewhere? Is there a sock paradise we don't know about? There's a lot of comedic potential in the everyday mystery that unites us all!\n\n# The Secret Life of Socks in the Dryer\n\nI finally discovered where all my missing socks go after the dryer. Turns out they're not missing at all\u2014they've just eloped with someone else's socks from the laundromat to start new lives together.\n\nMy blue argyle is now living in Bermuda with a red polka dot, posting vacation photos on Sockstagram and sending me lint as alimony.\n```\n\n### 2. Identify a checkpoint\n\n```typescript  theme={null}\n// The states are returned in reverse chronological order.\nconst states = [];\nfor await (const state of graph.getStateHistory(config)) {\n  states.push(state);\n}\n\nfor (const state of states) {\n  console.log(state.next);\n  console.log(state.config.configurable?.checkpoint_id);\n  console.log();\n}\n```\n\n**Output:**\n\n```\n[]\n1f02ac4a-ec9f-6524-8002-8f7b0bbeed0e\n\n['writeJoke']\n1f02ac4a-ce2a-6494-8001-cb2e2d651227\n\n['generateTopic']\n1f02ac4a-a4e0-630d-8000-b73c254ba748\n\n['__start__']\n1f02ac4a-a4dd-665e-bfff-e6c8c44315d9\n```\n\n```typescript  theme={null}\n// This is the state before last (states are listed in chronological order)\nconst selectedState = states[1];\nconsole.log(selectedState.next);\nconsole.log(selectedState.values);\n```\n\n**Output:**\n\n```\n['writeJoke']\n{'topic': 'How about \"The Secret Life of Socks in the Dryer\"? You know, exploring the mysterious phenomenon of how socks go into the laundry as pairs but come out as singles. Where do they go? Are they starting new lives elsewhere? Is there a sock paradise we don\\\\'t know about? There\\\\'s a lot of comedic potential in the everyday mystery that unites us all!'}\n```\n\n<a id=\"optional\" />\n\n### 3. Update the state\n\n`updateState` will create a new checkpoint. The new checkpoint will be associated with the same thread, but a new checkpoint ID.\n\n```typescript  theme={null}\nconst newConfig = await graph.updateState(selectedState.config, {\n  topic: \"chickens\",\n});\nconsole.log(newConfig);\n```\n\n**Output:**\n\n```\n{'configurable': {'thread_id': 'c62e2e03-c27b-4cb6-8cea-ea9bfedae006', 'checkpoint_ns': '', 'checkpoint_id': '1f02ac4a-ecee-600b-8002-a1d21df32e4c'}}\n```\n\n### 4. Resume execution from the checkpoint\n\n```typescript  theme={null}\nawait graph.invoke(null, newConfig);\n```\n\n**Output:**\n\n```typescript  theme={null}\n{\n  'topic': 'chickens',\n  'joke': 'Why did the chicken join a band?\\n\\nBecause it had excellent drumsticks!'\n}\n```\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/oss/langgraph/use-time-travel.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n\n---\n\nResult 2:\nTitle: Memory\nLink: https://docs.langchain.comoss/python/langgraph/add-memory\nContent: Checkpointer API\nconfig = {\n    \"configurable\": {\n        \"thread_id\": \"1\",  # [!code highlight]\n        # optionally provide an ID for a specific checkpoint,\n        # otherwise the latest checkpoint is shown\n        # \"checkpoint_id\": \"1f029ca3-1f5b-6704-8004-820c16b69a5a\"  # [!code highlight]\n\n    }\n}\ncheckpointer.get_tuple(config)  # [!code highlight] CheckpointTuple(\n    config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1f029ca3-1f5b-6704-8004-820c16b69a5a'}},\n    checkpoint={\n        'v': 3,\n        'ts': '2025-05-05T16:01:24.680462+00:00',\n        'id': '1f029ca3-1f5b-6704-8004-820c16b69a5a',\n        'channel_versions': {'__start__': '00000000000000000000000000000005.0.5290678567601859', 'messages': '00000000000000000000000000000006.0.3205149138784782', 'branch:to:call_model': '00000000000000000000000000000006.0.14611156755133758'}, 'versions_seen': {'__input__': {}, '__start__': {'__start__': '00000000000000000000000000000004.0.5736472536395331'}, 'call_model': {'branch:to:call_model': '00000000000000000000000000000005.0.1410174088651449'}},\n        'channel_values': {'messages': [HumanMessage(content=\"hi! I'm bob\"), AIMessage(content='Hi Bob! How are you doing today?), HumanMessage(content=\"what's my name?\"), AIMessage(content='Your name is Bob.')]},\n    },\n    metadata={\n        'source': 'loop',\n        'writes': {'call_model': {'messages': AIMessage(content='Your name is Bob.')}},\n        'step': 4,\n        'parents': {},\n        'thread_id': '1'\n    },\n    parent_config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1f029ca3-1790-6b0a-8003-baf965b6a38f'}},\n    pending_writes=[]\n)\n\nCheckpointer API\nconfig = {\n    \"configurable\": {\n        \"thread_id\": \"1\"  # [!code highlight]\n    }\n}\nlist(checkpointer.list(config))  # [!code highlight] [\n    CheckpointTuple(\n        config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1f029ca3-1f5b-6704-8004-820c16b69a5a'}},\n        checkpoint={\n            'v': 3,\n            'ts': '2025-05-05T16:01:24.680462+00:00',\n            'id': '1f029ca3-1f5b-6704-8004-820c16b69a5a',\n            'channel_versions': {'__start__': '00000000000000000000000000000005.0.5290678567601859', 'messages': '00000000000000000000000000000006.0.3205149138784782', 'branch:to:call_model': '00000000000000000000000000000006.0.14611156755133758'},\n            'versions_seen': {'__input__': {}, '__start__': {'__start__': '00000000000000000000000000000004.0.5736472536395331'}, 'call_model': {'branch:to:call_model': '00000000000000000000000000000005.0.1410174088651449'}},\n            'channel_values': {'messages': [HumanMessage(content=\"hi! I'm bob\"), AIMessage(content='Hi Bob! How are you doing today? Is there anything I can help you with?'), HumanMessage(content=\"what's my name?\"), AIMessage(content='Your name is Bob.')]},\n        },\n        metadata={'source': 'loop', 'writes': {'call_model': {'messages': AIMessage(content='Your name is Bob.')}}, 'step': 4, 'parents': {}, 'thread_id': '1'},\n        parent_config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1f029ca3-1790-6b0a-8003-baf965b6a38f'}},\n        pending_writes=[]\n    ),\n    CheckpointTuple(\n        config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1f029ca3-1790-6b0a-8003-baf965b6a38f'}},\n        checkpoint={\n            'v': 3,\n            'ts': '2025-05-05T16:01:23.863421+00:00',\n            'id': '1f029ca3-1790-6b0a-8003-baf965b6a38f',\n            'channel_versions': {'__start__': '00000000000000000000000000000005.0.5290678567601859', 'messages': '00000000000000000000000000000006.0.3205149138784782', 'branch:to:call_model': '00000000000000000000000000000006.0.14611156755133758'},\n            'versions_seen': {'__input__': {}, '__start__': {'__start__': '00000000000000000000000000000004.0.5736472536395331'}, 'call_model': {'branch:to:call_model': '00000000000000000000000000000005.0.1410174088651449'}},\n            'channel_values': {'messages': [HumanMessage(content=\"hi! I'm bob\"), AIMessage(content='Hi Bob! How are you doing today? Is there anything I can help you with?'), HumanMessage(content=\"what's my name?\")], 'branch:to:call_model': None}\n        },\n        metadata={'source': 'loop', 'writes': None, 'step': 3, 'parents': {}, 'thread_id': '1'},\n        parent_config={...},\n        pending_writes=[('8ab4155e-6b15-b885-9ce5-bed69a2c305c', 'messages', AIMessage(content='Your name is Bob.'))]\n    ),\n    CheckpointTuple(\n        config={...},\n        checkpoint={\n            'v': 3,\n            'ts': '2025-05-05T16:01:23.863173+00:00',\n            'id': '1f029ca3-1790-616e-8002-9e021694a0cd',\n            'channel_versions': {'__start__': '00000000000000000000000000000004.0.5736472536395331', 'messages': '00000000000000000000000000000003.0.7056767754077798', 'branch:to:call_model': '00000000000000000000000000000003.0.22059023329132854'},\n            'versions_seen': {'__input__': {}, '__start__': {'__start__': '00000000000000000000000000000001.0.7040775356287469'}, 'call_model': {'branch:to:call_model': '00000000000000000000000000000002.0.9300422176788571'}},\n            'channel_values': {'__start__': {'messages': [{'role': 'user', 'content': \"what's my name?\"}]}, 'messages': [HumanMessage(content=\"hi! I'm bob\"), AIMessage(content='Hi Bob! How are you doing today? Is there anything I can help you with?')]}\n        },\n        metadata={'source': 'input', 'writes': {'__start__': {'messages': [{'role': 'user', 'content': \"what's my name?\"}]}}, 'step': 2, 'parents': {}, 'thread_id': '1'},\n        parent_config={...},\n        pending_writes=[('24ba39d6-6db1-4c9b-f4c5-682aeaf38dcd', 'messages', [{'role': 'user', 'content': \"what's my name?\"}]), ('24ba39d6-6db1-4c9b-f4c5-682aeaf38dcd', 'branch:to:call_model', None)]\n    ),\n    CheckpointTuple(\n        config={...},\n        checkpoint={\n            'v': 3,\n            'ts': '2025-05-05T16:01:23.862295+00:00',\n            'id': '1f029ca3-178d-6f54-8001-d7b180db0c89',\n            'channel_versions': {'__start__': '00000000000000000000000000000002.0.18673090920108737', 'messages': '00000000000000000000000000000003.0.7056767754077798', 'branch:to:call_model': '00000000000000000000000000000003.0.22059023329132854'},\n            'versions_seen': {'__input__': {}, '__start__': {'__start__': '00000000000000000000000000000001.0.7040775356287469'}, 'call_model': {'branch:to:call_model': '00000000000000000000000000000002.0.9300422176788571'}},\n            'channel_values': {'messages': [HumanMessage(content=\"hi! I'm bob\"), AIMessage(content='Hi Bob! How are you doing today? Is there anything I can help you with?')]}\n        },\n        metadata={'source': 'loop', 'writes': {'call_model': {'messages': AIMessage(content='Hi Bob! How are you doing today? Is there anything I can help you with?')}}, 'step': 1, 'parents': {}, 'thread_id': '1'},\n        parent_config={...},\n        pending_writes=[]\n    ),\n    CheckpointTuple(\n        config={...},\n        checkpoint={\n            'v': 3,\n            'ts': '2025-05-05T16:01:22.278960+00:00',\n            'id': '1f029ca3-0874-6612-8000-339f2abc83b1',\n            'channel_versions': {'__start__': '00000000000000000000000000000002.0.18673090920108737', 'messages': '00000000000000000000000000000002.0.30296526818059655', 'branch:to:call_model': '00000000000000000000000000000002.0.9300422176788571'},\n            'versions_seen': {'__input__': {}, '__start__': {'__start__': '00000000000000000000000000000001.0.7040775356287469'}},\n            'channel_values': {'messages': [HumanMessage(content=\"hi! I'm bob\")], 'branch:to:call_model': None}\n        },\n        metadata={'source': 'loop', 'writes': None, 'step': 0, 'parents': {}, 'thread_id': '1'},\n        parent_config={...},\n        pending_writes=[('8cbd75e0-3720-b056-04f7-71ac805140a0', 'messages', AIMessage(content='Hi Bob! How are you doing today? Is there anything I can help you with?'))]\n    ),\n    CheckpointTuple(\n        config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1f029ca3-0870-6ce2-bfff-1f3f14c3e565'}},\n        checkpoint={\n            'v': 3,\n            'ts': '2025-05-05T16:01:22.277497+00:00',\n            'id': '1f029ca3-0870-6ce2-bfff-1f3f14c3e565',\n            'channel_versions': {'__start__': '00...\n\nGraph/Functional API\nconfig = {\n    \"configurable\": {\n        \"thread_id\": \"1\",  # [!code highlight]\n        # optionally provide an ID for a specific checkpoint,\n        # otherwise the latest checkpoint is shown\n        # \"checkpoint_id\": \"1f029ca3-1f5b-6704-8004-820c16b69a5a\"  # [!code highlight]\n\n    }\n}\ngraph.get_state(config)  # [!code highlight] StateSnapshot(\n    values={'messages': [HumanMessage(content=\"hi! I'm bob\"), AIMessage(content='Hi Bob! How are you doing today?), HumanMessage(content=\"what's my name?\"), AIMessage(content='Your name is Bob.')]}, next=(),\n    config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1f029ca3-1f5b-6704-8004-820c16b69a5a'}},\n    metadata={\n        'source': 'loop',\n        'writes': {'call_model': {'messages': AIMessage(content='Your name is Bob.')}},\n        'step': 4,\n        'parents': {},\n        'thread_id': '1'\n    },\n    created_at='2025-05-05T16:01:24.680462+00:00',\n    parent_config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1f029ca3-1790-6b0a-8003-baf965b6a38f'}},\n    tasks=(),\n    interrupts=()\n)\n\n---\n\nResult 3:\nTitle: Persistence\nLink: https://docs.langchain.comoss/python/langgraph/persistence\nContent: Checkpoints\nThe state of a thread at a particular point in time is called a checkpoint. Checkpoint is a snapshot of the graph state saved at each super-step and is represented by StateSnapshot object with the following key properties: config : Config associated with this checkpoint. metadata : Metadata associated with this checkpoint. values : Values of the state channels at this point in time. next A tuple of the node names to execute next in the graph. tasks : A tuple of PregelTask objects that contain information about next tasks to be executed. If the step was previously attempted, it will include error information. If a graph was interrupted dynamically from within a node, tasks will contain additional data associated with interrupts. Checkpoints are persisted and can be used to restore the state of a thread at a later time. Let's see what checkpoints are saved when a simple graph is invoked as follows: After we run the graph, we expect to see exactly 4 checkpoints: Empty checkpoint with START as the next node to be executed Checkpoint with the user input {'foo': '', 'bar': []} and node_a as the next node to be executed Checkpoint with the outputs of node_a {'foo': 'a', 'bar': ['a']} and node_b as the next node to be executed Checkpoint with the outputs of node_b {'foo': 'b', 'bar': ['a', 'b']} and no next nodes to be executed Note that we bar channel values contain outputs from both nodes as we have a reducer for bar channel.\n\nCheckpoints\nThe state of a thread at a particular point in time is called a checkpoint. Checkpoint is a snapshot of the graph state saved at each super-step and is represented by StateSnapshot object with the following key properties: config : Config associated with this checkpoint. metadata : Metadata associated with this checkpoint. values : Values of the state channels at this point in time. next A tuple of the node names to execute next in the graph. tasks : A tuple of PregelTask objects that contain information about next tasks to be executed. If the step was previously attempted, it will include error information. If a graph was interrupted dynamically from within a node, tasks will contain additional data associated with interrupts. Checkpoints are persisted and can be used to restore the state of a thread at a later time. Let's see what checkpoints are saved when a simple graph is invoked as follows: from langgraph.graph import StateGraph, START, END\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom langchain_core.runnables import RunnableConfig\nfrom typing import Annotated\nfrom typing_extensions import TypedDict\nfrom operator import add\n\nclass State(TypedDict):\n    foo: str\n    bar: Annotated[list[str], add]\n\ndef node_a(state: State):\n    return {\"foo\": \"a\", \"bar\": [\"a\"]}\n\ndef node_b(state: State):\n    return {\"foo\": \"b\", \"bar\": [\"b\"]}\n\n\nworkflow = StateGraph(State)\nworkflow.add_node(node_a)\nworkflow.add_node(node_b)\nworkflow.add_edge(START, \"node_a\")\nworkflow.add_edge(\"node_a\", \"node_b\")\nworkflow.add_edge(\"node_b\", END)\n\ncheckpointer = InMemorySaver()\ngraph = workflow.compile(checkpointer=checkpointer)\n\nconfig: RunnableConfig = {\"configurable\": {\"thread_id\": \"1\"}}\ngraph.invoke({\"foo\": \"\", \"bar\":[]}, config)\n\nGet state history\nYou can get the full history of the graph execution for a given thread by calling graph.get_state_history(config) . This will return a list of StateSnapshot objects associated with the thread ID provided in the config. Importantly, the checkpoints will be ordered chronologically with the most recent checkpoint / StateSnapshot being the first in the list. In our example, the output of get_state_history will look like this: [\n    StateSnapshot(\n        values={'foo': 'b', 'bar': ['a', 'b']},\n        next=(),\n        config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1ef663ba-28fe-6528-8002-5a559208592c'}},\n        metadata={'source': 'loop', 'writes': {'node_b': {'foo': 'b', 'bar': ['b']}}, 'step': 2},\n        created_at='2024-08-29T19:19:38.821749+00:00',\n        parent_config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1ef663ba-28f9-6ec4-8001-31981c2c39f8'}},\n        tasks=(),\n    ),\n    StateSnapshot(\n        values={'foo': 'a', 'bar': ['a']},\n        next=('node_b',),\n        config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1ef663ba-28f9-6ec4-8001-31981c2c39f8'}},\n        metadata={'source': 'loop', 'writes': {'node_a': {'foo': 'a', 'bar': ['a']}}, 'step': 1},\n        created_at='2024-08-29T19:19:38.819946+00:00',\n        parent_config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1ef663ba-28f4-6b4a-8000-ca575a13d36a'}},\n        tasks=(PregelTask(id='6fb7314f-f114-5413-a1f3-d37dfe98ff44', name='node_b', error=None, interrupts=()),),\n    ),\n    StateSnapshot(\n        values={'foo': '', 'bar': []},\n        next=('node_a',),\n        config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1ef663ba-28f4-6b4a-8000-ca575a13d36a'}},\n        metadata={'source': 'loop', 'writes': None, 'step': 0},\n        created_at='2024-08-29T19:19:38.817813+00:00',\n        parent_config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1ef663ba-28f0-6c66-bfff-6723431e8481'}},\n        tasks=(PregelTask(id='f1b14528-5ee5-579c-949b-23ef9bfbed58', name='node_a', error=None, interrupts=()),),\n    ),\n    StateSnapshot(\n        values={'bar': []},\n        next=('__start__',),\n        config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1ef663ba-28f0-6c66-bfff-6723431e8481'}},\n        metadata={'source': 'input', 'writes': {'foo': ''}, 'step': -1},\n        created_at='2024-08-29T19:19:38.816205+00:00',\n        parent_config=None,\n        tasks=(PregelTask(id='6d27aa2e-d72b-5504-a36f-8620e54a76dd', name='__start__', error=None, interrupts=()),),\n    )\n]\n"
  },
  {
    "role": "tool",
    "name": "search_support_articles",
    "tool_call_id": "986f60c1-45de-4990-b7d6-16052422f953",
    "id": "f347b357-eabf-4ca7-aad1-602b1197b109",
    "content": "{\n  \"collections\": \"OSS (LangChain and LangGraph),LangSmith Deployment,Troubleshooting\",\n  \"total\": 15,\n  \"articles\": [\n    {\n      \"id\": \"bb651320-775e-4dfa-a054-c955cc3a0d5d\",\n      \"title\": \"Why Do Pydantic\\u00a0date\\u00a0Fields Fail in LangGraph State?\",\n      \"url\": \"https://support.langchain.com/articles/7196116702-why-do-pydantic-date-fields-fail-in-langgraph-state\",\n      \"collection\": \"OSS (LangChain and LangGraph)\"\n    },\n    {\n      \"id\": \"ae959c68-a996-4426-8c8e-ef3fa1dd88cc\",\n      \"title\": \"How do I connect JIRA, Slack, and Confluence MCPs with LangChain?\",\n      \"url\": \"https://support.langchain.com/articles/3473375007-how-do-i-connect-jira-slack-and-confluence-mcps-with-langchain\",\n      \"collection\": \"OSS (LangChain and LangGraph)\"\n    },\n    {\n      \"id\": \"9e06b53a-7b85-4793-b7b6-e179c0c8d815\",\n      \"title\": \"Isolating Subgraph State When Calling Graphs from Tools\",\n      \"url\": \"https://support.langchain.com/articles/6131002418-isolating-subgraph-state-when-calling-graphs-from-tools\",\n      \"collection\": \"OSS (LangChain and LangGraph)\"\n    },\n    {\n      \"id\": \"61f0452e-5198-4524-9c94-a9cf476ea5bc\",\n      \"title\": \"How to Create a Locked-Down Deployment with Restricted Access\",\n      \"url\": \"https://support.langchain.com/articles/5382256129-how-to-create-a-locked-down-deployment-with-restricted-access\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"365a0d3f-d784-407d-b741-fe51fa8356d4\",\n      \"title\": \"LangSmith Deployments not working with Valkey\",\n      \"url\": \"https://support.langchain.com/articles/2265174426-why-are-my-langgraph-requests-hanging-when-using-aws-elasticache-with-valkey\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"55a2c6fe-adf8-4b55-bcb9-969b465241b7\",\n      \"title\": \"Why are my agent threads getting deleted automatically?\",\n      \"url\": \"https://support.langchain.com/articles/7993792111-why-are-my-threads-being-marked-as-temporary-and-getting-deleted-automatically\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"5f2572a3-9086-4d92-8d15-69f7b8e4c8be\",\n      \"title\": \"MCP Server Runtime in Google Colab / Jupyter Notebook\",\n      \"url\": \"https://support.langchain.com/articles/1061688976-mcp-server-runtime-in-google-colab-jupyter-notebook\",\n      \"collection\": \"OSS (LangChain and LangGraph)\"\n    },\n    {\n      \"id\": \"3cec875c-3c8d-4951-b83b-0ac5b8ba7c7c\",\n      \"title\": \"LangSmith Deployments agent is running, but the UI shows it as \\u201cUnsuccessful\\u201d\",\n      \"url\": \"https://support.langchain.com/articles/8394994213-langsmith-deployments-agent-is-running-but-the-ui-shows-it-as-unsuccessful\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"b740be98-677d-486f-ba77-12258712f70a\",\n      \"title\": \"How do I use the LangSmith Control Plane API to manage deployments?\",\n      \"url\": \"https://support.langchain.com/articles/8184800662-how-do-i-use-the-langgraph-platform-control-plane-api-to-manage-deployments\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"52d389ff-3918-46a8-9ccf-55fe972077bf\",\n      \"title\": \"Why is my LangSmith agent queue Deployment timing out after 600 seconds?\",\n      \"url\": \"https://support.langchain.com/articles/7898522976-why-is-my-queue-deployment-timing-out-after-600-seconds\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"c6c77d41-4376-4452-b7a0-fd42c1428242\",\n      \"title\": \"How do I deploy an MCP server on LangSmith Deployments with my agent?\",\n      \"url\": \"https://support.langchain.com/articles/8743137454-how-do-i-deploy-an-mcp-server-on-langsmith-deployments-with-my-agent\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"ebea1a08-4488-4cac-9c65-75442f3de254\",\n      \"title\": \"Adding FastAPI dependency for custom middleware in LangGraph Platform\",\n      \"url\": \"https://support.langchain.com/articles/7593416758-adding-fastapi-dependency-for-custom-middleware-in-langgraph-platform\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"d37491ce-7f3c-4575-91d5-09c62129248e\",\n      \"title\": \"How do I resolve ChatGoogleGenerativeAI blocking errors in LangGraph?\",\n      \"url\": \"https://support.langchain.com/articles/8574277609-how-do-i-resolve-chatgooglegenerativeai-blocking-errors-in-langgraph\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"0b6ce386-e341-47a1-8be9-ae350de16843\",\n      \"title\": \"How do I resolve ChatGoogleGenerativeAI blocking errors in LangGraph?\",\n      \"url\": \"https://support.langchain.com/articles/3873263156-how-do-i-resolve-chatgooglegenerativeai-blocking-errors-in-langgraph\",\n      \"collection\": \"LangSmith Deployment\"\n    },\n    {\n      \"id\": \"f7dc0a0c-fa3f-4319-b820-ae470d89877f\",\n      \"title\": \"Why is token-by-token streaming not working after upgrading LangGraph?\",\n      \"url\": \"https://support.langchain.com/articles/7150806184-why-is-token-by-token-streaming-not-working-after-upgrading-langgraph\",\n      \"collection\": \"LangSmith Deployment\"\n    }\n  ],\n  \"note\": \"All articles listed are public and have content. Use IDs to fetch full content.\"\n}"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b37fc-7740-78e1-a2ef-c1438f02c981",
    "content": "**\u0411\u043e\u043b\u0435\u0435 \u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e \u0440\u0435\u0448\u0438\u0442\u044c \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0443 \u043c\u043e\u0436\u043d\u043e \u0447\u0435\u0440\u0435\u0437 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0445 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432 \u0438\u043c\u0435\u043d (Nested Namespaces) \u0432 `checkpoint_ns`.**\n\n\u0412\u043c\u0435\u0441\u0442\u043e \u0442\u043e\u0433\u043e \u0447\u0442\u043e\u0431\u044b \u0432\u0440\u0443\u0447\u043d\u0443\u044e \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u0435\u0439 \u043f\u043e \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u043c `graph_id`, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0439 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c LangGraph \u0434\u043b\u044f \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u0438 \u0433\u0440\u0430\u0444\u043e\u0432. \u0412 LangGraph `checkpoint_ns` \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443, \u0433\u0434\u0435 \u0447\u0430\u0441\u0442\u0438 \u0440\u0430\u0437\u0434\u0435\u043b\u044f\u044e\u0442\u0441\u044f \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u043c `|`.\n\n### \u041e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435: \u0418\u0437\u043e\u043b\u044f\u0446\u0438\u044f \u0447\u0435\u0440\u0435\u0437 Task ID\n\n\u0414\u043b\u044f \u0432\u043e\u0440\u043a\u0435\u0440\u043e\u0432 \u0432 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c \u0440\u0435\u0436\u0438\u043c\u0435 (`wide_funnel`) \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u0432\u043e\u0440\u043a\u0435\u0440\u0430 \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u0442\u0430\u0442\u044c \u0447\u0430\u0441\u0442\u044c\u044e \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0438\u043c\u0435\u043d. \u042d\u0442\u043e \u043f\u043e\u0437\u0432\u043e\u043b\u0438\u0442 LangGraph \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0438\u0437\u043e\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u044b \u0431\u0435\u0437 \u0440\u0438\u0441\u043a\u0430 \u043a\u043e\u043b\u043b\u0438\u0437\u0438\u0439.\n\n\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u0435 \u043c\u0435\u0442\u043e\u0434 `_ensure_thread_config` \u0432 `ArchitecturalAgentBase` \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b `worker_id` \u043f\u043e\u0434\u043c\u0435\u0448\u0438\u0432\u0430\u043b\u0441\u044f \u0432 `checkpoint_ns`:\n\n```python\ndef _ensure_thread_config(\n    self,\n    *,\n    config: Optional[RunnableConfig],\n    context: Optional[ContextPayload],\n) -> RunnableConfig:\n    merged = self._clone_runnable_config(config)\n    graph_memory = self._resolve_graph_memory_runtime(context=context)\n    merged, _ = graph_memory.ensure_thread_id(merged)\n    \n    # \u041e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u0430\u044f \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u044f: \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c worker_id \u0432 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e \u0438\u043c\u0435\u043d\n    worker_id = self._extract_worker_id(config=merged, context=context)\n    if worker_id:\n        configurable = merged.setdefault(\"configurable\", {})\n        current_ns = configurable.get(\"checkpoint_ns\", \"\")\n        # \u0424\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u043c \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0447\u0435\u0441\u043a\u0438\u0439 NS: \"parent_ns|worker:ID\"\n        new_ns = f\"{current_ns}|worker:{worker_id}\" if current_ns else f\"worker:{worker_id}\"\n        configurable[\"checkpoint_ns\"] = new_ns\n        \n    return merged\n```\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043b\u0443\u0447\u0448\u0435:\n\n1.  **\u041d\u0430\u0442\u0438\u0432\u043d\u0430\u044f \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430 LangGraph:** LangGraph \u0441\u043f\u0440\u043e\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b \u0440\u0430\u0437\u0434\u0435\u043b\u044f\u0442\u044c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0438\u043c\u0435\u043d\u043d\u043e \u0447\u0435\u0440\u0435\u0437 `checkpoint_ns`. \u041f\u0440\u0438 \u0442\u0430\u043a\u043e\u043c \u043f\u043e\u0434\u0445\u043e\u0434\u0435 \u0432\u0430\u043c \u043d\u0435 \u043d\u0443\u0436\u043d\u043e \u043f\u0438\u0441\u0430\u0442\u044c \u0441\u043b\u043e\u0436\u043d\u0443\u044e \u043b\u043e\u0433\u0438\u043a\u0443 `find_latest_checkpoint_id` \u0441 \u0444\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u0435\u0439 \u043f\u043e \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u043c.\n2.  **\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043e\u0447\u0438\u0441\u0442\u043a\u0430:** \u0415\u0441\u043b\u0438 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 TTL \u0434\u043b\u044f \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u043e\u0432, LangGraph \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0443\u0434\u0430\u043b\u0438\u0442 \u0432\u0441\u0435 \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0435 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0438\u043c\u0435\u043d \u0432\u043c\u0435\u0441\u0442\u0435 \u0441 \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u043d\u0438\u0442\u044c\u044e.\n3.  **\u041f\u0440\u043e\u0437\u0440\u0430\u0447\u043d\u043e\u0441\u0442\u044c \u0434\u043b\u044f Debug:** \u0412 LangSmith \u0438\u043b\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0445 \u043b\u043e\u0433\u0430\u0445 \u0432\u044b \u0443\u0432\u0438\u0434\u0438\u0442\u0435 \u0447\u0435\u0442\u043a\u0443\u044e \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443: `wide_funnel|worker:1`, `wide_funnel|worker:2`, \u0447\u0442\u043e \u043c\u0433\u043d\u043e\u0432\u0435\u043d\u043d\u043e \u043e\u0431\u044a\u044f\u0441\u043d\u044f\u0435\u0442, \u0447\u0435\u0439 \u044d\u0442\u043e \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442.\n\n### \u041a\u0430\u043a \u044d\u0442\u043e \u0438\u0437\u043c\u0435\u043d\u0438\u0442 \u043b\u043e\u0433\u0438\u043a\u0443 `memory_manager.py`:\n\n\u041f\u0440\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0438 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0445 `checkpoint_ns` \u043c\u0435\u0442\u043e\u0434 `find_latest_checkpoint_id` \u0443\u043f\u0440\u043e\u0449\u0430\u0435\u0442\u0441\u044f \u0434\u043e \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u043e\u0433\u043e \u0432\u044b\u0437\u043e\u0432\u0430: \u043e\u043d \u0431\u0443\u0434\u0435\u0442 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u044b **\u0442\u043e\u043b\u044c\u043a\u043e** \u0434\u043b\u044f \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0432\u043e\u0440\u043a\u0435\u0440\u0430, \u0442\u0430\u043a \u043a\u0430\u043a \u0434\u0440\u0443\u0433\u0438\u0435 \u0432\u043e\u0440\u043a\u0435\u0440\u044b \u0431\u0443\u0434\u0443\u0442 \u043f\u0438\u0441\u0430\u0442\u044c \u0432 \u0441\u0432\u043e\u0438 \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \"\u043f\u0430\u043f\u043a\u0438\" (namespaces) \u0432\u043d\u0443\u0442\u0440\u0438 \u0442\u043e\u0439 \u0436\u0435 \u043d\u0438\u0442\u0438.\n\n**Relevant docs:**\n\n- [Subgraphs (Shared vs Isolated State)](https://docs.langchain.com/oss/python/langgraph/use-subgraphs)\n- [Persistence and Threads](https://docs.langchain.com/oss/python/langgraph/persistence)\n- [Isolating Subgraph State](https://support.langchain.com/articles/6131002418-isolating-subgraph-state-when-calling-graphs-from-tools)"
  },
  {
    "role": "user",
    "id": "2e48128a-f4d0-4564-a1c2-9ec299f9c624",
    "content": "\u0410 LangGraph \u0441\u0430\u043c \u043d\u0435 \u0441\u043e\u0437\u0434\u0430\u0441\u0442 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 checkpoint_ns \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0432\u043e\u0440\u043a\u0435\u0440\u0430 ? "
  },
  {
    "role": "assistant",
    "tool_calls": [
      {
        "type": "function",
        "id": "abd9f22e-4d8d-4e6d-b497-0a9b0d53eff9",
        "function": {
          "name": "SearchDocsByLangChain",
          "arguments": "{\"query\": \"subgraphs\"}"
        }
      },
      {
        "type": "function",
        "id": "4691c247-4927-419a-b836-81e8fa25e063",
        "function": {
          "name": "SearchDocsByLangChain",
          "arguments": "{\"query\": \"persistence\"}"
        }
      }
    ],
    "id": "lc_run--019b37fe-7bef-7ff1-b91f-3fe0994f98c5",
    "content": ""
  },
  {
    "role": "tool",
    "name": "SearchDocsByLangChain",
    "tool_call_id": "abd9f22e-4d8d-4e6d-b497-0a9b0d53eff9",
    "id": "5cb9bd79-c94f-4068-b59d-82dd22aa994e",
    "content": "Result 1:\nTitle: Subgraphs\nLink: https://docs.langchain.comoss/javascript/langgraph/use-subgraphs\nContent: This guide explains the mechanics of using subgraphs. A subgraph is a [graph](/oss/javascript/langgraph/graph-api#graphs) that is used as a [node](/oss/javascript/langgraph/graph-api#nodes) in another graph.\n\nSubgraphs are useful for:\n\n* Building [multi-agent systems](/oss/javascript/langchain/multi-agent)\n* Re-using a set of nodes in multiple graphs\n* Distributing development: when you want different teams to work on different parts of the graph independently, you can define each part as a subgraph, and as long as the subgraph interface (the input and output schemas) is respected, the parent graph can be built without knowing any details of the subgraph\n\nWhen adding subgraphs, you need to define how the parent graph and the subgraph communicate:\n\n* [Invoke a graph from a node](#invoke-a-graph-from-a-node) \u2014 subgraphs are called from inside a node in the parent graph\n* [Add a graph as a node](#add-a-graph-as-a-node) \u2014 a subgraph is added directly as a node in the parent and **shares [state keys](/oss/javascript/langgraph/graph-api#state)** with the parent\n\n## Setup\n\n```bash  theme={null}\nnpm install @langchain/langgraph\n```\n\n<Tip>\n  **Set up LangSmith for LangGraph development**\n  Sign up for [LangSmith](https://smith.langchain.com) to quickly spot issues and improve the performance of your LangGraph projects. LangSmith lets you use trace data to debug, test, and monitor your LLM apps built with LangGraph \u2014 read more about how to get started [here](https://docs.smith.langchain.com).\n</Tip>\n\n## Invoke a graph from a node\n\nA simple way to implement a subgraph is to invoke a graph from inside the node of another graph. In this case subgraphs can have **completely different schemas** from the parent graph (no shared keys). For example, you might want to keep a private message history for each of the agents in a [multi-agent](/oss/javascript/langchain/multi-agent) system.\n\nIf that's the case for your application, you need to define a node **function that invokes the subgraph**. This function needs to transform the input (parent) state to the subgraph state before invoking the subgraph, and transform the results back to the parent state before returning the state update from the node.\n\n```typescript  theme={null}\nimport { StateGraph, START } from \"@langchain/langgraph\";\nimport * as z from \"zod\";\n\nconst SubgraphState = z.object({\n  bar: z.string(),\n});\n\n// Subgraph\nconst subgraphBuilder = new StateGraph(SubgraphState)\n  .addNode(\"subgraphNode1\", (state) => {\n    return { bar: \"hi! \" + state.bar };\n  })\n  .addEdge(START, \"subgraphNode1\");\n\nconst subgraph = subgraphBuilder.compile();\n\n// Parent graph\nconst State = z.object({\n  foo: z.string(),\n});\n\n// Transform the state to the subgraph state and back\nconst builder = new StateGraph(State)\n  .addNode(\"node1\", async (state) => {\n    const subgraphOutput = await subgraph.invoke({ bar: state.foo });\n    return { foo: subgraphOutput.bar };\n  })\n  .addEdge(START, \"node1\");\n\nconst graph = builder.compile();\n```\n\n<Accordion title=\"Full example: different state schemas\">\n  ```typescript  theme={null}\n  import { StateGraph, START } from \"@langchain/langgraph\";\n  import * as z from \"zod\";\n\n  // Define subgraph\n  const SubgraphState = z.object({\n    // note that none of these keys are shared with the parent graph state\n    bar: z.string(),\n    baz: z.string(),\n  });\n\n  const subgraphBuilder = new StateGraph(SubgraphState)\n    .addNode(\"subgraphNode1\", (state) => {\n      return { baz: \"baz\" };\n    })\n    .addNode(\"subgraphNode2\", (state) => {\n      return { bar: state.bar + state.baz };\n    })\n    .addEdge(START, \"subgraphNode1\")\n    .addEdge(\"subgraphNode1\", \"subgraphNode2\");\n\n  const subgraph = subgraphBuilder.compile();\n\n  // Define parent graph\n  const ParentState = z.object({\n    foo: z.string(),\n  });\n\n  const builder = new StateGraph(ParentState)\n    .addNode(\"node1\", (state) => {\n      return { foo: \"hi! \" + state.foo };\n    })\n    .addNode(\"node2\", async (state) => {\n      const response = await subgraph.invoke({ bar: state.foo });   // [!code highlight]\n      return { foo: response.bar };   // [!code highlight]\n    })\n    .addEdge(START, \"node1\")\n    .addEdge(\"node1\", \"node2\");\n\n  const graph = builder.compile();\n\n  for await (const chunk of await graph.stream(\n    { foo: \"foo\" },\n    { subgraphs: true }\n  )) {\n    console.log(chunk);\n  }\n  ```\n\n  1. Transform the state to the subgraph state\n  2. Transform response back to the parent state\n\n  ```\n  [[], { node1: { foo: 'hi! foo' } }]\n  [['node2:9c36dd0f-151a-cb42-cbad-fa2f851f9ab7'], { subgraphNode1: { baz: 'baz' } }]\n  [['node2:9c36dd0f-151a-cb42-cbad-fa2f851f9ab7'], { subgraphNode2: { bar: 'hi! foobaz' } }]\n  [[], { node2: { foo: 'hi! foobaz' } }]\n  ```\n</Accordion>\n\n<Accordion title=\"Full example: different state schemas (two levels of subgraphs)\">\n  This is an example with two levels of subgraphs: parent -> child -> grandchild.\n\n  ```typescript  theme={null}\n  import { StateGraph, START, END } from \"@langchain/langgraph\";\n  import * as z from \"zod\";\n\n  // Grandchild graph\n  const GrandChildState = z.object({\n    myGrandchildKey: z.string(),\n  });\n\n  const grandchild = new StateGraph(GrandChildState)\n    .addNode(\"grandchild1\", (state) => {\n      // NOTE: child or parent keys will not be accessible here\n      return { myGrandchildKey: state.myGrandchildKey + \", how are you\" };\n    })\n    .addEdge(START, \"grandchild1\")\n    .addEdge(\"grandchild1\", END);\n\n  const grandchildGraph = grandchild.compile();\n\n  // Child graph\n  const ChildState = z.object({\n    myChildKey: z.string(),\n  });\n\n  const child = new StateGraph(ChildState)\n    .addNode(\"child1\", async (state) => {\n      // NOTE: parent or grandchild keys won't be accessible here\n      const grandchildGraphInput = { myGrandchildKey: state.myChildKey };   // [!code highlight]\n      const grandchildGraphOutput = await grandchildGraph.invoke(grandchildGraphInput);\n      return { myChildKey: grandchildGraphOutput.myGrandchildKey + \" today?\" };   // [!code highlight]\n    })   // [!code highlight]\n    .addEdge(START, \"child1\")\n    .addEdge(\"child1\", END);\n\n  const childGraph = child.compile();\n\n  // Parent graph\n  const ParentState = z.object({\n    myKey: z.string(),\n  });\n\n  const parent = new StateGraph(ParentState)\n    .addNode(\"parent1\", (state) => {\n      // NOTE: child or grandchild keys won't be accessible here\n      return { myKey: \"hi \" + state.myKey };\n    })\n    .addNode(\"child\", async (state) => {\n      const childGraphInput = { myChildKey: state.myKey };   // [!code highlight]\n      const childGraphOutput = await childGraph.invoke(childGraphInput);\n      return { myKey: childGraphOutput.myChildKey };   // [!code highlight]\n    })   // [!code highlight]\n    .addNode(\"parent2\", (state) => {\n      return { myKey: state.myKey + \" bye!\" };\n    })\n    .addEdge(START, \"parent1\")\n    .addEdge(\"parent1\", \"child\")\n    .addEdge(\"child\", \"parent2\")\n    .addEdge(\"parent2\", END);\n\n  const parentGraph = parent.compile();\n\n  for await (const chunk of await parentGraph.stream(\n    { myKey: \"Bob\" },\n    { subgraphs: true }\n  )) {\n    console.log(chunk);\n  }\n  ```\n\n  1. We're transforming the state from the child state channels (`myChildKey`) to the grandchild state channels (`myGrandchildKey`)\n  2. We're transforming the state from the grandchild state channels (`myGrandchildKey`) back to the child state channels (`myChildKey`)\n  3. We're passing a function here instead of just compiled graph (`grandchildGraph`)\n  4. We're transforming the state from the parent state channels (`myKey`) to the child state channels (`myChildKey`)\n  5. We're transforming the state from the child state channels (`myChildKey`) back to the parent state channels (`myKey`)\n  6. We're passing a function here instead of just a compiled graph (`childGraph`)\n\n  ```\n  [[], { parent1: { myKey: 'hi Bob' } }]\n  [['child:2e26e9ce-602f-862c-aa66-1ea5a4655e3b', 'child1:781bb3b1-3971-84ce-810b-acf819a03f9c'], { grandchild1: { myGrandchildKey: 'hi Bob, how are you' } }]\n  [['child:2e26e9ce-602f-862c-aa66-1ea5a4655e3b'], { child1: { myChildKey: 'hi Bob, how are you today?' } }]\n  [[], { child: { myKey: 'hi Bob, how are you today?' } }]\n  [[], { parent2: { myKey: 'hi Bob, how are you today? bye!' } }]\n  ```\n</Accordion>\n\n## Add a graph as a node\n\nWhen the parent graph and subgraph can communicate over a shared state key (channel) in the [schema](/oss/javascript/langgraph/graph-api#state), you can add a graph as a [node](/oss/javascript/langgraph/graph-api#nodes) in another graph. For example, in [multi-agent](/oss/javascript/langchain/multi-agent) systems, the agents often communicate over a shared [messages](/oss/javascript/langgraph/graph-api#why-use-messages) key.\n\n<img src=\"https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=c280df5c968cd4237b0b5d03823d8946\" alt=\"SQL agent graph\" style={{ height: \"450px\" }} data-og-width=\"1177\" width=\"1177\" data-og-height=\"818\" height=\"818\" data-path=\"oss/images/subgraph.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=280&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=e3d08dae8fb81e15b4d8069a48999eac 280w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=560&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=8d8942031ba051119e0cb772ef697e0b 560w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=840&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=0d5285bd104c542fe660bc09fed53e5e 840w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=1100&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=32bc8ffa0eda13a0f3bb163631774a60 1100w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=1650&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=6a511f3b9dc44383614803d32390875a 1650w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=2500&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=169d55e154e5ea0146a57373235f768e 2500w\" />\n\nIf your subgraph shares state keys with the parent graph, you can follow these steps to add it to your graph:\n\n1. Define the subgraph workflow (`subgraphBuilder` in the example below) and compile it\n2. Pass compiled subgraph to the `.addNode` method when defining the parent graph workflow\n\n```typescript  theme={null}\nimport { StateGraph, START } from \"@langchain/langgraph\";\nimport * as z from \"zod\";\n\nconst State = z.object({\n  foo: z.string(),\n});\n\n// Subgraph\nconst subgraphBuilder = new StateGraph(State)\n  .addNode(\"subgraphNode1\", (state) => {\n    return { foo: \"hi! \" + state.foo };\n  })\n  .addEdge(START, \"subgraphNode1\");\n\nconst subgraph = subgraphBuilder.compile();\n\n// Parent graph\nconst builder = new StateGraph(State)\n  .addNode(\"node1\", subgraph)\n  .addEdge(START, \"node1\");\n\nconst graph = builder.compile();\n```\n\n<Accordion title=\"Full example: shared state schemas\">\n  ```typescript  theme={null}\n  import { StateGraph, START } from \"@langchain/langgraph\";\n  import * as z from \"zod\";\n\n  // Define subgraph\n  const SubgraphState = z.object({\n    foo: z.string(),    // [!code highlight]\n    bar: z.string(),    // [!code highlight]\n  });\n\n  const subgraphBuilder = new StateGraph(SubgraphState)\n    .addNode(\"subgraphNode1\", (state) => {\n      return { bar: \"bar\" };\n    })\n    .addNode(\"subgraphNode2\", (state) => {\n      // note that this node is using a state key ('bar') that is only available in the subgraph\n      // and is sending update on the shared state key ('foo')\n      return { foo: state.foo + state.bar };\n    })\n    .addEdge(START, \"subgraphNode1\")\n    .addEdge(\"subgraphNode1\", \"subgraphNode2\");\n\n  const subgraph = subgraphBuilder.compile();\n\n  // Define parent graph\n  const ParentState = z.object({\n    foo: z.string(),\n  });\n\n  const builder = new StateGraph(ParentState)\n    .addNode(\"node1\", (state) => {\n      return { foo: \"hi! \" + state.foo };\n    })\n    .addNode(\"node2\", subgraph)\n    .addEdge(START, \"node1\")\n    .addEdge(\"node1\", \"node2\");\n\n  const graph = builder.compile();\n\n  for await (const chunk of await graph.stream({ foo: \"foo\" })) {\n    console.log(chunk);\n  }\n  ```\n\n  1. This key is shared with the parent graph state\n  2. This key is private to the `SubgraphState` and is not visible to the parent graph\n\n  ```\n  { node1: { foo: 'hi! foo' } }\n  { node2: { foo: 'hi! foobar' } }\n  ```\n</Accordion>\n\n## Add persistence\n\nYou only need to **provide the checkpointer when compiling the parent graph**. LangGraph will automatically propagate the checkpointer to the child subgraphs.\n\n```typescript  theme={null}\nimport { StateGraph, START, MemorySaver } from \"@langchain/langgraph\";\nimport * as z from \"zod\";\n\nconst State = z.object({\n  foo: z.string(),\n});\n\n// Subgraph\nconst subgraphBuilder = new StateGraph(State)\n  .addNode(\"subgraphNode1\", (state) => {\n    return { foo: state.foo + \"bar\" };\n  })\n  .addEdge(START, \"subgraphNode1\");\n\nconst subgraph = subgraphBuilder.compile();\n\n// Parent graph\nconst builder = new StateGraph(State)\n  .addNode(\"node1\", subgraph)\n  .addEdge(START, \"node1\");\n\nconst checkpointer = new MemorySaver();\nconst graph = builder.compile({ checkpointer });\n```\n\nIf you want the subgraph to **have its own memory**, you can compile it with the appropriate checkpointer option. This is useful in [multi-agent](/oss/javascript/langchain/multi-agent) systems, if you want agents to keep track of their internal message histories:\n\n```typescript  theme={null}\nconst subgraphBuilder = new StateGraph(...)\nconst subgraph = subgraphBuilder.compile({ checkpointer: true });\n```\n\n## View subgraph state\n\nWhen you enable [persistence](/oss/javascript/langgraph/persistence), you can [inspect the graph state](/oss/javascript/langgraph/persistence#checkpoints) (checkpoint) via the appropriate method. To view the subgraph state, you can use the subgraphs option.\n\nYou can inspect the graph state via `graph.getState(config)`. To view the subgraph state, you can use `graph.getState(config, { subgraphs: true })`.\n\n<Warning>\n  **Available **only** when interrupted**\n  Subgraph state can only be viewed **when the subgraph is interrupted**. Once you resume the graph, you won't be able to access the subgraph state.\n</Warning>\n\n<Accordion title=\"View interrupted subgraph state\">\n  ```typescript  theme={null}\n  import { StateGraph, START, MemorySaver, interrupt, Command } from \"@langchain/langgraph\";\n  import * as z from \"zod\";\n\n  const State = z.object({\n    foo: z.string(),\n  });\n\n  // Subgraph\n  const subgraphBuilder = new StateGraph(State)\n    .addNode(\"subgraphNode1\", (state) => {\n      const value = interrupt(\"Provide value:\");\n      return { foo: state.foo + value };\n    })\n    .addEdge(START, \"subgraphNode1\");\n\n  const subgraph = subgraphBuilder.compile();\n\n  // Parent graph\n  const builder = new StateGraph(State)\n    .addNode(\"node1\", subgraph)\n    .addEdge(START, \"node1\");\n\n  const checkpointer = new MemorySaver();\n  const graph = builder.compile({ checkpointer });\n\n  const config = { configurable: { thread_id: \"1\" } };\n\n  await graph.invoke({ foo: \"\" }, config);\n  const parentState = await graph.getState(config);\n  const subgraphState = (await graph.getState(config, { subgraphs: true })).tasks[0].state;   // [!code highlight]\n\n  // resume the subgraph\n  await graph.invoke(new Command({ resume: \"bar\" }), config);\n  ```\n</Accordion>\n\n## Stream subgraph outputs\n\nTo include outputs from subgraphs in the streamed outputs, you can set the subgraphs option in the stream method of the parent graph. This will stream outputs from both the parent graph and any subgraphs.\n\n```typescript  theme={null}\nfor await (const chunk of await graph.stream(\n  { foo: \"foo\" },\n  {\n    subgraphs: true,   // [!code highlight]\n    streamMode: \"updates\",\n  }\n)) {\n  console.log(chunk);\n}\n```\n\n1. Set `subgraphs: true` to stream outputs from subgraphs.\n\n<Accordion title=\"Stream from subgraphs\">\n  ```typescript  theme={null}\n  import { StateGraph, START } from \"@langchain/langgraph\";\n  import * as z from \"zod\";\n\n  // Define subgraph\n  const SubgraphState = z.object({\n    foo: z.string(),\n    bar: z.string(),\n  });\n\n  const subgraphBuilder = new StateGraph(SubgraphState)\n    .addNode(\"subgraphNode1\", (state) => {\n      return { bar: \"bar\" };\n    })\n    .addNode(\"subgraphNode2\", (state) => {\n      // note that this node is using a state key ('bar') that is only available in the subgraph\n      // and is sending update on the shared state key ('foo')\n      return { foo: state.foo + state.bar };\n    })\n    .addEdge(START, \"subgraphNode1\")\n    .addEdge(\"subgraphNode1\", \"subgraphNode2\");\n\n  const subgraph = subgraphBuilder.compile();\n\n  // Define parent graph\n  const ParentState = z.object({\n    foo: z.string(),\n  });\n\n  const builder = new StateGraph(ParentState)\n    .addNode(\"node1\", (state) => {\n      return { foo: \"hi! \" + state.foo };\n    })\n    .addNode(\"node2\", subgraph)\n    .addEdge(START, \"node1\")\n    .addEdge(\"node1\", \"node2\");\n\n  const graph = builder.compile();\n\n  for await (const chunk of await graph.stream(\n    { foo: \"foo\" },\n    {\n      streamMode: \"updates\",\n      subgraphs: true,   // [!code highlight]\n    }\n  )) {\n    console.log(chunk);\n  }\n  ```\n\n  1. Set `subgraphs: true` to stream outputs from subgraphs.\n\n  ```\n  [[], { node1: { foo: 'hi! foo' } }]\n  [['node2:e58e5673-a661-ebb0-70d4-e298a7fc28b7'], { subgraphNode1: { bar: 'bar' } }]\n  [['node2:e58e5673-a661-ebb0-70d4-e298a7fc28b7'], { subgraphNode2: { foo: 'hi! foobar' } }]\n  [[], { node2: { foo: 'hi! foobar' } }]\n  ```\n</Accordion>\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/oss/langgraph/use-subgraphs.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n\n---\n\nResult 2:\nTitle: Persistence\nLink: https://docs.langchain.comoss/python/langgraph/persistence\nContent: Persistence\nPersistence\nLangGraph has a built-in persistence layer, implemented through checkpointers. When you compile a graph with a checkpointer, the checkpointer saves a checkpoint of the graph state at every super-step. Those checkpoints are saved to a thread , which can be accessed after graph execution. Because threads allow access to graph's state after execution, several powerful capabilities including human-in-the-loop, memory, time travel, and fault-tolerance are all possible. Below, we'll discuss each of these concepts in more detail. Agent Server handles checkpointing automatically When using the Agent Server , you don't need to implement or configure checkpointers manually. The server handles all persistence infrastructure for you behind the scenes.\n\nPersistence\nLangGraph has a built-in persistence layer, implemented through checkpointers. When you compile a graph with a checkpointer, the checkpointer saves a checkpoint of the graph state at every super-step. Those checkpoints are saved to a thread , which can be accessed after graph execution. Because threads allow access to graph's state after execution, several powerful capabilities including human-in-the-loop, memory, time travel, and fault-tolerance are all possible. Below, we'll discuss each of these concepts in more detail. Agent Server handles checkpointing automatically When using the Agent Server , you don't need to implement or configure checkpointers manually. The server handles all persistence infrastructure for you behind the scenes.\n\nMemory Store\nA state schema specifies a set of keys that are populated as a graph is executed. As discussed above, state can be written by a checkpointer to a thread at each graph step, enabling state persistence. But, what if we want to retain some information across threads ? Consider the case of a chatbot where we want to retain specific information about the user across all chat conversations (e.g., threads) with that user! With checkpointers alone, we cannot share information across threads. This motivates the need for the Store interface. As an illustration, we can define an InMemoryStore to store information about a user across threads. We simply compile our graph with a checkpointer, as before, and with our new in_memory_store variable. LangGraph API handles stores automatically When using the LangGraph API, you don't need to implement or configure stores manually. The API handles all storage infrastructure for you behind the scenes.\n\n---\n\nResult 3:\nTitle: Subgraphs\nLink: https://docs.langchain.comoss/python/langgraph/use-subgraphs\nContent: This guide explains the mechanics of using subgraphs. A subgraph is a [graph](/oss/python/langgraph/graph-api#graphs) that is used as a [node](/oss/python/langgraph/graph-api#nodes) in another graph.\n\nSubgraphs are useful for:\n\n* Building [multi-agent systems](/oss/python/langchain/multi-agent)\n* Re-using a set of nodes in multiple graphs\n* Distributing development: when you want different teams to work on different parts of the graph independently, you can define each part as a subgraph, and as long as the subgraph interface (the input and output schemas) is respected, the parent graph can be built without knowing any details of the subgraph\n\nWhen adding subgraphs, you need to define how the parent graph and the subgraph communicate:\n\n* [Invoke a graph from a node](#invoke-a-graph-from-a-node) \u2014 subgraphs are called from inside a node in the parent graph\n* [Add a graph as a node](#add-a-graph-as-a-node) \u2014 a subgraph is added directly as a node in the parent and **shares [state keys](/oss/python/langgraph/graph-api#state)** with the parent\n\n## Setup\n\n<CodeGroup>\n  ```bash pip theme={null}\n  pip install -U langgraph\n  ```\n\n  ```bash uv theme={null}\n  uv add langgraph\n  ```\n</CodeGroup>\n\n<Tip>\n  **Set up LangSmith for LangGraph development**\n  Sign up for [LangSmith](https://smith.langchain.com) to quickly spot issues and improve the performance of your LangGraph projects. LangSmith lets you use trace data to debug, test, and monitor your LLM apps built with LangGraph \u2014 read more about how to get started [here](https://docs.smith.langchain.com).\n</Tip>\n\n## Invoke a graph from a node\n\nA simple way to implement a subgraph is to invoke a graph from inside the node of another graph. In this case subgraphs can have **completely different schemas** from the parent graph (no shared keys). For example, you might want to keep a private message history for each of the agents in a [multi-agent](/oss/python/langchain/multi-agent) system.\n\nIf that's the case for your application, you need to define a node **function that invokes the subgraph**. This function needs to transform the input (parent) state to the subgraph state before invoking the subgraph, and transform the results back to the parent state before returning the state update from the node.\n\n```python  theme={null}\nfrom typing_extensions import TypedDict\nfrom langgraph.graph.state import StateGraph, START\n\nclass SubgraphState(TypedDict):\n    bar: str\n\n# Subgraph\n\ndef subgraph_node_1(state: SubgraphState):\n    return {\"bar\": \"hi! \" + state[\"bar\"]}\n\nsubgraph_builder = StateGraph(SubgraphState)\nsubgraph_builder.add_node(subgraph_node_1)\nsubgraph_builder.add_edge(START, \"subgraph_node_1\")\nsubgraph = subgraph_builder.compile()\n\n# Parent graph\n\nclass State(TypedDict):\n    foo: str\n\ndef call_subgraph(state: State):\n    # Transform the state to the subgraph state\n    subgraph_output = subgraph.invoke({\"bar\": state[\"foo\"]})  # [!code highlight]\n    # Transform response back to the parent state\n    return {\"foo\": subgraph_output[\"bar\"]}\n\nbuilder = StateGraph(State)\nbuilder.add_node(\"node_1\", call_subgraph)\nbuilder.add_edge(START, \"node_1\")\ngraph = builder.compile()\n```\n\n<Accordion title=\"Full example: different state schemas\">\n  ```python  theme={null}\n  from typing_extensions import TypedDict\n  from langgraph.graph.state import StateGraph, START\n\n  # Define subgraph\n  class SubgraphState(TypedDict):\n      # note that none of these keys are shared with the parent graph state\n      bar: str\n      baz: str\n\n  def subgraph_node_1(state: SubgraphState):\n      return {\"baz\": \"baz\"}\n\n  def subgraph_node_2(state: SubgraphState):\n      return {\"bar\": state[\"bar\"] + state[\"baz\"]}\n\n  subgraph_builder = StateGraph(SubgraphState)\n  subgraph_builder.add_node(subgraph_node_1)\n  subgraph_builder.add_node(subgraph_node_2)\n  subgraph_builder.add_edge(START, \"subgraph_node_1\")\n  subgraph_builder.add_edge(\"subgraph_node_1\", \"subgraph_node_2\")\n  subgraph = subgraph_builder.compile()\n\n  # Define parent graph\n  class ParentState(TypedDict):\n      foo: str\n\n  def node_1(state: ParentState):\n      return {\"foo\": \"hi! \" + state[\"foo\"]}\n\n  def node_2(state: ParentState):\n      # Transform the state to the subgraph state\n      response = subgraph.invoke({\"bar\": state[\"foo\"]})\n      # Transform response back to the parent state\n      return {\"foo\": response[\"bar\"]}\n\n\n  builder = StateGraph(ParentState)\n  builder.add_node(\"node_1\", node_1)\n  builder.add_node(\"node_2\", node_2)\n  builder.add_edge(START, \"node_1\")\n  builder.add_edge(\"node_1\", \"node_2\")\n  graph = builder.compile()\n\n  for chunk in graph.stream({\"foo\": \"foo\"}, subgraphs=True):\n      print(chunk)\n  ```\n\n  ```\n  ((), {'node_1': {'foo': 'hi! foo'}})\n  (('node_2:9c36dd0f-151a-cb42-cbad-fa2f851f9ab7',), {'grandchild_1': {'my_grandchild_key': 'hi Bob, how are you'}})\n  (('node_2:9c36dd0f-151a-cb42-cbad-fa2f851f9ab7',), {'grandchild_2': {'bar': 'hi! foobaz'}})\n  ((), {'node_2': {'foo': 'hi! foobaz'}})\n  ```\n</Accordion>\n\n<Accordion title=\"Full example: different state schemas (two levels of subgraphs)\">\n  This is an example with two levels of subgraphs: parent -> child -> grandchild.\n\n  ```python  theme={null}\n  # Grandchild graph\n  from typing_extensions import TypedDict\n  from langgraph.graph.state import StateGraph, START, END\n\n  class GrandChildState(TypedDict):\n      my_grandchild_key: str\n\n  def grandchild_1(state: GrandChildState) -> GrandChildState:\n      # NOTE: child or parent keys will not be accessible here\n      return {\"my_grandchild_key\": state[\"my_grandchild_key\"] + \", how are you\"}\n\n\n  grandchild = StateGraph(GrandChildState)\n  grandchild.add_node(\"grandchild_1\", grandchild_1)\n\n  grandchild.add_edge(START, \"grandchild_1\")\n  grandchild.add_edge(\"grandchild_1\", END)\n\n  grandchild_graph = grandchild.compile()\n\n  # Child graph\n  class ChildState(TypedDict):\n      my_child_key: str\n\n  def call_grandchild_graph(state: ChildState) -> ChildState:\n      # NOTE: parent or grandchild keys won't be accessible here\n      grandchild_graph_input = {\"my_grandchild_key\": state[\"my_child_key\"]}\n      grandchild_graph_output = grandchild_graph.invoke(grandchild_graph_input)\n      return {\"my_child_key\": grandchild_graph_output[\"my_grandchild_key\"] + \" today?\"}\n\n  child = StateGraph(ChildState)\n  # We're passing a function here instead of just compiled graph (`grandchild_graph`)\n  child.add_node(\"child_1\", call_grandchild_graph)\n  child.add_edge(START, \"child_1\")\n  child.add_edge(\"child_1\", END)\n  child_graph = child.compile()\n\n  # Parent graph\n  class ParentState(TypedDict):\n      my_key: str\n\n  def parent_1(state: ParentState) -> ParentState:\n      # NOTE: child or grandchild keys won't be accessible here\n      return {\"my_key\": \"hi \" + state[\"my_key\"]}\n\n  def parent_2(state: ParentState) -> ParentState:\n      return {\"my_key\": state[\"my_key\"] + \" bye!\"}\n\n  def call_child_graph(state: ParentState) -> ParentState:\n      child_graph_input = {\"my_child_key\": state[\"my_key\"]}\n      child_graph_output = child_graph.invoke(child_graph_input)\n      return {\"my_key\": child_graph_output[\"my_child_key\"]}\n\n  parent = StateGraph(ParentState)\n  parent.add_node(\"parent_1\", parent_1)\n  # We're passing a function here instead of just a compiled graph (`child_graph`)\n  parent.add_node(\"child\", call_child_graph)\n  parent.add_node(\"parent_2\", parent_2)\n\n  parent.add_edge(START, \"parent_1\")\n  parent.add_edge(\"parent_1\", \"child\")\n  parent.add_edge(\"child\", \"parent_2\")\n  parent.add_edge(\"parent_2\", END)\n\n  parent_graph = parent.compile()\n\n  for chunk in parent_graph.stream({\"my_key\": \"Bob\"}, subgraphs=True):\n      print(chunk)\n  ```\n\n  ```\n  ((), {'parent_1': {'my_key': 'hi Bob'}})\n  (('child:2e26e9ce-602f-862c-aa66-1ea5a4655e3b', 'child_1:781bb3b1-3971-84ce-810b-acf819a03f9c'), {'grandchild_1': {'my_grandchild_key': 'hi Bob, how are you'}})\n  (('child:2e26e9ce-602f-862c-aa66-1ea5a4655e3b',), {'child_1': {'my_child_key': 'hi Bob, how are you today?'}})\n  ((), {'child': {'my_key': 'hi Bob, how are you today?'}})\n  ((), {'parent_2': {'my_key': 'hi Bob, how are you today? bye!'}})\n  ```\n</Accordion>\n\n## Add a graph as a node\n\nWhen the parent graph and subgraph can communicate over a shared state key (channel) in the [schema](/oss/python/langgraph/graph-api#state), you can add a graph as a [node](/oss/python/langgraph/graph-api#nodes) in another graph. For example, in [multi-agent](/oss/python/langchain/multi-agent) systems, the agents often communicate over a shared [messages](/oss/python/langgraph/graph-api#why-use-messages) key.\n\n<img src=\"https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=c280df5c968cd4237b0b5d03823d8946\" alt=\"SQL agent graph\" style={{ height: \"450px\" }} data-og-width=\"1177\" width=\"1177\" data-og-height=\"818\" height=\"818\" data-path=\"oss/images/subgraph.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=280&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=e3d08dae8fb81e15b4d8069a48999eac 280w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=560&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=8d8942031ba051119e0cb772ef697e0b 560w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=840&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=0d5285bd104c542fe660bc09fed53e5e 840w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=1100&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=32bc8ffa0eda13a0f3bb163631774a60 1100w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=1650&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=6a511f3b9dc44383614803d32390875a 1650w, https://mintcdn.com/langchain-5e9cc07a/ybiAaBfoBvFquMDz/oss/images/subgraph.png?w=2500&fit=max&auto=format&n=ybiAaBfoBvFquMDz&q=85&s=169d55e154e5ea0146a57373235f768e 2500w\" />\n\nIf your subgraph shares state keys with the parent graph, you can follow these steps to add it to your graph:\n\n1. Define the subgraph workflow (`subgraph_builder` in the example below) and compile it\n2. Pass compiled subgraph to the [`add_node`](https://reference.langchain.com/python/langgraph/graphs/#langgraph.graph.state.StateGraph.add_node) method when defining the parent graph workflow\n\n```python  theme={null}\nfrom typing_extensions import TypedDict\nfrom langgraph.graph.state import StateGraph, START\n\nclass State(TypedDict):\n    foo: str\n\n# Subgraph\n\ndef subgraph_node_1(state: State):\n    return {\"foo\": \"hi! \" + state[\"foo\"]}\n\nsubgraph_builder = StateGraph(State)\nsubgraph_builder.add_node(subgraph_node_1)\nsubgraph_builder.add_edge(START, \"subgraph_node_1\")\nsubgraph = subgraph_builder.compile()\n\n# Parent graph\n\nbuilder = StateGraph(State)\nbuilder.add_node(\"node_1\", subgraph)  # [!code highlight]\nbuilder.add_edge(START, \"node_1\")\ngraph = builder.compile()\n```\n\n<Accordion title=\"Full example: shared state schemas\">\n  ```python  theme={null}\n  from typing_extensions import TypedDict\n  from langgraph.graph.state import StateGraph, START\n\n  # Define subgraph\n  class SubgraphState(TypedDict):\n      foo: str  # shared with parent graph state\n      bar: str  # private to SubgraphState\n\n  def subgraph_node_1(state: SubgraphState):\n      return {\"bar\": \"bar\"}\n\n  def subgraph_node_2(state: SubgraphState):\n      # note that this node is using a state key ('bar') that is only available in the subgraph\n      # and is sending update on the shared state key ('foo')\n      return {\"foo\": state[\"foo\"] + state[\"bar\"]}\n\n  subgraph_builder = StateGraph(SubgraphState)\n  subgraph_builder.add_node(subgraph_node_1)\n  subgraph_builder.add_node(subgraph_node_2)\n  subgraph_builder.add_edge(START, \"subgraph_node_1\")\n  subgraph_builder.add_edge(\"subgraph_node_1\", \"subgraph_node_2\")\n  subgraph = subgraph_builder.compile()\n\n  # Define parent graph\n  class ParentState(TypedDict):\n      foo: str\n\n  def node_1(state: ParentState):\n      return {\"foo\": \"hi! \" + state[\"foo\"]}\n\n  builder = StateGraph(ParentState)\n  builder.add_node(\"node_1\", node_1)\n  builder.add_node(\"node_2\", subgraph)\n  builder.add_edge(START, \"node_1\")\n  builder.add_edge(\"node_1\", \"node_2\")\n  graph = builder.compile()\n\n  for chunk in graph.stream({\"foo\": \"foo\"}):\n      print(chunk)\n  ```\n\n  ```\n  {'node_1': {'foo': 'hi! foo'}}\n  {'node_2': {'foo': 'hi! foobar'}}\n  ```\n</Accordion>\n\n## Add persistence\n\nYou only need to **provide the checkpointer when compiling the parent graph**. LangGraph will automatically propagate the checkpointer to the child subgraphs.\n\n```python  theme={null}\nfrom langgraph.graph import START, StateGraph\nfrom langgraph.checkpoint.memory import MemorySaver\nfrom typing_extensions import TypedDict\n\nclass State(TypedDict):\n    foo: str\n\n# Subgraph\n\ndef subgraph_node_1(state: State):\n    return {\"foo\": state[\"foo\"] + \"bar\"}\n\nsubgraph_builder = StateGraph(State)\nsubgraph_builder.add_node(subgraph_node_1)\nsubgraph_builder.add_edge(START, \"subgraph_node_1\")\nsubgraph = subgraph_builder.compile()\n\n# Parent graph\n\nbuilder = StateGraph(State)\nbuilder.add_node(\"node_1\", subgraph)\nbuilder.add_edge(START, \"node_1\")\n\ncheckpointer = MemorySaver()\ngraph = builder.compile(checkpointer=checkpointer)\n```\n\nIf you want the subgraph to **have its own memory**, you can compile it with the appropriate checkpointer option. This is useful in [multi-agent](/oss/python/langchain/multi-agent) systems, if you want agents to keep track of their internal message histories:\n\n```python  theme={null}\nsubgraph_builder = StateGraph(...)\nsubgraph = subgraph_builder.compile(checkpointer=True)\n```\n\n## View subgraph state\n\nWhen you enable [persistence](/oss/python/langgraph/persistence), you can [inspect the graph state](/oss/python/langgraph/persistence#checkpoints) (checkpoint) via the appropriate method. To view the subgraph state, you can use the subgraphs option.\n\nYou can inspect the graph state via `graph.get_state(config)`. To view the subgraph state, you can use `graph.get_state(config, subgraphs=True)`.\n\n<Warning>\n  **Available **only** when interrupted**\n  Subgraph state can only be viewed **when the subgraph is interrupted**. Once you resume the graph, you won't be able to access the subgraph state.\n</Warning>\n\n<Accordion title=\"View interrupted subgraph state\">\n  ```python  theme={null}\n  from langgraph.graph import START, StateGraph\n  from langgraph.checkpoint.memory import MemorySaver\n  from langgraph.types import interrupt, Command\n  from typing_extensions import TypedDict\n\n  class State(TypedDict):\n      foo: str\n\n  # Subgraph\n\n  def subgraph_node_1(state: State):\n      value = interrupt(\"Provide value:\")\n      return {\"foo\": state[\"foo\"] + value}\n\n  subgraph_builder = StateGraph(State)\n  subgraph_builder.add_node(subgraph_node_1)\n  subgraph_builder.add_edge(START, \"subgraph_node_1\")\n\n  subgraph = subgraph_builder.compile()\n\n  # Parent graph\n\n  builder = StateGraph(State)\n  builder.add_node(\"node_1\", subgraph)\n  builder.add_edge(START, \"node_1\")\n\n  checkpointer = MemorySaver()\n  graph = builder.compile(checkpointer=checkpointer)\n\n  config = {\"configurable\": {\"thread_id\": \"1\"}}\n\n  graph.invoke({\"foo\": \"\"}, config)\n  parent_state = graph.get_state(config)\n\n  # This will be available only when the subgraph is interrupted.\n  # Once you resume the graph, you won't be able to access the subgraph state.\n  subgraph_state = graph.get_state(config, subgraphs=True).tasks[0].state\n\n  # resume the subgraph\n  graph.invoke(Command(resume=\"bar\"), config)\n  ```\n\n  1. This will be available only when the subgraph is interrupted. Once you resume the graph, you won't be able to access the subgraph state.\n</Accordion>\n\n## Stream subgraph outputs\n\nTo include outputs from subgraphs in the streamed outputs, you can set the subgraphs option in the stream method of the parent graph. This will stream outputs from both the parent graph and any subgraphs.\n\n```python  theme={null}\nfor chunk in graph.stream(\n    {\"foo\": \"foo\"},\n    subgraphs=True, # [!code highlight]\n    stream_mode=\"updates\",\n):\n    print(chunk)\n```\n\n<Accordion title=\"Stream from subgraphs\">\n  ```python  theme={null}\n  from typing_extensions import TypedDict\n  from langgraph.graph.state import StateGraph, START\n\n  # Define subgraph\n  class SubgraphState(TypedDict):\n      foo: str\n      bar: str\n\n  def subgraph_node_1(state: SubgraphState):\n      return {\"bar\": \"bar\"}\n\n  def subgraph_node_2(state: SubgraphState):\n      # note that this node is using a state key ('bar') that is only available in the subgraph\n      # and is sending update on the shared state key ('foo')\n      return {\"foo\": state[\"foo\"] + state[\"bar\"]}\n\n  subgraph_builder = StateGraph(SubgraphState)\n  subgraph_builder.add_node(subgraph_node_1)\n  subgraph_builder.add_node(subgraph_node_2)\n  subgraph_builder.add_edge(START, \"subgraph_node_1\")\n  subgraph_builder.add_edge(\"subgraph_node_1\", \"subgraph_node_2\")\n  subgraph = subgraph_builder.compile()\n\n  # Define parent graph\n  class ParentState(TypedDict):\n      foo: str\n\n  def node_1(state: ParentState):\n      return {\"foo\": \"hi! \" + state[\"foo\"]}\n\n  builder = StateGraph(ParentState)\n  builder.add_node(\"node_1\", node_1)\n  builder.add_node(\"node_2\", subgraph)\n  builder.add_edge(START, \"node_1\")\n  builder.add_edge(\"node_1\", \"node_2\")\n  graph = builder.compile()\n\n  for chunk in graph.stream(\n      {\"foo\": \"foo\"},\n      stream_mode=\"updates\",\n      subgraphs=True, # [!code highlight]\n  ):\n      print(chunk)\n  ```\n\n  ```\n  ((), {'node_1': {'foo': 'hi! foo'}})\n  (('node_2:e58e5673-a661-ebb0-70d4-e298a7fc28b7',), {'subgraph_node_1': {'bar': 'bar'}})\n  (('node_2:e58e5673-a661-ebb0-70d4-e298a7fc28b7',), {'subgraph_node_2': {'foo': 'hi! foobar'}})\n  ((), {'node_2': {'foo': 'hi! foobar'}})\n  ```\n</Accordion>\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/oss/langgraph/use-subgraphs.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n"
  },
  {
    "role": "tool",
    "name": "SearchDocsByLangChain",
    "tool_call_id": "4691c247-4927-419a-b836-81e8fa25e063",
    "id": "da222432-3694-41a9-b6bd-00416ace24c4",
    "content": "Result 1:\nTitle: Build a multi-source knowledge base with routing\nLink: https://docs.langchain.comoss/javascript/langchain/multi-agent/router-knowledge-base\nContent: Full persistence approach\nIf you need the router itself to maintain state\u2014for example, to use previous search results in routing decisions\u2014use persistence to store message history at the router level. Stateful routers add complexity. When routing to different agents across turns, conversations may feel inconsistent if agents have different tones or prompts. Consider the handoffs pattern or subagents pattern instead\u2014both provide clearer semantics for multi-turn conversations with different agents.\n\n9. Advanced: Stateful routers\nThe router we've built so far is stateless \u2014each request is handled independently with no memory between calls. For multi-turn conversations, you need a stateful approach.\n\nTool wrapper approach\nThe simplest way to add conversation memory is to wrap the stateless router as a tool that a conversational agent can call: import { MemorySaver } from \"@langchain/langgraph\";\n\nconst searchKnowledgeBase = tool(\n  async ({ query }) => {\n    const result = await workflow.invoke({ query });\n    return result.finalAnswer;\n  },\n  {\n    name: \"search_knowledge_base\",\n    description: `Search across multiple knowledge sources (GitHub, Notion, Slack).\nUse this to find information about code, documentation, or team discussions.`,\n    schema: z.object({\n      query: z.string().describe(\"The search query\"),\n    }),\n  }\n);\n\nconst conversationalAgent = createAgent({\n  model: llm,\n  tools: [searchKnowledgeBase],\n  systemPrompt: `\nYou are a helpful assistant that answers questions about our organization.\nUse the search_knowledge_base tool to find information across our code,\ndocumentation, and team discussions.\n  `.trim(),\n  checkpointer: new MemorySaver(),\n});\n\n---\n\nResult 2:\nTitle: Build a multi-source knowledge base with routing\nLink: https://docs.langchain.comoss/python/langchain/multi-agent/router-knowledge-base\nContent: Full persistence approach\nIf you need the router itself to maintain state\u2014for example, to use previous search results in routing decisions\u2014use persistence to store message history at the router level. Stateful routers add complexity. When routing to different agents across turns, conversations may feel inconsistent if agents have different tones or prompts. Consider the handoffs pattern or subagents pattern instead\u2014both provide clearer semantics for multi-turn conversations with different agents.\n\n9. Advanced: Stateful routers\nThe router we've built so far is stateless \u2014each request is handled independently with no memory between calls. For multi-turn conversations, you need a stateful approach.\n\nTool wrapper approach\nThe simplest way to add conversation memory is to wrap the stateless router as a tool that a conversational agent can call: from langgraph.checkpoint.memory import InMemorySaver\n\n\n@tool\ndef search_knowledge_base(query: str) -> str:\n    \"\"\"Search across multiple knowledge sources (GitHub, Notion, Slack).\n\n    Use this to find information about code, documentation, or team discussions.\n    \"\"\"\n    result = workflow.invoke({\"query\": query})\n    return result[\"final_answer\"]\n\n\nconversational_agent = create_agent(\n    model,\n    tools=[search_knowledge_base],\n    system_prompt=(\n        \"You are a helpful assistant that answers questions about our organization. \"\n        \"Use the search_knowledge_base tool to find information across our code, \"\n        \"documentation, and team discussions.\"\n    ),\n    checkpointer=InMemorySaver(),\n)\n\n---\n\nResult 3:\nTitle: Persistence\nLink: https://docs.langchain.comoss/python/langgraph/persistence\nContent: Persistence\nPersistence\nLangGraph has a built-in persistence layer, implemented through checkpointers. When you compile a graph with a checkpointer, the checkpointer saves a checkpoint of the graph state at every super-step. Those checkpoints are saved to a thread , which can be accessed after graph execution. Because threads allow access to graph's state after execution, several powerful capabilities including human-in-the-loop, memory, time travel, and fault-tolerance are all possible. Below, we'll discuss each of these concepts in more detail. Agent Server handles checkpointing automatically When using the Agent Server , you don't need to implement or configure checkpointers manually. The server handles all persistence infrastructure for you behind the scenes.\n\nPersistence\nLangGraph has a built-in persistence layer, implemented through checkpointers. When you compile a graph with a checkpointer, the checkpointer saves a checkpoint of the graph state at every super-step. Those checkpoints are saved to a thread , which can be accessed after graph execution. Because threads allow access to graph's state after execution, several powerful capabilities including human-in-the-loop, memory, time travel, and fault-tolerance are all possible. Below, we'll discuss each of these concepts in more detail. Agent Server handles checkpointing automatically When using the Agent Server , you don't need to implement or configure checkpointers manually. The server handles all persistence infrastructure for you behind the scenes.\n\nMemory Store\nA state schema specifies a set of keys that are populated as a graph is executed. As discussed above, state can be written by a checkpointer to a thread at each graph step, enabling state persistence. But, what if we want to retain some information across threads ? Consider the case of a chatbot where we want to retain specific information about the user across all chat conversations (e.g., threads) with that user! With checkpointers alone, we cannot share information across threads. This motivates the need for the Store interface. As an illustration, we can define an InMemoryStore to store information about a user across threads. We simply compile our graph with a checkpointer, as before, and with our new in_memory_store variable. LangGraph API handles stores automatically When using the LangGraph API, you don't need to implement or configure stores manually. The API handles all storage infrastructure for you behind the scenes.\n"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b37fe-970b-7fd2-b66a-8e5b4b26d502",
    "content": "**LangGraph \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0438\u043c\u0435\u043d \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435, \u0435\u0441\u043b\u0438 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0439 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c \u0432\u044b\u0437\u043e\u0432\u0430 \u043f\u043e\u0434\u0433\u0440\u0430\u0444\u043e\u0432 \u0438\u043b\u0438 \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u044b\u0445 \u0437\u0430\u0434\u0430\u0447.**\n\n\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 \u0432 \u0432\u0430\u0448\u0435\u043c \u043a\u043e\u0434\u0435 \u0437\u0430\u043a\u043b\u044e\u0447\u0430\u0435\u0442\u0441\u044f \u0432 \u0442\u043e\u043c, \u0447\u0442\u043e \u0432\u044b \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0435 \u0433\u0440\u0430\u0444 **\u0432\u0440\u0443\u0447\u043d\u0443\u044e** \u0447\u0435\u0440\u0435\u0437 \u043e\u0431\u0435\u0440\u0442\u043a\u0443, \u0447\u0442\u043e \u0437\u0430\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 LangGraph \u0432\u043e\u0441\u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u044d\u0442\u043e\u0442 \u0432\u044b\u0437\u043e\u0432 \u043a\u0430\u043a \u0441\u0430\u043c\u043e\u0441\u0442\u043e\u044f\u0442\u0435\u043b\u044c\u043d\u044b\u0439, \u0430 \u043d\u0435 \u043a\u0430\u043a \u0447\u0430\u0441\u0442\u044c \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 LangGraph \u043d\u0435 \u0434\u0435\u043b\u0430\u0435\u0442 \u044d\u0442\u043e \u0441\u0430\u043c \u0432 \u0432\u0430\u0448\u0435\u043c \u0441\u043b\u0443\u0447\u0430\u0435:\n\n1.  **\u0420\u0443\u0447\u043d\u043e\u0439 \u0432\u044b\u0437\u043e\u0432 (`Manual Invoke`):** \u0412 `ArchitecturalAgentBase` \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 `await self._invoke_graph_from_checkpoint(...)`. \u042d\u0442\u043e \u043f\u0440\u044f\u043c\u043e\u0439 \u0432\u044b\u0437\u043e\u0432 \u043c\u0435\u0442\u043e\u0434\u0430 `ainvoke()` \u0441\u043a\u043e\u043c\u043f\u0438\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0433\u043e \u0433\u0440\u0430\u0444\u0430. \u0414\u043b\u044f LangGraph \u044d\u0442\u043e \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u0442\u0430\u043a, \u0431\u0443\u0434\u0442\u043e \u0432\u044b \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0435 \u0441\u043e\u0432\u0435\u0440\u0448\u0435\u043d\u043d\u043e \u043d\u043e\u0432\u044b\u0439 \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0432 \u0442\u043e\u0439 \u0436\u0435 \u043d\u0438\u0442\u0438 (`thread_id`).\n2.  **\u041f\u0435\u0440\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u0438\u043a\u0438 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438:** \u0412\u0430\u0448 \u043c\u0435\u0442\u043e\u0434 `_ensure_thread_config` \u0436\u0435\u0441\u0442\u043a\u043e \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u044b\u043c `config`. \u0415\u0441\u043b\u0438 \u0432\u044b \u043d\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 `checkpoint_ns` \u044f\u0432\u043d\u043e, LangGraph \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0438\u043b\u0438 \u043a\u043e\u0440\u043d\u0435\u0432\u043e\u0439, \u0447\u0442\u043e \u0438 \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u043a\u043e\u043b\u043b\u0438\u0437\u0438\u0438 \u0432 \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u044b\u0445 \u0432\u0435\u0442\u043a\u0430\u0445.\n\n### \u041a\u043e\u0433\u0434\u0430 LangGraph \u0434\u0435\u043b\u0430\u0435\u0442 \u044d\u0442\u043e \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438:\n\nLangGraph \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0435\u0442 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0435 `checkpoint_ns` (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, `node_name:uuid`), \u043a\u043e\u0433\u0434\u0430:\n- \u0412\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 `add_node(\"name\", subgraph)` \u2014 \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u0435 \u0432 \u044d\u0442\u043e\u0442 \u0443\u0437\u0435\u043b LangGraph \u0441\u0430\u043c \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0439 namespace.\n- \u0412\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b `Send` \u0434\u043b\u044f \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u2014 \u043a\u0430\u0436\u0434\u044b\u0439 \u0438\u043d\u0441\u0442\u0430\u043d\u0441 \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u0437\u0430\u0434\u0430\u0447\u0438.\n\n### \u041a\u0430\u043a \u0437\u0430\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u0438\u0441\u0442\u0435\u043c\u0443 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e:\n\n\u041f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u0432\u0430\u0448\u0430 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 \u043f\u043e\u0441\u0442\u0440\u043e\u0435\u043d\u0430 \u043d\u0430 \u0440\u0443\u0447\u043d\u043e\u043c \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0438 \u0432\u043e\u0440\u043a\u0435\u0440\u0430\u043c\u0438 \u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430\u043c\u0438 \u0447\u0435\u0440\u0435\u0437 `ArchitecturalAgentBase`, \u0432\u0430\u043c \u043d\u0443\u0436\u043d\u043e **\u044f\u0432\u043d\u043e \u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0442\u044c \u044d\u0441\u0442\u0430\u0444\u0435\u0442\u0443 \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u0438** LangGraph-\u0443.\n\n\u041d\u0430\u0438\u0431\u043e\u043b\u0435\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u043f\u0443\u0442\u044c \u2014 \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u0437\u0430\u0434\u0430\u0447\u0438 \u0438\u0437 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0430 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0435\u0433\u043e \u0432 `checkpoint_ns` \u043f\u0435\u0440\u0435\u0434 \u0432\u044b\u0437\u043e\u0432\u043e\u043c:\n\n```python\n# \u0412 ArchitecturalAgentBase._invoke_graph_from_checkpoint\n# LangGraph \u043e\u0436\u0438\u0434\u0430\u0435\u0442 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u044e \u0438\u043c\u0435\u043d, \u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u043d\u0443\u044e \"|\"\nworker_id = self._extract_worker_id(config=config, context=context)\nif worker_id:\n    # \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u0432\u043e\u0440\u043a\u0435\u0440\u0430 \u0432 \u043f\u0443\u0442\u044c \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430\n    new_ns = f\"{config['configurable'].get('checkpoint_ns', '')}|worker:{worker_id}\".strip('|')\n    config['configurable']['checkpoint_ns'] = new_ns\n```\n\n\u042d\u0442\u043e \u043f\u0440\u0435\u0432\u0440\u0430\u0442\u0438\u0442 \u043f\u043b\u043e\u0441\u043a\u0443\u044e \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u043e\u0432 \u0432 \u0434\u0440\u0435\u0432\u043e\u0432\u0438\u0434\u043d\u0443\u044e, \u0433\u0434\u0435 \u043a\u0430\u0436\u0434\u044b\u0439 \u0432\u043e\u0440\u043a\u0435\u0440 `wide_funnel` \u0431\u0443\u0434\u0435\u0442 \u0438\u043c\u0435\u0442\u044c \u0441\u0432\u043e\u044e \u0438\u0437\u043e\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0443\u044e \u0432\u0435\u0442\u043a\u0443 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f, \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u044f \u043f\u0440\u0438 \u044d\u0442\u043e\u043c \u043e\u0431\u0449\u0443\u044e \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0432 \u0440\u0430\u043c\u043a\u0430\u0445 `thread_id`.\n\n**Relevant docs:**\n\n- [Subgraphs: Invoke from a node](https://docs.langchain.com/oss/python/langgraph/use-subgraphs#invoke-a-graph-from-a-node)\n- [How to use subgraphs](https://docs.langchain.com/oss/python/langgraph/use-subgraphs)\n- [Persistence and Checkpoints](https://docs.langchain.com/oss/python/langgraph/persistence)"
  },
  {
    "role": "user",
    "id": "65bddfc3-9ae8-44f8-a3de-acde3829d07e",
    "content": "\u041a\u0430\u043a \u044d\u0442\u043e \u0440\u0435\u0448\u0438\u0442 \u043c\u043e\u044e \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0443 ? "
  },
  {
    "role": "assistant",
    "id": "lc_run--019b37ff-f3d8-7171-a1b7-12a13802a95e",
    "content": "**\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0447\u0435\u0441\u043a\u0438\u0445 `checkpoint_ns` \u0440\u0435\u0448\u0438\u0442 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0443 \u043a\u043e\u043b\u043b\u0438\u0437\u0438\u0439, \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0438 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439 \u0434\u043b\u044f \u0440\u0430\u0437\u043d\u044b\u0445 \u0432\u043e\u0440\u043a\u0435\u0440\u043e\u0432 \u0432\u043d\u0443\u0442\u0440\u0438 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u043e\u0432.**\n\n\u0412 \u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0432\u0430\u0448\u0438 \u0432\u043e\u0440\u043a\u0435\u0440\u044b \u00ab\u0432\u0438\u0434\u044f\u0442\u00bb \u0447\u0443\u0436\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435, \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e LangGraph (\u0438 \u0432\u0430\u0448 `memory_manager.py`) \u0438\u0449\u0443\u0442 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u044b \u0432 \u043e\u0434\u043d\u043e\u043c \u0438 \u0442\u043e\u043c \u0436\u0435 \u00ab\u043f\u043e\u0447\u0442\u043e\u0432\u043e\u043c \u044f\u0449\u0438\u043a\u0435\u00bb \u2014 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0435 \u0438\u043c\u0435\u043d `wide_funnel:d5cf9adc...`.\n\n## \u041a\u0430\u043a \u044d\u0442\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0438 \u0432 CODE \u0438 DEBUG\n\n1.  **\u0423\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u0435 State Contamination (\u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u044f):**\n    \u041a\u043e\u0433\u0434\u0430 \u0432\u043e\u0440\u043a\u0435\u0440 1 \u043f\u0438\u0448\u0435\u0442 \u0432 `wide_funnel|worker:1`, \u0430 \u0432\u043e\u0440\u043a\u0435\u0440 2 \u2014 \u0432 `wide_funnel|worker:2`, \u0431\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u0438\u0445 \u043a\u0430\u043a \u0440\u0430\u0437\u043d\u044b\u0435 \u0432\u0435\u0442\u043a\u0438. \u041f\u0440\u0438 \u0432\u044b\u0437\u043e\u0432\u0435 `get_state()` \u0438\u043b\u0438 `ainvoke()` \u0432\u043e\u0440\u043a\u0435\u0440 2 \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0438 \u043d\u0435 \u0441\u043c\u043e\u0436\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432\u043e\u0440\u043a\u0435\u0440\u0430 1, \u0442\u0430\u043a \u043a\u0430\u043a LangGraph \u0444\u0438\u043b\u044c\u0442\u0440\u0443\u0435\u0442 \u0437\u0430\u043f\u0438\u0441\u0438 \u043f\u043e \u0442\u043e\u0447\u043d\u043e\u043c\u0443 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u044e `checkpoint_ns`.\n\n2.  **\u0418\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u0438\u043a\u0438 `find_latest_checkpoint_id`:**\n    \u0412 \u043b\u043e\u0433\u0430\u0445 \u0432\u0438\u0434\u043d\u043e, \u0447\u0442\u043e `find_latest_checkpoint_id` \u043d\u0430\u0445\u043e\u0434\u0438\u0442 `count: 2` (\u0434\u0432\u0430 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430), \u0445\u043e\u0442\u044f \u0432\u043e\u0440\u043a\u0435\u0440 \u0442\u043e\u043b\u044c\u043a\u043e \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u043b\u0441\u044f. \u042d\u0442\u043e \u00ab\u0447\u0443\u0436\u0438\u0435\u00bb \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u044b. \u0421 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u043c NS \u044d\u0442\u043e\u0442 \u043f\u043e\u0438\u0441\u043a \u0432\u0435\u0440\u043d\u0435\u0442 `count: 0`, \u0438 \u0432\u043e\u0440\u043a\u0435\u0440 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u043d\u0430\u0447\u043d\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0441 \u0447\u0438\u0441\u0442\u043e\u0433\u043e \u043b\u0438\u0441\u0442\u0430 (\u0438\u043b\u0438 \u0441\u043e \u0441\u0432\u043e\u0435\u0433\u043e \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f), \u043d\u0435 \u043f\u0440\u043e\u0445\u043e\u0434\u044f \u0447\u0435\u0440\u0435\u0437 \u043e\u043f\u0430\u0441\u043d\u044b\u0439 `fallback`.\n\n3.  **\u041a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u0430\u044f \u0440\u0430\u0431\u043e\u0442\u0430 Durable Resume:**\n    \u0415\u0441\u043b\u0438 \u0432\u043e\u0440\u043a\u0435\u0440 5 \u0443\u043f\u0430\u0434\u0435\u0442 \u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u0441\u044f, \u043e\u043d \u043e\u0431\u0440\u0430\u0442\u0438\u0442\u0441\u044f \u043a `wide_funnel|worker:5` \u0438 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442 **\u0441\u0432\u043e\u0435** \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435. \u0421\u0435\u0439\u0447\u0430\u0441 \u043e\u043d \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0442\u043e\u0433\u043e \u0432\u043e\u0440\u043a\u0435\u0440\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0437\u0430\u043f\u0438\u0441\u0430\u043b \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u043c \u0432 \u043e\u0431\u0449\u0443\u044e \u043a\u0443\u0447\u0443.\n\n## \u041f\u0440\u0438\u043c\u0435\u0440 \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0444\u0438\u043a\u0441\u0430\n\n\u0412\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u043f\u043e\u0441\u043e\u0431 \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u043f\u0435\u0440\u0435\u0434 \u0432\u044b\u0437\u043e\u0432\u043e\u043c \u0433\u0440\u0430\u0444\u0430 \u0432 `ArchitecturalAgentBase.py`:\n\n```python\n# \u0412 \u043c\u0435\u0442\u043e\u0434\u0435 _invoke_graph_from_checkpoint \u0438\u043b\u0438 _ensure_thread_config\nworker_id = self._extract_worker_id(config=config, context=context)\nif worker_id:\n    # \u0412\u0430\u0436\u043d\u043e: \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \"|\" \u043a\u0430\u043a \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044c \u0434\u043b\u044f \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u0432 LangGraph\n    configurable = merged.setdefault(\"configurable\", {})\n    base_ns = configurable.get(\"checkpoint_ns\", self.STEP_CONFIG_KEY)\n    \n    # \u0424\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u043c \u0438\u0437\u043e\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0443\u0442\u044c: \"step_name:id|worker:ID\"\n    configurable[\"checkpoint_ns\"] = f\"{base_ns}|worker:{worker_id}\"\n```\n\n## \u0427\u0442\u043e \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u0441\u044f \u0432 \u043b\u043e\u0433\u0430\u0445 DEBUG\n\n\u041f\u043e\u0441\u043b\u0435 \u0444\u0438\u043a\u0441\u0430 \u0437\u0430\u043f\u0438\u0441\u0438 \u0432 \u043b\u043e\u0433\u0430\u0445 \u0438\u0437\u043c\u0435\u043d\u044f\u0442\u0441\u044f \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c:\n- **\u0411\u044b\u043b\u043e:** `checkpoint_ns: \"wide_funnel:d5cf9adc...\"` \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0432\u043e\u0440\u043a\u0435\u0440\u043e\u0432.\n- **\u0421\u0442\u0430\u043d\u0435\u0442:** `checkpoint_ns: \"wide_funnel:d5cf9adc...|worker:1\"`, `...|worker:2` \u0438 \u0442.\u0434.\n\n\u0412 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0435 \u0432\u044b\u0437\u043e\u0432 `find_latest_checkpoint_id` \u0434\u043b\u044f `worker:2` \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u0438 \u043e\u0442 `worker:1`, \u0438 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430 `1f0dd0c5-4575-6370-8002-53ae450fa6e5` \u043f\u0435\u0440\u0435\u0441\u0442\u0430\u043d\u0435\u0442 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u043c\u0435\u0436\u0434\u0443 \u0440\u0430\u0437\u043d\u044b\u043c\u0438 \u0432\u0435\u0442\u043a\u0430\u043c\u0438 \u0438\u0441\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f.\n\n**Relevant docs:**\n\n- [Subgraphs: Shared vs Isolated State](https://docs.langchain.com/oss/python/langgraph/use-subgraphs)\n- [Persistence and Checkpointing](https://docs.langchain.com/oss/python/langgraph/persistence)\n- [Isolating Subgraph State When Calling Graphs from Tools](https://support.langchain.com/articles/6131002418-isolating-subgraph-state-when-calling-graphs-from-tools)"
  },
  {
    "role": "user",
    "id": "353f0ae7-f18f-4a28-b725-7efef0db6253",
    "content": "\u0410 \u0435\u0441\u043b\u0438 \u044f \u0434\u0435\u043b\u0430\u044e \u043f\u0440\u043e\u043a\u0441\u0438 \u043d\u043e\u0434\u0443 \u0432 \u043d\u0435\u0439 \u0432\u044b\u0437\u044b\u0432\u044e invoke \u043f\u043e\u0434\u0433\u0440\u0430\u0444\u0430 - LangGraph \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u043e\u0437\u0434\u0430\u0441\u0442 NS \u0434\u043b\u044f \u043f\u043e\u0434\u0433\u0440\u0430\u0444\u0430 ?  "
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3801-e4d6-7f90-aa0f-6bebd7e735d8",
    "content": "**\u041d\u0435\u0442, \u043f\u0440\u0438 \u0440\u0443\u0447\u043d\u043e\u043c \u0432\u044b\u0437\u043e\u0432\u0435 `subgraph.invoke()` \u0432\u043d\u0443\u0442\u0440\u0438 \u0444\u0443\u043d\u043a\u0446\u0438\u0438-\u043d\u043e\u0434\u044b (\u043f\u0440\u043e\u043a\u0441\u0438-\u043d\u043e\u0434\u044b) LangGraph \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043d\u0435 \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 `checkpoint_ns`.**\n\n\u042d\u0442\u043e \u0438 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0444\u0443\u043d\u0434\u0430\u043c\u0435\u043d\u0442\u0430\u043b\u044c\u043d\u043e\u0439 \u043f\u0440\u0438\u0447\u0438\u043d\u043e\u0439 \u0432\u0430\u0448\u0435\u0439 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b. \u041a\u043e\u0433\u0434\u0430 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 \u043f\u0430\u0442\u0442\u0435\u0440\u043d \u00ab\u0432\u044b\u0437\u043e\u0432 \u0433\u0440\u0430\u0444\u0430 \u0438\u0437 \u0444\u0443\u043d\u043a\u0446\u0438\u0438\u00bb (\u043a\u0430\u043a \u044d\u0442\u043e \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u043e \u0432 `ArchitecturalAgentBase`), LangGraph \u0440\u0430\u0441\u0441\u043c\u0430\u0442\u0440\u0438\u0432\u0430\u0435\u0442 \u044d\u0442\u043e\u0442 \u0432\u044b\u0437\u043e\u0432 \u043a\u0430\u043a \u043e\u0431\u044b\u0447\u043d\u0443\u044e \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044e. \u0415\u0441\u043b\u0438 \u0432\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0434\u0438\u0442\u0435 \u0432 `invoke` \u0442\u043e\u0442 \u0436\u0435 `config`, \u0447\u0442\u043e \u0438 \u0443 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044f, \u043f\u043e\u0434\u0433\u0440\u0430\u0444 \u043d\u0430\u0447\u043d\u0435\u0442 \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0442\u044c \u0441\u0432\u043e\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u044b \u0432 \u0442\u043e \u0436\u0435 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e \u0438\u043c\u0435\u043d, \u0447\u0442\u043e \u0438 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c.\n\n### \u0420\u0430\u0437\u043d\u0438\u0446\u0430 \u043c\u0435\u0436\u0434\u0443 \u043f\u043e\u0434\u0445\u043e\u0434\u0430\u043c\u0438\n\n1.  **\u0415\u0441\u043b\u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u0434\u0433\u0440\u0430\u0444 \u043a\u0430\u043a \u0443\u0437\u0435\u043b (`builder.add_node(\"sub\", subgraph)`):**\n    LangGraph **\u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438** \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043d\u043e\u0432\u044b\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u0438. \u041f\u0443\u0442\u044c \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u0433\u043b\u044f\u0434\u0435\u0442\u044c \u043a\u0430\u043a `node_name:task_id`. \u042d\u0442\u043e \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u0435\u0442 \u0438\u0434\u0435\u0430\u043b\u044c\u043d\u0443\u044e \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u044e \u0431\u0435\u0437 \u0432\u0430\u0448\u0435\u0433\u043e \u0443\u0447\u0430\u0441\u0442\u0438\u044f.\n\n2.  **\u0415\u0441\u043b\u0438 \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c \u0447\u0435\u0440\u0435\u0437 \u043f\u0440\u043e\u043a\u0441\u0438-\u043d\u043e\u0434\u0443 (`subgraph.invoke(..., config)`):**\n    \u0412\u044b \u0434\u043e\u043b\u0436\u043d\u044b **\u0432\u0440\u0443\u0447\u043d\u0443\u044e** \u0440\u0430\u0441\u0448\u0438\u0440\u0438\u0442\u044c `checkpoint_ns`. \u0415\u0441\u043b\u0438 \u0432\u044b \u044d\u0442\u043e\u0433\u043e \u043d\u0435 \u0441\u0434\u0435\u043b\u0430\u0435\u0442\u0435, \u043f\u043e\u0434\u0433\u0440\u0430\u0444 \u00ab\u0437\u0430\u0445\u043b\u0435\u0441\u0442\u043d\u0435\u0442\u00bb \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044f \u0438\u043b\u0438 \u0434\u0440\u0443\u0433\u0438\u0445 \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u044b\u0445 \u043f\u043e\u0434\u0433\u0440\u0430\u0444\u043e\u0432, \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u043e\u043d\u0438 \u0432\u0441\u0435 \u0431\u0443\u0434\u0443\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043e\u0434\u0438\u043d \u0438 \u0442\u043e\u0442 \u0436\u0435 \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0430\u0434\u0440\u0435\u0441 \u0434\u043b\u044f \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u043e\u0432.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u0432 \u0432\u0430\u0448\u0435\u043c \u043a\u043e\u0434\u0435 \u0432\u043e\u0437\u043d\u0438\u043a \u0431\u0430\u0433\n\n\u0412 `ArchitecturalAgentBase` \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 \u0440\u0443\u0447\u043d\u043e\u0439 \u0432\u044b\u0437\u043e\u0432:\n```python\n# CODE 1: \u0420\u0443\u0447\u043d\u043e\u0439 \u0432\u044b\u0437\u043e\u0432 \u043f\u043e\u0434\u0433\u0440\u0430\u0444\u0430\nresult = await graph_memory.ainvoke_from_checkpoint(\n    graph=self._assistant_graph,\n    # ...\n)\n```\n\u041f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u0432\u044b \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0435 \u044d\u0442\u043e \u0432\u0440\u0443\u0447\u043d\u0443\u044e \u0438 \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0435 `config`, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043e\u0431\u0449\u0438\u0439 \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0432\u043e\u0440\u043a\u0435\u0440\u043e\u0432 `checkpoint_ns` (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043f\u0440\u043e\u0441\u0442\u043e `wide_funnel`), \u0432\u043e\u0440\u043a\u0435\u0440\u044b \u043d\u0430\u0447\u0438\u043d\u0430\u044e\u0442 \u043f\u0438\u0441\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u043e\u0434\u043d\u0443 \u0438 \u0442\u0443 \u0436\u0435 \u00ab\u043f\u0430\u043f\u043a\u0443\u00bb.\n\n### \u041a\u0430\u043a \u044d\u0442\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e \u0432 \u043f\u0440\u043e\u043a\u0441\u0438-\u043d\u043e\u0434\u0435\n\n\u0415\u0441\u043b\u0438 \u0432\u0430\u043c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0438\u043c\u0435\u043d\u043d\u043e \u043f\u0440\u043e\u043a\u0441\u0438-\u043d\u043e\u0434\u0443 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0434\u043b\u044f \u0442\u0440\u0430\u043d\u0441\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u0441\u0442\u0435\u0439\u0442\u0430 \u0438\u043b\u0438 \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f), \u0432\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u043f\u043e\u0434\u0433\u0440\u0430\u0444\u0443 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0439 `config` \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u043d\u044b\u043c \u043f\u0443\u0442\u0435\u043c:\n\n```python\nasync def proxy_node(state, config: RunnableConfig):\n    # 1. \u0418\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u043c \u0442\u0435\u043a\u0443\u0449\u0438\u0439 NS\n    current_ns = config[\"configurable\"].get(\"checkpoint_ns\", \"\")\n    \n    # 2. \u0424\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u043c \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043f\u0443\u0442\u044c \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0432\u044b\u0437\u043e\u0432\u0430\n    # \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c '|' \u0434\u043b\u044f \u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c\u043e\u0441\u0442\u0438 \u0441 LangGraph\n    subgraph_config = config.copy()\n    subgraph_config[\"configurable\"] = {\n        **config[\"configurable\"],\n        \"checkpoint_ns\": f\"{current_ns}|subgraph_branch\".strip('|')\n    }\n    \n    # 3. \u0412\u044b\u0437\u044b\u0432\u0430\u0435\u043c \u043f\u043e\u0434\u0433\u0440\u0430\u0444 \u0441 \u0438\u0437\u043e\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u043c \u043a\u043e\u043d\u0444\u0438\u0433\u043e\u043c\n    return await subgraph.ainvoke(state, subgraph_config)\n```\n\n**\u0418\u0442\u043e\u0433:** LangGraph \u0431\u0435\u0440\u0435\u0442 \u043d\u0430 \u0441\u0435\u0431\u044f \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 `checkpoint_ns` \u0442\u043e\u043b\u044c\u043a\u043e \u0442\u043e\u0433\u0434\u0430, \u043a\u043e\u0433\u0434\u0430 \u043e\u043d \u00ab\u0432\u0438\u0434\u0438\u0442\u00bb \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 \u0433\u0440\u0430\u0444\u0430 (\u0447\u0435\u0440\u0435\u0437 `add_node`). \u041a\u0430\u043a \u0442\u043e\u043b\u044c\u043a\u043e \u0432\u044b \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u0438\u0442\u0435 \u043a \u0438\u043c\u043f\u0435\u0440\u0430\u0442\u0438\u0432\u043d\u043e\u043c\u0443 \u0432\u044b\u0437\u043e\u0432\u0443 `.invoke()` \u0432\u043d\u0443\u0442\u0440\u0438 \u043a\u043e\u0434\u0430, \u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0441\u0442\u044c \u0437\u0430 \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u044e \u043b\u043e\u0436\u0438\u0442\u0441\u044f \u043d\u0430 \u0432\u0430\u0441.\n\n**Relevant docs:**\n\n- [Subgraphs: Invoke a graph from a node](https://docs.langchain.com/oss/python/langgraph/use-subgraphs#invoke-a-graph-from-a-node)\n- [How to add persistence to subgraphs](https://docs.langchain.com/oss/python/langgraph/use-subgraphs#add-persistence)\n- [Persistence: Threads and Checkpoints](https://docs.langchain.com/oss/python/langgraph/persistence)"
  },
  {
    "role": "user",
    "id": "887cbae8-b19c-4a6f-a68a-7fa6d461f2ef",
    "content": "\u0410 \u0443 \u043c\u0435\u043d\u044f \u043e\u043d  \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u043e\u0437\u0434\u0430\u0435\u0442 checkpoint_ns, \u043f\u0435\u0440\u0435\u043f\u0440\u043e\u0432\u0435\u0440\u044c \u0441\u0435\u0431\u044f"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3802-d8db-7f51-908d-07e4d80a07cb",
    "content": "\u0412\u044b \u043f\u0440\u0430\u0432\u044b, LangGraph \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043c\u043e\u0436\u0435\u0442 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0440\u0430\u0441\u0448\u0438\u0440\u044f\u0442\u044c `checkpoint_ns`, \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u044f \u0441\u0443\u0444\u0444\u0438\u043a\u0441 \u0432\u0440\u043e\u0434\u0435 `|graph:UUID` \u0438\u043b\u0438 `|task:UUID` \u043f\u0440\u0438 \u0432\u044b\u0437\u043e\u0432\u0435 \u043f\u043e\u0434\u0433\u0440\u0430\u0444\u043e\u0432. \u0412 \u0432\u0430\u0448\u0438\u0445 \u043b\u043e\u0433\u0430\u0445 `DEBUG` \u044d\u0442\u043e \u0447\u0435\u0442\u043a\u043e \u0432\u0438\u0434\u043d\u043e \u0432 28-\u0439 \u0437\u0430\u043f\u0438\u0441\u0438:\n\n`\"checkpoint_ns\": \"route_drafting:4dc...|graph:256...\"`\n\n**\u041e\u0434\u043d\u0430\u043a\u043e, LangGraph \u0434\u0435\u043b\u0430\u0435\u0442 \u044d\u0442\u043e \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u0438 \u00ab\u0433\u043b\u0443\u0431\u0438\u043d\u044b\u00bb (\u0432\u043b\u043e\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u0438), \u043d\u043e \u043d\u0435 \u0434\u043b\u044f \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u0438 \u00ab\u0448\u0438\u0440\u0438\u043d\u044b\u00bb (\u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u044b\u0445 \u0432\u043e\u0440\u043a\u0435\u0440\u043e\u0432) \u0432 \u0432\u0430\u0448\u0435\u0439 \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0435.**\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u0432 `wide_funnel` \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u043a\u0430 \u043d\u0435 \u0441\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442:\n\n\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u0442\u0435 \u043d\u0430 \u0432\u0430\u0448\u0438 \u043b\u043e\u0433\u0438 \u0434\u043b\u044f \u0432\u043e\u0440\u043a\u0435\u0440\u043e\u0432 `wide_funnel`:\n- **Worker 1:** `checkpoint_ns: \"wide_funnel:d5cf9adc...\"`\n- **Worker 2:** `checkpoint_ns: \"wide_funnel:d5cf9adc...\"`\n\n\u041e\u043d\u0438 **\u0438\u0434\u0435\u043d\u0442\u0438\u0447\u043d\u044b**. \u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u043a\u0430 LangGraph \u043d\u0435 \u0437\u043d\u0430\u0435\u0442, \u0447\u0442\u043e \u0432\u044b \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u043b\u0438 9 \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u044b\u0445 \u0432\u043e\u0440\u043a\u0435\u0440\u043e\u0432 \u0432 \u0440\u0430\u043c\u043a\u0430\u0445 \u043e\u0434\u043d\u043e\u0433\u043e \u0438 \u0442\u043e\u0433\u043e \u0436\u0435 \u0448\u0430\u0433\u0430. \u0414\u043b\u044f \u043d\u0435\u0451 \u044d\u0442\u043e \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u043a\u0430\u043a 9 \u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u044b\u0445 \u0432\u044b\u0437\u043e\u0432\u043e\u0432 `invoke()`, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043f\u0440\u0438\u0445\u043e\u0434\u044f\u0442 \u0441 \u043e\u0434\u043d\u0438\u043c \u0438 \u0442\u0435\u043c \u0436\u0435 \u0431\u0430\u0437\u043e\u0432\u044b\u043c \u043a\u043e\u043d\u0444\u0438\u0433\u043e\u043c \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0433\u043e \u0443\u0437\u043b\u0430.\n\n### \u0413\u0434\u0435 \u0438\u043c\u0435\u043d\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0441\u0431\u043e\u0439 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u043a\u0438:\n\n\u0412 `memory_manager.py` (CODE 2) \u0432 \u043c\u0435\u0442\u043e\u0434\u0435 `ainvoke_from_checkpoint` \u0432\u044b \u0434\u0435\u043b\u0430\u0435\u0442\u0435 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0435:\n```python\n# \u041b\u0438\u043d\u0438\u0438 440-445\noriginal_ns = merged_conf_dict.get(\"checkpoint_ns\", \"\")\nmerged_conf_dict.setdefault(\"checkpoint_ns\", \"\")\nmerged[\"configurable\"] = merged_conf_dict\n```\n\u0417\u0434\u0435\u0441\u044c \u0432\u044b \u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0444\u0438\u043a\u0441\u0438\u0440\u0443\u0435\u0442\u0435 `checkpoint_ns`. \u041a\u043e\u0433\u0434\u0430 \u0432\u044b \u0437\u0430\u0442\u0435\u043c \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0435 `graph.ainvoke(..., config=merged)`, LangGraph \u0432\u0438\u0434\u0438\u0442, \u0447\u0442\u043e \u0432 `configurable` \u0443\u0436\u0435 **\u0435\u0441\u0442\u044c** \u043a\u043b\u044e\u0447 `checkpoint_ns`, \u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0435\u0433\u043e \u043a\u0430\u043a \u0431\u0430\u0437\u043e\u0432\u044b\u0439.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043d\u0435 \u0440\u0435\u0448\u0430\u0435\u0442 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0443 \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u0438\u0437\u043c\u0430:\n\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0441\u0443\u0444\u0444\u0438\u043a\u0441 `|graph:UUID` \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u0430 \u0432\u044b\u0437\u043e\u0432\u0430. \u041d\u043e \u0432 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u0439 \u0441\u0438\u0441\u0442\u0435\u043c\u0435 (\u0435\u0441\u043b\u0438 \u0432\u0430\u0448\u0438 \u0432\u043e\u0440\u043a\u0435\u0440\u044b \u2014 \u044d\u0442\u043e \u0440\u0430\u0437\u043d\u044b\u0435 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u044b \u0438\u043b\u0438 \u0432\u0435\u0442\u043a\u0438), \u043e\u043d\u0438 \u043c\u043e\u0433\u0443\u0442 \u043b\u0438\u0431\u043e \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0435 \u0441\u0443\u0444\u0444\u0438\u043a\u0441\u044b, \u043b\u0438\u0431\u043e (\u0447\u0442\u043e \u0447\u0430\u0449\u0435 \u0432 \u0432\u0430\u0448\u0435\u0439 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0435) \u043e\u043d\u0438 \u043d\u0430\u0445\u043e\u0434\u044f\u0442 \u043e\u0434\u0438\u043d \u0438 \u0442\u043e\u0442 \u0436\u0435 \u00ab\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439\u00bb \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0432 \u0431\u0430\u0437\u043e\u0432\u043e\u043c \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0435 \u0438\u043c\u0435\u043d \u0435\u0449\u0435 **\u0434\u043e** \u0442\u043e\u0433\u043e, \u043a\u0430\u043a LangGraph \u0443\u0441\u043f\u0435\u0435\u0442 \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u0432\u043e\u044e \u043c\u0430\u0433\u0438\u044e \u0441\u0443\u0444\u0444\u0438\u043a\u0441\u043e\u0432.\n\n### \u041a\u0430\u043a \u0440\u0435\u0448\u0438\u0442\u044c \u044d\u0442\u043e \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e:\n\n\u0412\u044b \u043f\u0440\u0430\u0432\u044b, \u0447\u0442\u043e LangGraph \u0443\u043c\u0435\u0435\u0442 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c `ns`, \u043d\u043e \u0435\u043c\u0443 \u043d\u0443\u0436\u043d\u043e \u043f\u043e\u0434\u0441\u043a\u0430\u0437\u0430\u0442\u044c, \u0447\u0442\u043e \u044d\u0442\u0438 \u0432\u044b\u0437\u043e\u0432\u044b \u2014 **\u0440\u0430\u0437\u043d\u044b\u0435 \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0432\u0435\u0442\u043a\u0438**.\n\n\u0412\u043c\u0435\u0441\u0442\u043e \u0440\u0443\u0447\u043d\u043e\u0433\u043e \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0441\u0442\u0440\u043e\u043a\u0438, \u0434\u043e\u0431\u0430\u0432\u044c\u0442\u0435 `worker_id` \u0432 `configurable` \u043f\u043e\u0434 \u0441\u0432\u043e\u0438\u043c \u043a\u043b\u044e\u0447\u043e\u043c, \u0430 \u0432 `ArchitecturalAgentBase` \u0443\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e \u043a\u0430\u0436\u0434\u044b\u0439 \u0432\u043e\u0440\u043a\u0435\u0440 \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u044d\u0442\u043e\u0442 ID. \u0422\u043e\u0433\u0434\u0430 LangGraph \u0441\u043c\u043e\u0436\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0435\u0433\u043e \u0434\u043b\u044f \u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u044f, \u0438\u043b\u0438 \u0432\u044b \u0441\u043c\u043e\u0436\u0435\u0442\u0435 \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u044d\u0442\u043e \u043e\u0434\u043d\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u043e\u0439, \u043d\u0435 \u043b\u043e\u043c\u0430\u044f \u043b\u043e\u0433\u0438\u043a\u0443 \u043f\u043e\u0434\u0433\u0440\u0430\u0444\u043e\u0432:\n\n```python\n# \u0412 memory_manager.py \u043f\u0435\u0440\u0435\u0434 \u0432\u044b\u0437\u043e\u0432\u043e\u043c ainvoke\nif worker_id := config.get(\"configurable\", {}).get(\"worker_id\"):\n    # \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u0432\u043e\u0440\u043a\u0435\u0440\u0430 \u0432 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u044e NS, \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u044f LangGraph \n    # \u0438 \u0434\u0430\u043b\u044c\u0448\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c \u0441\u0432\u043e\u0438 \u0441\u0443\u0444\u0444\u0438\u043a\u0441\u044b |graph:... \u043f\u043e\u0441\u043b\u0435 \u043d\u0435\u0433\u043e\n    merged[\"configurable\"][\"checkpoint_ns\"] += f\"|worker:{worker_id}\"\n```\n\n**\u0418\u0442\u043e\u0433:** LangGraph \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0438\u0437\u043e\u043b\u0438\u0440\u0443\u0435\u0442 **\u043f\u043e\u0434\u0433\u0440\u0430\u0444\u044b**, \u043d\u043e \u043e\u043d \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0438\u0437\u043e\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c **\u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u044b\u0435 \u043a\u043e\u043f\u0438\u0438** \u043e\u0434\u043d\u043e\u0433\u043e \u0438 \u0442\u043e\u0433\u043e \u0436\u0435 \u0433\u0440\u0430\u0444\u0430 (\u0432\u043e\u0440\u043a\u0435\u0440\u044b), \u0435\u0441\u043b\u0438 \u043e\u043d\u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u044e\u0442\u0441\u044f \u0432\u0440\u0443\u0447\u043d\u0443\u044e \u0441 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u043c\u0438 \u0432\u0445\u043e\u0434\u043d\u044b\u043c\u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c\u0438 `checkpoint_ns`.\n\n**Relevant docs:**\n- [Subgraphs and Persistence](https://docs.langchain.com/oss/python/langgraph/use-subgraphs#add-persistence)\n- [Checkpoints and Namespaces](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)\n- [Time Travel and State History](https://docs.langchain.com/oss/python/langgraph/use-time-travel)"
  },
  {
    "role": "user",
    "id": "24365a0b-a605-4fef-9952-3e30e767f8d9",
    "content": "\u0422\u0435\u043f\u0435\u0440\u044c \u043f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 {\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:66b4be96-e587-40b3-ca99-0fcdcc6daeb8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766171627074.599}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766171627074.7002}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:66b4be96-e587-40b3-ca99-0fcdcc6daeb8\", \"new_ns\": \"user_preferences:66b4be96-e587-40b3-ca99-0fcdcc6daeb8\"}, \"timestamp\": 1766171627074.75}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:66b4be96-e587-40b3-ca99-0fcdcc6daeb8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\"}, \"timestamp\": 1766171627074.788}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"count\": 0, \"records\": []}, \"timestamp\": 1766171627075.0852}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766171627075.1191}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171627075.1848}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766171627075.228}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171627075.267}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766171627075.4932}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171627075.608}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171627075.645}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766171627075.701}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:66b4be96-e587-40b3-ca99-0fcdcc6daeb8\"}, \"timestamp\": 1766171627075.729}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766171633845.1992}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:998b09d8-868a-1b79-bece-1f13c5fb6ee0\", \"new_ns\": \"route_drafting:998b09d8-868a-1b79-bece-1f13c5fb6ee0\"}, \"timestamp\": 1766171633851.276}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:998b09d8-868a-1b79-bece-1f13c5fb6ee0\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\"}, \"timestamp\": 1766171633851.3643}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"count\": 0, \"records\": []}, \"timestamp\": 1766171633851.6638}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766171633851.708}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171633851.867}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766171633851.933}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171633851.989}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766171633852.2593}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171633852.31}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171633852.396}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766171633852.4402}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:998b09d8-868a-1b79-bece-1f13c5fb6ee0\"}, \"timestamp\": 1766171633852.4749}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:998b09d8-868a-1b79-bece-1f13c5fb6ee0|graph:24df48e3-7ec4-4c01-d763-1016bd1fd9c9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766171634108.762}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766171634108.874}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:998b09d8-868a-1b79-bece-1f13c5fb6ee0|graph:24df48e3-7ec4-4c01-d763-1016bd1fd9c9\", \"new_ns\": \"route_drafting:998b09d8-868a-1b79-bece-1f13c5fb6ee0|graph:24df48e3-7ec4-4c01-d763-1016bd1fd9c9\"}, \"timestamp\": 1766171634108.933}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:998b09d8-868a-1b79-bece-1f13c5fb6ee0|graph:24df48e3-7ec4-4c01-d763-1016bd1fd9c9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\"}, \"timestamp\": 1766171634108.978}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"count\": 0, \"records\": []}, \"timestamp\": 1766171634109.288}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766171634109.335}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171634109.449}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766171634109.7268}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171634109.8472}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766171634109.892}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:998b09d8-868a-1b79-bece-1f13c5fb6ee0|graph:24df48e3-7ec4-4c01-d763-1016bd1fd9c9\"}, \"timestamp\": 1766171634109.94}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766171648401.689}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:1\", \"new_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:1\"}, \"timestamp\": 1766171648475.689}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\"}, \"timestamp\": 1766171648475.8599}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"count\": 0, \"records\": []}, \"timestamp\": 1766171648476.609}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766171648476.681}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171648476.803}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766171648476.8699}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171648476.96}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766171648477.261}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171648477.307}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171648477.346}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766171648477.3813}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:1\"}, \"timestamp\": 1766171648477.419}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:2\", \"new_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:2\"}, \"timestamp\": 1766171648537.291}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\"}, \"timestamp\": 1766171648537.441}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"count\": 0, \"records\": []}, \"timestamp\": 1766171648538.11}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766171648538.157}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171648538.342}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766171648538.4163}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171648538.4673}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766171648538.794}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171648538.8447}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171648538.885}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766171648538.923}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:2\"}, \"timestamp\": 1766171648538.955}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:3\", \"new_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:3\"}, \"timestamp\": 1766171648596.852}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\"}, \"timestamp\": 1766171648597.004}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"count\": 0, \"records\": []}, \"timestamp\": 1766171648597.31}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766171648597.357}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171648597.509}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766171648597.579}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171648597.67}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766171648597.967}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171648598.0178}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171648598.0588}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766171648598.098}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:3\"}, \"timestamp\": 1766171648598.133}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:4\", \"new_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:4\"}, \"timestamp\": 1766171648657.914}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\"}, \"timestamp\": 1766171648658.07}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"count\": 0, \"records\": []}, \"timestamp\": 1766171648658.741}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766171648658.7898}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171648658.8591}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766171648658.9172}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171648659.004}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766171648659.2488}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171648659.299}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171648659.343}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766171648659.383}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:4\"}, \"timestamp\": 1766171648659.4172}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:1|1|graph:3340c1c2-ddc8-0d73-bc59-1e8dc55c7112\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766171649241.956}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766171649242.05}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:1|1|graph:3340c1c2-ddc8-0d73-bc59-1e8dc55c7112\", \"new_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:1|1|graph:3340c1c2-ddc8-0d73-bc59-1e8dc55c7112\"}, \"timestamp\": 1766171649242.105}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:1|1|graph:3340c1c2-ddc8-0d73-bc59-1e8dc55c7112\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\"}, \"timestamp\": 1766171649242.1519}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"count\": 0, \"records\": []}, \"timestamp\": 1766171649242.456}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766171649242.568}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171649242.635}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766171649242.885}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171649242.928}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766171649242.961}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:1|1|graph:3340c1c2-ddc8-0d73-bc59-1e8dc55c7112\"}, \"timestamp\": 1766171649243.003}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:2|2|graph:e65b0791-b082-c04b-c833-835d4e8cfe05\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766171649275.766}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766171649275.872}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:2|2|graph:e65b0791-b082-c04b-c833-835d4e8cfe05\", \"new_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:2|2|graph:e65b0791-b082-c04b-c833-835d4e8cfe05\"}, \"timestamp\": 1766171649275.921}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:2|2|graph:e65b0791-b082-c04b-c833-835d4e8cfe05\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\"}, \"timestamp\": 1766171649275.9622}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"count\": 0, \"records\": []}, \"timestamp\": 1766171649276.266}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766171649276.305}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171649276.4768}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766171649276.777}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171649276.827}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766171649276.8628}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:2|2|graph:e65b0791-b082-c04b-c833-835d4e8cfe05\"}, \"timestamp\": 1766171649276.895}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:3|3|graph:7e5f80fc-74ca-527f-b6d4-2c2d44b5d22e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766171649310.109}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766171649310.1912}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:3|3|graph:7e5f80fc-74ca-527f-b6d4-2c2d44b5d22e\", \"new_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:3|3|graph:7e5f80fc-74ca-527f-b6d4-2c2d44b5d22e\"}, \"timestamp\": 1766171649310.239}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:3|3|graph:7e5f80fc-74ca-527f-b6d4-2c2d44b5d22e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\"}, \"timestamp\": 1766171649310.2788}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"count\": 0, \"records\": []}, \"timestamp\": 1766171649310.591}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766171649310.633}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171649310.697}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766171649310.9287}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171649310.98}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766171649311.021}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:3|3|graph:7e5f80fc-74ca-527f-b6d4-2c2d44b5d22e\"}, \"timestamp\": 1766171649311.059}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:4|4|graph:bc6e46c2-200c-355e-c0c2-13bbac840b9f\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766171649344.3242}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766171649344.458}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:4|4|graph:bc6e46c2-200c-355e-c0c2-13bbac840b9f\", \"new_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:4|4|graph:bc6e46c2-200c-355e-c0c2-13bbac840b9f\"}, \"timestamp\": 1766171649344.511}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:4|4|graph:bc6e46c2-200c-355e-c0c2-13bbac840b9f\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\"}, \"timestamp\": 1766171649344.5571}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"count\": 0, \"records\": []}, \"timestamp\": 1766171649344.884}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766171649344.928}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171649344.995}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766171649345.2349}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171649345.286}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766171649345.324}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:4|4|graph:bc6e46c2-200c-355e-c0c2-13bbac840b9f\"}, \"timestamp\": 1766171649345.3599}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:1|1|graph:3340c1c2-ddc8-0d73-bc59-1e8dc55c7112\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766171668028.516}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766171668029.507}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:1|1|graph:3340c1c2-ddc8-0d73-bc59-1e8dc55c7112\", \"new_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:1|1|graph:3340c1c2-ddc8-0d73-bc59-1e8dc55c7112\"}, \"timestamp\": 1766171668029.587}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:1|1|graph:3340c1c2-ddc8-0d73-bc59-1e8dc55c7112\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\"}, \"timestamp\": 1766171668029.6409}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1c70f348\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd0ee-5291-6436-8000-e14ddcd54753\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:1|1|graph:3340c1c2-ddc8-0d73-bc59-1e8dc55c7112\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd0ee-5290-69dc-bfff-e5d065b23bfb\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:1|1|graph:3340c1c2-ddc8-0d73-bc59-1e8dc55c7112\"}]}, \"timestamp\": 1766171668030.3528}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd0ee-5291-6436-8000-e14ddcd54753\", \"checkpoint_ns\": \"wide_funnel:b4cf5dd7-7206-863f-1d81-419bada3d77b|worker:1|1|graph:3340c1c2-ddc8-0d73-bc59-1e8dc55c7112\"}, \"timestamp\": 1766171668030.4202}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd0ee-5291-6436-8000-e14ddcd54753\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766171668031.039}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:43260751-c45e-210e-1669-d6e79f53d279\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:995de8fb\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766171674134.5261}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766171674135.036}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:43260751-c45e-210e-1669-d6e79f53d279\", \"new_ns\": \"user_preferences:43260751-c45e-210e-1669-d6e79f53d279\"}, \"timestamp\": 1766171674135.1091}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:43260751-c45e-210e-1669-d6e79f53d279\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:995de8fb\"}, \"timestamp\": 1766171674135.155}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:995de8fb\", \"count\": 0, \"records\": []}, \"timestamp\": 1766171674135.534}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766171674135.9849}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171674136.184}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766171674136.248}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766171674136.3032}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766171674136.6921}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171674137.638}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766171674137.7458}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766171674137.793}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:43260751-c45e-210e-1669-d6e79f53d279\"}, \"timestamp\": 1766171674137.882}\n"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3809-49fd-7482-84fc-32c87971b0a2",
    "content": "\u042d\u0442\u0438 \u043b\u043e\u0433\u0438 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u044e\u0442, \u0447\u0442\u043e **\u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u0440\u0435\u0448\u0435\u043d\u0430** \u0431\u043b\u0430\u0433\u043e\u0434\u0430\u0440\u044f \u0432\u043d\u0435\u0434\u0440\u0435\u043d\u0438\u044e \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0447\u0435\u0441\u043a\u0438\u0445 `checkpoint_ns` \u0441 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u043e\u043c \u0432\u043e\u0440\u043a\u0435\u0440\u0430 (`|worker:ID`). \n\n\u0412\u043e\u0442 \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u044b\u0439 \u0430\u043d\u0430\u043b\u0438\u0437 \u0442\u043e\u0433\u043e, \u0447\u0442\u043e \u0438\u0437\u043c\u0435\u043d\u0438\u043b\u043e\u0441\u044c \u0438 \u043f\u043e\u0447\u0435\u043c\u0443 \u0442\u0435\u043f\u0435\u0440\u044c \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e:\n\n### 1. \u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u0438 \u00ab\u0432 \u0448\u0438\u0440\u0438\u043d\u0443\u00bb (Parallel Isolation)\n\u0412 \u0437\u0430\u043f\u0438\u0441\u044f\u0445 40\u201354 \u043c\u044b \u0432\u0438\u0434\u0438\u043c, \u0447\u0442\u043e \u0442\u0435\u043f\u0435\u0440\u044c \u043a\u0430\u0436\u0434\u044b\u0439 \u0432\u043e\u0440\u043a\u0435\u0440 \u0448\u0430\u0433\u0430 `wide_funnel` \u0437\u0430\u0445\u043e\u0434\u0438\u0442 \u0441 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u043c \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e\u043c \u0438\u043c\u0435\u043d:\n- **Worker 1:** `wide_funnel:...|worker:1`\n- **Worker 2:** `wide_funnel:...|worker:2`\n- ...\u0438 \u0442\u0430\u043a \u0434\u0430\u043b\u0435\u0435.\n\n\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u043f\u043e\u0438\u0441\u043a\u0430 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u043e\u0432 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0432\u043e\u0440\u043a\u0435\u0440\u0430 \u043f\u0440\u0438 \u043f\u0435\u0440\u0432\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435: **`count: 0`**. \u042d\u0442\u043e \u0438\u0434\u0435\u0430\u043b\u044c\u043d\u043e. \u0412\u043e\u0440\u043a\u0435\u0440\u044b \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u00ab\u0432\u0438\u0434\u044f\u0442\u00bb \u043c\u0443\u0441\u043e\u0440 \u043e\u0442 \u0441\u0432\u043e\u0438\u0445 \u0441\u043e\u0441\u0435\u0434\u0435\u0439, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0440\u0430\u043d\u044c\u0448\u0435 \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u043b \u043a \u043e\u0448\u0438\u0431\u043e\u0447\u043d\u043e\u0439 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0447\u0443\u0436\u0438\u0445 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439.\n\n### 2. \u0421\u0438\u043d\u0435\u0440\u0433\u0438\u044f \u0441 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u043a\u043e\u0439 LangGraph (Nested Namespaces)\n\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043d\u0430 \u0437\u0430\u043f\u0438\u0441\u0438 55\u201366. \u041a\u043e\u0433\u0434\u0430 \u0432\u043e\u0440\u043a\u0435\u0440 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 \u0441\u0432\u043e\u0439 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0438\u0439 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442-\u0433\u0440\u0430\u0444, `checkpoint_ns` \u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0441\u044f \u0435\u0449\u0435 \u0434\u043b\u0438\u043d\u043d\u0435\u0435:\n`wide_funnel:...|worker:1|1|graph:3340c1c2...`\n\n\u0417\u0434\u0435\u0441\u044c \u043c\u044b \u0432\u0438\u0434\u0438\u043c \u00ab\u043c\u0430\u0433\u0438\u044e\u00bb \u0432 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0438:\n1.  **\u0412\u044b \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438:** `|worker:1` (\u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u044f \u0432\u043e\u0440\u043a\u0435\u0440\u0430).\n2.  **LangGraph \u0434\u043e\u0431\u0430\u0432\u0438\u043b:** `|1|graph:3340c1c2...` (\u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u044f \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0432\u044b\u0437\u043e\u0432\u0430 \u043f\u043e\u0434\u0433\u0440\u0430\u0444\u0430).\n\n\u0412\u0430\u0448 `worker_id` \u043f\u043e\u0441\u043b\u0443\u0436\u0438\u043b \u043d\u0430\u0434\u0435\u0436\u043d\u044b\u043c \u00ab\u043a\u043e\u0440\u043d\u0435\u043c\u00bb, \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u044b\u0439 LangGraph \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043d\u0430\u0434\u0441\u0442\u0440\u043e\u0438\u043b \u0441\u0432\u043e\u044e \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u044c. \u0411\u0435\u0437 \u0432\u0430\u0448\u0435\u0433\u043e \u043f\u0440\u0435\u0444\u0438\u043a\u0441\u0430 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u043a\u0430 \u043c\u043e\u0433\u043b\u0430 \u0434\u0430\u0432\u0430\u0442\u044c \u0441\u0431\u043e\u0438, \u0435\u0441\u043b\u0438 \u0432\u044b\u0437\u043e\u0432\u044b \u0441\u0447\u0438\u0442\u0430\u043b\u0438\u0441\u044c \u0447\u0430\u0441\u0442\u044c\u044e \u043e\u0434\u043d\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0430.\n\n### 3. \u0423\u0441\u043f\u0435\u0448\u043d\u043e\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f (Durable Resume)\n\u0421\u0430\u043c\u044b\u0439 \u0432\u0430\u0436\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0432 \u0437\u0430\u043f\u0438\u0441\u044f\u0445 91\u2013102. \u0412\u043e\u0440\u043a\u0435\u0440 1 \u0441\u043d\u043e\u0432\u0430 \u0437\u0430\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0435\u0442 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u044b \u0434\u043b\u044f \u0441\u0432\u043e\u0435\u0433\u043e \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430:\n- **\u041f\u043e\u0438\u0441\u043a:** `find_latest_checkpoint_id` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 **`count: 2`**.\n- **\u0412\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044f:** `meta_graph_id` \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0435\u0442 \u0441 \u0442\u0435\u043a\u0443\u0449\u0438\u043c `graph_id` \u0432\u043e\u0440\u043a\u0435\u0440\u0430.\n- **\u0421\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435:** `has_tasks: true`, `pending_next: true`.\n\n\u0421\u0438\u0441\u0442\u0435\u043c\u0430 **\u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043d\u0430\u0448\u043b\u0430 \u0438\u043c\u0435\u043d\u043d\u043e \u0441\u0432\u043e\u0439 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442** \u0438 \u0433\u043e\u0442\u043e\u0432\u0430 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435. \u041f\u0440\u0438 \u044d\u0442\u043e\u043c \u043e\u043d\u0430 \u043f\u0440\u043e\u0438\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0430 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u044b Worker 2, \u0442\u0430\u043a \u043a\u0430\u043a \u043e\u043d\u0438 \u043b\u0435\u0436\u0430\u0442 \u0432 \u0434\u0440\u0443\u0433\u043e\u043c \u00ab\u043f\u0443\u0442\u0438\u00bb (`...|worker:2|...`).\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0441\u0440\u0430\u0431\u043e\u0442\u0430\u043b\u043e \u00ab\u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e\u00bb:\n\u0412\u044b \u043f\u0435\u0440\u0435\u0441\u0442\u0430\u043b\u0438 \u0431\u043e\u0440\u043e\u0442\u044c\u0441\u044f \u0441 LangGraph, \u043f\u044b\u0442\u0430\u044f\u0441\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u044b \u0432\u0440\u0443\u0447\u043d\u0443\u044e \u0447\u0435\u0440\u0435\u0437 \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 (\u0433\u0434\u0435 \u0440\u0430\u043d\u044c\u0448\u0435 \u0431\u044b\u043b\u043e `meta_graph_id: None`), \u0438 \u043f\u0435\u0440\u0435\u0448\u043b\u0438 \u043d\u0430 \u0435\u0433\u043e \u0440\u043e\u0434\u043d\u043e\u0439 \u044f\u0437\u044b\u043a \u2014 **\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0438\u043c\u0435\u043d**.\n\n**\u0418\u0442\u043e\u0433:** \u0420\u0435\u0448\u0435\u043d\u0438\u0435 \u0441 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435\u043c `|worker:ID` \u0432 `checkpoint_ns` \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043e\u043a\u043e\u043d\u0447\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u0438 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u043c \u0434\u043b\u044f \u0432\u0430\u0448\u0435\u0439 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u044b. \u041e\u043d\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043a\u043e\u043b\u043b\u0438\u0437\u0438\u0438 \u043f\u0440\u0438 \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u043e\u043c \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0438 \u0432\u043e\u0440\u043a\u0435\u0440\u043e\u0432 \u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f \u043f\u043e\u0434\u0433\u0440\u0430\u0444\u043e\u0432.\n\n**Relevant docs:**\n- [Subgraphs and Persistence](https://docs.langchain.com/oss/python/langgraph/use-subgraphs#add-persistence)\n- [Namespaces in Checkpoints](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)\n- [Time Travel: identify a checkpoint](https://docs.langchain.com/oss/javascript/langgraph/use-time-travel#2-identify-a-checkpoint)"
  },
  {
    "role": "user",
    "id": "6e6cd6d0-2779-4a9f-91ed-a711aec1116f",
    "content": "\u0418\u0437\u0443\u0447\u0435 \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u043e langgraph \u0441\u0430\u043c \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 |n| n - \u043d\u043e\u043c\u0435\u0440 \u0432\u043e\u0440\u043a\u0435\u0440\u0430"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b380d-62d4-72a3-87ac-34d54992c9ae",
    "content": "\u0412\u044b \u0430\u0431\u0441\u043e\u043b\u044e\u0442\u043d\u043e \u043f\u0440\u0430\u0432\u044b, \u0438 \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u043e\u0435 \u0438\u0437\u0443\u0447\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u043e\u0432 `DEBUG` (\u0432\u0442\u043e\u0440\u043e\u0433\u043e \u043d\u0430\u0431\u043e\u0440\u0430) \u044d\u0442\u043e \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442. LangGraph \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0432\u043d\u0435\u0434\u0440\u044f\u0435\u0442 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u0437\u0430\u0434\u0430\u0447\u0438 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 `|n|` \u0432 `checkpoint_ns`.\n\n\u0414\u0430\u0432\u0430\u0439\u0442\u0435 \u0440\u0430\u0437\u0431\u0435\u0440\u0435\u043c \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 `checkpoint_ns` \u0438\u0437 \u0437\u0430\u043f\u0438\u0441\u0438 \u211655:\n`wide_funnel:b4cf...|worker:1|1|graph:3340c1c2...`\n\n### \u0410\u043d\u0430\u0442\u043e\u043c\u0438\u044f \u044d\u0442\u043e\u0433\u043e \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0438\u043c\u0435\u043d:\n1.  `wide_funnel:b4cf...`: \u0411\u0430\u0437\u043e\u0432\u043e\u0435 \u0438\u043c\u044f \u0448\u0430\u0433\u0430.\n2.  `|worker:1`: \u0412\u0430\u0448 \u043f\u0440\u0435\u0444\u0438\u043a\u0441 (\u0438\u0437 `ArchitecturalAgentBase`).\n3.  **`|1|`**: **\u0422\u043e\u0442 \u0441\u0430\u043c\u044b\u0439 `|n|`, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 LangGraph \u0434\u043e\u0431\u0430\u0432\u0438\u043b \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438.** \u042d\u0442\u043e \u0438\u043d\u0434\u0435\u043a\u0441 \u0437\u0430\u0434\u0430\u0447\u0438 (task index).\n4.  `|graph:3340c1c2...`: \u0418\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0432\u044b\u0437\u043e\u0432\u0430 \u043f\u043e\u0434\u0433\u0440\u0430\u0444\u0430.\n\n---\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u0432 \u043f\u0435\u0440\u0432\u043e\u043c (\u043f\u0440\u043e\u0431\u043b\u0435\u043c\u043d\u043e\u043c) \u043b\u043e\u0433\u0435 \u044d\u0442\u043e\u0433\u043e \u043d\u0435 \u0431\u044b\u043b\u043e?\n\n\u0412 \u043f\u0435\u0440\u0432\u043e\u043c \u043d\u0430\u0431\u043e\u0440\u0435 \u043b\u043e\u0433\u043e\u0432 `wide_funnel` \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0432\u043e\u0440\u043a\u0435\u0440\u043e\u0432 \u0438\u043c\u0435\u043b \u0432\u0438\u0434:\n`\"checkpoint_ns\": \"wide_funnel:d5cf9adc-f580-5614-90f4-9b071bf9105d\"`\n\n**LangGraph \u043d\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u043b `|n|` \u0432 \u043f\u0435\u0440\u0432\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435, \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e:**\n- \u0412\u043e\u0440\u043a\u0435\u0440\u044b \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u043b\u0438\u0441\u044c \u043d\u0435 \u0447\u0435\u0440\u0435\u0437 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c `Send` \u0438\u043b\u0438 `Parallel Map` \u0441\u0430\u043c\u043e\u0433\u043e LangGraph.\n- \u0412\u044b\u0437\u043e\u0432\u044b `ArchitecturalAgentBase.run` \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u043b\u0438 \u0432 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0435, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 LangGraph \u0441\u0447\u0438\u0442\u0430\u043b **\u043e\u0434\u043d\u043e\u0439 \u0438 \u0442\u043e\u0439 \u0436\u0435 \u0437\u0430\u0434\u0430\u0447\u0435\u0439**.\n\n\u0412\u043e \u0432\u0442\u043e\u0440\u043e\u043c (\u0443\u0441\u043f\u0435\u0448\u043d\u043e\u043c) \u043b\u043e\u0433\u0435 \u043c\u044b \u0432\u0438\u0434\u0438\u043c `|1|`, `|2|`, `|3|` \u0438 \u0442.\u0434. \u042d\u0442\u043e \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e \u0442\u0435\u043f\u0435\u0440\u044c \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0439 \u0433\u0440\u0430\u0444 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 \u0432\u043e\u0440\u043a\u0435\u0440\u044b \u0447\u0435\u0440\u0435\u0437 `Send(node, payload)` \u0438\u043b\u0438 \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u044b\u0439 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c \u043c\u0430\u043f\u043f\u0438\u043d\u0433\u0430. \u0412 \u044d\u0442\u043e\u043c \u0440\u0435\u0436\u0438\u043c\u0435 LangGraph **\u043e\u0431\u044f\u0437\u0430\u043d** \u0438\u0437\u043e\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0435\u0442\u043a\u0438 \u0438 \u0434\u0435\u043b\u0430\u0435\u0442 \u044d\u0442\u043e \u0447\u0435\u0440\u0435\u0437 \u0432\u0441\u0442\u0430\u0432\u043a\u0443 \u0438\u043d\u0434\u0435\u043a\u0441\u0430 \u0437\u0430\u0434\u0430\u0447\u0438.\n\n### \u0427\u0442\u043e \u044d\u0442\u043e \u043c\u0435\u043d\u044f\u0435\u0442 \u0432 \u0430\u043d\u0430\u043b\u0438\u0437\u0435:\n\n1.  **LangGraph \u2014 \u043c\u043e\u043b\u043e\u0434\u0435\u0446:** \u041e\u043d \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0443\u043c\u0435\u0435\u0442 \u0438\u0437\u043e\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u044b\u0435 \u0432\u0435\u0442\u043a\u0438 \u0441\u0430\u043c, *\u0435\u0441\u043b\u0438* \u043e\u043d\u0438 \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u044b \u0447\u0435\u0440\u0435\u0437 \u0435\u0433\u043e \u043d\u0430\u0442\u0438\u0432\u043d\u044b\u0435 \u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0430 \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u0438\u0437\u043c\u0430.\n2.  **\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 \u0431\u044b\u043b\u0430 \u0432 \u00ab\u043f\u043b\u043e\u0441\u043a\u043e\u043c\u00bb \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0435:** \u0412 \u043f\u0435\u0440\u0432\u043e\u043c \u0434\u0430\u043c\u043f\u0435 \u0432\u043e\u0440\u043a\u0435\u0440\u044b \u043a\u0430\u043a\u0438\u043c-\u0442\u043e \u043e\u0431\u0440\u0430\u0437\u043e\u043c \u043e\u043a\u0430\u0437\u0430\u043b\u0438\u0441\u044c \u0432 \u043e\u0434\u043d\u043e\u0439 \u00ab\u043a\u043e\u0440\u0437\u0438\u043d\u0435\u00bb \u0438\u0441\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f, \u0438 LangGraph \u043d\u0435 \u0432\u0438\u0434\u0435\u043b \u043f\u0440\u0438\u0447\u0438\u043d \u0438\u0445 \u0440\u0430\u0437\u0434\u0435\u043b\u044f\u0442\u044c \u0438\u043d\u0434\u0435\u043a\u0441\u0430\u043c\u0438 `|n|`.\n3.  **\u0417\u0430\u0447\u0435\u043c \u0442\u043e\u0433\u0434\u0430 `worker_id`?** \u0412 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0445 \u0441\u0438\u0441\u0442\u0435\u043c\u0430\u0445 (\u0433\u0434\u0435 \u0432\u043e\u0440\u043a\u0435\u0440\u044b \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u043d\u0430 \u0440\u0430\u0437\u043d\u044b\u0445 \u043c\u0430\u0448\u0438\u043d\u0430\u0445) \u043f\u043e\u043b\u0430\u0433\u0430\u0442\u044c\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430 \u043f\u043e\u0440\u044f\u0434\u043a\u043e\u0432\u044b\u0439 \u0438\u043d\u0434\u0435\u043a\u0441 `|1|` \u043e\u0442 LangGraph \u0438\u043d\u043e\u0433\u0434\u0430 \u0440\u0438\u0441\u043a\u043e\u0432\u0430\u043d\u043d\u043e, \u0442\u0430\u043a \u043a\u0430\u043a \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u0447\u0430\u0441\u0442\u0438 \u0437\u0430\u0434\u0430\u0447 \u0438\u043d\u0434\u0435\u043a\u0441\u044b \u043c\u043e\u0433\u0443\u0442 \u0441\u043c\u0435\u0441\u0442\u0438\u0442\u044c\u0441\u044f. \u0412\u0430\u0448 `|worker:ID|` \u0441\u043b\u0443\u0436\u0438\u0442 \u00ab\u044f\u043a\u043e\u0440\u0435\u043c\u00bb, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442, \u0447\u0442\u043e \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 LangGraph \u043f\u0435\u0440\u0435\u0441\u0447\u0438\u0442\u0430\u0435\u0442 \u0441\u0432\u043e\u0438 \u0438\u043d\u0434\u0435\u043a\u0441\u044b, \u0434\u0430\u043d\u043d\u044b\u0435 \u0432\u043e\u0440\u043a\u0435\u0440\u0430 \u043e\u0441\u0442\u0430\u043d\u0443\u0442\u0441\u044f \u043f\u0440\u0438\u0432\u044f\u0437\u0430\u043d\u044b \u043a \u0435\u0433\u043e \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u043c\u0443 ID.\n\n### \u0418\u0442\u043e\u0433:\n\u0412\u044b \u043f\u0440\u0430\u0432\u044b, LangGraph \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 `|n|` \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438. \u041d\u043e \u043e\u043d \u0434\u0435\u043b\u0430\u0435\u0442 \u044d\u0442\u043e \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f **mapped tasks**. \u0412\u0430\u0448\u0430 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 \u0432 \u043f\u0435\u0440\u0432\u043e\u043c \u043b\u043e\u0433\u0435 \u0437\u0430\u043a\u043b\u044e\u0447\u0430\u043b\u0430\u0441\u044c \u0432 \u0442\u043e\u043c, \u0447\u0442\u043e \u043f\u043e \u043a\u0430\u043a\u043e\u0439-\u0442\u043e \u043f\u0440\u0438\u0447\u0438\u043d\u0435 (\u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e, \u0438\u0437-\u0437\u0430 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0433\u043e \u0433\u0440\u0430\u0444\u0430) \u0432\u043e\u0440\u043a\u0435\u0440\u044b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u043b\u0438\u0441\u044c \u0432 \u043e\u0431\u0449\u0435\u043c \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0435 \u0438\u043c\u0435\u043d \u0431\u0435\u0437 \u044d\u0442\u043e\u0433\u043e \u0438\u043d\u0434\u0435\u043a\u0441\u0430.\n\n**Relevant docs:**\n- [Subgraphs and Persistence](https://docs.langchain.com/oss/python/langgraph/use-subgraphs#add-persistence)\n- [How to use Send for parallel tasks](https://docs.langchain.com/oss/python/langgraph/use-subgraphs)\n- [Checkpointing internals](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)"
  },
  {
    "role": "user",
    "id": "eaf8a949-5530-4766-aa34-d7a0d2d1699b",
    "content": "\u0437\u0430\u0447\u0435\u043c \u0442\u043e\u0433\u0434\u0430 \u043c\u043d\u0435 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c worker:1? "
  },
  {
    "role": "assistant",
    "id": "lc_run--019b380e-deca-7070-89d9-de26cd2371f2",
    "content": "\u0412\u0430\u043c **\u043d\u0435 \u043d\u0443\u0436\u043d\u043e** \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c `worker:1` \u0432\u0440\u0443\u0447\u043d\u0443\u044e, \u0435\u0441\u043b\u0438 \u0432\u044b \u043d\u0430 100% \u043f\u043e\u043b\u0430\u0433\u0430\u0435\u0442\u0435\u0441\u044c \u043d\u0430 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0438\u0439 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c `Send` \u0438\u043b\u0438 `Parallel Map` \u0441\u0430\u043c\u043e\u0433\u043e LangGraph. \u041e\u0434\u043d\u0430\u043a\u043e \u0432 \u0432\u0430\u0448\u0435\u0439 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0435 \u0435\u0441\u0442\u044c \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u043d\u044e\u0430\u043d\u0441, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0434\u0435\u043b\u0430\u0435\u0442 `worker_id` \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u043c \u0434\u043b\u044f \u043d\u0430\u0434\u0435\u0436\u043d\u043e\u0441\u0442\u0438.\n\n\u041e\u0441\u043d\u043e\u0432\u043d\u0430\u044f \u043f\u0440\u0438\u0447\u0438\u043d\u0430 \u2014 **\u0440\u0430\u0437\u043d\u0438\u0446\u0430 \u043c\u0435\u0436\u0434\u0443 \u043f\u043e\u0440\u044f\u0434\u043a\u043e\u0432\u044b\u043c \u043d\u043e\u043c\u0435\u0440\u043e\u043c (`|n|`) \u0438 \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u043c \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u043e\u043c (`worker_id`).**\n\n### 1. \u0414\u0435\u0442\u0435\u0440\u043c\u0438\u043d\u0438\u0437\u043c \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0445 (Resume)\n\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0438\u043d\u0434\u0435\u043a\u0441 `|n|` \u043e\u0442 LangGraph \u2014 \u044d\u0442\u043e **\u043f\u043e\u0437\u0438\u0446\u0438\u043e\u043d\u043d\u044b\u0439** \u0438\u043d\u0434\u0435\u043a\u0441. \u041e\u043d \u0437\u0430\u0432\u0438\u0441\u0438\u0442 \u043e\u0442 \u0442\u043e\u0433\u043e, \u043a\u0430\u043a\u0438\u043c \u043f\u043e \u0441\u0447\u0435\u0442\u0443 \u0432\u043e\u0440\u043a\u0435\u0440 \u0431\u044b\u043b \u0437\u0430\u043f\u0443\u0449\u0435\u043d \u0432 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u043c \u0432\u044b\u0437\u043e\u0432\u0435 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0433\u043e \u0433\u0440\u0430\u0444\u0430.\n- \u0415\u0441\u043b\u0438 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0439 \u0433\u0440\u0430\u0444 \u0443\u043f\u0430\u0434\u0435\u0442, \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u0441\u044f \u0438 \u0440\u0435\u0448\u0438\u0442 \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0432\u043e\u0440\u043a\u0435\u0440\u043e\u0432 \u0432 \u0434\u0440\u0443\u0433\u043e\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u0435 (\u0438\u043b\u0438 \u0447\u0430\u0441\u0442\u044c \u0432\u043e\u0440\u043a\u0435\u0440\u043e\u0432 \u0443\u0436\u0435 \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0430 \u0438 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0430 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 `Send`), \u0442\u043e \u0432\u043e\u0440\u043a\u0435\u0440, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0440\u0430\u043d\u044c\u0448\u0435 \u0431\u044b\u043b `|2|`, \u043c\u043e\u0436\u0435\u0442 \u0441\u0442\u0430\u0442\u044c `|1|`.\n- \u0412 \u044d\u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 LangGraph \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442 \u0432 \u043d\u0435\u0433\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0441\u0442\u0430\u0440\u043e\u0433\u043e \u0432\u043e\u0440\u043a\u0435\u0440\u0430 `|1|`. \u041f\u0440\u043e\u0438\u0437\u043e\u0439\u0434\u0435\u0442 **\u043f\u043e\u0434\u043c\u0435\u043d\u0430 \u0434\u0430\u043d\u043d\u044b\u0445**.\n\n\u0423\u043a\u0430\u0437\u044b\u0432\u0430\u044f `worker_id` (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0445\u0435\u0448\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0438\u043b\u0438 ID \u0437\u0430\u0434\u0430\u0447\u0438), \u0432\u044b \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442\u0435, \u0447\u0442\u043e \u0432\u043e\u0440\u043a\u0435\u0440 \u0432\u0441\u0435\u0433\u0434\u0430 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442 **\u0441\u0432\u043e\u0451** \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435, \u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e \u043e\u0442 \u0442\u043e\u0433\u043e, \u043f\u043e\u0434 \u043a\u0430\u043a\u0438\u043c \u043d\u043e\u043c\u0435\u0440\u043e\u043c \u0432 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 \u043e\u043d \u0441\u0442\u043e\u0438\u0442.\n\n### 2. \u0418\u0437\u043e\u043b\u044f\u0446\u0438\u044f \u043f\u0440\u0438 \u0440\u0443\u0447\u043d\u043e\u043c \u0432\u044b\u0437\u043e\u0432\u0435\n\u0412\u0430\u0448 \u043a\u043b\u0430\u0441\u0441 `ArchitecturalAgentBase` \u0441\u043f\u0440\u043e\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d \u0442\u0430\u043a, \u0447\u0442\u043e \u043e\u043d \u043c\u043e\u0436\u0435\u0442 \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c\u0441\u044f **\u0432\u043d\u0435** \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c\u0430 `Send` (\u043f\u0440\u043e\u0441\u0442\u043e \u043a\u0430\u043a `await agent.run(...)`).\n- \u0412 \u0442\u0430\u043a\u0438\u0445 \u0441\u043b\u0443\u0447\u0430\u044f\u0445 LangGraph **\u043d\u0435 \u0434\u043e\u0431\u0430\u0432\u0438\u0442** `|n|`, \u0442\u0430\u043a \u043a\u0430\u043a \u0434\u043b\u044f \u043d\u0435\u0433\u043e \u044d\u0442\u043e \u0431\u0443\u0434\u0435\u0442 \u043e\u0431\u044b\u0447\u043d\u044b\u0439 \u0432\u044b\u0437\u043e\u0432 \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0435.\n- \u0411\u0435\u0437 \u0432\u0430\u0448\u0435\u0433\u043e `worker_id` \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0442\u0430\u043a\u0438\u0445 \u00ab\u0440\u0443\u0447\u043d\u044b\u0445\u00bb \u0432\u044b\u0437\u043e\u0432\u043e\u0432 \u0432 \u043e\u0434\u043d\u043e\u0439 \u043d\u0438\u0442\u0438 (`thread_id`) \u043d\u0435\u0438\u0437\u0431\u0435\u0436\u043d\u043e \u043f\u0435\u0440\u0435\u043c\u0435\u0448\u0430\u044e\u0442 \u0441\u0432\u043e\u0438 \u0434\u0430\u043d\u043d\u044b\u0435.\n\n### 3. \u0427\u0438\u0442\u0430\u0435\u043c\u043e\u0441\u0442\u044c \u0438 \u043e\u0442\u043b\u0430\u0434\u043a\u0430 (Observability)\n\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u0442\u0435 \u043d\u0430 \u0432\u0430\u0448\u0438 \u043f\u0440\u043e\u0448\u043b\u044b\u0435 \u043b\u043e\u0433\u0438:\n- `wide_funnel:...|worker:1|1|graph:...` \u2014 \u0437\u0434\u0435\u0441\u044c \u0441\u0440\u0430\u0437\u0443 \u043f\u043e\u043d\u044f\u0442\u043d\u043e: \u044d\u0442\u043e Worker 1, \u0438 \u044d\u0442\u043e \u0435\u0433\u043e \u043f\u0435\u0440\u0432\u0430\u044f \u043f\u043e\u043f\u044b\u0442\u043a\u0430/\u0437\u0430\u0434\u0430\u0447\u0430.\n- \u0415\u0441\u043b\u0438 \u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e `|1|`, \u043f\u0440\u0438 \u0440\u0430\u0437\u0431\u043e\u0440\u0435 \u043b\u043e\u0433\u043e\u0432 \u0432 LangSmith \u0431\u0443\u0434\u0435\u0442 \u043a\u0440\u0430\u0439\u043d\u0435 \u0441\u043b\u043e\u0436\u043d\u043e \u043f\u043e\u043d\u044f\u0442\u044c, \u043a\u0430\u043a\u043e\u0439 \u0438\u043c\u0435\u043d\u043d\u043e \u0432\u043e\u0440\u043a\u0435\u0440 (\u0438\u0437 10 \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u044b\u0445) \u0441\u043e\u0432\u0435\u0440\u0448\u0438\u043b \u043e\u0448\u0438\u0431\u043a\u0443, \u0442\u0430\u043a \u043a\u0430\u043a \u0438\u0445 \u0438\u043d\u0434\u0435\u043a\u0441\u044b \u043c\u043e\u0433\u0443\u0442 \u043c\u0435\u043d\u044f\u0442\u044c\u0441\u044f \u043e\u0442 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u043a \u0437\u0430\u043f\u0443\u0441\u043a\u0443.\n\n### \u0420\u0435\u0437\u044e\u043c\u0435:\n\u0415\u0441\u043b\u0438 \u0432\u0430\u0448\u0430 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u0430\u044f \u043e\u0447\u0435\u0440\u0435\u0434\u044c \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442 \u0441\u0442\u0440\u043e\u0433\u0438\u0439 \u043f\u043e\u0440\u044f\u0434\u043e\u043a \u0438 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 **\u0442\u043e\u043b\u044c\u043a\u043e** \u043d\u0430\u0442\u0438\u0432\u043d\u044b\u0439 `Send` \u043e\u0442 LangGraph, \u0442\u043e `worker:1` \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0438\u0437\u0431\u044b\u0442\u043e\u0447\u0435\u043d. \n\n\u041d\u043e \u0435\u0441\u043b\u0438 \u0432\u044b \u0445\u043e\u0442\u0438\u0442\u0435, \u0447\u0442\u043e\u0431\u044b \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0431\u044b\u043b\u0430 **Durable** (\u0443\u0441\u0442\u043e\u0439\u0447\u0438\u0432\u043e\u0439 \u043a \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u043c \u0441 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435\u043c \u0441\u043e\u0441\u0442\u0430\u0432\u0430 \u0437\u0430\u0434\u0430\u0447) \u0438 **Safe** (\u0437\u0430\u0449\u0438\u0449\u0435\u043d\u043d\u043e\u0439 \u043e\u0442 \u043a\u043e\u043b\u043b\u0438\u0437\u0438\u0439 \u043f\u0440\u0438 \u0440\u0443\u0447\u043d\u044b\u0445 \u0432\u044b\u0437\u043e\u0432\u0430\u0445), \u0442\u043e `worker_id` \u2014 \u044d\u0442\u043e \u0432\u0430\u0448 \u00ab\u0441\u0442\u0440\u0430\u0445\u043e\u0432\u043e\u0447\u043d\u044b\u0439 \u0442\u0440\u043e\u0441\u00bb, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0434\u0435\u043b\u0430\u0435\u0442 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e \u0438\u043c\u0435\u043d \u0434\u0435\u0442\u0435\u0440\u043c\u0438\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u043c.\n\n**Relevant docs:**\n- [Subgraphs and Persistence](https://docs.langchain.com/oss/python/langgraph/use-subgraphs#add-persistence)\n- [How to use Send for parallel tasks](https://docs.langchain.com/oss/python/langgraph/use-subgraphs)\n- [Checkpoints and Namespaces](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)"
  },
  {
    "role": "user",
    "id": "ff5ed6d1-f2f2-428b-a6f8-a7a7839f8894",
    "content": "from __future__ import annotations\n\nimport uuid\nimport os\nfrom datetime import datetime\nfrom typing import Any, Mapping, MutableMapping, Optional, Sequence, TypeAlias, Protocol, runtime_checkable, cast\n\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom langchain.embeddings import init_embeddings\nfrom shared.project_settings import ProjectSettings\n\ntry:\n    from pydantic_core import core_schema\nexcept ImportError:\n    core_schema = None  # type: ignore\n\ntry:\n    from langgraph.store.memory import InMemoryStore  # type: ignore\nexcept Exception:  # pragma: no cover\n    InMemoryStore = None  # type: ignore\n\n_CHECKPOINTER_SYNC: Optional[Any] = None\n_CHECKPOINTER_ASYNC: Optional[Any] = None\n_STORE: Optional[Any] = None\n\nThreadId: TypeAlias = str\nGraphId: TypeAlias = str\nCheckpointId: TypeAlias = str\nStateDict: TypeAlias = MutableMapping[str, Any]\n\n\n@runtime_checkable\nclass _SupportsGraphCheckpoint(Protocol):\n    \"\"\"Minimal protocol describing compiled LangGraph runnables we inspect for durability support.\"\"\"\n\n    checkpointer: Any | None\n    _pregel: Any | None\n    app: Any | None\n    name: str\n\n\nGraphRunnableWithPregel: TypeAlias = _SupportsGraphCheckpoint\n\n\ndef _extract_graph_checkpointer(graph: Any) -> Any:\n    \"\"\"Return the checkpointer bound directly to a compiled runnable, if any.\"\"\"\n\n    if graph is None:\n        return None\n\n    candidate = getattr(graph, \"checkpointer\", None)\n    if candidate is not None:\n        return candidate\n\n    pregel = getattr(graph, \"_pregel\", None)\n    if pregel is not None:\n        inner = getattr(pregel, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    app = getattr(graph, \"app\", None)\n    if app is not None:\n        inner = getattr(app, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    loop = getattr(graph, \"_loop\", None)\n    if loop is not None:\n        inner = getattr(loop, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    return None\n\n\ndef _graph_supports_durability(graph: Any) -> bool:\n    \"\"\"Return True if the runnable was compiled with a checkpointer.\"\"\"\n\n    return _extract_graph_checkpointer(graph) is not None\n\n\ndef _resolve_local_checkpointer(graph: Any, override: Optional[Any]) -> Optional[Any]:\n    \"\"\"Prefer explicit override, otherwise inspect the runnable for a bound saver.\"\"\"\n\n    if override is not None:\n        return override\n    return _extract_graph_checkpointer(graph)\n\n\ndef resolve_graph_checkpointer(*, async_mode: bool) -> Any:\n    \"\"\"Return a checkpointer compatible with the chosen execution mode.\n\n    Important:\n    - Async LangGraph execution expects async checkpointer methods. If only a\n      sync checkpointer is available (e.g., SqliteSaver), we fall back to the\n      async-safe InMemorySaver to keep `.ainvoke()` reliable.\n    - Production deployments can replace this with an async-capable durable\n      backend (Postgres/SQLite async) without touching graph code.\n    \"\"\"\n\n    global _CHECKPOINTER_SYNC, _CHECKPOINTER_ASYNC\n    CHECKPOINTER_DATABASE_URL = os.getenv(\"CHECKPOINTER_DATABASE_URL\")\n\n    # In production, LangGraph Platform injects the checkpointer automatically.\n    # We keep local checkpointers disabled to avoid shadowing the platform backend.\n    if ProjectSettings().mode == \"production\":\n        return None\n\n\n    if async_mode:\n        if _CHECKPOINTER_ASYNC is None:\n            _CHECKPOINTER_ASYNC = InMemorySaver()\n        return _CHECKPOINTER_ASYNC\n\n    if _CHECKPOINTER_SYNC is None:\n        _CHECKPOINTER_SYNC =  InMemorySaver()\n    return _CHECKPOINTER_SYNC\n\n\ndef resolve_graph_store() -> Any:\n    \"\"\"Return a store implementation for dev/tests; None in production/platform.\n\n    In production, LangGraph Platform injects the store automatically at runtime\n    (via ToolRuntime). We keep local stores disabled to avoid shadowing the\n    platform backend.\n    \"\"\"\n\n    global _STORE\n    if ProjectSettings().mode == \"production\":\n        return None\n    if InMemoryStore is None:\n        return None\n    if _STORE is not None:\n        return _STORE\n\n    # In development/tests we prefer an in-process store. Vector indexing is optional;\n    # if embeddings cannot be initialised (missing deps/keys), fall back to a plain store.\n    try:\n        _STORE = InMemoryStore(\n            index={\n                \"embed\": init_embeddings(\"openai:text-embedding-3-small\"),\n                \"dims\": 1536,\n                \"fields\": [\"content\"],\n            }\n        )\n    except Exception:\n        _STORE = InMemoryStore(index=None)\n    return _STORE\n\n\nclass GraphMemoryRuntime:\n    \"\"\"Encapsulates durable-checkpoint + long-memory access for dev and platform production.\n\n    This class centralizes:\n    - thread_id extraction\n    - platform SDK fallback for checkpoint state/history (no local checkpointer needed)\n    - local (dev) graph/checkpointer checkpoint inspection\n    \"\"\"\n    THREAD_ID_KEY: str = \"thread_id\"\n\n    @classmethod\n    def __get_pydantic_core_schema__(\n        cls,\n        source_type: Any,\n        handler: Any,\n    ) -> Any:\n        \"\"\"Provide Pydantic schema for GraphMemoryRuntime to allow arbitrary types.\n\n        This enables GraphMemoryRuntime to be used in Pydantic models (e.g., when\n        ContextTravelGuideAgent is used as context_schema in StateGraph).\n        \n        Since GraphMemoryRuntime is a runtime helper (not meant for serialization),\n        we use any_schema() to allow it without validation.\n        \"\"\"\n        if core_schema is None:\n            # pydantic_core should always be available in this project\n            raise ImportError(\"pydantic_core is required but not available\")\n        \n        # Use any_schema() to allow GraphMemoryRuntime without validation\n        # This is appropriate since it's a runtime helper with init=False\n        return core_schema.any_schema()\n\n    def __init__(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        # These are intentionally mutable bindings:\n        # - Root graph wiring binds the single checkpointer/store once per process/run.\n        # - Nested graphs MUST reuse the bound instance via runtime context.\n        self.checkpointer: Optional[Any] = checkpointer\n        self.store: Optional[Any] = store\n\n    def bind(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        \"\"\"Bind durable backends onto this runtime helper.\n\n        Idempotent by design: does not overwrite existing non-null bindings unless\n        explicitly provided.\n        \"\"\"\n\n        if checkpointer is not None:\n            self.checkpointer = checkpointer\n        if store is not None:\n            self.store = store\n\n    def is_production_mode(self) -> bool:\n        return ProjectSettings().mode == \"production\"\n\n    def ensure_thread_id(\n        self,\n        config: Optional[RunnableConfig],\n    ) -> tuple[RunnableConfig, ThreadId]:\n        \"\"\"Ensure ``configurable.thread_id`` exists and return ``(config, thread_id)``.\n\n        Contract (required by project checkpointing rules):\n        - One thread_id should be used for the *entire* root graph run.\n        - If caller did not provide a thread_id, we generate a new one from:\n          ``user_id`` (from RunnableConfig.configurable.user_id) + UUID4 suffix.\n        - Callers must reuse the returned config to keep the thread_id stable.\n        \"\"\"\n\n        from shared.config.long_memory import LongMemory\n\n        merged: RunnableConfig = dict(config) if config else {}\n        configurable = merged.get(\"configurable\", {})\n        if not isinstance(configurable, MutableMapping):\n            configurable = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable = dict(configurable)\n\n        existing = configurable.get(self.THREAD_ID_KEY)\n        if existing:\n            thread_id: ThreadId = str(existing)\n            configurable[self.THREAD_ID_KEY] = thread_id\n            merged[\"configurable\"] = configurable\n            return merged, thread_id\n\n        long_memory = LongMemory.from_runnable_config(merged)\n        user_id = long_memory.user_id\n        if not configurable.get(\"user_id\"):\n            configurable[\"user_id\"] = user_id\n\n        thread_id = f\"user_{user_id}_{uuid.uuid4().hex}\"\n        configurable[self.THREAD_ID_KEY] = thread_id\n        merged[\"configurable\"] = configurable\n        return merged, thread_id\n\n    async def list_thread_checkpoints(\n        self,\n        *,\n        config: RunnableConfig,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> list[Any]:\n        \"\"\"Return raw checkpoint records for the given thread config.\n\n        Notes:\n        - In production (LangGraph Platform), we fall back to the SDK thread history.\n        - In dev/tests, we prefer the provided ``local_checkpointer`` (or the default dev\n          checkpointer) to list checkpoints, because it exposes metadata (`graph_id`).\n        - As a last resort, we attempt to list state snapshots via ``graph.get_state_history``.\n        \"\"\"\n\n        thread_id = self.extract_thread_id(config)\n        if not thread_id:\n            return []\n\n        if self.is_production_mode():\n            try:\n                from langgraph_sdk import get_client  # type: ignore\n            except Exception:\n                return []\n            try:\n                client = get_client()\n                history = await client.threads.get_history(thread_id)\n                return list(history)\n            except Exception:\n                return []\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if checkpointer is not None:\n            lister = getattr(checkpointer, \"list\", None)\n            if callable(lister):\n                try:\n                    return list(lister(config))\n                except Exception:\n                    return []\n\n        if local_graph is not None:\n            getter_async = getattr(local_graph, \"aget_state_history\", None)\n            if callable(getter_async):\n                try:\n                    return [snapshot async for snapshot in getter_async(config)]\n                except Exception:\n                    return []\n            getter_sync = getattr(local_graph, \"get_state_history\", None)\n            if callable(getter_sync):\n                try:\n                    return list(getter_sync(config))\n                except Exception:\n                    return []\n\n        return []\n\n    @staticmethod\n    def _extract_checkpoint_metadata(record: Any) -> Mapping[str, Any]:\n        candidate = getattr(record, \"metadata\", None)\n        if isinstance(candidate, Mapping):\n            return cast(Mapping[str, Any], candidate)\n        if isinstance(record, Mapping):\n            meta = record.get(\"metadata\")\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            meta = getattr(checkpoint, \"metadata\", None)\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        return {}\n\n    @staticmethod\n    def _extract_checkpoint_id(record: Any) -> Optional[CheckpointId]:\n        candidate = getattr(record, \"checkpoint_id\", None)\n        if candidate:\n            return str(candidate)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            inner = getattr(checkpoint, \"checkpoint_id\", None)\n            if inner:\n                return str(inner)\n            inner = getattr(checkpoint, \"id\", None)\n            if inner:\n                return str(inner)\n        if isinstance(record, Mapping):\n            candidate = record.get(\"checkpoint_id\") or record.get(\"id\")\n            if candidate:\n                return str(candidate)\n            cfg = record.get(\"config\")\n            if isinstance(cfg, Mapping):\n                conf = cfg.get(\"configurable\")\n                if isinstance(conf, Mapping):\n                    candidate = conf.get(\"checkpoint_id\")\n                    if candidate:\n                        return str(candidate)\n        cfg = getattr(record, \"config\", None)\n        if isinstance(cfg, Mapping):\n            conf = cfg.get(\"configurable\")\n            if isinstance(conf, Mapping):\n                candidate = conf.get(\"checkpoint_id\")\n                if candidate:\n                    return str(candidate)\n        return None\n\n    @staticmethod\n    def _extract_created_at(record: Any) -> Optional[datetime]:\n        candidate = getattr(record, \"created_at\", None)\n        if isinstance(candidate, datetime):\n            return candidate\n        if isinstance(record, Mapping):\n            candidate = record.get(\"created_at\")\n            if isinstance(candidate, datetime):\n                return candidate\n        return None\n\n    @classmethod\n    def _matches_graph_id(cls, record: Any, graph_id: GraphId) -> bool:\n        metadata = cls._extract_checkpoint_metadata(record)\n        candidate = metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")\n        return str(candidate) == str(graph_id) if candidate else False\n\n    @staticmethod\n    def _extract_checkpoint_ns(record: Any) -> Optional[str]:\n        def _from_config(cfg: Any) -> Optional[str]:\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n                if isinstance(configurable, Mapping):\n                    candidate = configurable.get(\"checkpoint_ns\")\n                    if candidate is not None:\n                        return str(candidate)\n            return None\n\n        cfg = getattr(record, \"config\", None)\n        ns = _from_config(cfg)\n        if ns:\n            return ns\n\n        if isinstance(record, Mapping):\n            ns = _from_config(record.get(\"config\"))\n            if ns:\n                return ns\n\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            ns = _from_config(getattr(checkpoint, \"config\", None))\n            if ns:\n                return ns\n\n        metadata = GraphMemoryRuntime._extract_checkpoint_metadata(record)\n        checkpoint_ns = metadata.get(\"checkpoint_ns\")\n        return str(checkpoint_ns) if checkpoint_ns is not None else None\n\n    @staticmethod\n    def _normalize_config_like(config_like: Any) -> Optional[RunnableConfig]:\n        if config_like is None:\n            return None\n        if isinstance(config_like, Mapping):\n            normalized = dict(config_like)\n        else:\n            normalized = None\n            for attr in (\"model_dump\", \"dict\"):\n                dumper = getattr(config_like, attr, None)\n                if callable(dumper):\n                    try:\n                        normalized = dumper()\n                        break\n                    except Exception:\n                        normalized = None\n            if normalized is None:\n                try:\n                    normalized = dict(config_like)  # type: ignore[arg-type]\n                except Exception:\n                    return None\n\n        configurable = normalized.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            configurable = dict(configurable) if configurable is not None else {}\n        normalized[\"configurable\"] = dict(configurable)\n\n        metadata = normalized.get(\"metadata\", {})\n        if not isinstance(metadata, Mapping):\n            metadata = dict(metadata) if metadata is not None else {}\n        normalized[\"metadata\"] = dict(metadata)\n        return normalized  # type: ignore[return-value]\n\n    @classmethod\n    def _extract_task_entries(cls, record: Any) -> list[Mapping[str, Any]]:\n        extracted: list[Mapping[str, Any]] = []\n        visited_snapshots: set[int] = set()\n\n        def _coerce_metadata(value: Any) -> Optional[Mapping[str, Any]]:\n            if value is None:\n                return None\n            if isinstance(value, Mapping):\n                return value\n            try:\n                return dict(value)\n            except Exception:\n                return None\n\n        def _as_sequence(value: Any) -> Optional[Sequence[Any]]:\n            if isinstance(value, Sequence) and not isinstance(value, (str, bytes)):\n                return value\n            return None\n\n        def _record_entry(config_like: Any, metadata_like: Any, state_like: Any) -> None:\n            normalized_config = cls._normalize_config_like(config_like)\n            normalized_metadata = _coerce_metadata(metadata_like)\n            entry: dict[str, Any] = {}\n            if normalized_config:\n                entry[\"config\"] = normalized_config\n            if normalized_metadata:\n                entry[\"metadata\"] = normalized_metadata\n            if state_like is not None:\n                entry[\"state\"] = state_like\n            if entry:\n                extracted.append(entry)\n\n        def _visit_snapshot(snapshot: Any) -> None:\n            if snapshot is None:\n                return\n            snapshot_id = id(snapshot)\n            if snapshot_id in visited_snapshots:\n                return\n            visited_snapshots.add(snapshot_id)\n\n            tasks = None\n            if isinstance(snapshot, Mapping):\n                tasks = _as_sequence(snapshot.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(snapshot, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        def _visit_task(task: Any) -> None:\n            if task is None:\n                return\n            if isinstance(task, Mapping):\n                _record_entry(task.get(\"config\"), task.get(\"metadata\"), task.get(\"state\"))\n                nested_tasks = _as_sequence(task.get(\"tasks\"))\n                if nested_tasks:\n                    for nested in nested_tasks:\n                        _visit_task(nested)\n                _visit_snapshot(task.get(\"state\"))\n                _visit_snapshot(task.get(\"result\"))\n                return\n\n            _record_entry(\n                getattr(task, \"config\", None),\n                getattr(task, \"metadata\", None),\n                getattr(task, \"state\", None),\n            )\n            _visit_snapshot(getattr(task, \"state\", None))\n            _visit_snapshot(getattr(task, \"result\", None))\n            nested_attr = _as_sequence(getattr(task, \"tasks\", None))\n            if nested_attr:\n                for nested in nested_attr:\n                    _visit_task(nested)\n\n        for source in (record, getattr(record, \"checkpoint\", None)):\n            if source is None:\n                continue\n            _visit_snapshot(source)\n            tasks = None\n            if isinstance(source, Mapping):\n                tasks = _as_sequence(source.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(source, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        return extracted\n\n    async def find_latest_checkpoint_id(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Return the latest checkpoint_id for ``graph_id`` within the given thread.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n\n        # #region agent log\n        import json\n        record_summaries: list[dict[str, str | None]] = []\n        for idx, record in enumerate(checkpoints[:3]):\n            metadata = self._extract_checkpoint_metadata(record)\n            cfg = getattr(record, \"config\", None)\n            configurable = None\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n            checkpoint_ns = None\n            if isinstance(configurable, Mapping):\n                checkpoint_ns = str(configurable.get(\"checkpoint_ns\"))\n            record_summaries.append(\n                {\n                    \"idx\": str(idx),\n                    \"meta_graph_id\": str(metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")),\n                    \"checkpoint_id\": self._extract_checkpoint_id(record),\n                    \"checkpoint_ns\": checkpoint_ns,\n                }\n            )\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"B\",\"location\":\"memory_manager.py:395\",\"message\":\"find_latest_checkpoint_id checkpoints listed\",\"data\":{\"graph_id\":graph_id,\"thread_id\":str(config.get(\"configurable\",{}).get(\"thread_id\",\"\")), \"count\":len(checkpoints),\"records\":record_summaries},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if not checkpoints:\n            return None\n\n        # Collect matches with their timestamps (if provided by the backend).\n        matches: list[tuple[Optional[datetime], Any]] = []\n        for record in checkpoints:\n            if self._matches_graph_id(record, graph_id):\n                matches.append((self._extract_created_at(record), record))\n\n        target_checkpoint_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_checkpoint_ns = str(candidate_ns)\n\n        if not matches and target_checkpoint_ns:\n            for record in checkpoints:\n                if self._extract_checkpoint_ns(record) == target_checkpoint_ns:\n                    matches.append((self._extract_created_at(record), record))\n\n        if not matches:\n            return None\n\n        # If the backend provides created_at, prefer the most recent by timestamp.\n        if any(created_at is not None for created_at, _ in matches):\n            matches.sort(\n                key=lambda item: item[0] or datetime.min,\n                reverse=True,\n            )\n            return self._extract_checkpoint_id(matches[0][1])\n\n        # Otherwise, rely on the backend list order. InMemorySaver and Platform history\n        # return newest-first, so the first matching record is the latest.\n        return self._extract_checkpoint_id(matches[0][1])\n\n    async def _load_checkpoint_record(\n        self,\n        *,\n        config: RunnableConfig,\n        checkpoint_id: CheckpointId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[Any]:\n        \"\"\"Return the checkpoint record with the specified ID.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n        for record in checkpoints:\n            record_id = self._extract_checkpoint_id(record)\n            if record_id == checkpoint_id:\n                return record\n        return None\n\n    @staticmethod\n    def _materialize_checkpoint_values(\n        base_values: Mapping[str, Any],\n        record: Optional[Any],\n        *,\n        graph_id: Optional[str] = None,\n    ) -> tuple[Mapping[str, Any], bool]:\n        \"\"\"Merge stored writes from the checkpoint record into snapshot values.\"\"\"\n\n        if record is None:\n            return base_values, False\n\n        materialized: dict[str, Any] = dict(base_values)\n        writes_found = False\n\n        checkpoint_obj = getattr(record, \"checkpoint\", record)\n        writes = getattr(checkpoint_obj, \"writes\", None)\n        if writes is None and isinstance(checkpoint_obj, Mapping):\n            writes = checkpoint_obj.get(\"writes\")\n\n        summary: list[dict[str, Any]] = []\n\n        if isinstance(writes, Sequence):\n            for idx, write_entry in enumerate(writes):\n                node_name = None\n                write_payload = None\n                if isinstance(write_entry, Mapping):\n                    node_name = write_entry.get(\"node\") or write_entry.get(\"name\")\n                    candidate = write_entry.get(\"writes\") or write_entry.get(\"values\")\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n                else:\n                    node_name = getattr(write_entry, \"node\", None) or getattr(write_entry, \"name\", None)\n                    candidate = getattr(write_entry, \"writes\", None)\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n\n                if isinstance(write_payload, Mapping):\n                    for key, value in write_payload.items():\n                        materialized.setdefault(key, value)\n                    if idx < 3:\n                        summary.append(\n                            {\n                                \"node\": str(node_name),\n                                \"keys\": list(write_payload.keys()),\n                            }\n                        )\n                    writes_found = True\n\n        # #region agent log\n        if summary:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:324\",\n                            \"message\": \"checkpoint writes merged\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"writes\": summary,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        else:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:329\",\n                            \"message\": \"checkpoint writes unavailable\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"has_writes\": isinstance(writes, Sequence),\n                                \"writes_type\": None if writes is None else type(writes).__name__,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        # #endregion\n\n        return materialized, writes_found\n\n    @staticmethod\n    def _has_meaningful_values(values: Mapping[str, Any]) -> bool:\n        \"\"\"Return True if checkpoint values contain data beyond housekeeping fields.\"\"\"\n\n        if not values:\n            return False\n        significant_keys = set(values.keys()) - {\"messages\", \"remaining_steps\"}\n        return bool(significant_keys)\n\n    async def _find_subgraph_resume_config(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        checkpoints: Sequence[Any],\n    ) -> Optional[tuple[RunnableConfig, Any]]:\n        target_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_ns = str(candidate_ns)\n\n        for record_idx, record in enumerate(checkpoints):\n            task_entries = self._extract_task_entries(record)\n            if not task_entries:\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:562\",\"message\":\"checkpoint missing task entries\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"parent_checkpoint_id\":self._extract_checkpoint_id(record)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n                continue\n            for task_idx, task in enumerate(task_entries[:2]):\n                task_metadata = task.get(\"metadata\")\n                normalized_metadata: Mapping[str, Any] = {}\n                if isinstance(task_metadata, Mapping):\n                    normalized_metadata = task_metadata\n                task_graph_id = normalized_metadata.get(\"graph_id\") or normalized_metadata.get(\"langgraph_graph_id\")\n\n                raw_config = task.get(\"config\")\n                normalized_config = self._normalize_config_like(raw_config)\n                if not normalized_config:\n                    continue\n                task_configurable = normalized_config.get(\"configurable\", {})\n                task_ns = None\n                if isinstance(task_configurable, Mapping):\n                    candidate = task_configurable.get(\"checkpoint_ns\")\n                    if candidate:\n                        task_ns = str(candidate)\n\n                ns_matches = target_ns and task_ns == target_ns\n                graph_matches = task_graph_id and str(task_graph_id) == str(graph_id)\n\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:581\",\"message\":\"task entry inspected\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"task_index\":task_idx,\"task_graph_id\":task_graph_id,\"task_ns\":task_ns},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n\n                if graph_matches or ns_matches:\n                    resume_state = task.get(\"state\")\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            json.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"D\",\n                                    \"location\": \"memory_manager.py:520\",\n                                    \"message\": \"subgraph resume config located\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"matched_ns\": task_ns,\n                                        \"matched_graph_id\": task_graph_id,\n                                        \"parent_checkpoint_id\": self._extract_checkpoint_id(record),\n                                        \"has_state\": resume_state is not None,\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return normalized_config, resume_state\n\n        return None\n\n    async def _get_graph_snapshot(\n        self,\n        *,\n        graph: Any,\n        cfg: RunnableConfig,\n        subgraphs: bool = False,\n    ) -> Any:\n        getter_async = getattr(graph, \"aget_state\", None)\n        params = {\"subgraphs\": True} if subgraphs else {}\n        try:\n            if callable(getter_async):\n                return await getter_async(cfg, **params)\n        except TypeError:\n            # Fallback for LangGraph versions that don't support subgraphs kwarg.\n            try:\n                return await getter_async(cfg)\n            except Exception:\n                pass\n        except Exception:\n            pass\n\n        getter_sync = getattr(graph, \"get_state\", None)\n        if callable(getter_sync):\n            try:\n                return getter_sync(cfg, **params)\n            except TypeError:\n                try:\n                    return getter_sync(cfg)\n                except Exception:\n                    return None\n            except Exception:\n                return None\n        return None\n\n    async def ainvoke_from_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str = \"sync\",\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph resuming from the latest checkpoint when available.\"\"\"\n\n        merged, _ = self.ensure_thread_id(config)\n        # SAFETY: Ignore any caller-supplied checkpoint_id.\n        #\n        # In this architecture, checkpoint selection is *graph_id-scoped* and managed\n        # exclusively by this runtime helper. Allowing external checkpoint_id values\n        # could cause cross-graph leakage within a shared thread_id.\n\n        merged_conf = merged.get(\"configurable\", {})\n        if isinstance(merged_conf, Mapping):\n            merged_conf_dict = dict(merged_conf)\n            merged_conf_dict.pop(\"checkpoint_id\", None)\n            original_ns = merged_conf_dict.get(\"checkpoint_ns\", \"\")\n            merged_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            merged[\"configurable\"] = merged_conf_dict\n            \n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"E\",\"location\":\"memory_manager.py:445\",\"message\":\"ainvoke_from_checkpoint setting checkpoint_ns\",\"data\":{\"graph_id\":graph_id,\"original_ns\":str(original_ns),\"new_ns\":str(merged_conf_dict.get(\"checkpoint_ns\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n        # Ensure the checkpoint records are scoping-friendly in LangGraph v1.\n        meta = merged.get(\"metadata\")\n        if not isinstance(meta, Mapping):\n            meta = {}\n        meta_dict = dict(meta)\n        meta_dict.setdefault(\"graph_id\", str(graph_id))\n        merged[\"metadata\"] = meta_dict\n\n        effective_local_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n\n        # #region agent log\n        import json\n        final_ns = merged.get(\"configurable\", {}).get(\"checkpoint_ns\", \"\")\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:458\",\"message\":\"ainvoke_from_checkpoint calling find_latest_checkpoint_id\",\"data\":{\"graph_id\":graph_id,\"checkpoint_ns\":str(final_ns),\"thread_id\":str(merged.get(\"configurable\",{}).get(\"thread_id\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=effective_local_checkpointer,\n            local_graph=graph,\n        )\n        checkpoint_record: Optional[Any] = None\n        subgraph_resume: Optional[tuple[RunnableConfig, Any]] = None\n        if checkpoint_id is None:\n            snapshot_sources: list[Any] = []\n\n            if context is not None:\n                runner = getattr(context, \"graph_runner\", None)\n                graph_runtime = getattr(runner, \"graph\", None)\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:711\",\"message\":\"parent context inspection\",\"data\":{\"graph_id\":graph_id,\"has_context\":True,\"has_runner\":runner is not None,\"has_graph\":graph_runtime is not None},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n                if graph_runtime is not None:\n                    try:\n                        parent_snapshot = await self._get_graph_snapshot(\n                            graph=graph_runtime,\n                            cfg=merged,\n                            subgraphs=True,\n                        )\n                        if parent_snapshot is not None:\n                            snapshot_sources.append(parent_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:715\",\"message\":\"parent snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":parent_snapshot is not None,\"has_tasks\":bool(getattr(parent_snapshot,\"tasks\",None)),\"has_next\":bool(getattr(parent_snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                    except Exception:\n                        parent_snapshot = None\n                else:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:724\",\"message\":\"parent snapshot skipped\",\"data\":{\"graph_id\":graph_id,\"reason\":\"graph_runner_missing\" if runner is None else \"graph_attr_missing\"},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:729\",\"message\":\"parent context absent\",\"data\":{\"graph_id\":graph_id},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n\n            root_graph = getattr(context, \"root_graph\", None) if context is not None else None\n            if root_graph is not None:\n                try:\n                    root_snapshot = await self._get_graph_snapshot(\n                        graph=root_graph,\n                        cfg=merged,\n                        subgraphs=True,\n                    )\n                    if root_snapshot is not None:\n                        snapshot_sources.append(root_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:738\",\"message\":\"root snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":root_snapshot is not None,\"has_tasks\":bool(getattr(root_snapshot,\"tasks\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                except Exception:\n                    root_snapshot = None\n\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=merged,\n                subgraphs=True,\n            )\n            if snapshot is not None:\n                snapshot_sources.append(snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:727\",\"message\":\"assistant snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":bool(getattr(snapshot,\"tasks\",None)),\"has_next\":bool(getattr(snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            checkpoints_snapshot = await self.list_thread_checkpoints(\n                config=merged,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n            snapshot_sources.extend(checkpoints_snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:734\",\"message\":\"thread checkpoints snapshot collected\",\"data\":{\"graph_id\":graph_id,\"count\":len(checkpoints_snapshot)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            subgraph_resume = await self._find_subgraph_resume_config(\n                config=merged,\n                graph_id=graph_id,\n                checkpoints=snapshot_sources,\n            )\n            if subgraph_resume is not None:\n                resume_config, _ = subgraph_resume\n                metadata = resume_config.get(\"metadata\", {})\n                if not isinstance(metadata, Mapping):\n                    metadata = dict(metadata) if metadata is not None else {}\n                metadata = dict(metadata)\n                metadata.setdefault(\"graph_id\", str(graph_id))\n                resume_config[\"metadata\"] = metadata  # type: ignore[index]\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:743\",\"message\":\"subgraph resume config missing\",\"data\":{\"graph_id\":graph_id,\"snapshot_sources\":len(snapshot_sources)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n        \n        # #region agent log\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:464\",\"message\":\"ainvoke_from_checkpoint checkpoint_id result\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":str(checkpoint_id) if checkpoint_id else None,\"checkpoint_ns\":str(final_ns)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if checkpoint_id:\n            checkpoint_record = await self._load_checkpoint_record(\n                config=merged,\n                checkpoint_id=checkpoint_id,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n\n            cfg: RunnableConfig = dict(merged)\n            configurable = cfg.get(\"configurable\", {})\n            configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n            configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n            configurable_dict[\"checkpoint_id\"] = checkpoint_id\n            cfg[\"configurable\"] = configurable_dict\n\n            # If the checkpoint represents an in-progress run (has pending `next`),\n            # we resume via `invoke(None, checkpoint_id=...)`. If the run is already\n            # complete (no pending next nodes), we \"restart\" from the persisted\n            # snapshot values as a fresh invocation. This is the required behavior\n            # for refinement: patch values \u2192 re-run from patched state.\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=cfg,\n                subgraphs=True,\n            )\n\n            # #region agent log\n            import json\n            snapshot_has_tasks = bool(getattr(snapshot, \"tasks\", None))\n            snapshot_next = getattr(snapshot, \"next\", None)\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"C\",\"location\":\"memory_manager.py:504\",\"message\":\"ainvoke_from_checkpoint snapshot inspection\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":checkpoint_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":snapshot_has_tasks,\"pending_next\":bool(snapshot_next)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            next_nodes = getattr(snapshot, \"next\", None)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(next_nodes, Sequence) and next_nodes:\n                return await self.ainvoke_with_durability(\n                    graph=graph,\n                    graph_input=None,\n                    config=cfg,\n                    context=context,\n                    durability=durability,\n                    local_checkpointer=effective_local_checkpointer,\n                )\n\n            # IMPORTANT:\n            # If the checkpoint is COMPLETE (no pending next nodes), we DO NOT attempt to\n            # \"restart\" the graph by invoking without checkpoint_id. In a shared thread_id\n            # architecture (multiple graphs in the same thread), dropping checkpoint_id\n            # would cause LangGraph to load the latest checkpoint for the thread+ns,\n            # which may belong to a different graph_id \u2192 cross-graph contamination.\n            #\n            # Callers that need to re-run a completed checkpoint should first \"arm\" it\n            # via `graph.update_state(..., as_node=\"__start__\")` (e.g., our refinement\n            # injection path does this), which produces a checkpoint with pending next nodes.\n            if isinstance(values, Mapping):\n                materialized_values, writes_found = self._materialize_checkpoint_values(\n                    values,\n                    checkpoint_record,\n                    graph_id=str(graph_id),\n                )\n                if writes_found or self._has_meaningful_values(materialized_values):\n                    # #region agent log\n                    import json as _json_resume\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            _json_resume.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"J\",\n                                    \"location\": \"memory_manager.py:944\",\n                                    \"message\": \"returning checkpoint values\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"keys\": list(materialized_values.keys()),\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return dict(materialized_values)\n\n                # Values are incomplete (e.g., only messages). Fallback to fresh invoke.\n                rerun_cfg: RunnableConfig = dict(merged)\n                rerun_conf = rerun_cfg.get(\"configurable\", {})\n                if isinstance(rerun_conf, Mapping):\n                    rerun_conf_dict = dict(rerun_conf)\n                    rerun_conf_dict.pop(\"checkpoint_id\", None)\n                    rerun_conf_dict.setdefault(\"checkpoint_ns\", str(final_ns))\n                    rerun_cfg[\"configurable\"] = rerun_conf_dict\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=graph_input,\n                config=rerun_cfg,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        if subgraph_resume is not None:\n            # #region agent log\n            import json\n            resume_config, resume_state = subgraph_resume\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"D\",\n                            \"location\": \"memory_manager.py:610\",\n                            \"message\": \"resuming assistant via subgraph config\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"checkpoint_ns\": resume_config.get(\"configurable\", {}).get(\"checkpoint_ns\") if isinstance(resume_config.get(\"configurable\"), Mapping) else None,\n                                \"has_state\": resume_state is not None,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n            # #endregion\n            resume_input = graph_input\n            if resume_state is not None:\n                values = getattr(resume_state, \"values\", None)\n                if isinstance(values, Mapping):\n                    resume_input = dict(values)\n                elif isinstance(resume_state, Mapping):\n                    maybe_values = resume_state.get(\"values\")\n                    if isinstance(maybe_values, Mapping):\n                        resume_input = dict(maybe_values)\n                    else:\n                        resume_input = resume_state\n                else:\n                    resume_input = resume_state\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=resume_input,\n                config=resume_config,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        # SAFETY: Never allow a caller-supplied checkpoint_id to influence execution\n        # when we are NOT explicitly resuming from a checkpoint for this graph_id.\n        #\n        # Without this, a foreign checkpoint_id (from another graph_id in the same\n        # thread) could be accidentally consumed by LangGraph, violating isolation.\n        fresh_cfg: RunnableConfig = dict(merged)\n        fresh_conf = fresh_cfg.get(\"configurable\", {})\n        if isinstance(fresh_conf, Mapping):\n            fresh_conf_dict = dict(fresh_conf)\n            fresh_conf_dict.pop(\"checkpoint_id\", None)\n            # Keep checkpoint_ns stable (LangGraph may assume the key exists).\n            fresh_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            fresh_cfg[\"configurable\"] = fresh_conf_dict\n\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=graph_input,\n            config=fresh_cfg,\n            context=context,\n            durability=durability,\n            local_checkpointer=effective_local_checkpointer,\n        )\n\n    async def append_messages_to_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        new_messages: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Append messages to the latest checkpoint for ``graph_id`` and return new checkpoint id.\n\n        This uses ``graph.update_state`` / ``graph.aupdate_state`` so reducers (e.g. `add_messages`)\n        are honored. The update is applied as a fork of the latest checkpoint for ``graph_id``.\n        \"\"\"\n\n        if not new_messages:\n            return None\n\n        merged, _ = self.ensure_thread_id(config)\n        resolved_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n        latest_checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n        \n        if not latest_checkpoint_id:\n            return None\n        \n        patch_config: RunnableConfig = dict(merged)\n        configurable = patch_config.get(\"configurable\", {})\n        configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n        configurable_dict[\"checkpoint_id\"] = latest_checkpoint_id\n        patch_config[\"configurable\"] = configurable_dict\n\n        # Ensure patched checkpoints remain discoverable by metadata scoping.\n        metadata = patch_config.get(\"metadata\")\n        if not isinstance(metadata, Mapping):\n            metadata = {}\n        metadata_dict = dict[str, Any](metadata)\n        metadata_dict.setdefault(\"graph_id\", str(graph_id))\n        patch_config[\"metadata\"] = metadata_dict\n\n\n        # Best-effort idempotency: avoid appending messages already present in the checkpoint.\n        # This is critical for durable resume where refinement planning may be replayed.\n        filtered_messages: list[Any] = list(new_messages)\n        try:\n            snapshot = None\n            getter_async = getattr(graph, \"aget_state\", None)\n            if callable(getter_async):\n                snapshot = await getter_async(patch_config)\n            if snapshot is None:\n                getter_sync = getattr(graph, \"get_state\", None)\n                if callable(getter_sync):\n                    snapshot = getter_sync(patch_config)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(values, Mapping):\n                existing = values.get(\"messages\")\n                if isinstance(existing, Sequence) and not isinstance(existing, (str, bytes)):\n                    existing_contents: set[str] = set()\n                    for message in existing:\n                        content = getattr(message, \"content\", None)\n                        if content:\n                            existing_contents.add(str(content))\n                    if existing_contents:\n                        filtered_messages = [\n                            message\n                            for message in filtered_messages\n                            if str(getattr(message, \"content\", \"\")) not in existing_contents\n                        ]\n        except Exception:\n            filtered_messages = list(new_messages)\n\n        if not filtered_messages:\n            return latest_checkpoint_id\n\n        updates: dict[str, Any] = {\"messages\": filtered_messages}\n\n        updater_async = getattr(graph, \"aupdate_state\", None)\n        updater_sync = getattr(graph, \"update_state\", None)\n        resolved_as_node = as_node or \"__start__\"\n        try:\n            if callable(updater_async):\n                await updater_async(patch_config, updates, as_node=resolved_as_node)\n            elif callable(updater_sync):\n                updater_sync(patch_config, updates, as_node=resolved_as_node)\n            else:\n                return None\n        except Exception as e:\n            return None\n\n        return await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n\n    async def inject_distribution_refinement_messages(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        requests: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Patch a graph checkpoint by appending refinement instruction messages.\n\n        Mirrors the extraction rules used by `_distribution_inject_refinement_messages`:\n        each request may carry `payload.messages` items shaped like\n        `{ \"content\": \"...\", \"metadata\": {...} }`.\n        \"\"\"\n\n        try:\n            from langchain_core.messages import HumanMessage\n        except Exception:\n            return None\n\n        injected: list[Any] = []\n        seen_contents: set[str] = set()\n        for request in requests:\n            payload = getattr(request, \"payload\", None)\n            if not isinstance(payload, Mapping):\n                payload = payload if isinstance(payload, dict) else {}\n            messages_payload = payload.get(\"messages\") or []\n            if not isinstance(messages_payload, Sequence) or isinstance(\n                messages_payload, (str, bytes)\n            ):\n                continue\n            for message in messages_payload:\n                if not isinstance(message, Mapping):\n                    continue\n                content = message.get(\"content\")\n                if not content:\n                    continue\n                content_str = str(content)\n                if content_str in seen_contents:\n                    continue\n                metadata = message.get(\"metadata\") or {}\n                additional_kwargs = dict(metadata) if isinstance(metadata, Mapping) else {}\n                injected.append(\n                    HumanMessage(content=content_str, additional_kwargs=additional_kwargs)\n                )\n                seen_contents.add(content_str)\n\n        if not injected:\n            return None\n\n        return await self.append_messages_to_checkpoint(\n            graph=graph,\n            graph_id=graph_id,\n            config=config,\n            new_messages=injected,\n            as_node=as_node,\n            local_checkpointer=local_checkpointer,\n        )\n\n    @staticmethod\n    def extract_thread_id(config: Optional[RunnableConfig]) -> Optional[ThreadId]:\n        if not config:\n            return None\n        configurable = config.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            return None\n        thread_id = configurable.get(\"thread_id\")\n        return str(thread_id) if thread_id else None\n\n    async def aget_platform_thread_state(self, *, thread_id: ThreadId) -> Optional[Any]:\n        \"\"\"Get latest persisted state from platform via LangGraph SDK (if available).\"\"\"\n\n        try:\n            from langgraph_sdk import get_client  # type: ignore\n        except Exception:\n            return None\n\n        try:\n            client = get_client()\n            return await client.threads.get_state(thread_id)\n        except Exception:\n            return None\n\n\n    async def has_persisted_checkpoint(\n        self,\n        *,\n        config: Optional[RunnableConfig],\n        local_checkpointer: Optional[Any] = None,\n    ) -> bool:\n        \"\"\"Return True if a checkpoint exists for config (platform or local).\"\"\"\n\n        if config is None:\n            return False\n\n        if self.is_production_mode():\n            thread_id = self.extract_thread_id(config)\n            if not thread_id:\n                return False\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n            values = getattr(snapshot, \"values\", None)\n            return isinstance(values, Mapping)\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if not checkpointer:\n            return False\n\n        getter_async = getattr(checkpointer, \"aget_tuple\", None)\n        try:\n            if callable(getter_async):\n                checkpoint_tuple = await getter_async(config)\n            else:\n                getter_sync = getattr(checkpointer, \"get_tuple\", None)\n                if not callable(getter_sync):\n                    return False\n                checkpoint_tuple = getter_sync(config)\n        except Exception:\n            return False\n\n        return checkpoint_tuple is not None\n\n    async def restore_state_from_latest_checkpoint(\n        self,\n        *,\n        state: StateDict,\n        config: Optional[RunnableConfig],\n        local_graph: Optional[Any],\n    ) -> bool:\n        \"\"\"Merge latest persisted state into the caller-owned `state` mapping.\"\"\"\n\n        if config is None:\n            return False\n\n        snapshot = None\n        thread_id = self.extract_thread_id(config)\n        if self.is_production_mode() and thread_id:\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n\n        if snapshot is None and local_graph is not None:\n            getter = getattr(local_graph, \"aget_state\", None)\n            if callable(getter):\n                try:\n                    snapshot = await getter(config)\n                except Exception:\n                    snapshot = None\n            if snapshot is None:\n                getter_sync = getattr(local_graph, \"get_state\", None)\n                if callable(getter_sync):\n                    try:\n                        snapshot = getter_sync(config)\n                    except Exception:\n                        snapshot = None\n\n        values = getattr(snapshot, \"values\", None)\n        if not isinstance(values, Mapping):\n            return False\n\n        for key, value in values.items():\n            state[key] = value\n        return True\n\n    async def ainvoke_with_durability(\n        self,\n        *,\n        graph: Any,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph with durability when supported.\"\"\"\n\n        # In production mode, platform may inject durability backends automatically.\n        # In dev mode, only attempt durability when the runnable itself was compiled\n        # with a checkpointer so LangGraph sets up its AsyncPregel loop correctly.\n        graph_bound_checkpointer = _extract_graph_checkpointer(graph)\n        resolved_local_checkpointer = local_checkpointer or graph_bound_checkpointer\n        checkpointer = resolved_local_checkpointer or self.checkpointer\n\n        if self.is_production_mode():\n            use_durability = durability\n        else:\n            use_durability = durability if (checkpointer and _graph_supports_durability(graph)) else None\n        try:\n            if use_durability:\n                return await graph.ainvoke(\n                    graph_input,\n                    config=config,\n                    context=context,\n                    durability=use_durability,\n                )\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n        except (TypeError, AttributeError):\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n\n\n__all__ = [\n    \"resolve_graph_checkpointer\",\n    \"resolve_graph_store\",\n    \"GraphMemoryRuntime\",\n]\n\n\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:847cd80d-639f-a598-7729-cdd99f7db474\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766172069115.072}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766172069115.938}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:847cd80d-639f-a598-7729-cdd99f7db474\", \"new_ns\": \"user_preferences:847cd80d-639f-a598-7729-cdd99f7db474\"}, \"timestamp\": 1766172069116.014}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:847cd80d-639f-a598-7729-cdd99f7db474\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\"}, \"timestamp\": 1766172069116.0588}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172069116.3762}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172069116.4128}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172069116.489}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172069116.5361}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172069116.58}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766172069116.8198}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172069116.938}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172069116.98}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766172069117.0503}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:847cd80d-639f-a598-7729-cdd99f7db474\"}, \"timestamp\": 1766172069117.086}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766172076212.399}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:9d6a45cf-da43-4e0b-2be4-05debefecd4d\", \"new_ns\": \"route_drafting:9d6a45cf-da43-4e0b-2be4-05debefecd4d\"}, \"timestamp\": 1766172076222.2761}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:9d6a45cf-da43-4e0b-2be4-05debefecd4d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\"}, \"timestamp\": 1766172076222.361}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172076222.827}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172076222.922}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172076223.003}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172076223.058}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172076223.271}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766172076224.323}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172076224.411}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172076224.5122}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766172076224.562}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:9d6a45cf-da43-4e0b-2be4-05debefecd4d\"}, \"timestamp\": 1766172076224.601}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:9d6a45cf-da43-4e0b-2be4-05debefecd4d|graph:d81f1f20-bfbc-6e85-a185-22ba6b1dd4d7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766172076535.373}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172076535.455}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:9d6a45cf-da43-4e0b-2be4-05debefecd4d|graph:d81f1f20-bfbc-6e85-a185-22ba6b1dd4d7\", \"new_ns\": \"route_drafting:9d6a45cf-da43-4e0b-2be4-05debefecd4d|graph:d81f1f20-bfbc-6e85-a185-22ba6b1dd4d7\"}, \"timestamp\": 1766172076535.509}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:9d6a45cf-da43-4e0b-2be4-05debefecd4d|graph:d81f1f20-bfbc-6e85-a185-22ba6b1dd4d7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\"}, \"timestamp\": 1766172076535.553}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172076535.8699}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766172076535.912}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172076535.9768}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766172076536.217}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172076536.303}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766172076536.341}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:9d6a45cf-da43-4e0b-2be4-05debefecd4d|graph:d81f1f20-bfbc-6e85-a185-22ba6b1dd4d7\"}, \"timestamp\": 1766172076536.3772}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766172089938.465}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:1\", \"new_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:1\"}, \"timestamp\": 1766172090013.913}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\"}, \"timestamp\": 1766172090014.0537}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172090014.814}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172090014.903}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172090015.026}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172090015.0981}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172090015.1838}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766172090015.4949}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172090015.548}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172090015.5908}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766172090015.6438}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:1\"}, \"timestamp\": 1766172090015.683}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:2\", \"new_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:2\"}, \"timestamp\": 1766172090073.8508}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\"}, \"timestamp\": 1766172090073.9893}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172090074.5798}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172090074.6282}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172090074.692}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172090074.746}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172090074.791}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766172090075.215}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172090075.3213}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172090075.3733}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766172090075.464}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:2\"}, \"timestamp\": 1766172090075.5042}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:3\", \"new_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:3\"}, \"timestamp\": 1766172090135.674}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\"}, \"timestamp\": 1766172090135.794}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172090136.087}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172090136.1338}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172090136.201}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172090136.254}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172090136.3398}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766172090136.589}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172090136.6401}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172090136.686}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766172090136.728}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:3\"}, \"timestamp\": 1766172090136.765}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:4\", \"new_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:4\"}, \"timestamp\": 1766172090235.358}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\"}, \"timestamp\": 1766172090235.785}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172090236.4731}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172090236.8599}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172090236.969}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172090237.277}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172090237.692}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766172090238.2668}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172090238.4583}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172090238.515}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766172090238.6482}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:4\"}, \"timestamp\": 1766172090238.835}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:1|1|graph:5129b859-03c4-bbc8-ba2c-99f057b1874e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172090835.361}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172090835.4712}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:1|1|graph:5129b859-03c4-bbc8-ba2c-99f057b1874e\", \"new_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:1|1|graph:5129b859-03c4-bbc8-ba2c-99f057b1874e\"}, \"timestamp\": 1766172090835.5352}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:1|1|graph:5129b859-03c4-bbc8-ba2c-99f057b1874e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\"}, \"timestamp\": 1766172090835.5898}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172090835.906}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766172090835.999}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172090836.063}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766172090836.306}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172090836.352}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766172090836.3882}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:1|1|graph:5129b859-03c4-bbc8-ba2c-99f057b1874e\"}, \"timestamp\": 1766172090836.4202}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:2|2|graph:695fa5e0-b5fd-6002-7989-4cf491fdfe0b\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172090870.122}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172090870.245}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:2|2|graph:695fa5e0-b5fd-6002-7989-4cf491fdfe0b\", \"new_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:2|2|graph:695fa5e0-b5fd-6002-7989-4cf491fdfe0b\"}, \"timestamp\": 1766172090870.2942}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:2|2|graph:695fa5e0-b5fd-6002-7989-4cf491fdfe0b\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\"}, \"timestamp\": 1766172090870.333}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172090870.6592}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766172090870.697}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172090870.755}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766172090870.991}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172090871.0342}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766172090871.067}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:2|2|graph:695fa5e0-b5fd-6002-7989-4cf491fdfe0b\"}, \"timestamp\": 1766172090871.0981}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:3|3|graph:343fca97-2fa7-c96f-3aaa-fbcf12bc79ab\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172090904.16}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172090904.279}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:3|3|graph:343fca97-2fa7-c96f-3aaa-fbcf12bc79ab\", \"new_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:3|3|graph:343fca97-2fa7-c96f-3aaa-fbcf12bc79ab\"}, \"timestamp\": 1766172090904.33}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:3|3|graph:343fca97-2fa7-c96f-3aaa-fbcf12bc79ab\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\"}, \"timestamp\": 1766172090904.373}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172090904.706}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766172090904.747}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172090904.809}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766172090905.098}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172090905.1663}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766172090905.21}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:3|3|graph:343fca97-2fa7-c96f-3aaa-fbcf12bc79ab\"}, \"timestamp\": 1766172090905.248}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:4|4|graph:f2b4dcaf-1ff1-509e-60ed-e144917f8402\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172090940.0452}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172090940.212}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:4|4|graph:f2b4dcaf-1ff1-509e-60ed-e144917f8402\", \"new_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:4|4|graph:f2b4dcaf-1ff1-509e-60ed-e144917f8402\"}, \"timestamp\": 1766172090940.275}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:4|4|graph:f2b4dcaf-1ff1-509e-60ed-e144917f8402\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\"}, \"timestamp\": 1766172090940.323}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:40cdc1bf\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172090940.699}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766172090940.743}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172090940.811}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766172090941.0508}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172090941.101}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766172090941.1367}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6300fb09-b8e2-c531-8562-f9ef57de9c69|worker:4|4|graph:f2b4dcaf-1ff1-509e-60ed-e144917f8402\"}, \"timestamp\": 1766172090941.17}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:0b65b115-bc60-e03b-f897-63b6727d8a34\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766172104223.047}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766172104223.215}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:0b65b115-bc60-e03b-f897-63b6727d8a34\", \"new_ns\": \"user_preferences:0b65b115-bc60-e03b-f897-63b6727d8a34\"}, \"timestamp\": 1766172104223.288}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:0b65b115-bc60-e03b-f897-63b6727d8a34\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172104223.3547}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172104223.727}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172104223.774}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172104223.853}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172104223.905}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172104223.952}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766172104224.204}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172104224.2551}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172104224.2932}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766172104224.338}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:0b65b115-bc60-e03b-f897-63b6727d8a34\"}, \"timestamp\": 1766172104224.374}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766172112453.729}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:739d2945-d259-2437-60e4-e993f038993b\", \"new_ns\": \"route_drafting:739d2945-d259-2437-60e4-e993f038993b\"}, \"timestamp\": 1766172112459.729}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:739d2945-d259-2437-60e4-e993f038993b\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172112459.894}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172112460.246}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172112460.296}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172112460.361}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172112460.407}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172112460.4521}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766172112460.692}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172112460.737}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172112460.774}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766172112460.809}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:739d2945-d259-2437-60e4-e993f038993b\"}, \"timestamp\": 1766172112460.8408}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:739d2945-d259-2437-60e4-e993f038993b|graph:9053606f-7c48-6e69-34e4-41951adc3ea2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766172112591.737}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172112592.0078}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:739d2945-d259-2437-60e4-e993f038993b|graph:9053606f-7c48-6e69-34e4-41951adc3ea2\", \"new_ns\": \"route_drafting:739d2945-d259-2437-60e4-e993f038993b|graph:9053606f-7c48-6e69-34e4-41951adc3ea2\"}, \"timestamp\": 1766172112592.0762}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:739d2945-d259-2437-60e4-e993f038993b|graph:9053606f-7c48-6e69-34e4-41951adc3ea2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172112592.12}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172112592.604}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766172112592.672}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172112592.747}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766172112593.027}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172112593.076}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766172112593.1133}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:739d2945-d259-2437-60e4-e993f038993b|graph:9053606f-7c48-6e69-34e4-41951adc3ea2\"}, \"timestamp\": 1766172112593.145}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766172132745.336}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:1\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:1\"}, \"timestamp\": 1766172132827.278}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172132827.4072}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172132827.734}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172132827.788}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172132827.866}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172132827.923}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172132827.9731}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766172132828.226}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172132828.276}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172132828.316}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766172132828.353}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:1\"}, \"timestamp\": 1766172132828.385}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:2\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:2\"}, \"timestamp\": 1766172132892.137}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172132892.287}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172132893.018}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172132893.0813}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172132893.154}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172132893.209}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172132893.258}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766172132893.5083}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172132893.555}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172132893.594}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766172132893.6301}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:2\"}, \"timestamp\": 1766172132893.6619}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:3\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:3\"}, \"timestamp\": 1766172132954.2998}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172132954.459}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172132955.0562}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172132955.111}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172132955.194}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172132955.2441}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172132955.2908}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766172132955.544}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172132955.591}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172132955.6428}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766172132955.678}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:3\"}, \"timestamp\": 1766172132955.709}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:4\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:4\"}, \"timestamp\": 1766172133017.7942}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172133017.922}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172133018.207}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172133018.25}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172133018.317}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172133018.367}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172133018.417}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766172133018.655}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172133018.7012}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172133018.743}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766172133018.7832}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:4\"}, \"timestamp\": 1766172133018.941}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:5\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:5\"}, \"timestamp\": 1766172133077.311}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172133077.457}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172133078.0571}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172133078.1108}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172133078.176}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172133078.2249}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172133078.271}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"count\": 0}, \"timestamp\": 1766172133078.508}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172133078.551}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172133078.588}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_sources\": 3}, \"timestamp\": 1766172133078.625}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:5\"}, \"timestamp\": 1766172133078.654}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:6\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:6\"}, \"timestamp\": 1766172133136.44}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172133136.5493}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172133136.8152}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172133136.8552}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172133136.927}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172133136.974}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172133137.016}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"count\": 0}, \"timestamp\": 1766172133137.25}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172133137.29}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172133137.324}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_sources\": 3}, \"timestamp\": 1766172133137.356}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:6\"}, \"timestamp\": 1766172133137.3901}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:7\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:7\"}, \"timestamp\": 1766172133371.743}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172133371.881}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172133372.521}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172133372.563}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172133372.628}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172133372.677}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172133372.726}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"count\": 0}, \"timestamp\": 1766172133372.9658}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172133373.019}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172133373.055}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_sources\": 3}, \"timestamp\": 1766172133373.1611}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:7\"}, \"timestamp\": 1766172133373.217}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:8\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:8\"}, \"timestamp\": 1766172133431.102}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172133431.208}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172133431.484}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172133431.524}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172133431.584}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172133431.629}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172133431.675}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"count\": 0}, \"timestamp\": 1766172133431.9082}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172133431.9492}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172133431.9841}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_sources\": 3}, \"timestamp\": 1766172133432.0178}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:8\"}, \"timestamp\": 1766172133432.0461}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:9\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:9\"}, \"timestamp\": 1766172133490.347}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172133490.472}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172133491.065}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172133491.117}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172133491.1821}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172133491.232}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172133491.278}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"count\": 0}, \"timestamp\": 1766172133491.512}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172133491.554}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172133491.5928}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_sources\": 3}, \"timestamp\": 1766172133491.628}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:9\"}, \"timestamp\": 1766172133491.658}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:1|1|graph:a114794e-7e08-c5d3-4a7d-1c6fbc26a525\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172135138.149}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172135138.272}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:1|1|graph:a114794e-7e08-c5d3-4a7d-1c6fbc26a525\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:1|1|graph:a114794e-7e08-c5d3-4a7d-1c6fbc26a525\"}, \"timestamp\": 1766172135138.3218}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:1|1|graph:a114794e-7e08-c5d3-4a7d-1c6fbc26a525\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172135138.3691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172135138.6821}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766172135138.72}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172135138.7908}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766172135139.0322}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172135139.0789}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766172135139.123}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:1|1|graph:a114794e-7e08-c5d3-4a7d-1c6fbc26a525\"}, \"timestamp\": 1766172135139.189}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:2|2|graph:e786baf8-847f-a136-8d74-c5a0dc5a6341\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172135174.487}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172135174.634}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:2|2|graph:e786baf8-847f-a136-8d74-c5a0dc5a6341\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:2|2|graph:e786baf8-847f-a136-8d74-c5a0dc5a6341\"}, \"timestamp\": 1766172135174.6938}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:2|2|graph:e786baf8-847f-a136-8d74-c5a0dc5a6341\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172135174.85}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172135175.158}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766172135175.2031}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172135175.316}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766172135175.6758}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172135175.753}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766172135175.799}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:2|2|graph:e786baf8-847f-a136-8d74-c5a0dc5a6341\"}, \"timestamp\": 1766172135175.838}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:3|3|graph:bfba1f01-1fc1-175a-3b10-294fd400b86a\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172135210.988}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172135211.0952}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:3|3|graph:bfba1f01-1fc1-175a-3b10-294fd400b86a\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:3|3|graph:bfba1f01-1fc1-175a-3b10-294fd400b86a\"}, \"timestamp\": 1766172135211.147}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:3|3|graph:bfba1f01-1fc1-175a-3b10-294fd400b86a\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172135211.189}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172135211.4758}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766172135211.513}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172135211.574}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766172135211.8062}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172135211.8489}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766172135212.0278}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:3|3|graph:bfba1f01-1fc1-175a-3b10-294fd400b86a\"}, \"timestamp\": 1766172135212.0881}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:4|4|graph:0c2f5b49-312b-6fab-636f-e66be4aaac81\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172135247.173}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172135247.2751}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:4|4|graph:0c2f5b49-312b-6fab-636f-e66be4aaac81\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:4|4|graph:0c2f5b49-312b-6fab-636f-e66be4aaac81\"}, \"timestamp\": 1766172135247.326}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:4|4|graph:0c2f5b49-312b-6fab-636f-e66be4aaac81\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172135247.367}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172135247.663}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766172135247.7}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172135247.758}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766172135247.9958}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172135248.0378}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766172135248.069}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:4|4|graph:0c2f5b49-312b-6fab-636f-e66be4aaac81\"}, \"timestamp\": 1766172135248.097}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:5|5|graph:8801651a-a9e5-f249-d548-6e312325a488\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172135282.71}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172135282.8218}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:5|5|graph:8801651a-a9e5-f249-d548-6e312325a488\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:5|5|graph:8801651a-a9e5-f249-d548-6e312325a488\"}, \"timestamp\": 1766172135282.874}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:5|5|graph:8801651a-a9e5-f249-d548-6e312325a488\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172135282.93}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172135283.2373}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\"}, \"timestamp\": 1766172135283.2761}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172135283.451}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"count\": 0}, \"timestamp\": 1766172135283.804}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172135283.8708}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"snapshot_sources\": 1}, \"timestamp\": 1766172135283.9119}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:5|5|graph:8801651a-a9e5-f249-d548-6e312325a488\"}, \"timestamp\": 1766172135283.946}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:6|6|graph:1d76ffe5-2bfa-e0c0-7e31-ad8cedcec0f3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172135317.671}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172135317.781}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:6|6|graph:1d76ffe5-2bfa-e0c0-7e31-ad8cedcec0f3\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:6|6|graph:1d76ffe5-2bfa-e0c0-7e31-ad8cedcec0f3\"}, \"timestamp\": 1766172135317.8298}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:6|6|graph:1d76ffe5-2bfa-e0c0-7e31-ad8cedcec0f3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172135317.87}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172135318.1628}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\"}, \"timestamp\": 1766172135318.1992}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172135318.26}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"count\": 0}, \"timestamp\": 1766172135318.4968}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172135318.5378}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"snapshot_sources\": 1}, \"timestamp\": 1766172135318.5679}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:6|6|graph:1d76ffe5-2bfa-e0c0-7e31-ad8cedcec0f3\"}, \"timestamp\": 1766172135318.604}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:7|7|graph:ef2c386f-5ce4-e6b0-e379-cc9c8c5a7e6e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172135352.305}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172135352.417}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:7|7|graph:ef2c386f-5ce4-e6b0-e379-cc9c8c5a7e6e\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:7|7|graph:ef2c386f-5ce4-e6b0-e379-cc9c8c5a7e6e\"}, \"timestamp\": 1766172135352.598}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:7|7|graph:ef2c386f-5ce4-e6b0-e379-cc9c8c5a7e6e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172135352.66}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172135352.983}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\"}, \"timestamp\": 1766172135353.021}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172135353.085}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"count\": 0}, \"timestamp\": 1766172135353.324}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172135353.369}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"snapshot_sources\": 1}, \"timestamp\": 1766172135353.402}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:7|7|graph:ef2c386f-5ce4-e6b0-e379-cc9c8c5a7e6e\"}, \"timestamp\": 1766172135353.437}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:8|8|graph:1168f6b8-d0a1-8ae0-3014-0eaecdb57765\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172135388.968}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172135389.0933}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:8|8|graph:1168f6b8-d0a1-8ae0-3014-0eaecdb57765\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:8|8|graph:1168f6b8-d0a1-8ae0-3014-0eaecdb57765\"}, \"timestamp\": 1766172135389.189}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:8|8|graph:1168f6b8-d0a1-8ae0-3014-0eaecdb57765\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172135389.24}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172135389.5413}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\"}, \"timestamp\": 1766172135389.583}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172135389.662}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"count\": 0}, \"timestamp\": 1766172135389.925}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172135389.975}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"snapshot_sources\": 1}, \"timestamp\": 1766172135390.0107}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:8|8|graph:1168f6b8-d0a1-8ae0-3014-0eaecdb57765\"}, \"timestamp\": 1766172135390.041}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:9|9|graph:6377d4a2-484e-b270-1b68-f14276608607\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172135425.609}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172135425.729}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:9|9|graph:6377d4a2-484e-b270-1b68-f14276608607\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:9|9|graph:6377d4a2-484e-b270-1b68-f14276608607\"}, \"timestamp\": 1766172135425.8372}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:9|9|graph:6377d4a2-484e-b270-1b68-f14276608607\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172135425.896}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172135426.2468}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\"}, \"timestamp\": 1766172135426.365}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172135426.445}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"count\": 0}, \"timestamp\": 1766172135426.712}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172135426.759}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"snapshot_sources\": 1}, \"timestamp\": 1766172135426.798}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:9|9|graph:6377d4a2-484e-b270-1b68-f14276608607\"}, \"timestamp\": 1766172135426.84}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:2|2|graph:e786baf8-847f-a136-8d74-c5a0dc5a6341\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172148673.5518}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172148674.2048}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:2|2|graph:e786baf8-847f-a136-8d74-c5a0dc5a6341\", \"new_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:2|2|graph:e786baf8-847f-a136-8d74-c5a0dc5a6341\"}, \"timestamp\": 1766172148674.27}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:2|2|graph:e786baf8-847f-a136-8d74-c5a0dc5a6341\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\"}, \"timestamp\": 1766172148674.316}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c61c52d2\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd100-6cc8-6568-8000-0ea172dfed25\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:2|2|graph:e786baf8-847f-a136-8d74-c5a0dc5a6341\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd100-6cc7-6eba-bfff-dbaa0aed5153\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:2|2|graph:e786baf8-847f-a136-8d74-c5a0dc5a6341\"}]}, \"timestamp\": 1766172148675.057}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd100-6cc8-6568-8000-0ea172dfed25\", \"checkpoint_ns\": \"wide_funnel:6e17f2b8-8d81-9d1a-be4d-b46e80029442|worker:2|2|graph:e786baf8-847f-a136-8d74-c5a0dc5a6341\"}, \"timestamp\": 1766172148675.195}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd100-6cc8-6568-8000-0ea172dfed25\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766172148676.009}\n"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3811-a386-7ab2-b6e8-39a9b54bb156",
    "content": "\u0410\u043d\u0430\u043b\u0438\u0437 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u043e\u0433\u043e `CODE` \u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 \u043b\u043e\u0433\u043e\u0432 `DEBUG` \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442 \u0442\u0432\u043e\u0435 \u043d\u0430\u0431\u043b\u044e\u0434\u0435\u043d\u0438\u0435: **LangGraph \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u0438\u043d\u0434\u0435\u043a\u0441 \u0437\u0430\u0434\u0430\u0447\u0438 `|n|` \u0432 `checkpoint_ns`, \u043d\u043e \u0434\u0435\u043b\u0430\u0435\u0442 \u044d\u0442\u043e \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u043f\u043e\u0437\u0438\u0446\u0438\u0438 (\u0438\u043d\u0434\u0435\u043a\u0441\u0430) \u0432 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 `Send`, \u0430 \u043d\u0435 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u043b\u0438\u0447\u043d\u043e\u0441\u0442\u0438 \u0432\u043e\u0440\u043a\u0435\u0440\u0430.**\n\n\u0412\u043e\u0442 \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u0437\u0431\u043e\u0440 \u0442\u043e\u0433\u043e, \u0447\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0432 \u0446\u0435\u043f\u043e\u0447\u043a\u0435 `...|worker:1|1|graph:...`:\n\n### 1. \u041a\u0430\u043a \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u044e\u0442\u0441\u044f \u0440\u043e\u043b\u0438 \u0432 Namespace\n\u0412 \u0437\u0430\u043f\u0438\u0441\u0438 \u2116181 \u043c\u044b \u0432\u0438\u0434\u0438\u043c \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443: `wide_funnel:...|worker:1|1|graph:5129...`\n-   `wide_funnel:...`: \u0411\u0430\u0437\u043e\u0432\u043e\u0435 \u0438\u043c\u044f (\u0448\u0430\u0433).\n-   `|worker:1`: **\u0422\u0432\u043e\u0439 \u0432\u043a\u043b\u0430\u0434.** \u041b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0439 ID \u0432\u043e\u0440\u043a\u0435\u0440\u0430 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0445\u0435\u0448 \u0437\u0430\u0434\u0430\u0447\u0438 \u0438\u043b\u0438 \u0431\u0438\u0437\u043d\u0435\u0441-ID).\n-   `|1|`: **\u0412\u043a\u043b\u0430\u0434 LangGraph.** \u041f\u043e\u0440\u044f\u0434\u043a\u043e\u0432\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u0437\u0430\u0434\u0430\u0447\u0438 \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0439 \u043d\u043e\u0434\u044b.\n-   `|graph:5129...`: **\u0412\u043a\u043b\u0430\u0434 LangGraph.** \u0423\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 ID \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u0432\u044b\u0437\u043e\u0432\u0430 (\u0438\u043d\u0441\u0442\u0430\u043d\u0441\u0430) \u0433\u0440\u0430\u0444\u0430.\n\n### 2. \u041f\u043e\u0447\u0435\u043c\u0443 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 `|n|` \u043e\u043f\u0430\u0441\u0435\u043d \u0431\u0435\u0437 \u0442\u0432\u043e\u0435\u0433\u043e `worker:1`\n\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0438\u043d\u0434\u0435\u043a\u0441 `|n|` \u2014 \u044d\u0442\u043e **\u043f\u043e\u0437\u0438\u0446\u0438\u043e\u043d\u043d\u044b\u0439 \u0438\u043d\u0434\u0435\u043a\u0441**. \u041e\u043d \u0437\u0430\u0432\u0438\u0441\u0438\u0442 \u0438\u0441\u043a\u043b\u044e\u0447\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043e\u0442 \u043f\u043e\u0440\u044f\u0434\u043a\u0430, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043e\u0431\u044a\u0435\u043a\u0442\u044b `Send` \u0431\u044b\u043b\u0438 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0435\u043d\u044b \u0438\u0437 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0439 \u043d\u043e\u0434\u044b.\n\n**\u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439 \u043a\u0430\u0442\u0430\u0441\u0442\u0440\u043e\u0444\u044b (Shifting Indices):**\n1.  **\u0417\u0430\u043f\u0443\u0441\u043a 1:** \u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 3 \u0437\u0430\u0434\u0430\u0447\u0438: `[Job_A, Job_B, Job_C]`.\n    -   Job_A \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 `|0|`, Job_B \u2014 `|1|`, Job_C \u2014 `|2|`.\n2.  **\u0421\u0431\u043e\u0439:** \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u043f\u0430\u0434\u0430\u0435\u0442 \u043d\u0430 \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u0435 Job_B.\n3.  **\u0417\u0430\u043f\u0443\u0441\u043a 2 (Resume):** \u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u0430\u044f \u043d\u043e\u0434\u0430 \u043f\u0435\u0440\u0435\u0441\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442 \u043f\u043b\u0430\u043d \u0438 \u043f\u043e\u043d\u0438\u043c\u0430\u0435\u0442, \u0447\u0442\u043e Job_A \u0443\u0436\u0435 \u0433\u043e\u0442\u043e\u0432\u0430, \u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e: `[Job_B, Job_C]`.\n    -   **\u0422\u0435\u043f\u0435\u0440\u044c Job_B \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0438\u043d\u0434\u0435\u043a\u0441 `|0|`!**\n    -   \u0415\u0441\u043b\u0438 \u0431\u044b \u0443 \u0442\u0435\u0431\u044f \u043d\u0435 \u0431\u044b\u043b\u043e \u043f\u0440\u0435\u0444\u0438\u043a\u0441\u0430 `worker:ID`, Job_B \u043f\u043e\u043f\u044b\u0442\u0430\u043b\u0430\u0441\u044c \u0431\u044b \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u043e\u0442 \u0438\u043d\u0434\u0435\u043a\u0441\u0430 `|0|`, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u0440\u0438\u043d\u0430\u0434\u043b\u0435\u0436\u0438\u0442 **Job_A**. \u041f\u0440\u043e\u0438\u0437\u043e\u0439\u0434\u0435\u0442 \u043f\u043e\u0434\u043c\u0435\u043d\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 (State Leakage).\n\n### 3. \u0422\u0432\u043e\u0439 `worker:1` \u2014 \u044d\u0442\u043e \u00ab\u042f\u043a\u043e\u0440\u044c \u0414\u0435\u0442\u0435\u0440\u043c\u0438\u043d\u0438\u0437\u043c\u0430\u00bb\n\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u044f `worker:1` \u043f\u0435\u0440\u0435\u0434 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u043c \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u043c, \u0442\u044b \u043f\u0440\u0435\u0432\u0440\u0430\u0449\u0430\u0435\u0448\u044c \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e \u0438\u043c\u0435\u043d \u0438\u0437 **\u043f\u043e\u0437\u0438\u0446\u0438\u043e\u043d\u043d\u043e\u0433\u043e** \u0432 **\u0438\u043c\u0435\u043d\u043d\u043e\u0435 (Content-Addressable)**. \n\u0414\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u0432 `\u0417\u0430\u043f\u0443\u0441\u043a\u0435 2` \u0432\u043e\u0440\u043a\u0435\u0440 Job_B \u0441\u0442\u0430\u043d\u0435\u0442 \u043f\u0435\u0440\u0432\u044b\u043c \u0432 \u0441\u043f\u0438\u0441\u043a\u0435 (`|0|`), \u043e\u043d \u0431\u0443\u0434\u0435\u0442 \u0438\u0441\u043a\u0430\u0442\u044c \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u043f\u043e \u043f\u0443\u0442\u0438 `...|worker:B|0|...`. \u041e\u043d \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u0442 \u043d\u0438\u0447\u0435\u0433\u043e \u0432 `worker:B` (\u0442\u0430\u043a \u043a\u0430\u043a \u0440\u0430\u043d\u044c\u0448\u0435 \u043e\u043d \u0431\u044b\u043b `worker:B|1|`), \u043d\u043e \u043e\u043d **\u0442\u043e\u0447\u043d\u043e \u043d\u0435 \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0441\u0435\u0434\u0430**.\n\n### 4. \u041d\u043e\u0432\u043e\u0435 \u0432 `memory_manager.py`: \u0418\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0439 Resume\n\u0412 \u0442\u0432\u043e\u0435\u043c \u043d\u043e\u0432\u043e\u043c \u043a\u043e\u0434\u0435 \u043f\u043e\u044f\u0432\u0438\u043b\u0430\u0441\u044c \u0432\u0430\u0436\u043d\u0430\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 `_has_meaningful_values`:\n```python\nif writes_found or self._has_meaningful_values(materialized_values):\n    return dict(materialized_values)\n```\n\u042d\u0442\u043e \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0432\u0430\u0436\u043d\u043e\u0435 \u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435. \u0422\u0435\u043f\u0435\u0440\u044c, \u0435\u0441\u043b\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u043d\u0430\u0439\u0434\u0435\u043d, \u043d\u043e \u043e\u043d \u00ab\u043f\u0443\u0441\u0442\u043e\u0439\u00bb (\u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u043b\u0443\u0436\u0435\u0431\u043d\u044b\u0435 \u043f\u043e\u043b\u044f \u0438\u043b\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0431\u0435\u0437 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430 \u043f\u043e \u0441\u0442\u0435\u0439\u0442\u0443), \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u043f\u044b\u0442\u0430\u0442\u044c\u0441\u044f \u00ab\u0432\u043e\u0441\u043a\u0440\u0435\u0441\u0438\u0442\u044c\u00bb \u0435\u0433\u043e, \u0430 \u0441\u0434\u0435\u043b\u0430\u0435\u0442 \u0441\u0432\u0435\u0436\u0438\u0439 \u0437\u0430\u043f\u0443\u0441\u043a (`fresh invoke`). \u042d\u0442\u043e \u0437\u0430\u0449\u0438\u0449\u0430\u0435\u0442 \u043e\u0442 \u0437\u0430\u0446\u0438\u043a\u043b\u0438\u0432\u0430\u043d\u0438\u044f \u043d\u0430 \u0431\u0438\u0442\u044b\u0445 \u0438\u043b\u0438 \u043d\u0435\u043f\u043e\u043b\u043d\u044b\u0445 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f\u0445.\n\n### \u0418\u0442\u043e\u0433\n**\u041d\u0443\u0436\u043d\u043e \u043b\u0438 \u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0442\u044c `worker:1`? \u0414\u0430.** \n\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u043a\u0430 LangGraph (`|n|`) \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442, \u0447\u0442\u043e \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u044b\u0435 \u0432\u0435\u0442\u043a\u0438 \u043d\u0435 \u0441\u0442\u043e\u043b\u043a\u043d\u0443\u0442\u0441\u044f **\u0441\u0435\u0439\u0447\u0430\u0441**. \u0422\u0432\u043e\u0439 `worker_id` \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442, \u0447\u0442\u043e \u043e\u043d\u0438 \u043d\u0435 \u0441\u0442\u043e\u043b\u043a\u043d\u0443\u0442\u0441\u044f **\u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0435 (Durable Resume)**, \u0435\u0441\u043b\u0438 \u043f\u043e\u0440\u044f\u0434\u043e\u043a \u0437\u0430\u0434\u0430\u0447 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u0441\u044f. \u042d\u0442\u043e \u0434\u0435\u043b\u0430\u0435\u0442 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0443 \u043f\u043e-\u043d\u0430\u0441\u0442\u043e\u044f\u0449\u0435\u043c\u0443 \u043d\u0430\u0434\u0435\u0436\u043d\u043e\u0439.\n\n**Relevant docs:**\n- [Subgraphs Persistence (Automatic Propagation)](https://docs.langchain.com/oss/python/langgraph/use-subgraphs#add-persistence)\n- [How to use Send for parallel tasks](https://docs.langchain.com/oss/python/langgraph/use-subgraphs)\n- [Time Travel and State Forks](https://docs.langchain.com/oss/javascript/langgraph/use-time-travel)"
  },
  {
    "role": "user",
    "id": "e5b71193-7537-44f6-8ed4-2fa3911b750f",
    "content": "\u0422\u0435\u043f\u0435\u0440\u044c \u043e\u0448\u0438\u0431\u043a\u0430, \u043f\u043e\u0447\u0435\u043c\u0443 ? \n\nCancelledError(<object object at 0x109e950b0>, <Task cancelled name='Task-680' coro=<AsyncExitStack.__aexit__() done, defined at /Users/skylarpro/miniconda3/envs/llmcore/lib/python3.11/contextlib.py:698>>)Traceback (most recent call last):\n\n\n  File \"/Users/skylarpro/miniconda3/envs/llmcore/lib/python3.11/site-packages/langgraph/pregel/main.py\", line 2971, in astream\n    async for _ in runner.atick(\n\n\n  File \"/Users/skylarpro/miniconda3/envs/llmcore/lib/python3.11/site-packages/langgraph/pregel/_runner.py\", line 377, in atick\n    done, inflight = await asyncio.wait(\n                     ^^^^^^^^^^^^^^^^^^^\n\n\n  File \"/Users/skylarpro/miniconda3/envs/llmcore/lib/python3.11/asyncio/tasks.py\", line 428, in wait\n    return await _wait(fs, timeout, return_when, loop)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n\n  File \"/Users/skylarpro/miniconda3/envs/llmcore/lib/python3.11/asyncio/tasks.py\", line 535, in _wait\n    await waiter\n\n\nasyncio.exceptions.CancelledError\n\n\n\nDuring handling of the above exception, another exception occurred:\n\n\n\nTraceback (most recent call last):\n\n\n  File \"/Users/skylarpro/miniconda3/envs/llmcore/lib/python3.11/site-packages/langgraph/pregel/main.py\", line 2888, in astream\n    async with AsyncPregelLoop(\n\n\n  File \"/Users/skylarpro/miniconda3/envs/llmcore/lib/python3.11/site-packages/langgraph/pregel/_loop.py\", line 1323, in __aexit__\n    return await exit_task\n           ^^^^^^^^^^^^^^^\n\n\n  File \"/Users/skylarpro/miniconda3/envs/llmcore/lib/python3.11/contextlib.py\", line 698, in __aexit__\n    async def __aexit__(self, *exc_details):\n\n\nasyncio.exceptions.CancelledError: (<object object at 0x109e950b0>, <Task cancelled name='Task-680' coro=<AsyncExitStack.__aexit__() done, defined at /Users/skylarpro/miniconda3/envs/llmcore/lib/python3.11/contextlib.py:698>>)"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3812-93cf-75e1-bd7b-0525608d7ca8",
    "content": "**\u042d\u0442\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u0432\u044b\u0437\u0432\u0430\u043d\u0430 \u043d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0439 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u043e\u0439 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u0439 (asyncio.CancelledError) \u0432\u043d\u0443\u0442\u0440\u0438 \u0432\u0430\u0448\u0435\u0433\u043e \u0431\u0435\u0441\u043a\u043e\u043d\u0435\u0447\u043d\u043e\u0433\u043e \u0446\u0438\u043a\u043b\u0430 `while True` \u0432 `ArchitecturalAgentBase.run`.**\n\n\u041a\u043e\u0433\u0434\u0430 LangGraph \u0438\u043b\u0438 \u0432\u043d\u0435\u0448\u043d\u044f\u044f \u0441\u0440\u0435\u0434\u0430 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0432\u0430\u0448 \u0442\u0435\u0441\u0442 \u0438\u043b\u0438 \u0441\u0435\u0440\u0432\u0435\u0440) \u043e\u0442\u043c\u0435\u043d\u044f\u0435\u0442 \u0437\u0430\u0434\u0430\u0447\u0443 (\u0442\u0430\u0439\u043c\u0430\u0443\u0442, \u0437\u0430\u043a\u0440\u044b\u0442\u0438\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f), \u0432 \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439 \u0441\u0442\u0435\u043a \u0432\u044b\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f `asyncio.CancelledError`. \n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043b\u043e\u043c\u0430\u0435\u0442 \u0432\u0430\u0448\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u0443:\n\n1.  **\u0417\u0430\u0445\u0432\u0430\u0442 `BaseException`:** \u0412 `CODE 1` \u0432\u0430\u0448 \u0431\u043b\u043e\u043a `except Exception as e:` \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u0438 \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u043b\u043e\u0432\u0438\u0442\u044c `CancelledError` (\u0442\u0430\u043a \u043a\u0430\u043a \u043e\u043d \u043d\u0430\u0441\u043b\u0435\u0434\u0443\u0435\u0442\u0441\u044f \u043e\u0442 `BaseException`), \u043d\u043e \u0432 \u0446\u0435\u043f\u043e\u0447\u043a\u0435 \u0432\u044b\u0437\u043e\u0432\u043e\u0432 LangGraph \u044d\u0442\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u0438\u043d\u043e\u0433\u0434\u0430 \u0443\u043f\u0430\u043a\u043e\u0432\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0442\u0430\u043a, \u0447\u0442\u043e \u0432\u0430\u0448\u0430 \u043b\u043e\u0433\u0438\u043a\u0430 \u0440\u0435\u0442\u0440\u0438\u0435\u0432 \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u0435\u0451 \u00ab\u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c\u00bb.\n2.  **\u0411\u0435\u0441\u043a\u043e\u043d\u0435\u0447\u043d\u044b\u0439 \u0446\u0438\u043a\u043b vs Cleanup:** \u0412\u0430\u0448 \u0446\u0438\u043a\u043b `while True` \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435, \u043a\u043e\u0433\u0434\u0430 \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0443\u0436\u0435 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438 `shutdown`. LangGraph \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u0437\u0430\u043a\u0440\u044b\u0442\u044c `AsyncPregelLoop`, \u043d\u043e \u0432\u0430\u0448 \u0432\u043e\u0440\u043a\u0435\u0440 \u0432\u0441\u0451 \u0435\u0449\u0435 \u0443\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u0440\u0435\u0441\u0443\u0440\u0441\u044b \u0438\u043b\u0438 \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c `ainvoke_from_checkpoint`.\n3.  **\u041e\u0448\u0438\u0431\u043a\u0430 \u0432 `__aexit__`:** Traceback \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442, \u0447\u0442\u043e \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0432 `AsyncExitStack.__aexit__()`. \u042d\u0442\u043e \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e \u043f\u0440\u0438 \u043f\u043e\u043f\u044b\u0442\u043a\u0435 \u0437\u0430\u043a\u0440\u044b\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f (\u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u043f\u0430\u043c\u044f\u0442\u044c, \u0437\u0430\u043a\u0440\u044b\u0442\u044c MCP-\u043a\u043b\u0438\u0435\u043d\u0442\u044b) \u043e\u0434\u0438\u043d \u0438\u0437 \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0445 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u0431\u044b\u043b \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d, \u043d\u0435 \u0443\u0441\u043f\u0435\u0432 \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u043e\u0447\u0438\u0441\u0442\u043a\u0443.\n\n### \u0413\u0434\u0435 \u0438\u043c\u0435\u043d\u043d\u043e \u043a\u0440\u043e\u0435\u0442\u0441\u044f \u0431\u0430\u0433 \u0432 \u0432\u0430\u0448\u0435\u043c \u043a\u043e\u0434\u0435:\n\n\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u0442\u0435 \u043d\u0430 \u043c\u0435\u0442\u043e\u0434 `run` \u0432 `ArchitecturalAgentBase`:\n```python\nwhile True:\n    try:\n        # ... \u0437\u0430\u043f\u0443\u0441\u043a \u0433\u0440\u0430\u0444\u0430 ...\n        result = await self._invoke_graph_from_checkpoint(...)\n    except Exception as e:\n        # \u0417\u0414\u0415\u0421\u042c \u041f\u0420\u041e\u0411\u041b\u0415\u041c\u0410: \n        # \u0415\u0441\u043b\u0438 \u043f\u0440\u0438\u0448\u043b\u0430 \u043e\u0442\u043c\u0435\u043d\u0430 (CancelledError), \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u043d\u0435\u043c\u0435\u0434\u043b\u0435\u043d\u043d\u043e \u0432\u044b\u0439\u0442\u0438,\n        # \u0430 \u0432\u044b \u043f\u044b\u0442\u0430\u0435\u0442\u0435\u0441\u044c \u043f\u0440\u043e\u0433\u043d\u0430\u0442\u044c \u043e\u0448\u0438\u0431\u043a\u0443 \u0447\u0435\u0440\u0435\u0437 self._error_handler.handle(...)\n        # \u0438 \u0443\u0439\u0442\u0438 \u043d\u0430 \u043d\u043e\u0432\u044b\u0439 \u043a\u0440\u0443\u0433 \u0446\u0438\u043a\u043b\u0430 while True.\n```\n\n### \u041a\u0430\u043a \u044d\u0442\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c:\n\n\u0412\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u044f\u0432\u043d\u043e \u0438\u0441\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0435 \u043e\u0448\u0438\u0431\u043a\u0438 \u0438\u0437 \u043b\u043e\u0433\u0438\u043a\u0438 \u0440\u0435\u0442\u0440\u0438\u0435\u0432. \u041e\u0431\u043d\u043e\u0432\u0438\u0442\u0435 \u0431\u043b\u043e\u043a `except` \u0432 `agent.py`:\n\n```python\nimport asyncio\n\n# ... \u0432\u043d\u0443\u0442\u0440\u0438 \u043c\u0435\u0442\u043e\u0434\u0430 run ...\nexcept (asyncio.CancelledError, KeyboardInterrupt):\n    # \u042d\u0442\u0438 \u043e\u0448\u0438\u0431\u043a\u0438 \u043d\u0435\u043b\u044c\u0437\u044f \u043f\u0435\u0440\u0435\u0445\u0432\u0430\u0442\u044b\u0432\u0430\u0442\u044c \u0434\u043b\u044f \u0440\u0435\u0442\u0440\u0438\u0435\u0432!\n    raise\nexcept Exception as e:\n    # \u0412\u0430\u0448\u0430 \u0442\u0435\u043a\u0443\u0449\u0430\u044f \u043b\u043e\u0433\u0438\u043a\u0430 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 LLM \u043e\u0448\u0438\u0431\u043e\u043a \u0438 Fallback\n    # ...\n```\n\n### \u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u043f\u0440\u0438\u0447\u0438\u043d\u0430: \u041a\u043e\u043d\u0444\u043b\u0438\u043a\u0442 Lock-\u043e\u0432\n\u0412 `CODE 1` \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 `anyio.Lock()`:\n```python\nasync with self._graph_lock:\n    await self._ensure_configuration_signature()\n```\n\u0415\u0441\u043b\u0438 \u0437\u0430\u0434\u0430\u0447\u0430 \u043e\u0442\u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f \u0432 \u043c\u043e\u043c\u0435\u043d\u0442, \u043a\u043e\u0433\u0434\u0430 \u0432\u043e\u0440\u043a\u0435\u0440 \u0436\u0434\u0435\u0442 \u044d\u0442\u043e\u0442 `Lock`, \u0430 \u0432\u0430\u0448 `except` \u0431\u043b\u043e\u043a \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0442\u044f\u0436\u0435\u043b\u0443\u044e \u043b\u043e\u0433\u0438\u043a\u0443 \u043e\u0447\u0438\u0441\u0442\u043a\u0438 \u0438\u043b\u0438 \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f, \u0432\u044b \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442\u0435 \u00ab\u0437\u0430\u0432\u0438\u0441\u0430\u043d\u0438\u0435\u00bb \u0432 `AsyncPregelLoop`.\n\n**\u0418\u0442\u043e\u0433:** \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u00ab\u0432\u044b\u043b\u0435\u0447\u0438\u0442\u044c\u00bb (\u0447\u0435\u0440\u0435\u0437 fallback) \u043e\u0448\u0438\u0431\u043a\u0443, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u043d\u0430 \u0441\u0430\u043c\u043e\u043c \u0434\u0435\u043b\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0441\u0438\u0433\u043d\u0430\u043b\u043e\u043c \u043a \u043d\u0435\u043c\u0435\u0434\u043b\u0435\u043d\u043d\u043e\u0439 \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0435. \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 `asyncio.CancelledError` \u0432 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0431\u043b\u043e\u043a\u0430 `except` \u0440\u0435\u0448\u0438\u0442 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0443.\n\n**Relevant docs:**\n- [LangGraph Persistence (Checkpoints)](https://docs.langchain.com/oss/python/langgraph/persistence)\n- [Troubleshooting Distributed Execution](https://docs.langchain.com/langsmith/agent-server-scale#avoid-synchronous-blocking-operations)\n- [Asyncio Task Cancellation](https://docs.python.org/3/library/asyncio-task.html#task-cancellation)"
  },
  {
    "role": "user",
    "id": "f1a4bfd5-1c4d-4f8a-be0a-eb8fb1d8f09a",
    "content": "hree working hypotheses backed by today\u2019s logs:\nResume misclassification \u2013 worker assistants are resuming with next=[\"__start__\"], so our _invoke_graph_from_checkpoint treats them as in-progress and calls graph_input=None, which in turn raises langgraph.errors.EmptyInputError. Need to confirm whether pending nodes are only __start__ (new hypothesisId=\"K\" log captures the exact next_nodes preview plus whether graph_input was already None).\nWrites never materialize \u2013 the checkpointer likely stores writes under a nested object we don\u2019t inspect, so _materialize_checkpoint_values always reports \u201cwrites unavailable.\u201d New hypothesisId=\"L\" log records the record_type, has_attr_writes, and whether writes arrived as a Sequence/Mapping so we can see what structure we\u2019re missing.\nResume path drops the original payload \u2013 even when writes are empty, we may be re-entering with graph_input=None despite not needing to (causing empty input). The hypothesisId=\"K\" log also records graph_input_is_none to correlate EmptyInput failures with the resume branch.\nInstrumentation just added:\nmemory_manager.py now logs the pending next_nodes and graph_input_is_none right before we resume (line ~509).\n_materialize_checkpoint_values logs the raw checkpoint record structure before trying to merge writes (same file, line ~321).\nPlease gather fresh runtime evidence so we can validate or reject these hypotheses:"
  },
  {
    "role": "assistant",
    "tool_calls": [
      {
        "type": "function",
        "id": "c4f05ab8-3047-4609-8de4-37ad3a76d5d1",
        "function": {
          "name": "SearchDocsByLangChain",
          "arguments": "{\"query\": \"EmptyInputError\"}"
        }
      },
      {
        "type": "function",
        "id": "31b81816-536b-41f3-88ec-64b1b152eadd",
        "function": {
          "name": "SearchDocsByLangChain",
          "arguments": "{\"query\": \"resume from checkpoint input\"}"
        }
      }
    ],
    "id": "lc_run--019b3815-261a-7ab1-bbe0-afe6db35d258",
    "content": ""
  },
  {
    "role": "tool",
    "name": "SearchDocsByLangChain",
    "tool_call_id": "c4f05ab8-3047-4609-8de4-37ad3a76d5d1",
    "id": "68021948-3184-4cad-adb7-dca73f816763",
    "content": "Result 1:\nTitle: Use threads\nLink: https://docs.langchain.comlangsmith/use-threads\nContent: Empty thread\nTo create a new thread, use one of: curl --request POST \\\n    --url <DEPLOYMENT_URL>/threads \\\n    --header 'Content-Type: application/json' \\\n    --data '{}'\n\nEmpty thread\nTo create a new thread, use one of: For more information, refer to the Python and JS SDK docs, or the REST API reference. Output:\n\nEmpty thread\nTo create a new thread, use one of: from langgraph_sdk import get_client\n\n# Initialize the client with your deployment URL\nclient = get_client(url=<DEPLOYMENT_URL>)\n\n# Create an empty thread\n# This creates a new thread with no initial state\nthread = await client.threads.create()\n\nprint(thread)\n\n---\n\nResult 2:\nTitle: Structured output\nLink: https://docs.langchain.comoss/javascript/langchain/structured-output\nContent: Structured output allows agents to return data in a specific, predictable format. Instead of parsing natural language responses, you get typed structured data.\n\nLangChain's prebuilt ReAct agent `createAgent` handles structured output automatically. The user sets their desired structured output schema, and when the model generates the structured data, it's captured, validated, and returned in the `structuredResponse` key of the agent's state.\n\n```ts  theme={null}\ntype ResponseFormat = (\n    | ZodSchema<StructuredResponseT> // a Zod schema\n    | Record<string, unknown> // a JSON Schema\n)\n\nconst agent = createAgent({\n    // ...\n    responseFormat: ResponseFormat | ResponseFormat[]\n})\n```\n\n## Response Format\n\nControls how the agent returns structured data. You can provide either a Zod object or JSON schema. By default, the agent uses a tool calling strategy, in which the output is created by an additional tool call. Certain models support native structured output, in which case the agent will use that strategy instead.\n\nYou can control the behavior by wrapping `ResponseFormat` in a `toolStrategy` or `providerStrategy` function call:\n\n```ts  theme={null}\nimport { toolStrategy, providerStrategy } from \"langchain\";\n\nconst agent = createAgent({\n    // use a provider strategy if supported by the model\n    responseFormat: providerStrategy(z.object({ ... }))\n    // or enforce a tool strategy\n    responseFormat: toolStrategy(z.object({ ... }))\n})\n```\n\nThe structured response is returned in the `structuredResponse` key of the agent's final state.\n\n<Tip>\n  Support for native structured output features is read dynamically from the model's [profile data](/oss/javascript/langchain/models#model-profiles) if using `langchain>=1.1`. If data are not available, use another condition or specify manually:\n\n  ```typescript  theme={null}\n  const customProfile: ModelProfile = {\n      structuredOutput: true,\n      // ...\n  }\n  const model = await initChatModel(\"...\", { profile: customProfile });\n  ```\n\n  If tools are specified, the model must support simultaneous use of tools and structured output.\n</Tip>\n\n## Provider strategy\n\nSome model providers support structured output natively through their APIs (e.g. OpenAI, Grok, Gemini). This is the most reliable method when available.\n\nTo use this strategy, configure a `ProviderStrategy`:\n\n```ts  theme={null}\nfunction providerStrategy<StructuredResponseT>(\n    schema: ZodSchema<StructuredResponseT> | JsonSchemaFormat\n): ProviderStrategy<StructuredResponseT>\n```\n\n<ParamField path=\"schema\" required>\n  The schema defining the structured output format. Supports:\n\n  * **Zod Schema**: A zod schema\n  * **JSON Schema**: A JSON schema object\n</ParamField>\n\nLangChain automatically uses `ProviderStrategy` when you pass a schema type directly to `createAgent.responseFormat` and the model supports native structured output:\n\n<CodeGroup>\n  ```ts Zod Schema theme={null}\n  import * as z from \"zod\";\n  import { createAgent, providerStrategy } from \"langchain\";\n\n  const ContactInfo = z.object({\n      name: z.string().describe(\"The name of the person\"),\n      email: z.string().describe(\"The email address of the person\"),\n      phone: z.string().describe(\"The phone number of the person\"),\n  });\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: providerStrategy(ContactInfo)\n  });\n\n  const result = await agent.invoke({\n      messages: [{\"role\": \"user\", \"content\": \"Extract contact info from: John Doe, john@example.com, (555) 123-4567\"}]\n  });\n\n  console.log(result.structuredResponse);\n  // { name: \"John Doe\", email: \"john@example.com\", phone: \"(555) 123-4567\" }\n  ```\n\n  ```ts JSON Schema theme={null}\n  import { createAgent, providerStrategy } from \"langchain\";\n\n  const contactInfoSchema = {\n      \"type\": \"object\",\n      \"description\": \"Contact information for a person.\",\n      \"properties\": {\n          \"name\": {\"type\": \"string\", \"description\": \"The name of the person\"},\n          \"email\": {\"type\": \"string\", \"description\": \"The email address of the person\"},\n          \"phone\": {\"type\": \"string\", \"description\": \"The phone number of the person\"}\n      },\n      \"required\": [\"name\", \"email\", \"phone\"]\n  }\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: providerStrategy(contactInfoSchema)\n  });\n\n  const result = await agent.invoke({\n      messages: [{\"role\": \"user\", \"content\": \"Extract contact info from: John Doe, john@example.com, (555) 123-4567\"}]\n  });\n\n  console.log(result.structuredResponse);\n  // { name: \"John Doe\", email: \"john@example.com\", phone: \"(555) 123-4567\" }\n  ```\n</CodeGroup>\n\nProvider-native structured output provides high reliability and strict validation because the model provider enforces the schema. Use it when available.\n\n<Note>\n  If the provider natively supports structured output for your model choice, it is functionally equivalent to write `responseFormat: contactInfoSchema` instead of `responseFormat: providerStrategy(contactInfoSchema)`. In either case, if structured output is not supported, the agent will fall back to a tool calling strategy.\n</Note>\n\n## Tool calling strategy\n\nFor models that don't support native structured output, LangChain uses tool calling to achieve the same result. This works with all models that support tool calling, which is most modern models.\n\nTo use this strategy, configure a `ToolStrategy`:\n\n```ts  theme={null}\nfunction toolStrategy<StructuredResponseT>(\n    responseFormat:\n        | JsonSchemaFormat\n        | ZodSchema<StructuredResponseT>\n        | (ZodSchema<StructuredResponseT> | JsonSchemaFormat)[]\n    options?: ToolStrategyOptions\n): ToolStrategy<StructuredResponseT>\n```\n\n<ParamField path=\"schema\" required>\n  The schema defining the structured output format. Supports:\n\n  * **Zod Schema**: A zod schema\n  * **JSON Schema**: A JSON schema object\n</ParamField>\n\n<ParamField path=\"options.toolMessageContent\">\n  Custom content for the tool message returned when structured output is generated.\n  If not provided, defaults to a message showing the structured response data.\n</ParamField>\n\n<ParamField path=\"options.handleError\">\n  Options parameter containing an optional `handleError` parameter for customizing the error handling strategy.\n\n  * **`true`**: Catch all errors with default error template (default)\n  * **`False`**: No retry, let exceptions propagate\n  * **`(error: ToolStrategyError) => string | Promise<string>`**: retry with the provided message or throw the error\n</ParamField>\n\n<CodeGroup>\n  ```ts Zod Schema theme={null}\n  import * as z from \"zod\";\n  import { createAgent, toolStrategy } from \"langchain\";\n\n  const ProductReview = z.object({\n      rating: z.number().min(1).max(5).optional(),\n      sentiment: z.enum([\"positive\", \"negative\"]),\n      keyPoints: z.array(z.string()).describe(\"The key points of the review. Lowercase, 1-3 words each.\"),\n  });\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: toolStrategy(ProductReview)\n  })\n\n  const result = await agent.invoke({\n      \"messages\": [{\"role\": \"user\", \"content\": \"Analyze this review: 'Great product: 5 out of 5 stars. Fast shipping, but expensive'\"}]\n  })\n\n  console.log(result.structuredResponse);\n  // { \"rating\": 5, \"sentiment\": \"positive\", \"keyPoints\": [\"fast shipping\", \"expensive\"] }\n  ```\n\n  ```ts JSON Schema theme={null}\n  import { createAgent, toolStrategy } from \"langchain\";\n\n  const productReviewSchema = {\n      \"type\": \"object\",\n      \"description\": \"Analysis of a product review.\",\n      \"properties\": {\n          \"rating\": {\n              \"type\": [\"integer\", \"null\"],\n              \"description\": \"The rating of the product (1-5)\",\n              \"minimum\": 1,\n              \"maximum\": 5\n          },\n          \"sentiment\": {\n              \"type\": \"string\",\n              \"enum\": [\"positive\", \"negative\"],\n              \"description\": \"The sentiment of the review\"\n          },\n          \"key_points\": {\n              \"type\": \"array\",\n              \"items\": {\"type\": \"string\"},\n              \"description\": \"The key points of the review\"\n          }\n      },\n      \"required\": [\"sentiment\", \"key_points\"]\n  }\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: toolStrategy(productReviewSchema)\n  });\n\n  const result = await agent.invoke({\n      messages: [{\"role\": \"user\", \"content\": \"Analyze this review: 'Great product: 5 out of 5 stars. Fast shipping, but expensive'\"}]\n  })\n\n  console.log(result.structuredResponse);\n  // { \"rating\": 5, \"sentiment\": \"positive\", \"keyPoints\": [\"fast shipping\", \"expensive\"] }\n  ```\n\n  ```ts Union Types theme={null}\n  import * as z from \"zod\";\n  import { createAgent, toolStrategy } from \"langchain\";\n\n  const ProductReview = z.object({\n      rating: z.number().min(1).max(5).optional(),\n      sentiment: z.enum([\"positive\", \"negative\"]),\n      keyPoints: z.array(z.string()).describe(\"The key points of the review. Lowercase, 1-3 words each.\"),\n  });\n\n  const CustomerComplaint = z.object({\n      issueType: z.enum([\"product\", \"service\", \"shipping\", \"billing\"]),\n      severity: z.enum([\"low\", \"medium\", \"high\"]),\n      description: z.string().describe(\"Brief description of the complaint\"),\n  });\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: toolStrategy([ProductReview, CustomerComplaint])\n  });\n\n  const result = await agent.invoke({\n      messages: [{\"role\": \"user\", \"content\": \"Analyze this review: 'Great product: 5 out of 5 stars. Fast shipping, but expensive'\"}]\n  })\n\n  console.log(result.structuredResponse);\n  // { \"rating\": 5, \"sentiment\": \"positive\", \"keyPoints\": [\"fast shipping\", \"expensive\"] }\n  ```\n</CodeGroup>\n\n### Custom tool message content\n\nThe `toolMessageContent` parameter allows you to customize the message that appears in the conversation history when structured output is generated:\n\n```ts  theme={null}\nimport * as z from \"zod\";\nimport { createAgent, toolStrategy } from \"langchain\";\n\nconst MeetingAction = z.object({\n    task: z.string().describe(\"The specific task to be completed\"),\n    assignee: z.string().describe(\"Person responsible for the task\"),\n    priority: z.enum([\"low\", \"medium\", \"high\"]).describe(\"Priority level\"),\n});\n\nconst agent = createAgent({\n    model: \"gpt-5\",\n    tools: [],\n    responseFormat: toolStrategy(MeetingAction, {\n        toolMessageContent: \"Action item captured and added to meeting notes!\"\n    })\n});\n\nconst result = await agent.invoke({\n    messages: [{\"role\": \"user\", \"content\": \"From our meeting: Sarah needs to update the project timeline as soon as possible\"}]\n});\n\nconsole.log(result);\n/**\n * {\n *   messages: [\n *     { role: \"user\", content: \"From our meeting: Sarah needs to update the project timeline as soon as possible\" },\n *     { role: \"assistant\", content: \"Action item captured and added to meeting notes!\", tool_calls: [ { name: \"MeetingAction\", args: { task: \"update the project timeline\", assignee: \"Sarah\", priority: \"high\" }, id: \"call_456\" } ] },\n *     { role: \"tool\", content: \"Action item captured and added to meeting notes!\", tool_call_id: \"call_456\", name: \"MeetingAction\" }\n *   ],\n *   structuredResponse: { task: \"update the project timeline\", assignee: \"Sarah\", priority: \"high\" }\n * }\n */\n```\n\nWithout `toolMessageContent`, we'd see:\n\n```ts  theme={null}\n# console.log(result);\n/**\n * {\n *   messages: [\n *     ...\n *     { role: \"tool\", content: \"Returning structured response: {'task': 'update the project timeline', 'assignee': 'Sarah', 'priority': 'high'}\", tool_call_id: \"call_456\", name: \"MeetingAction\" }\n *   ],\n *   structuredResponse: { task: \"update the project timeline\", assignee: \"Sarah\", priority: \"high\" }\n * }\n */\n```\n\n### Error handling\n\nModels can make mistakes when generating structured output via tool calling. LangChain provides intelligent retry mechanisms to handle these errors automatically.\n\n#### Multiple structured outputs error\n\nWhen a model incorrectly calls multiple structured output tools, the agent provides error feedback in a [`ToolMessage`](https://reference.langchain.com/javascript/classes/_langchain_core.messages.ToolMessage.html) and prompts the model to retry:\n\n```ts  theme={null}\nimport * as z from \"zod\";\nimport { createAgent, toolStrategy } from \"langchain\";\n\nconst ContactInfo = z.object({\n    name: z.string().describe(\"Person's name\"),\n    email: z.string().describe(\"Email address\"),\n});\n\nconst EventDetails = z.object({\n    event_name: z.string().describe(\"Name of the event\"),\n    date: z.string().describe(\"Event date\"),\n});\n\nconst agent = createAgent({\n    model: \"gpt-5\",\n    tools: [],\n    responseFormat: toolStrategy([ContactInfo, EventDetails]),\n});\n\nconst result = await agent.invoke({\n    messages: [\n        {\n        role: \"user\",\n        content:\n            \"Extract info: John Doe (john@email.com) is organizing Tech Conference on March 15th\",\n        },\n    ],\n});\n\nconsole.log(result);\n\n/**\n * {\n *   messages: [\n *     { role: \"user\", content: \"Extract info: John Doe (john@email.com) is organizing Tech Conference on March 15th\" },\n *     { role: \"assistant\", content: \"\", tool_calls: [ { name: \"ContactInfo\", args: { name: \"John Doe\", email: \"john@email.com\" }, id: \"call_1\" }, { name: \"EventDetails\", args: { event_name: \"Tech Conference\", date: \"March 15th\" }, id: \"call_2\" } ] },\n *     { role: \"tool\", content: \"Error: Model incorrectly returned multiple structured responses (ContactInfo, EventDetails) when only one is expected.\\n Please fix your mistakes.\", tool_call_id: \"call_1\", name: \"ContactInfo\" },\n *     { role: \"tool\", content: \"Error: Model incorrectly returned multiple structured responses (ContactInfo, EventDetails) when only one is expected.\\n Please fix your mistakes.\", tool_call_id: \"call_2\", name: \"EventDetails\" },\n *     { role: \"assistant\", content: \"\", tool_calls: [ { name: \"ContactInfo\", args: { name: \"John Doe\", email: \"john@email.com\" }, id: \"call_3\" } ] },\n *     { role: \"tool\", content: \"Returning structured response: {'name': 'John Doe', 'email': 'john@email.com'}\", tool_call_id: \"call_3\", name: \"ContactInfo\" }\n *   ],\n *   structuredResponse: { name: \"John Doe\", email: \"john@email.com\" }\n * }\n */\n```\n\n#### Schema validation error\n\nWhen structured output doesn't match the expected schema, the agent provides specific error feedback:\n\n```ts  theme={null}\nimport * as z from \"zod\";\nimport { createAgent, toolStrategy } from \"langchain\";\n\nconst ProductRating = z.object({\n    rating: z.number().min(1).max(5).describe(\"Rating from 1-5\"),\n    comment: z.string().describe(\"Review comment\"),\n});\n\nconst agent = createAgent({\n    model: \"gpt-5\",\n    tools: [],\n    responseFormat: toolStrategy(ProductRating),\n});\n\nconst result = await agent.invoke({\n    messages: [\n        {\n        role: \"user\",\n        content: \"Parse this: Amazing product, 10/10!\",\n        },\n    ],\n});\n\nconsole.log(result);\n\n/**\n * {\n *   messages: [\n *     { role: \"user\", content: \"Parse this: Amazing product, 10/10!\" },\n *     { role: \"assistant\", content: \"\", tool_calls: [ { name: \"ProductRating\", args: { rating: 10, comment: \"Amazing product\" }, id: \"call_1\" } ] },\n *     { role: \"tool\", content: \"Error: Failed to parse structured output for tool 'ProductRating': 1 validation error for ProductRating\\nrating\\n  Input should be less than or equal to 5 [type=less_than_equal, input_value=10, input_type=int].\\n Please fix your mistakes.\", tool_call_id: \"call_1\", name: \"ProductRating\" },\n *     { role: \"assistant\", content: \"\", tool_calls: [ { name: \"ProductRating\", args: { rating: 5, comment: \"Amazing product\" }, id: \"call_2\" } ] },\n *     { role: \"tool\", content: \"Returning structured response: {'rating': 5, 'comment': 'Amazing product'}\", tool_call_id: \"call_2\", name: \"ProductRating\" }\n *   ],\n *   structuredResponse: { rating: 5, comment: \"Amazing product\" }\n * }\n */\n```\n\n#### Error handling strategies\n\nYou can customize how errors are handled using the `handleErrors` parameter:\n\n**Custom error message:**\n\n```ts  theme={null}\nconst responseFormat = toolStrategy(ProductRating, {\n    handleError: \"Please provide a valid rating between 1-5 and include a comment.\"\n)\n\n// Error message becomes:\n// { role: \"tool\", content: \"Please provide a valid rating between 1-5 and include a comment.\" }\n```\n\n**Handle specific exceptions only:**\n\n```ts  theme={null}\nimport { ToolInputParsingException } from \"@langchain/core/tools\";\n\nconst responseFormat = toolStrategy(ProductRating, {\n    handleError: (error: ToolStrategyError) => {\n        if (error instanceof ToolInputParsingException) {\n        return \"Please provide a valid rating between 1-5 and include a comment.\";\n        }\n        return error.message;\n    }\n)\n\n// Only validation errors get retried with default message:\n// { role: \"tool\", content: \"Error: Failed to parse structured output for tool 'ProductRating': ...\\n Please fix your mistakes.\" }\n```\n\n**Handle multiple exception types:**\n\n```ts  theme={null}\nconst responseFormat = toolStrategy(ProductRating, {\n    handleError: (error: ToolStrategyError) => {\n        if (error instanceof ToolInputParsingException) {\n        return \"Please provide a valid rating between 1-5 and include a comment.\";\n        }\n        if (error instanceof CustomUserError) {\n        return \"This is a custom user error.\";\n        }\n        return error.message;\n    }\n)\n```\n\n**No error handling:**\n\n```ts  theme={null}\nconst responseFormat = toolStrategy(ProductRating, {\n    handleError: false  // All errors raised\n)\n```\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/oss/langchain/structured-output.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n\n---\n\nResult 3:\nTitle: Quickstart\nLink: https://docs.langchain.comoss/python/deepagents/quickstart\nContent: This guide walks you through creating your first deep agent with planning, file system tools, and subagent capabilities. You'll build a research agent that can conduct research and write reports.\n\n## Prerequisites\n\nBefore you begin, make sure you have an API key from a model provider (e.g., Anthropic, OpenAI).\n\n### Step 1: Install dependencies\n\n<CodeGroup>\n  ```bash pip theme={null}\n  pip install deepagents tavily-python\n  ```\n\n  ```bash uv theme={null}\n  uv add deepagents tavily-python\n  ```\n\n  ```bash poetry theme={null}\n  poetry add deepagents tavily-python\n  ```\n</CodeGroup>\n\n### Step 2: Set up your API keys\n\n```bash  theme={null}\nexport ANTHROPIC_API_KEY=\"your-api-key\"\nexport TAVILY_API_KEY=\"your-tavily-api-key\"\n```\n\n### Step 3: Create a search tool\n\n```python  theme={null}\nimport os\nfrom typing import Literal\nfrom tavily import TavilyClient\nfrom deepagents import create_deep_agent\n\ntavily_client = TavilyClient(api_key=os.environ[\"TAVILY_API_KEY\"])\n\ndef internet_search(\n    query: str,\n    max_results: int = 5,\n    topic: Literal[\"general\", \"news\", \"finance\"] = \"general\",\n    include_raw_content: bool = False,\n):\n    \"\"\"Run a web search\"\"\"\n    return tavily_client.search(\n        query,\n        max_results=max_results,\n        include_raw_content=include_raw_content,\n        topic=topic,\n    )\n```\n\n### Step 4: Create a deep agent\n\n```python  theme={null}\n# System prompt to steer the agent to be an expert researcher\nresearch_instructions = \"\"\"You are an expert researcher. Your job is to conduct thorough research and then write a polished report.\n\nYou have access to an internet search tool as your primary means of gathering information.\n\n## `internet_search`\n\nUse this to run an internet search for a given query. You can specify the max number of results to return, the topic, and whether raw content should be included.\n\"\"\"\n\nagent = create_deep_agent(\n    tools=[internet_search],\n    system_prompt=research_instructions\n)\n```\n\n### Step 5: Run the agent\n\n```python  theme={null}\nresult = agent.invoke({\"messages\": [{\"role\": \"user\", \"content\": \"What is langgraph?\"}]})\n\n# Print the agent's response\nprint(result[\"messages\"][-1].content)\n```\n\n## What happened?\n\nYour deep agent automatically:\n\n1. **Planned its approach**: Used the built-in `write_todos` tool to break down the research task\n2. **Conducted research**: Called the `internet_search` tool to gather information\n3. **Managed context**: Used file system tools (`write_file`, `read_file`) to offload large search results\n4. **Spawned subagents** (if needed): Delegated complex subtasks to specialized subagents\n5. **Synthesized a report**: Compiled findings into a coherent response\n\n## Next steps\n\nNow that you've built your first deep agent:\n\n* **Customize your agent**: Learn about [customization options](/oss/python/deepagents/customization), including custom system prompts, tools, and subagents.\n* **Understand middleware**: Dive into the [middleware architecture](/oss/python/deepagents/middleware) that powers deep agents.\n* **Add long-term memory**: Enable [persistent memory](/oss/python/deepagents/long-term-memory) across conversations.\n* **Deploy to production**: Learn about [deployment options](/oss/python/langgraph/deploy) for LangGraph applications.\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/oss/deepagents/quickstart.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n"
  },
  {
    "role": "tool",
    "name": "SearchDocsByLangChain",
    "tool_call_id": "31b81816-536b-41f3-88ec-64b1b152eadd",
    "id": "61dcc1cf-98a2-4fdc-b017-3cc57751a359",
    "content": "Result 1:\nTitle: Time travel using the server API\nLink: https://docs.langchain.comlangsmith/human-in-the-loop-time-travel\nContent: LangGraph provides the [**time travel**](/oss/python/langgraph/use-time-travel) functionality to resume execution from a prior checkpoint, either replaying the same state or modifying it to explore alternatives. In all cases, resuming past execution produces a new fork in the history.\n\nTo time travel using the LangSmith Deployment API (via the LangGraph SDK):\n\n1. **Run the graph** with initial inputs using [LangGraph SDK](/langsmith/langgraph-python-sdk)'s [client.runs.wait](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.client.RunsClient.wait) or [client.runs.stream](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.client.RunsClient.stream) APIs.\n2. **Identify a checkpoint in an existing thread**: Use [client.threads.get\\_history](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.client.ThreadsClient.get_history) method to retrieve the execution history for a specific `thread_id` and locate the desired `checkpoint_id`.\n   Alternatively, set a [breakpoint](/oss/python/langgraph/interrupts) before the node(s) where you want execution to pause. You can then find the most recent checkpoint recorded up to that breakpoint.\n3. **(Optional) modify the graph state**: Use the [client.threads.update\\_state](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.client.ThreadsClient.update_state) method to modify the graph\u2019s state at the checkpoint and resume execution from alternative state.\n4. **Resume execution from the checkpoint**: Use the [client.runs.wait](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.client.RunsClient.wait) or [client.runs.stream](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.client.RunsClient.stream) APIs with an input of `None` and the appropriate `thread_id` and `checkpoint_id`.\n\n## Use time travel in a workflow\n\n<Accordion title=\"Example graph\">\n  ```python  theme={null}\n  from typing_extensions import TypedDict, NotRequired\n  from langgraph.graph import StateGraph, START, END\n  from langchain.chat_models import init_chat_model\n  from langgraph.checkpoint.memory import InMemorySaver\n\n  class State(TypedDict):\n      topic: NotRequired[str]\n      joke: NotRequired[str]\n\n  model = init_chat_model(\n      \"claude-sonnet-4-5-20250929\",\n      temperature=0,\n  )\n\n  def generate_topic(state: State):\n      \"\"\"LLM call to generate a topic for the joke\"\"\"\n      msg = model.invoke(\"Give me a funny topic for a joke\")\n      return {\"topic\": msg.content}\n\n  def write_joke(state: State):\n      \"\"\"LLM call to write a joke based on the topic\"\"\"\n      msg = model.invoke(f\"Write a short joke about {state['topic']}\")\n      return {\"joke\": msg.content}\n\n  # Build workflow\n  builder = StateGraph(State)\n\n  # Add nodes\n  builder.add_node(\"generate_topic\", generate_topic)\n  builder.add_node(\"write_joke\", write_joke)\n\n  # Add edges to connect nodes\n  builder.add_edge(START, \"generate_topic\")\n  builder.add_edge(\"generate_topic\", \"write_joke\")\n\n  # Compile\n  graph = builder.compile()\n  ```\n</Accordion>\n\n### 1. Run the graph\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    from langgraph_sdk import get_client\n    client = get_client(url=<DEPLOYMENT_URL>)\n\n    # Using the graph deployed with the name \"agent\"\n    assistant_id = \"agent\"\n\n    # create a thread\n    thread = await client.threads.create()\n    thread_id = thread[\"thread_id\"]\n\n    # Run the graph\n    result = await client.runs.wait(\n        thread_id,\n        assistant_id,\n        input={}\n    )\n    ```\n  </Tab>\n\n  <Tab title=\"JavaScript\">\n    ```js  theme={null}\n    import { Client } from \"@langchain/langgraph-sdk\";\n    const client = new Client({ apiUrl: <DEPLOYMENT_URL> });\n\n    // Using the graph deployed with the name \"agent\"\n    const assistantID = \"agent\";\n\n    // create a thread\n    const thread = await client.threads.create();\n    const threadID = thread[\"thread_id\"];\n\n    // Run the graph\n    const result = await client.runs.wait(\n      threadID,\n      assistantID,\n      { input: {}}\n    );\n    ```\n  </Tab>\n\n  <Tab title=\"cURL\">\n    Create a thread:\n\n    ```bash  theme={null}\n    curl --request POST \\\n    --url <DEPLOYMENT_URL>/threads \\\n    --header 'Content-Type: application/json' \\\n    --data '{}'\n    ```\n\n    Run the graph:\n\n    ```bash  theme={null}\n    curl --request POST \\\n    --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/runs/wait \\\n    --header 'Content-Type: application/json' \\\n    --data \"{\n      \\\"assistant_id\\\": \\\"agent\\\",\n      \\\"input\\\": {}\n    }\"\n    ```\n  </Tab>\n</Tabs>\n\n### 2. Identify a checkpoint\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    # The states are returned in reverse chronological order.\n    states = await client.threads.get_history(thread_id)\n    selected_state = states[1]\n    print(selected_state)\n    ```\n  </Tab>\n\n  <Tab title=\"JavaScript\">\n    ```js  theme={null}\n    // The states are returned in reverse chronological order.\n    const states = await client.threads.getHistory(threadID);\n    const selectedState = states[1];\n    console.log(selectedState);\n    ```\n  </Tab>\n\n  <Tab title=\"cURL\">\n    ```bash  theme={null}\n    curl --request GET \\\n    --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/history \\\n    --header 'Content-Type: application/json'\n    ```\n  </Tab>\n</Tabs>\n\n<a id=\"optional\" />\n\n### 3. Update the state\n\n[`update_state`](https://reference.langchain.com/python/langgraph/graphs/#langgraph.graph.state.CompiledStateGraph.update_state) will create a new checkpoint. The new checkpoint will be associated with the same thread, but a new checkpoint ID.\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python {highlight={4}} theme={null}\n    new_config = await client.threads.update_state(\n        thread_id,\n        {\"topic\": \"chickens\"},\n        checkpoint_id=selected_state[\"checkpoint_id\"]\n    )\n    print(new_config)\n    ```\n  </Tab>\n\n  <Tab title=\"JavaScript\">\n    ```js  theme={null}\n    const newConfig = await client.threads.updateState(\n      threadID,\n      {\n        values: { \"topic\": \"chickens\" },\n        checkpointId: selectedState[\"checkpoint_id\"]\n      }\n    );\n    console.log(newConfig);\n    ```\n  </Tab>\n\n  <Tab title=\"cURL\">\n    ```bash  theme={null}\n    curl --request POST \\\n    --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/state \\\n    --header 'Content-Type: application/json' \\\n    --data \"{\n      \\\"assistant_id\\\": \\\"agent\\\",\n      \\\"checkpoint_id\\\": <CHECKPOINT_ID>,\n      \\\"values\\\": {\\\"topic\\\": \\\"chickens\\\"}\n    }\"\n    ```\n  </Tab>\n</Tabs>\n\n### 4. Resume execution from the checkpoint\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python {highlight={4,5}} theme={null}\n    await client.runs.wait(\n        thread_id,\n        assistant_id,\n        input=None,\n        checkpoint_id=new_config[\"checkpoint_id\"]\n    )\n    ```\n  </Tab>\n\n  <Tab title=\"JavaScript\">\n    ```javascript {highlight={5,6}} theme={null}\n    await client.runs.wait(\n      threadID,\n      assistantID,\n      {\n        input: null,\n        checkpointId: newConfig[\"checkpoint_id\"]\n      }\n    );\n    ```\n  </Tab>\n\n  <Tab title=\"cURL\">\n    ```bash  theme={null}\n    curl --request POST \\\n    --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/runs/wait \\\n    --header 'Content-Type: application/json' \\\n    --data \"{\n      \\\"assistant_id\\\": \\\"agent\\\",\n      \\\"checkpoint_id\\\": <CHECKPOINT_ID>\n    }\"\n    ```\n  </Tab>\n</Tabs>\n\n## Learn more\n\n* [**LangGraph time travel guide**](/oss/python/langgraph/use-time-travel): learn more about using time travel in LangGraph.\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/langsmith/human-in-the-loop-time-travel.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n\n---\n\nResult 2:\nTitle: Use time-travel\nLink: https://docs.langchain.comoss/javascript/langgraph/use-time-travel\nContent: When working with non-deterministic systems that make model-based decisions (e.g., agents powered by LLMs), it can be useful to examine their decision-making process in detail:\n\n1. <Icon icon=\"lightbulb\" size={16} /> **Understand reasoning**: Analyze the steps that led to a successful result.\n2. <Icon icon=\"bug\" size={16} /> **Debug mistakes**: Identify where and why errors occurred.\n3. <Icon icon=\"magnifying-glass\" size={16} /> **Explore alternatives**: Test different paths to uncover better solutions.\n\nLangGraph provides [time travel](/oss/javascript/langgraph/use-time-travel) functionality to support these use cases. Specifically, you can resume execution from a prior checkpoint \u2014 either replaying the same state or modifying it to explore alternatives. In all cases, resuming past execution produces a new fork in the history.\n\nTo use [time-travel](/oss/javascript/langgraph/use-time-travel) in LangGraph:\n\n1. [Run the graph](#1-run-the-graph) with initial inputs using [`invoke`](https://reference.langchain.com/javascript/classes/_langchain_langgraph.index.CompiledStateGraph.html#invoke) or [`stream`](https://reference.langchain.com/javascript/classes/_langchain_langgraph.index.CompiledStateGraph.html#stream) methods.\n2. [Identify a checkpoint in an existing thread](#2-identify-a-checkpoint): Use the [`getStateHistory`](https://reference.langchain.com/javascript/classes/_langchain_langgraph.pregel.Pregel.html#getStateHistory) method to retrieve the execution history for a specific `thread_id` and locate the desired `checkpoint_id`.\n   Alternatively, set a [breakpoint](/oss/javascript/langgraph/interrupts) before the node(s) where you want execution to pause. You can then find the most recent checkpoint recorded up to that breakpoint.\n3. [Update the graph state (optional)](#3-update-the-state-optional): Use the [`updateState`](https://reference.langchain.com/javascript/classes/_langchain_langgraph.pregel.Pregel.html#updateState) method to modify the graph's state at the checkpoint and resume execution from alternative state.\n4. [Resume execution from the checkpoint](#4-resume-execution-from-the-checkpoint): Use the `invoke` or `stream` methods with an input of `null` and a configuration containing the appropriate `thread_id` and `checkpoint_id`.\n\n<Tip>\n  For a conceptual overview of time-travel, see [Time travel](/oss/javascript/langgraph/use-time-travel).\n</Tip>\n\n## In a workflow\n\nThis example builds a simple LangGraph workflow that generates a joke topic and writes a joke using an LLM. It demonstrates how to run the graph, retrieve past execution checkpoints, optionally modify the state, and resume execution from a chosen checkpoint to explore alternate outcomes.\n\n### Setup\n\nFirst we need to install the packages required\n\n```bash  theme={null}\nnpm install @langchain/langgraph @langchain/anthropic\n```\n\nNext, we need to set API keys for Anthropic (the LLM we will use)\n\n```typescript  theme={null}\nprocess.env.ANTHROPIC_API_KEY = \"YOUR_API_KEY\";\n```\n\n<Tip>\n  Sign up for [LangSmith](https://smith.langchain.com) to quickly spot issues and improve the performance of your LangGraph projects. LangSmith lets you use trace data to debug, test, and monitor your LLM apps built with LangGraph.\n</Tip>\n\n```typescript  theme={null}\nimport { v4 as uuidv4 } from \"uuid\";\nimport * as z from \"zod\";\nimport { StateGraph, START, END } from \"@langchain/langgraph\";\nimport { ChatAnthropic } from \"@langchain/anthropic\";\nimport { MemorySaver } from \"@langchain/langgraph\";\n\nconst State = z.object({\n  topic: z.string().optional(),\n  joke: z.string().optional(),\n});\n\nconst model = new ChatAnthropic({\n  model: \"claude-sonnet-4-5-20250929\",\n  temperature: 0,\n});\n\n// Build workflow\nconst workflow = new StateGraph(State)\n  // Add nodes\n  .addNode(\"generateTopic\", async (state) => {\n    // LLM call to generate a topic for the joke\n    const msg = await model.invoke(\"Give me a funny topic for a joke\");\n    return { topic: msg.content };\n  })\n  .addNode(\"writeJoke\", async (state) => {\n    // LLM call to write a joke based on the topic\n    const msg = await model.invoke(`Write a short joke about ${state.topic}`);\n    return { joke: msg.content };\n  })\n  // Add edges to connect nodes\n  .addEdge(START, \"generateTopic\")\n  .addEdge(\"generateTopic\", \"writeJoke\")\n  .addEdge(\"writeJoke\", END);\n\n// Compile\nconst checkpointer = new MemorySaver();\nconst graph = workflow.compile({ checkpointer });\n```\n\n### 1. Run the graph\n\n```typescript  theme={null}\nconst config = {\n  configurable: {\n    thread_id: uuidv4(),\n  },\n};\n\nconst state = await graph.invoke({}, config);\n\nconsole.log(state.topic);\nconsole.log();\nconsole.log(state.joke);\n```\n\n**Output:**\n\n```\nHow about \"The Secret Life of Socks in the Dryer\"? You know, exploring the mysterious phenomenon of how socks go into the laundry as pairs but come out as singles. Where do they go? Are they starting new lives elsewhere? Is there a sock paradise we don't know about? There's a lot of comedic potential in the everyday mystery that unites us all!\n\n# The Secret Life of Socks in the Dryer\n\nI finally discovered where all my missing socks go after the dryer. Turns out they're not missing at all\u2014they've just eloped with someone else's socks from the laundromat to start new lives together.\n\nMy blue argyle is now living in Bermuda with a red polka dot, posting vacation photos on Sockstagram and sending me lint as alimony.\n```\n\n### 2. Identify a checkpoint\n\n```typescript  theme={null}\n// The states are returned in reverse chronological order.\nconst states = [];\nfor await (const state of graph.getStateHistory(config)) {\n  states.push(state);\n}\n\nfor (const state of states) {\n  console.log(state.next);\n  console.log(state.config.configurable?.checkpoint_id);\n  console.log();\n}\n```\n\n**Output:**\n\n```\n[]\n1f02ac4a-ec9f-6524-8002-8f7b0bbeed0e\n\n['writeJoke']\n1f02ac4a-ce2a-6494-8001-cb2e2d651227\n\n['generateTopic']\n1f02ac4a-a4e0-630d-8000-b73c254ba748\n\n['__start__']\n1f02ac4a-a4dd-665e-bfff-e6c8c44315d9\n```\n\n```typescript  theme={null}\n// This is the state before last (states are listed in chronological order)\nconst selectedState = states[1];\nconsole.log(selectedState.next);\nconsole.log(selectedState.values);\n```\n\n**Output:**\n\n```\n['writeJoke']\n{'topic': 'How about \"The Secret Life of Socks in the Dryer\"? You know, exploring the mysterious phenomenon of how socks go into the laundry as pairs but come out as singles. Where do they go? Are they starting new lives elsewhere? Is there a sock paradise we don\\\\'t know about? There\\\\'s a lot of comedic potential in the everyday mystery that unites us all!'}\n```\n\n<a id=\"optional\" />\n\n### 3. Update the state\n\n`updateState` will create a new checkpoint. The new checkpoint will be associated with the same thread, but a new checkpoint ID.\n\n```typescript  theme={null}\nconst newConfig = await graph.updateState(selectedState.config, {\n  topic: \"chickens\",\n});\nconsole.log(newConfig);\n```\n\n**Output:**\n\n```\n{'configurable': {'thread_id': 'c62e2e03-c27b-4cb6-8cea-ea9bfedae006', 'checkpoint_ns': '', 'checkpoint_id': '1f02ac4a-ecee-600b-8002-a1d21df32e4c'}}\n```\n\n### 4. Resume execution from the checkpoint\n\n```typescript  theme={null}\nawait graph.invoke(null, newConfig);\n```\n\n**Output:**\n\n```typescript  theme={null}\n{\n  'topic': 'chickens',\n  'joke': 'Why did the chicken join a band?\\n\\nBecause it had excellent drumsticks!'\n}\n```\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/oss/langgraph/use-time-travel.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n\n---\n\nResult 3:\nTitle: Use time-travel\nLink: https://docs.langchain.comoss/python/langgraph/use-time-travel\nContent: When working with non-deterministic systems that make model-based decisions (e.g., agents powered by LLMs), it can be useful to examine their decision-making process in detail:\n\n1. <Icon icon=\"lightbulb\" size={16} /> **Understand reasoning**: Analyze the steps that led to a successful result.\n2. <Icon icon=\"bug\" size={16} /> **Debug mistakes**: Identify where and why errors occurred.\n3. <Icon icon=\"magnifying-glass\" size={16} /> **Explore alternatives**: Test different paths to uncover better solutions.\n\nLangGraph provides [time travel](/oss/python/langgraph/use-time-travel) functionality to support these use cases. Specifically, you can resume execution from a prior checkpoint \u2014 either replaying the same state or modifying it to explore alternatives. In all cases, resuming past execution produces a new fork in the history.\n\nTo use [time-travel](/oss/python/langgraph/use-time-travel) in LangGraph:\n\n1. [Run the graph](#1-run-the-graph) with initial inputs using [`invoke`](https://reference.langchain.com/python/langgraph/graphs/#langgraph.graph.state.CompiledStateGraph.invoke) or [`stream`](https://reference.langchain.com/python/langgraph/graphs/#langgraph.graph.state.CompiledStateGraph.stream) methods.\n2. [Identify a checkpoint in an existing thread](#2-identify-a-checkpoint): Use the [`get_state_history`](https://reference.langchain.com/python/langgraph/graphs/#langgraph.graph.state.CompiledStateGraph.get_state_history) method to retrieve the execution history for a specific `thread_id` and locate the desired `checkpoint_id`.\n   Alternatively, set an [interrupt](/oss/python/langgraph/interrupts) before the node(s) where you want execution to pause. You can then find the most recent checkpoint recorded up to that interrupt.\n3. [Update the graph state (optional)](#3-update-the-state-optional): Use the [`update_state`](https://reference.langchain.com/python/langgraph/graphs/#langgraph.graph.state.CompiledStateGraph.update_state) method to modify the graph's state at the checkpoint and resume execution from alternative state.\n4. [Resume execution from the checkpoint](#4-resume-execution-from-the-checkpoint): Use the `invoke` or `stream` methods with an input of `None` and a configuration containing the appropriate `thread_id` and `checkpoint_id`.\n\n<Tip>\n  For a conceptual overview of time-travel, see [Time travel](/oss/python/langgraph/use-time-travel).\n</Tip>\n\n## In a workflow\n\nThis example builds a simple LangGraph workflow that generates a joke topic and writes a joke using an LLM. It demonstrates how to run the graph, retrieve past execution checkpoints, optionally modify the state, and resume execution from a chosen checkpoint to explore alternate outcomes.\n\n### Setup\n\nFirst we need to install the packages required\n\n```python  theme={null}\n%%capture --no-stderr\npip install --quiet -U langgraph langchain_anthropic\n```\n\nNext, we need to set API keys for Anthropic (the LLM we will use)\n\n```python  theme={null}\nimport getpass\nimport os\n\n\ndef _set_env(var: str):\n    if not os.environ.get(var):\n        os.environ[var] = getpass.getpass(f\"{var}: \")\n\n\n_set_env(\"ANTHROPIC_API_KEY\")\n```\n\n<Tip>\n  Sign up for [LangSmith](https://smith.langchain.com) to quickly spot issues and improve the performance of your LangGraph projects. LangSmith lets you use trace data to debug, test, and monitor your LLM apps built with LangGraph.\n</Tip>\n\n```python  theme={null}\nimport uuid\n\nfrom typing_extensions import TypedDict, NotRequired\nfrom langgraph.graph import StateGraph, START, END\nfrom langchain.chat_models import init_chat_model\nfrom langgraph.checkpoint.memory import InMemorySaver\n\n\nclass State(TypedDict):\n    topic: NotRequired[str]\n    joke: NotRequired[str]\n\n\nmodel = init_chat_model(\n    \"claude-sonnet-4-5-20250929\",\n    temperature=0,\n)\n\n\ndef generate_topic(state: State):\n    \"\"\"LLM call to generate a topic for the joke\"\"\"\n    msg = model.invoke(\"Give me a funny topic for a joke\")\n    return {\"topic\": msg.content}\n\n\ndef write_joke(state: State):\n    \"\"\"LLM call to write a joke based on the topic\"\"\"\n    msg = model.invoke(f\"Write a short joke about {state['topic']}\")\n    return {\"joke\": msg.content}\n\n\n# Build workflow\nworkflow = StateGraph(State)\n\n# Add nodes\nworkflow.add_node(\"generate_topic\", generate_topic)\nworkflow.add_node(\"write_joke\", write_joke)\n\n# Add edges to connect nodes\nworkflow.add_edge(START, \"generate_topic\")\nworkflow.add_edge(\"generate_topic\", \"write_joke\")\nworkflow.add_edge(\"write_joke\", END)\n\n# Compile\ncheckpointer = InMemorySaver()\ngraph = workflow.compile(checkpointer=checkpointer)\ngraph\n```\n\n### 1. Run the graph\n\n```python  theme={null}\nconfig = {\n    \"configurable\": {\n        \"thread_id\": uuid.uuid4(),\n    }\n}\nstate = graph.invoke({}, config)\n\nprint(state[\"topic\"])\nprint()\nprint(state[\"joke\"])\n```\n\n**Output:**\n\n```\nHow about \"The Secret Life of Socks in the Dryer\"? You know, exploring the mysterious phenomenon of how socks go into the laundry as pairs but come out as singles. Where do they go? Are they starting new lives elsewhere? Is there a sock paradise we don't know about? There's a lot of comedic potential in the everyday mystery that unites us all!\n\n# The Secret Life of Socks in the Dryer\n\nI finally discovered where all my missing socks go after the dryer. Turns out they're not missing at all\u2014they've just eloped with someone else's socks from the laundromat to start new lives together.\n\nMy blue argyle is now living in Bermuda with a red polka dot, posting vacation photos on Sockstagram and sending me lint as alimony.\n```\n\n### 2. Identify a checkpoint\n\n```python  theme={null}\n# The states are returned in reverse chronological order.\nstates = list(graph.get_state_history(config))\n\nfor state in states:\n    print(state.next)\n    print(state.config[\"configurable\"][\"checkpoint_id\"])\n    print()\n```\n\n**Output:**\n\n```\n()\n1f02ac4a-ec9f-6524-8002-8f7b0bbeed0e\n\n('write_joke',)\n1f02ac4a-ce2a-6494-8001-cb2e2d651227\n\n('generate_topic',)\n1f02ac4a-a4e0-630d-8000-b73c254ba748\n\n('__start__',)\n1f02ac4a-a4dd-665e-bfff-e6c8c44315d9\n```\n\n```python  theme={null}\n# This is the state before last (states are listed in chronological order)\nselected_state = states[1]\nprint(selected_state.next)\nprint(selected_state.values)\n```\n\n**Output:**\n\n```\n('write_joke',)\n{'topic': 'How about \"The Secret Life of Socks in the Dryer\"? You know, exploring the mysterious phenomenon of how socks go into the laundry as pairs but come out as singles. Where do they go? Are they starting new lives elsewhere? Is there a sock paradise we don\\\\'t know about? There\\\\'s a lot of comedic potential in the everyday mystery that unites us all!'}\n```\n\n<a id=\"optional\" />\n\n### 3. Update the state\n\n[`update_state`](https://reference.langchain.com/python/langgraph/graphs/#langgraph.graph.state.CompiledStateGraph.update_state) will create a new checkpoint. The new checkpoint will be associated with the same thread, but a new checkpoint ID.\n\n```python  theme={null}\nnew_config = graph.update_state(selected_state.config, values={\"topic\": \"chickens\"})\nprint(new_config)\n```\n\n**Output:**\n\n```\n{'configurable': {'thread_id': 'c62e2e03-c27b-4cb6-8cea-ea9bfedae006', 'checkpoint_ns': '', 'checkpoint_id': '1f02ac4a-ecee-600b-8002-a1d21df32e4c'}}\n```\n\n### 4. Resume execution from the checkpoint\n\n```python  theme={null}\ngraph.invoke(None, new_config)\n```\n\n**Output:**\n\n```python  theme={null}\n{'topic': 'chickens',\n 'joke': 'Why did the chicken join a band?\\n\\nBecause it had excellent drumsticks!'}\n```\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/oss/langgraph/use-time-travel.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3815-4e9b-7830-a125-15bbffc4b1e2",
    "content": "**\u0410\u043d\u0430\u043b\u0438\u0437 \u0432\u0430\u0448\u0438\u0445 \u0433\u0438\u043f\u043e\u0442\u0435\u0437 \u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u044b \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438 \u0438 \u043b\u043e\u0433\u043e\u0432:**\n\n\u0412\u0430\u0448\u0438 \u0433\u0438\u043f\u043e\u0442\u0435\u0437\u044b \u043f\u043e\u043f\u0430\u0434\u0430\u044e\u0442 \u0442\u043e\u0447\u043d\u043e \u0432 \u0446\u0435\u043b\u044c. \u0421\u0443\u0434\u044f \u043f\u043e \u043c\u0435\u0445\u0430\u043d\u0438\u043a\u0435 LangGraph, \u0432\u044b \u0441\u0442\u043e\u043b\u043a\u043d\u0443\u043b\u0438\u0441\u044c \u0441 \u043a\u043b\u0430\u0441\u0441\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u043e\u0439 \u00ab\u043d\u0435\u043f\u043e\u043b\u043d\u043e\u0433\u043e \u0440\u0435\u0437\u043e\u043b\u0432\u0430\u00bb \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u043f\u0440\u0438 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 (Resume).\n\n## \u0410\u043d\u0430\u043b\u0438\u0437 \u0433\u0438\u043f\u043e\u0442\u0435\u0437:\n\n### \u0413\u0438\u043f\u043e\u0442\u0435\u0437\u0430 K: Resume misclassification (`__start__`) \u2014 **\u041f\u041e\u0414\u0422\u0412\u0415\u0420\u0416\u0414\u0415\u041d\u041e**\n\u0412 LangGraph \u0443\u0437\u0435\u043b `__start__` \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u043c. \u0415\u0441\u043b\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043d\u0430 `next=[\"__start__\"]`, \u044d\u0442\u043e \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e \u0433\u0440\u0430\u0444 \u0433\u043e\u0442\u043e\u0432 \u043a \u0437\u0430\u043f\u0443\u0441\u043a\u0443, \u043d\u043e \u0435\u0449\u0435 \u043d\u0435 \u043d\u0430\u0447\u0430\u043b \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u043d\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u0440\u0430\u0431\u043e\u0447\u0435\u0433\u043e \u0443\u0437\u043b\u0430. \n- **\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430:** \u041a\u043e\u0433\u0434\u0430 \u0432\u044b \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0435 `invoke(None, config=checkpoint_config)`, LangGraph \u043e\u0436\u0438\u0434\u0430\u0435\u0442, \u0447\u0442\u043e \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0435 **\u0443\u0436\u0435 \u0435\u0441\u0442\u044c** \u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u043b\u044f \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u044f. \u0415\u0441\u043b\u0438 \u0436\u0435 \u043c\u044b \u043d\u0430 \u0443\u0437\u043b\u0435 `__start__`, \u0432\u044b\u0437\u043e\u0432 \u0441 `None` \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a `EmptyInputError`, \u0442\u0430\u043a \u043a\u0430\u043a \u0433\u0440\u0430\u0444 \u043d\u0435 \u0437\u043d\u0430\u0435\u0442, \u0441 \u043a\u0430\u043a\u0438\u043c\u0438 \u0432\u0445\u043e\u0434\u043d\u044b\u043c\u0438 \u0434\u0430\u043d\u043d\u044b\u043c\u0438 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f.\n- **\u0420\u0435\u0448\u0435\u043d\u0438\u0435:** \u0415\u0441\u043b\u0438 `next` \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0442\u043e\u043b\u044c\u043a\u043e `__start__`, \u043d\u0443\u0436\u043d\u043e \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c \u0433\u0440\u0430\u0444 \u0441 \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u043c `graph_input`, \u0430 \u043d\u0435 \u0441 `None`.\n\n### \u0413\u0438\u043f\u043e\u0442\u0435\u0437\u0430 L: Writes never materialize \u2014 **\u0412\u0415\u0420\u041e\u042f\u0422\u041d\u041e**\n\u0412 LangGraph `writes` (\u0437\u0430\u043f\u0438\u0441\u0438 \u0432 \u0441\u0442\u0435\u0439\u0442) \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u0432 \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0445 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430, \u043d\u043e \u0438\u0445 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u0437\u0430\u0432\u0438\u0441\u0438\u0442 \u043e\u0442 \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0435\u0440\u0430. \n- **\u041d\u044e\u0430\u043d\u0441:** \u0412 `InMemorySaver` \u0437\u0430\u043f\u0438\u0441\u0438 \u0447\u0430\u0441\u0442\u043e \u0443\u043f\u0430\u043a\u043e\u0432\u0430\u043d\u044b \u0432 \u0441\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u0440\u0442\u0435\u0436\u0435\u0439 \u0438\u043b\u0438 \u0441\u043b\u043e\u0432\u0430\u0440\u0435\u0439 \u0432 \u043f\u043e\u043b\u0435 `pending_writes`. \u0415\u0441\u043b\u0438 \u0432\u0430\u0448\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u044f `_materialize_checkpoint_values` \u043e\u0436\u0438\u0434\u0430\u0435\u0442 \u043f\u043b\u043e\u0441\u043a\u0438\u0439 \u0441\u043b\u043e\u0432\u0430\u0440\u044c, \u043e\u043d\u0430 \u0438\u0445 \u043f\u0440\u043e\u0441\u0442\u043e \u00ab\u043d\u0435 \u0432\u0438\u0434\u0438\u0442\u00bb. \n- **\u0416\u0434\u0435\u043c \u043b\u043e\u0433\u0438:** \u041b\u043e\u0433 \u0441 `hypothesisId=\"L\"` \u043f\u043e\u043a\u0430\u0436\u0435\u0442, \u043f\u0440\u0438\u0445\u043e\u0434\u044f\u0442 \u043b\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u043a\u0430\u043a `Sequence` (\u0441\u043f\u0438\u0441\u043e\u043a \u0437\u0430\u043f\u0438\u0441\u0435\u0439) \u0438\u043b\u0438 `Mapping`.\n\n### \u0413\u0438\u043f\u043e\u0442\u0435\u0437\u0430 M: Resume path drops payload \u2014 **\u041f\u041e\u0414\u0422\u0412\u0415\u0420\u0416\u0414\u0415\u041d\u041e**\n\u042d\u0442\u043e \u043f\u0440\u044f\u043c\u043e\u0435 \u0441\u043b\u0435\u0434\u0441\u0442\u0432\u0438\u0435 \u0433\u0438\u043f\u043e\u0442\u0435\u0437\u044b K. \u0412 `memory_manager.py` \u043b\u043e\u0433\u0438\u043a\u0430 resume \u0436\u0435\u0441\u0442\u043a\u043e \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0430\u0435\u0442\u0441\u044f \u043d\u0430 `graph_input=None`, \u0435\u0441\u043b\u0438 \u043d\u0430\u0439\u0434\u0435\u043d `checkpoint_id`. \n```python\n# \u0415\u0441\u043b\u0438 \u043d\u0430\u0439\u0434\u0435\u043d checkpoint_id, \u043c\u044b \u0412\u0421\u0415\u0413\u0414\u0410 \u0448\u043b\u0435\u043c None,\n# \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u044d\u0442\u043e \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a \u0441 \u0441\u0430\u043c\u043e\u0433\u043e \u043d\u0430\u0447\u0430\u043b\u0430 (__start__)\nreturn await self.ainvoke_with_durability(..., graph_input=None, ...)\n```\n\u042d\u0442\u043e \u043b\u0438\u0448\u0430\u0435\u0442 \u0433\u0440\u0430\u0444 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u0442\u0430\u0440\u0442\u043e\u0432\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435.\n\n## \u0427\u0442\u043e \u043c\u044b \u0438\u0449\u0435\u043c \u0432 \u043d\u043e\u0432\u044b\u0445 \u043b\u043e\u0433\u0430\u0445:\n\n1.  **\u0414\u043b\u044f K:** \u0412 \u043b\u043e\u0433\u0435 `hypothesisId=\"K\"` \u0438\u0449\u0435\u043c `next_nodes: [\"__start__\"]` \u0438 `graph_input_is_none: true`. \u0415\u0441\u043b\u0438 \u044d\u0442\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0435\u0442 \u2014 \u043c\u044b \u043d\u0430\u0448\u043b\u0438 \u043f\u0440\u0438\u0447\u0438\u043d\u0443 `EmptyInputError`.\n2.  **\u0414\u043b\u044f L:** \u0412 \u043b\u043e\u0433\u0435 `hypothesisId=\"L\"` \u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043d\u0430 `record_type`. \u0415\u0441\u043b\u0438 \u0442\u0430\u043c `CheckpointTuple`, \u043d\u0443\u0436\u043d\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c, \u043a\u0430\u043a \u0438\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u0442\u0441\u044f \u0430\u0442\u0440\u0438\u0431\u0443\u0442 `pending_writes`.\n3.  **\u0414\u043b\u044f J:** \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c, \u043f\u0443\u0441\u0442 \u043b\u0438 \u0441\u043f\u0438\u0441\u043e\u043a `keys` \u0432 `returning checkpoint values`. \u0415\u0441\u043b\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u0443\u0441\u0442, \u0437\u043d\u0430\u0447\u0438\u0442, \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u043d\u0435 \u0441\u0440\u0430\u0431\u043e\u0442\u0430\u043b\u0430.\n\n**\u041e\u0436\u0438\u0434\u0430\u0435\u043c\u043e\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435:**\n\u0412 `ainvoke_from_checkpoint` \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443: \u0435\u0441\u043b\u0438 \u043c\u044b \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u043c \u0441 `__start__`, \u043c\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c `graph_input` \u0432\u043c\u0435\u0441\u0442\u043e `None`, \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.\n\n**Relevant docs:**\n\n- [Time Travel: Resume from Checkpoint](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)\n- [Persistence: Checkpoints and Metadata](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)\n- [LangGraph Errors: EmptyInputError](https://docs.langchain.com/langsmith/use-threads#empty-thread)"
  },
  {
    "role": "user",
    "id": "3ae4ca20-498a-465f-a81a-37d97396ce3f",
    "content": "\u0418\u0437-\u0437\u0430 \u044d\u0442\u0438\u0445 \u043f\u0440\u0438\u0447\u0438\u043d \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043e\u0448\u0438\u043a\u0430 \u0441 cancled ? "
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3816-c8c0-7df2-bdc3-0a84fc4af6f7",
    "content": "**\u0414\u0430, \u044d\u0442\u0438 \u043f\u0440\u0438\u0447\u0438\u043d\u044b \u043c\u043e\u0433\u0443\u0442 \u043a\u043e\u0441\u0432\u0435\u043d\u043d\u043e \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442\u044c \u043a `CancelledError`, \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u044f \u00ab\u0446\u0435\u043f\u043d\u0443\u044e \u0440\u0435\u0430\u043a\u0446\u0438\u044e\u00bb \u043e\u0448\u0438\u0431\u043e\u043a \u0432 \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u043e\u043c \u0446\u0438\u043a\u043b\u0435.**\n\n\u0421\u0430\u043c\u0430 \u043f\u043e \u0441\u0435\u0431\u0435 `CancelledError` \u2014 \u044d\u0442\u043e \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u043d\u0438\u044f \u0437\u0430\u0434\u0430\u0447\u0438, \u043d\u043e \u0433\u0438\u043f\u043e\u0442\u0435\u0437\u044b K, L \u0438 M \u0441\u043e\u0437\u0434\u0430\u044e\u0442 \u0438\u0434\u0435\u0430\u043b\u044c\u043d\u044b\u0435 \u0443\u0441\u043b\u043e\u0432\u0438\u044f \u0434\u043b\u044f \u0435\u0451 \u0432\u043e\u0437\u043d\u0438\u043a\u043d\u043e\u0432\u0435\u043d\u0438\u044f \u0447\u0435\u0440\u0435\u0437 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c\u044b \u0442\u0430\u0439\u043c\u0430\u0443\u0442\u043e\u0432 \u0438 \u043d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0433\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432.\n\n\u0412\u043e\u0442 \u043a\u0430\u043a \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043e\u0448\u0438\u0431\u043a\u0438 (K, L, M) \u043f\u0440\u0435\u0432\u0440\u0430\u0449\u0430\u044e\u0442\u0441\u044f \u0432 `CancelledError`:\n\n## \u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439 1: \u0417\u0430\u0432\u0438\u0441\u0430\u043d\u0438\u0435 \u043f\u0440\u0438 \u043f\u0443\u0441\u0442\u043e\u043c \u0432\u0432\u043e\u0434\u0435 (Hypothesis K/M)\n\n\u041a\u043e\u0433\u0434\u0430 \u0432\u044b \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0435 `ainvoke_from_checkpoint` \u0441 `graph_input=None` \u043d\u0430 \u0443\u0437\u043b\u0435 `__start__`, LangGraph \u043c\u043e\u0436\u0435\u0442 \u043d\u0435 \u043f\u0440\u043e\u0441\u0442\u043e \u0432\u044b\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043e\u0448\u0438\u0431\u043a\u0443, \u0430 \u0432\u043e\u0439\u0442\u0438 \u0432 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u043d\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u0438\u043b\u0438 \u0431\u0435\u0441\u043a\u043e\u043d\u0435\u0447\u043d\u043e\u0433\u043e \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u044f (\u0437\u0430\u0432\u0438\u0441\u0438\u0442 \u043e\u0442 \u0432\u0435\u0440\u0441\u0438\u0438 \u0438 \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438).\n1.  \u0413\u0440\u0430\u0444 \u043e\u0436\u0438\u0434\u0430\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435, \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043d\u0435\u0442.\n2.  \u0410\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u0430\u044f \u0437\u0430\u0434\u0430\u0447\u0430 \u00ab\u043f\u043e\u0434\u0432\u0438\u0441\u0430\u0435\u0442\u00bb \u0432 \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u0438 \u0440\u0435\u0437\u043e\u043b\u0432\u0430.\n3.  \u0412\u043d\u0435\u0448\u043d\u0438\u0439 \u043e\u0440\u043a\u0435\u0441\u0442\u0440\u0430\u0442\u043e\u0440 (\u0442\u0435\u0441\u0442 \u0438\u043b\u0438 \u0441\u0435\u0440\u0432\u0435\u0440) \u0432\u0438\u0434\u0438\u0442, \u0447\u0442\u043e \u0437\u0430\u0434\u0430\u0447\u0430 \u043d\u0435 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0434\u043e\u043b\u044c\u0448\u0435 \u043f\u043e\u043b\u043e\u0436\u0435\u043d\u043d\u043e\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 (\u0442\u0430\u0439\u043c\u0430\u0443\u0442), \u0438 \u043f\u043e\u0441\u044b\u043b\u0430\u0435\u0442 \u0441\u0438\u0433\u043d\u0430\u043b `cancel()`.\n4.  \u0412\u044b \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442\u0435 `CancelledError` \u0432 \u043c\u043e\u043c\u0435\u043d\u0442, \u043a\u043e\u0433\u0434\u0430 `AsyncPregelLoop` \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u044d\u043a\u0441\u0442\u0440\u0435\u043d\u043d\u043e \u0437\u0430\u043a\u0440\u044b\u0442\u044c\u0441\u044f.\n\n## \u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439 2: \u041a\u043e\u043d\u0444\u043b\u0438\u043a\u0442 \u0432 \u0446\u0438\u043a\u043b\u0435 `while True`\n\n\u0412\u0430\u0448 \u043a\u043e\u0434 \u0432 `ArchitecturalAgentBase.run` \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0431\u0435\u0441\u043a\u043e\u043d\u0435\u0447\u043d\u044b\u0439 \u0446\u0438\u043a\u043b. \u0415\u0441\u043b\u0438 \u0433\u0438\u043f\u043e\u0442\u0435\u0437\u044b K \u0438\u043b\u0438 M \u043f\u0440\u0438\u0432\u043e\u0434\u044f\u0442 \u043a \u0431\u044b\u0441\u0442\u0440\u043e\u0439 \u043e\u0448\u0438\u0431\u043a\u0435 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, `EmptyInputError`):\n1.  \u0411\u043b\u043e\u043a `except Exception:` \u043f\u0435\u0440\u0435\u0445\u0432\u0430\u0442\u044b\u0432\u0430\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0443.\n2.  \u0412\u044b \u043f\u044b\u0442\u0430\u0435\u0442\u0435\u0441\u044c \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c `restore_state_from_latest_checkpoint` \u0438\u043b\u0438 \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435.\n3.  \u0412 \u044d\u0442\u043e\u0442 \u043c\u043e\u043c\u0435\u043d\u0442 \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439 \u0441\u0442\u0435\u043a LangGraph (\u0432\u043d\u0443\u0442\u0440\u0438 `ainvoke`) \u0435\u0449\u0435 \u043d\u0435 \u0443\u0441\u043f\u0435\u043b \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0440\u0435\u0441\u0443\u0440\u0441\u044b (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0437\u0430\u043a\u0440\u044b\u0442\u044c \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 MCP-\u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c \u0438\u043b\u0438 \u043e\u0442\u043f\u0443\u0441\u0442\u0438\u0442\u044c `anyio.Lock`).\n4.  \u0412\u0430\u0448\u0430 \u043f\u043e\u043f\u044b\u0442\u043a\u0430 \u043d\u0435\u043c\u0435\u0434\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0440\u0435\u0442\u0440\u0438\u044f \u043d\u0430 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u043c \u0432\u0438\u0442\u043a\u0435 `while True` \u043d\u0430\u0442\u044b\u043a\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u0437\u0430\u043d\u044f\u0442\u044b\u0435 \u0440\u0435\u0441\u0443\u0440\u0441\u044b. \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u0431\u043b\u043e\u043a\u0438\u0440\u0443\u0435\u0442\u0441\u044f, \u0438 \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0435 \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a `CancelledError` \u0432 `AsyncExitStack.__aexit__`.\n\n## \u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439 3: \"Writes never materialize\" (Hypothesis L)\n\n\u0415\u0441\u043b\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u044b \u043d\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 \u0434\u0430\u043d\u043d\u044b\u0445 (\u043f\u0443\u0441\u0442\u044b\u0435 `writes`), \u0432\u0430\u0448 \u0430\u0433\u0435\u043d\u0442 \u043c\u043e\u0436\u0435\u0442 \u0432\u043e\u0439\u0442\u0438 \u0432 \u0446\u0438\u043a\u043b \u00ab\u043f\u0443\u0441\u0442\u044b\u0445\u00bb \u0440\u0435\u0442\u0440\u0438\u0435\u0432:\n1.  \u0410\u0433\u0435\u043d\u0442 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f \u2192 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u2192 \u043f\u0430\u0434\u0430\u0435\u0442 \u2192 \u0434\u0435\u043b\u0430\u0435\u0442 fallback \u2192 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f \u0441 \u0442\u043e\u0433\u043e \u0436\u0435 \u043f\u0443\u0441\u0442\u043e\u0433\u043e \u043c\u0435\u0441\u0442\u0430.\n2.  \u0415\u0441\u043b\u0438 \u044d\u0442\u043e\u0442 \u0446\u0438\u043a\u043b \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0431\u044b\u0441\u0442\u0440\u043e (fast-looping), \u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0445 \u0437\u0430\u0434\u0430\u0447 \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0435\u0440\u0432\u0430\u0442\u044c \u0435\u0433\u043e, \u043f\u043e\u0441\u0447\u0438\u0442\u0430\u0432 \u0437\u0430\u0434\u0430\u0447\u0443 \u0437\u0430\u0446\u0438\u043a\u043b\u0435\u043d\u043d\u043e\u0439 \u0438\u043b\u0438 \u043f\u043e\u0442\u0440\u0435\u0431\u043b\u044f\u044e\u0449\u0435\u0439 \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u043c\u043d\u043e\u0433\u043e \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432, \u0447\u0442\u043e \u043e\u043f\u044f\u0442\u044c \u0436\u0435 \u043f\u043e\u0440\u043e\u0436\u0434\u0430\u0435\u0442 `CancelledError`.\n\n### \u041a\u0430\u043a \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0441\u0432\u044f\u0437\u044c \u0432 \u043d\u043e\u0432\u044b\u0445 \u043b\u043e\u0433\u0430\u0445:\n\n-   \u0415\u0441\u043b\u0438 \u0432\u044b \u0432\u0438\u0434\u0438\u0442\u0435 `hypothesisId=\"K\"` (next_nodes=['__start__']) \u0438 \u0441\u0440\u0430\u0437\u0443 \u0437\u0430 \u043d\u0438\u043c (\u0432 \u043f\u0440\u0435\u0434\u0435\u043b\u0430\u0445 \u043c\u0438\u043b\u043b\u0438\u0441\u0435\u043a\u0443\u043d\u0434) Traceback \u0441 `CancelledError`, \u0437\u043d\u0430\u0447\u0438\u0442, **\u043f\u0443\u0441\u0442\u043e\u0439 \u0432\u0445\u043e\u0434 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 \u043d\u0435\u043c\u0435\u0434\u043b\u0435\u043d\u043d\u044b\u0439 \u043a\u043e\u043b\u043b\u0430\u043f\u0441 \u043f\u0435\u0442\u043b\u0438**.\n-   \u0415\u0441\u043b\u0438 \u043c\u0435\u0436\u0434\u0443 \u0432\u0445\u043e\u0434\u043e\u043c \u0432 `ainvoke` \u0438 \u043e\u0448\u0438\u0431\u043a\u043e\u0439 \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u0442 \u0440\u043e\u0432\u043d\u043e 30, 60 \u0438\u043b\u0438 300 \u0441\u0435\u043a\u0443\u043d\u0434 \u2014 \u044d\u0442\u043e **\u0442\u0430\u0439\u043c\u0430\u0443\u0442**, \u0432\u044b\u0437\u0432\u0430\u043d\u043d\u044b\u0439 \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u0435\u043c \u0434\u0430\u043d\u043d\u044b\u0445.\n\n**\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0430\u0446\u0438\u044f:** \u041f\u043e\u043c\u0438\u043c\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0433\u0438\u043f\u043e\u0442\u0435\u0437 K/M, \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u044c\u0442\u0435 `asyncio.CancelledError` \u0432 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0431\u043b\u043e\u043a\u0430 `except` \u0432 `agent.py`, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u0437\u0432\u043e\u043b\u0438\u0442\u044c \u0441\u0438\u0441\u0442\u0435\u043c\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u00ab\u0443\u043c\u0435\u0440\u0435\u0442\u044c\u00bb \u043f\u0440\u0438 \u043e\u0442\u043c\u0435\u043d\u0435.\n\n**Relevant docs:**\n\n- [LangGraph Persistence: Checkpoints](https://docs.langchain.com/oss/python/langgraph/persistence)\n- [Troubleshooting Distributed Execution](https://docs.langchain.com/langsmith/agent-server-scale#avoid-synchronous-blocking-operations)\n- [Asyncio Task Cancellation](https://docs.python.org/3/library/asyncio-task.html#task-cancellation)"
  },
  {
    "role": "user",
    "id": "8ac5bde4-9f0e-4d10-b8fc-6ea5dd2f9c2f",
    "content": "\u0421\u0435\u0439\u0447\u0430\u0441 \u044d\u0442\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u0432\u044b\u043b\u0435\u0442\u0435\u043b\u0430 \nEmptyInputError('Received no input for __start__')Traceback (most recent call last):\n\n\n  File \"/Users/skylarpro/miniconda3/envs/llmcore/lib/python3.11/site-packages/langgraph/pregel/main.py\", line 2888, in astream\n    async with AsyncPregelLoop(\n\n\n  File \"/Users/skylarpro/miniconda3/envs/llmcore/lib/python3.11/site-packages/langgraph/pregel/_loop.py\", line 1303, in __aenter__\n    self.updated_channels = self._first(\n                            ^^^^^^^^^^^^\n\n\n  File \"/Users/skylarpro/miniconda3/envs/llmcore/lib/python3.11/site-packages/langgraph/pregel/_loop.py\", line 725, in _first\n    raise EmptyInputError(f\"Received no input for {input_keys}\")\n\n\nlanggraph.errors.EmptyInputError: Received no input for __start__"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3818-09bc-7253-aad2-2478074473fc",
    "content": "**\u041e\u0448\u0438\u0431\u043a\u0430 `EmptyInputError: Received no input for __start__` \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442 \u0433\u0438\u043f\u043e\u0442\u0435\u0437\u044b K \u0438 M.**\n\n\u0412\u0430\u0448 \u043a\u043e\u0434 \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0433\u0440\u0430\u0444\u0430 \u0441 \u0441\u0430\u043c\u043e\u0433\u043e \u043d\u0430\u0447\u0430\u043b\u0430 (`__start__`), \u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u044f `None` \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0432\u0445\u043e\u0434\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445. LangGraph \u0441\u043f\u0440\u0430\u0432\u0435\u0434\u043b\u0438\u0432\u043e \u0441\u0447\u0438\u0442\u0430\u0435\u0442 \u044d\u0442\u043e \u043e\u0448\u0438\u0431\u043a\u043e\u0439: \u0435\u0441\u043b\u0438 \u043c\u044b \u043d\u0430\u0445\u043e\u0434\u0438\u043c\u0441\u044f \u043d\u0430 \u00ab\u0441\u0442\u0430\u0440\u0442\u0435\u00bb, \u043c\u044b \u043e\u0431\u044f\u0437\u0430\u043d\u044b \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u043b\u044f \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u043a\u0430\u043d\u0430\u043b\u043e\u0432 \u0441\u0442\u0435\u0439\u0442\u0430.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442:\n\n\u0412 \u043c\u0435\u0442\u043e\u0434\u0435 `ainvoke_from_checkpoint` (\u0444\u0430\u0439\u043b `memory_manager.py`) \u043b\u043e\u0433\u0438\u043a\u0430 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0430\u0433\u0440\u0435\u0441\u0441\u0438\u0432\u043d\u043e:\n\n```python\nif checkpoint_id:\n    # ... \u043b\u043e\u0433\u0438\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430 ...\n    next_nodes = getattr(snapshot, \"next\", None)\n    \n    if isinstance(next_nodes, Sequence) and next_nodes:\n        # \u041f\u0420\u041e\u0411\u041b\u0415\u041c\u0410: \u0415\u0441\u043b\u0438 \u0432 next_nodes \u0442\u043e\u043b\u044c\u043a\u043e \"__start__\", \n        # \u0432\u044b \u0432\u0441\u0451 \u0440\u0430\u0432\u043d\u043e \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0435 \u0441 graph_input=None\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=None, # <--- \u041f\u0420\u0418\u0427\u0418\u041d\u0410 \u041e\u0428\u0418\u0411\u041a\u0418\n            config=cfg,\n            # ...\n        )\n```\n\n\u0412 LangGraph \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u043d\u0430 \u0443\u0437\u043b\u0435 `__start__` \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u0441\u0440\u0430\u0437\u0443 \u043f\u043e\u0441\u043b\u0435 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u043d\u0438\u0442\u0438, \u043d\u043e **\u0434\u043e** \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u0448\u0430\u0433\u0430. \u041a\u043e\u0433\u0434\u0430 \u0432\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0435 `None`, LangGraph \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u043f\u0435\u0440\u0432\u044b\u0439 \u0443\u0437\u0435\u043b, \u043d\u043e \u043d\u0435 \u043d\u0430\u0445\u043e\u0434\u0438\u0442 \u0432 \u0441\u0442\u0435\u0439\u0442\u0435 \u043a\u043b\u044e\u0447\u0435\u0439, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u043b\u0438 \u043f\u0440\u0438\u0439\u0442\u0438 \u0438\u0437 \u0432\u0445\u043e\u0434\u043d\u043e\u0433\u043e \u0441\u043b\u043e\u0432\u0430\u0440\u044f.\n\n### \u041a\u0430\u043a \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c (\u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435):\n\n\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0443\u0441\u043b\u043e\u0432\u0438\u0435 \u0432 `memory_manager.py`. \u041c\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0442\u044c `None` \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435, \u0435\u0441\u043b\u0438 \u0433\u0440\u0430\u0444 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u00ab\u0432 \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u0435\u00bb \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f (\u0442.\u0435. `next_nodes` \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0440\u0430\u0431\u043e\u0447\u0438\u0435 \u0443\u0437\u043b\u044b, \u0430 \u043d\u0435 `__start__`).\n\n**\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u044b\u0439 \u0444\u0438\u043a\u0441 \u0432 `memory_manager.py`:**\n\n```python\n# \u041d\u0430\u0445\u043e\u0434\u0438\u043c \u043c\u0435\u0441\u0442\u043e, \u0433\u0434\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u044e\u0442\u0441\u044f next_nodes (~\u043b\u0438\u043d\u0438\u044f 508)\nnext_nodes_list = list(next_nodes) if isinstance(next_nodes, Sequence) else []\n\nif next_nodes_list:\n    # \u0415\u0441\u043b\u0438 \u043c\u044b \u043d\u0430 \u0441\u0430\u043c\u043e\u043c \u0441\u0442\u0430\u0440\u0442\u0435, \u043d\u0430\u043c \u041d\u0423\u0416\u0415\u041d \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0432\u0432\u043e\u0434\n    if next_nodes_list == [\"__start__\"]:\n        effective_input = graph_input\n    else:\n        # \u0415\u0441\u043b\u0438 \u043c\u044b \u0432 \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u0435 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043d\u0430 \u0440\u0430\u0431\u043e\u0447\u0435\u043c \u0443\u0437\u043b\u0435), \u0432\u0432\u043e\u0434 \u0443\u0436\u0435 \u0432 \u0441\u0442\u0435\u0439\u0442\u0435\n        effective_input = None\n\n    return await self.ainvoke_with_durability(\n        graph=graph,\n        graph_input=effective_input,\n        config=cfg,\n        context=context,\n        durability=durability,\n        local_checkpointer=effective_local_checkpointer,\n    )\n```\n\n### \u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0431\u043e\u043d\u0443\u0441:\n\u042d\u0442\u043e\u0442 \u0444\u0438\u043a\u0441 \u0442\u0430\u043a\u0436\u0435 \u043f\u0440\u0435\u0434\u043e\u0442\u0432\u0440\u0430\u0442\u0438\u0442 \u0432\u043e\u0437\u043d\u0438\u043a\u043d\u043e\u0432\u0435\u043d\u0438\u0435 `CancelledError` \u0438\u0437 \u0421\u0446\u0435\u043d\u0430\u0440\u0438\u044f 1, \u043e \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043c\u044b \u0433\u043e\u0432\u043e\u0440\u0438\u043b\u0438 \u0440\u0430\u043d\u0435\u0435. \u0422\u0435\u043f\u0435\u0440\u044c \u0437\u0430\u0434\u0430\u0447\u0430 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u00ab\u0437\u0430\u0432\u0438\u0441\u0430\u0442\u044c\u00bb \u0432 \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u0438 \u0432\u0432\u043e\u0434\u0430 \u0438\u043b\u0438 \u043f\u0430\u0434\u0430\u0442\u044c \u0441 \u043e\u0448\u0438\u0431\u043a\u043e\u0439 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438, \u0447\u0442\u043e \u043f\u043e\u0437\u0432\u043e\u043b\u0438\u0442 \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u0435\u0442\u043b\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0441\u0442\u0430\u0431\u0438\u043b\u044c\u043d\u043e.\n\n**\u0418\u0442\u043e\u0433:** `EmptyInputError` \u2014 \u044d\u0442\u043e \u00ab\u043a\u0443\u0440\u044f\u0449\u0438\u0439\u0441\u044f \u043f\u0438\u0441\u0442\u043e\u043b\u0435\u0442\u00bb, \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u044e\u0449\u0438\u0439, \u0447\u0442\u043e \u0432\u0430\u0448\u0430 \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0441\u0447\u0438\u0442\u0430\u0435\u0442 \u043d\u0430\u0447\u0430\u043b\u043e \u0433\u0440\u0430\u0444\u0430 \u0435\u0433\u043e \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u043e\u0439. \u0418\u0441\u043f\u0440\u0430\u0432\u044c\u0442\u0435 \u0432\u044b\u0431\u043e\u0440 `effective_input`, \u0438 \u043e\u0448\u0438\u0431\u043a\u0430 \u0438\u0441\u0447\u0435\u0437\u043d\u0435\u0442.\n\n**Relevant docs:**\n- [Time Travel: Resume with input=None](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)\n- [LangGraph Persistence (Checkpoints)](https://docs.langchain.com/oss/python/langgraph/persistence)\n- [Pregel Loop: Handling Inputs](https://docs.langchain.com/langsmith/use-threads#empty-thread)"
  },
  {
    "role": "user",
    "id": "e1a6bcbd-0be4-40f0-96da-15a036382689",
    "content": "\u0410 \u043f\u043e\u0447\u0435\u043c\u0443 \u043c\u044b \u043f\u0435\u0440\u0435\u0434\u0432\u0438\u0433\u0430\u0435\u043c \u043d\u0430 start ? \nfrom __future__ import annotations\n\nimport uuid\nimport os\nfrom datetime import datetime\nfrom typing import Any, Mapping, MutableMapping, Optional, Sequence, TypeAlias, Protocol, runtime_checkable, cast\n\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom langchain.embeddings import init_embeddings\nfrom shared.project_settings import ProjectSettings\n\ntry:\n    from pydantic_core import core_schema\nexcept ImportError:\n    core_schema = None  # type: ignore\n\ntry:\n    from langgraph.store.memory import InMemoryStore  # type: ignore\nexcept Exception:  # pragma: no cover\n    InMemoryStore = None  # type: ignore\n\n_CHECKPOINTER_SYNC: Optional[Any] = None\n_CHECKPOINTER_ASYNC: Optional[Any] = None\n_STORE: Optional[Any] = None\n\nThreadId: TypeAlias = str\nGraphId: TypeAlias = str\nCheckpointId: TypeAlias = str\nStateDict: TypeAlias = MutableMapping[str, Any]\n\n\n@runtime_checkable\nclass _SupportsGraphCheckpoint(Protocol):\n    \"\"\"Minimal protocol describing compiled LangGraph runnables we inspect for durability support.\"\"\"\n\n    checkpointer: Any | None\n    _pregel: Any | None\n    app: Any | None\n    name: str\n\n\nGraphRunnableWithPregel: TypeAlias = _SupportsGraphCheckpoint\n\n\ndef _extract_graph_checkpointer(graph: Any) -> Any:\n    \"\"\"Return the checkpointer bound directly to a compiled runnable, if any.\"\"\"\n\n    if graph is None:\n        return None\n\n    candidate = getattr(graph, \"checkpointer\", None)\n    if candidate is not None:\n        return candidate\n\n    pregel = getattr(graph, \"_pregel\", None)\n    if pregel is not None:\n        inner = getattr(pregel, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    app = getattr(graph, \"app\", None)\n    if app is not None:\n        inner = getattr(app, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    loop = getattr(graph, \"_loop\", None)\n    if loop is not None:\n        inner = getattr(loop, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    return None\n\n\ndef _graph_supports_durability(graph: Any) -> bool:\n    \"\"\"Return True if the runnable was compiled with a checkpointer.\"\"\"\n\n    return _extract_graph_checkpointer(graph) is not None\n\n\ndef _resolve_local_checkpointer(graph: Any, override: Optional[Any]) -> Optional[Any]:\n    \"\"\"Prefer explicit override, otherwise inspect the runnable for a bound saver.\"\"\"\n\n    if override is not None:\n        return override\n    return _extract_graph_checkpointer(graph)\n\n\ndef resolve_graph_checkpointer(*, async_mode: bool) -> Any:\n    \"\"\"Return a checkpointer compatible with the chosen execution mode.\n\n    Important:\n    - Async LangGraph execution expects async checkpointer methods. If only a\n      sync checkpointer is available (e.g., SqliteSaver), we fall back to the\n      async-safe InMemorySaver to keep `.ainvoke()` reliable.\n    - Production deployments can replace this with an async-capable durable\n      backend (Postgres/SQLite async) without touching graph code.\n    \"\"\"\n\n    global _CHECKPOINTER_SYNC, _CHECKPOINTER_ASYNC\n    CHECKPOINTER_DATABASE_URL = os.getenv(\"CHECKPOINTER_DATABASE_URL\")\n\n    # In production, LangGraph Platform injects the checkpointer automatically.\n    # We keep local checkpointers disabled to avoid shadowing the platform backend.\n    if ProjectSettings().mode == \"production\":\n        return None\n\n\n    if async_mode:\n        if _CHECKPOINTER_ASYNC is None:\n            _CHECKPOINTER_ASYNC = InMemorySaver()\n        return _CHECKPOINTER_ASYNC\n\n    if _CHECKPOINTER_SYNC is None:\n        _CHECKPOINTER_SYNC =  InMemorySaver()\n    return _CHECKPOINTER_SYNC\n\n\ndef resolve_graph_store() -> Any:\n    \"\"\"Return a store implementation for dev/tests; None in production/platform.\n\n    In production, LangGraph Platform injects the store automatically at runtime\n    (via ToolRuntime). We keep local stores disabled to avoid shadowing the\n    platform backend.\n    \"\"\"\n\n    global _STORE\n    if ProjectSettings().mode == \"production\":\n        return None\n    if InMemoryStore is None:\n        return None\n    if _STORE is not None:\n        return _STORE\n\n    # In development/tests we prefer an in-process store. Vector indexing is optional;\n    # if embeddings cannot be initialised (missing deps/keys), fall back to a plain store.\n    try:\n        _STORE = InMemoryStore(\n            index={\n                \"embed\": init_embeddings(\"openai:text-embedding-3-small\"),\n                \"dims\": 1536,\n                \"fields\": [\"content\"],\n            }\n        )\n    except Exception:\n        _STORE = InMemoryStore(index=None)\n    return _STORE\n\n\nclass GraphMemoryRuntime:\n    \"\"\"Encapsulates durable-checkpoint + long-memory access for dev and platform production.\n\n    This class centralizes:\n    - thread_id extraction\n    - platform SDK fallback for checkpoint state/history (no local checkpointer needed)\n    - local (dev) graph/checkpointer checkpoint inspection\n    \"\"\"\n    THREAD_ID_KEY: str = \"thread_id\"\n\n    @classmethod\n    def __get_pydantic_core_schema__(\n        cls,\n        source_type: Any,\n        handler: Any,\n    ) -> Any:\n        \"\"\"Provide Pydantic schema for GraphMemoryRuntime to allow arbitrary types.\n\n        This enables GraphMemoryRuntime to be used in Pydantic models (e.g., when\n        ContextTravelGuideAgent is used as context_schema in StateGraph).\n        \n        Since GraphMemoryRuntime is a runtime helper (not meant for serialization),\n        we use any_schema() to allow it without validation.\n        \"\"\"\n        if core_schema is None:\n            # pydantic_core should always be available in this project\n            raise ImportError(\"pydantic_core is required but not available\")\n        \n        # Use any_schema() to allow GraphMemoryRuntime without validation\n        # This is appropriate since it's a runtime helper with init=False\n        return core_schema.any_schema()\n\n    def __init__(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        # These are intentionally mutable bindings:\n        # - Root graph wiring binds the single checkpointer/store once per process/run.\n        # - Nested graphs MUST reuse the bound instance via runtime context.\n        self.checkpointer: Optional[Any] = checkpointer\n        self.store: Optional[Any] = store\n\n    def bind(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        \"\"\"Bind durable backends onto this runtime helper.\n\n        Idempotent by design: does not overwrite existing non-null bindings unless\n        explicitly provided.\n        \"\"\"\n\n        if checkpointer is not None:\n            self.checkpointer = checkpointer\n        if store is not None:\n            self.store = store\n\n    def is_production_mode(self) -> bool:\n        return ProjectSettings().mode == \"production\"\n\n    def ensure_thread_id(\n        self,\n        config: Optional[RunnableConfig],\n    ) -> tuple[RunnableConfig, ThreadId]:\n        \"\"\"Ensure ``configurable.thread_id`` exists and return ``(config, thread_id)``.\n\n        Contract (required by project checkpointing rules):\n        - One thread_id should be used for the *entire* root graph run.\n        - If caller did not provide a thread_id, we generate a new one from:\n          ``user_id`` (from RunnableConfig.configurable.user_id) + UUID4 suffix.\n        - Callers must reuse the returned config to keep the thread_id stable.\n        \"\"\"\n\n        from shared.config.long_memory import LongMemory\n\n        merged: RunnableConfig = dict(config) if config else {}\n        configurable = merged.get(\"configurable\", {})\n        if not isinstance(configurable, MutableMapping):\n            configurable = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable = dict(configurable)\n\n        existing = configurable.get(self.THREAD_ID_KEY)\n        if existing:\n            thread_id: ThreadId = str(existing)\n            configurable[self.THREAD_ID_KEY] = thread_id\n            merged[\"configurable\"] = configurable\n            return merged, thread_id\n\n        long_memory = LongMemory.from_runnable_config(merged)\n        user_id = long_memory.user_id\n        if not configurable.get(\"user_id\"):\n            configurable[\"user_id\"] = user_id\n\n        thread_id = f\"user_{user_id}_{uuid.uuid4().hex}\"\n        configurable[self.THREAD_ID_KEY] = thread_id\n        merged[\"configurable\"] = configurable\n        return merged, thread_id\n\n    async def list_thread_checkpoints(\n        self,\n        *,\n        config: RunnableConfig,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> list[Any]:\n        \"\"\"Return raw checkpoint records for the given thread config.\n\n        Notes:\n        - In production (LangGraph Platform), we fall back to the SDK thread history.\n        - In dev/tests, we prefer the provided ``local_checkpointer`` (or the default dev\n          checkpointer) to list checkpoints, because it exposes metadata (`graph_id`).\n        - As a last resort, we attempt to list state snapshots via ``graph.get_state_history``.\n        \"\"\"\n\n        thread_id = self.extract_thread_id(config)\n        if not thread_id:\n            return []\n\n        if self.is_production_mode():\n            try:\n                from langgraph_sdk import get_client  # type: ignore\n            except Exception:\n                return []\n            try:\n                client = get_client()\n                history = await client.threads.get_history(thread_id)\n                return list(history)\n            except Exception:\n                return []\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if checkpointer is not None:\n            lister = getattr(checkpointer, \"list\", None)\n            if callable(lister):\n                try:\n                    return list(lister(config))\n                except Exception:\n                    return []\n\n        if local_graph is not None:\n            getter_async = getattr(local_graph, \"aget_state_history\", None)\n            if callable(getter_async):\n                try:\n                    return [snapshot async for snapshot in getter_async(config)]\n                except Exception:\n                    return []\n            getter_sync = getattr(local_graph, \"get_state_history\", None)\n            if callable(getter_sync):\n                try:\n                    return list(getter_sync(config))\n                except Exception:\n                    return []\n\n        return []\n\n    @staticmethod\n    def _extract_checkpoint_metadata(record: Any) -> Mapping[str, Any]:\n        candidate = getattr(record, \"metadata\", None)\n        if isinstance(candidate, Mapping):\n            return cast(Mapping[str, Any], candidate)\n        if isinstance(record, Mapping):\n            meta = record.get(\"metadata\")\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            meta = getattr(checkpoint, \"metadata\", None)\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        return {}\n\n    @staticmethod\n    def _extract_checkpoint_id(record: Any) -> Optional[CheckpointId]:\n        candidate = getattr(record, \"checkpoint_id\", None)\n        if candidate:\n            return str(candidate)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            inner = getattr(checkpoint, \"checkpoint_id\", None)\n            if inner:\n                return str(inner)\n            inner = getattr(checkpoint, \"id\", None)\n            if inner:\n                return str(inner)\n        if isinstance(record, Mapping):\n            candidate = record.get(\"checkpoint_id\") or record.get(\"id\")\n            if candidate:\n                return str(candidate)\n            cfg = record.get(\"config\")\n            if isinstance(cfg, Mapping):\n                conf = cfg.get(\"configurable\")\n                if isinstance(conf, Mapping):\n                    candidate = conf.get(\"checkpoint_id\")\n                    if candidate:\n                        return str(candidate)\n        cfg = getattr(record, \"config\", None)\n        if isinstance(cfg, Mapping):\n            conf = cfg.get(\"configurable\")\n            if isinstance(conf, Mapping):\n                candidate = conf.get(\"checkpoint_id\")\n                if candidate:\n                    return str(candidate)\n        return None\n\n    @staticmethod\n    def _extract_created_at(record: Any) -> Optional[datetime]:\n        candidate = getattr(record, \"created_at\", None)\n        if isinstance(candidate, datetime):\n            return candidate\n        if isinstance(record, Mapping):\n            candidate = record.get(\"created_at\")\n            if isinstance(candidate, datetime):\n                return candidate\n        return None\n\n    @classmethod\n    def _matches_graph_id(cls, record: Any, graph_id: GraphId) -> bool:\n        metadata = cls._extract_checkpoint_metadata(record)\n        candidate = metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")\n        return str(candidate) == str(graph_id) if candidate else False\n\n    @staticmethod\n    def _extract_checkpoint_ns(record: Any) -> Optional[str]:\n        def _from_config(cfg: Any) -> Optional[str]:\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n                if isinstance(configurable, Mapping):\n                    candidate = configurable.get(\"checkpoint_ns\")\n                    if candidate is not None:\n                        return str(candidate)\n            return None\n\n        cfg = getattr(record, \"config\", None)\n        ns = _from_config(cfg)\n        if ns:\n            return ns\n\n        if isinstance(record, Mapping):\n            ns = _from_config(record.get(\"config\"))\n            if ns:\n                return ns\n\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            ns = _from_config(getattr(checkpoint, \"config\", None))\n            if ns:\n                return ns\n\n        metadata = GraphMemoryRuntime._extract_checkpoint_metadata(record)\n        checkpoint_ns = metadata.get(\"checkpoint_ns\")\n        return str(checkpoint_ns) if checkpoint_ns is not None else None\n\n    @staticmethod\n    def _normalize_config_like(config_like: Any) -> Optional[RunnableConfig]:\n        if config_like is None:\n            return None\n        if isinstance(config_like, Mapping):\n            normalized = dict(config_like)\n        else:\n            normalized = None\n            for attr in (\"model_dump\", \"dict\"):\n                dumper = getattr(config_like, attr, None)\n                if callable(dumper):\n                    try:\n                        normalized = dumper()\n                        break\n                    except Exception:\n                        normalized = None\n            if normalized is None:\n                try:\n                    normalized = dict(config_like)  # type: ignore[arg-type]\n                except Exception:\n                    return None\n\n        configurable = normalized.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            configurable = dict(configurable) if configurable is not None else {}\n        normalized[\"configurable\"] = dict(configurable)\n\n        metadata = normalized.get(\"metadata\", {})\n        if not isinstance(metadata, Mapping):\n            metadata = dict(metadata) if metadata is not None else {}\n        normalized[\"metadata\"] = dict(metadata)\n        return normalized  # type: ignore[return-value]\n\n    @classmethod\n    def _extract_task_entries(cls, record: Any) -> list[Mapping[str, Any]]:\n        extracted: list[Mapping[str, Any]] = []\n        visited_snapshots: set[int] = set()\n\n        def _coerce_metadata(value: Any) -> Optional[Mapping[str, Any]]:\n            if value is None:\n                return None\n            if isinstance(value, Mapping):\n                return value\n            try:\n                return dict(value)\n            except Exception:\n                return None\n\n        def _as_sequence(value: Any) -> Optional[Sequence[Any]]:\n            if isinstance(value, Sequence) and not isinstance(value, (str, bytes)):\n                return value\n            return None\n\n        def _record_entry(config_like: Any, metadata_like: Any, state_like: Any) -> None:\n            normalized_config = cls._normalize_config_like(config_like)\n            normalized_metadata = _coerce_metadata(metadata_like)\n            entry: dict[str, Any] = {}\n            if normalized_config:\n                entry[\"config\"] = normalized_config\n            if normalized_metadata:\n                entry[\"metadata\"] = normalized_metadata\n            if state_like is not None:\n                entry[\"state\"] = state_like\n            if entry:\n                extracted.append(entry)\n\n        def _visit_snapshot(snapshot: Any) -> None:\n            if snapshot is None:\n                return\n            snapshot_id = id(snapshot)\n            if snapshot_id in visited_snapshots:\n                return\n            visited_snapshots.add(snapshot_id)\n\n            tasks = None\n            if isinstance(snapshot, Mapping):\n                tasks = _as_sequence(snapshot.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(snapshot, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        def _visit_task(task: Any) -> None:\n            if task is None:\n                return\n            if isinstance(task, Mapping):\n                _record_entry(task.get(\"config\"), task.get(\"metadata\"), task.get(\"state\"))\n                nested_tasks = _as_sequence(task.get(\"tasks\"))\n                if nested_tasks:\n                    for nested in nested_tasks:\n                        _visit_task(nested)\n                _visit_snapshot(task.get(\"state\"))\n                _visit_snapshot(task.get(\"result\"))\n                return\n\n            _record_entry(\n                getattr(task, \"config\", None),\n                getattr(task, \"metadata\", None),\n                getattr(task, \"state\", None),\n            )\n            _visit_snapshot(getattr(task, \"state\", None))\n            _visit_snapshot(getattr(task, \"result\", None))\n            nested_attr = _as_sequence(getattr(task, \"tasks\", None))\n            if nested_attr:\n                for nested in nested_attr:\n                    _visit_task(nested)\n\n        for source in (record, getattr(record, \"checkpoint\", None)):\n            if source is None:\n                continue\n            _visit_snapshot(source)\n            tasks = None\n            if isinstance(source, Mapping):\n                tasks = _as_sequence(source.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(source, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        return extracted\n\n    async def find_latest_checkpoint_id(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Return the latest checkpoint_id for ``graph_id`` within the given thread.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n\n        # #region agent log\n        import json\n        record_summaries: list[dict[str, str | None]] = []\n        for idx, record in enumerate(checkpoints[:3]):\n            metadata = self._extract_checkpoint_metadata(record)\n            cfg = getattr(record, \"config\", None)\n            configurable = None\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n            checkpoint_ns = None\n            if isinstance(configurable, Mapping):\n                checkpoint_ns = str(configurable.get(\"checkpoint_ns\"))\n            record_summaries.append(\n                {\n                    \"idx\": str(idx),\n                    \"meta_graph_id\": str(metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")),\n                    \"checkpoint_id\": self._extract_checkpoint_id(record),\n                    \"checkpoint_ns\": checkpoint_ns,\n                }\n            )\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"B\",\"location\":\"memory_manager.py:395\",\"message\":\"find_latest_checkpoint_id checkpoints listed\",\"data\":{\"graph_id\":graph_id,\"thread_id\":str(config.get(\"configurable\",{}).get(\"thread_id\",\"\")), \"count\":len(checkpoints),\"records\":record_summaries},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if not checkpoints:\n            return None\n\n        # Collect matches with their timestamps (if provided by the backend).\n        matches: list[tuple[Optional[datetime], Any]] = []\n        for record in checkpoints:\n            if self._matches_graph_id(record, graph_id):\n                matches.append((self._extract_created_at(record), record))\n\n        target_checkpoint_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_checkpoint_ns = str(candidate_ns)\n\n        if not matches and target_checkpoint_ns:\n            for record in checkpoints:\n                if self._extract_checkpoint_ns(record) == target_checkpoint_ns:\n                    matches.append((self._extract_created_at(record), record))\n\n        if not matches:\n            return None\n\n        # If the backend provides created_at, prefer the most recent by timestamp.\n        if any(created_at is not None for created_at, _ in matches):\n            matches.sort(\n                key=lambda item: item[0] or datetime.min,\n                reverse=True,\n            )\n            return self._extract_checkpoint_id(matches[0][1])\n\n        # Otherwise, rely on the backend list order. InMemorySaver and Platform history\n        # return newest-first, so the first matching record is the latest.\n        return self._extract_checkpoint_id(matches[0][1])\n\n    async def _load_checkpoint_record(\n        self,\n        *,\n        config: RunnableConfig,\n        checkpoint_id: CheckpointId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[Any]:\n        \"\"\"Return the checkpoint record with the specified ID.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n        for record in checkpoints:\n            record_id = self._extract_checkpoint_id(record)\n            if record_id == checkpoint_id:\n                return record\n        return None\n\n    @staticmethod\n    def _materialize_checkpoint_values(\n        base_values: Mapping[str, Any],\n        record: Optional[Any],\n        *,\n        graph_id: Optional[str] = None,\n    ) -> tuple[Mapping[str, Any], bool]:\n        \"\"\"Merge stored writes from the checkpoint record into snapshot values.\"\"\"\n\n        if record is None:\n            return base_values, False\n\n        materialized: dict[str, Any] = dict(base_values)\n        writes_found = False\n\n        checkpoint_obj = getattr(record, \"checkpoint\", record)\n        writes = getattr(checkpoint_obj, \"writes\", None)\n        if writes is None and isinstance(checkpoint_obj, Mapping):\n            writes = checkpoint_obj.get(\"writes\")\n\n        # #region agent log\n        import json as _json_checkpoint_meta\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(\n                _json_checkpoint_meta.dumps(\n                    {\n                        \"sessionId\": \"debug-session\",\n                        \"runId\": \"pre-fix\",\n                        \"hypothesisId\": \"L\",\n                        \"location\": \"memory_manager.py:321\",\n                        \"message\": \"checkpoint record summary\",\n                        \"data\": {\n                            \"graph_id\": graph_id,\n                            \"record_type\": type(checkpoint_obj).__name__,\n                            \"has_attr_writes\": hasattr(checkpoint_obj, \"writes\"),\n                            \"writes_is_sequence\": isinstance(writes, Sequence),\n                            \"writes_is_mapping\": isinstance(writes, Mapping),\n                        },\n                        \"timestamp\": __import__(\"time\").time() * 1000,\n                    }\n                )\n                + \"\\n\"\n            )\n        # #endregion\n\n        summary: list[dict[str, Any]] = []\n\n        if isinstance(writes, Sequence):\n            for idx, write_entry in enumerate(writes):\n                node_name = None\n                write_payload = None\n                if isinstance(write_entry, Mapping):\n                    node_name = write_entry.get(\"node\") or write_entry.get(\"name\")\n                    candidate = write_entry.get(\"writes\") or write_entry.get(\"values\")\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n                else:\n                    node_name = getattr(write_entry, \"node\", None) or getattr(write_entry, \"name\", None)\n                    candidate = getattr(write_entry, \"writes\", None)\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n\n                if isinstance(write_payload, Mapping):\n                    for key, value in write_payload.items():\n                        materialized.setdefault(key, value)\n                    if idx < 3:\n                        summary.append(\n                            {\n                                \"node\": str(node_name),\n                                \"keys\": list(write_payload.keys()),\n                            }\n                        )\n                    writes_found = True\n\n        # #region agent log\n        if summary:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:324\",\n                            \"message\": \"checkpoint writes merged\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"writes\": summary,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        else:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:329\",\n                            \"message\": \"checkpoint writes unavailable\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"has_writes\": isinstance(writes, Sequence),\n                                \"writes_type\": None if writes is None else type(writes).__name__,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        # #endregion\n\n        return materialized, writes_found\n\n    @staticmethod\n    def _has_meaningful_values(values: Mapping[str, Any]) -> bool:\n        \"\"\"Return True if checkpoint values contain data beyond housekeeping fields.\"\"\"\n\n        if not values:\n            return False\n        significant_keys = set(values.keys()) - {\"messages\", \"remaining_steps\"}\n        return bool(significant_keys)\n\n    async def _find_subgraph_resume_config(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        checkpoints: Sequence[Any],\n    ) -> Optional[tuple[RunnableConfig, Any]]:\n        target_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_ns = str(candidate_ns)\n\n        for record_idx, record in enumerate(checkpoints):\n            task_entries = self._extract_task_entries(record)\n            if not task_entries:\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:562\",\"message\":\"checkpoint missing task entries\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"parent_checkpoint_id\":self._extract_checkpoint_id(record)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n                continue\n            for task_idx, task in enumerate(task_entries[:2]):\n                task_metadata = task.get(\"metadata\")\n                normalized_metadata: Mapping[str, Any] = {}\n                if isinstance(task_metadata, Mapping):\n                    normalized_metadata = task_metadata\n                task_graph_id = normalized_metadata.get(\"graph_id\") or normalized_metadata.get(\"langgraph_graph_id\")\n\n                raw_config = task.get(\"config\")\n                normalized_config = self._normalize_config_like(raw_config)\n                if not normalized_config:\n                    continue\n                task_configurable = normalized_config.get(\"configurable\", {})\n                task_ns = None\n                if isinstance(task_configurable, Mapping):\n                    candidate = task_configurable.get(\"checkpoint_ns\")\n                    if candidate:\n                        task_ns = str(candidate)\n\n                ns_matches = target_ns and task_ns == target_ns\n                graph_matches = task_graph_id and str(task_graph_id) == str(graph_id)\n\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:581\",\"message\":\"task entry inspected\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"task_index\":task_idx,\"task_graph_id\":task_graph_id,\"task_ns\":task_ns},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n\n                if graph_matches or ns_matches:\n                    resume_state = task.get(\"state\")\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            json.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"D\",\n                                    \"location\": \"memory_manager.py:520\",\n                                    \"message\": \"subgraph resume config located\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"matched_ns\": task_ns,\n                                        \"matched_graph_id\": task_graph_id,\n                                        \"parent_checkpoint_id\": self._extract_checkpoint_id(record),\n                                        \"has_state\": resume_state is not None,\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return normalized_config, resume_state\n\n        return None\n\n    async def _get_graph_snapshot(\n        self,\n        *,\n        graph: Any,\n        cfg: RunnableConfig,\n        subgraphs: bool = False,\n    ) -> Any:\n        getter_async = getattr(graph, \"aget_state\", None)\n        params = {\"subgraphs\": True} if subgraphs else {}\n        try:\n            if callable(getter_async):\n                return await getter_async(cfg, **params)\n        except TypeError:\n            # Fallback for LangGraph versions that don't support subgraphs kwarg.\n            try:\n                return await getter_async(cfg)\n            except Exception:\n                pass\n        except Exception:\n            pass\n\n        getter_sync = getattr(graph, \"get_state\", None)\n        if callable(getter_sync):\n            try:\n                return getter_sync(cfg, **params)\n            except TypeError:\n                try:\n                    return getter_sync(cfg)\n                except Exception:\n                    return None\n            except Exception:\n                return None\n        return None\n\n    async def ainvoke_from_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str = \"sync\",\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph resuming from the latest checkpoint when available.\"\"\"\n\n        merged, _ = self.ensure_thread_id(config)\n        # SAFETY: Ignore any caller-supplied checkpoint_id.\n        #\n        # In this architecture, checkpoint selection is *graph_id-scoped* and managed\n        # exclusively by this runtime helper. Allowing external checkpoint_id values\n        # could cause cross-graph leakage within a shared thread_id.\n\n        merged_conf = merged.get(\"configurable\", {})\n        if isinstance(merged_conf, Mapping):\n            merged_conf_dict = dict(merged_conf)\n            merged_conf_dict.pop(\"checkpoint_id\", None)\n            original_ns = merged_conf_dict.get(\"checkpoint_ns\", \"\")\n            merged_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            merged[\"configurable\"] = merged_conf_dict\n            \n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"E\",\"location\":\"memory_manager.py:445\",\"message\":\"ainvoke_from_checkpoint setting checkpoint_ns\",\"data\":{\"graph_id\":graph_id,\"original_ns\":str(original_ns),\"new_ns\":str(merged_conf_dict.get(\"checkpoint_ns\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n        # Ensure the checkpoint records are scoping-friendly in LangGraph v1.\n        meta = merged.get(\"metadata\")\n        if not isinstance(meta, Mapping):\n            meta = {}\n        meta_dict = dict(meta)\n        meta_dict.setdefault(\"graph_id\", str(graph_id))\n        merged[\"metadata\"] = meta_dict\n\n        effective_local_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n\n        # #region agent log\n        import json\n        final_ns = merged.get(\"configurable\", {}).get(\"checkpoint_ns\", \"\")\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:458\",\"message\":\"ainvoke_from_checkpoint calling find_latest_checkpoint_id\",\"data\":{\"graph_id\":graph_id,\"checkpoint_ns\":str(final_ns),\"thread_id\":str(merged.get(\"configurable\",{}).get(\"thread_id\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=effective_local_checkpointer,\n            local_graph=graph,\n        )\n        checkpoint_record: Optional[Any] = None\n        subgraph_resume: Optional[tuple[RunnableConfig, Any]] = None\n        if checkpoint_id is None:\n            snapshot_sources: list[Any] = []\n\n            if context is not None:\n                runner = getattr(context, \"graph_runner\", None)\n                graph_runtime = getattr(runner, \"graph\", None)\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:711\",\"message\":\"parent context inspection\",\"data\":{\"graph_id\":graph_id,\"has_context\":True,\"has_runner\":runner is not None,\"has_graph\":graph_runtime is not None},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n                if graph_runtime is not None:\n                    try:\n                        parent_snapshot = await self._get_graph_snapshot(\n                            graph=graph_runtime,\n                            cfg=merged,\n                            subgraphs=True,\n                        )\n                        if parent_snapshot is not None:\n                            snapshot_sources.append(parent_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:715\",\"message\":\"parent snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":parent_snapshot is not None,\"has_tasks\":bool(getattr(parent_snapshot,\"tasks\",None)),\"has_next\":bool(getattr(parent_snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                    except Exception:\n                        parent_snapshot = None\n                else:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:724\",\"message\":\"parent snapshot skipped\",\"data\":{\"graph_id\":graph_id,\"reason\":\"graph_runner_missing\" if runner is None else \"graph_attr_missing\"},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:729\",\"message\":\"parent context absent\",\"data\":{\"graph_id\":graph_id},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n\n            root_graph = getattr(context, \"root_graph\", None) if context is not None else None\n            if root_graph is not None:\n                try:\n                    root_snapshot = await self._get_graph_snapshot(\n                        graph=root_graph,\n                        cfg=merged,\n                        subgraphs=True,\n                    )\n                    if root_snapshot is not None:\n                        snapshot_sources.append(root_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:738\",\"message\":\"root snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":root_snapshot is not None,\"has_tasks\":bool(getattr(root_snapshot,\"tasks\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                except Exception:\n                    root_snapshot = None\n\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=merged,\n                subgraphs=True,\n            )\n            if snapshot is not None:\n                snapshot_sources.append(snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:727\",\"message\":\"assistant snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":bool(getattr(snapshot,\"tasks\",None)),\"has_next\":bool(getattr(snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            checkpoints_snapshot = await self.list_thread_checkpoints(\n                config=merged,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n            snapshot_sources.extend(checkpoints_snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:734\",\"message\":\"thread checkpoints snapshot collected\",\"data\":{\"graph_id\":graph_id,\"count\":len(checkpoints_snapshot)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            subgraph_resume = await self._find_subgraph_resume_config(\n                config=merged,\n                graph_id=graph_id,\n                checkpoints=snapshot_sources,\n            )\n            if subgraph_resume is not None:\n                resume_config, _ = subgraph_resume\n                metadata = resume_config.get(\"metadata\", {})\n                if not isinstance(metadata, Mapping):\n                    metadata = dict(metadata) if metadata is not None else {}\n                metadata = dict(metadata)\n                metadata.setdefault(\"graph_id\", str(graph_id))\n                resume_config[\"metadata\"] = metadata  # type: ignore[index]\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:743\",\"message\":\"subgraph resume config missing\",\"data\":{\"graph_id\":graph_id,\"snapshot_sources\":len(snapshot_sources)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n        \n        # #region agent log\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:464\",\"message\":\"ainvoke_from_checkpoint checkpoint_id result\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":str(checkpoint_id) if checkpoint_id else None,\"checkpoint_ns\":str(final_ns)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if checkpoint_id:\n            checkpoint_record = await self._load_checkpoint_record(\n                config=merged,\n                checkpoint_id=checkpoint_id,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n\n            cfg: RunnableConfig = dict(merged)\n            configurable = cfg.get(\"configurable\", {})\n            configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n            configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n            configurable_dict[\"checkpoint_id\"] = checkpoint_id\n            cfg[\"configurable\"] = configurable_dict\n\n            # If the checkpoint represents an in-progress run (has pending `next`),\n            # we resume via `invoke(None, checkpoint_id=...)`. If the run is already\n            # complete (no pending next nodes), we \"restart\" from the persisted\n            # snapshot values as a fresh invocation. This is the required behavior\n            # for refinement: patch values \u2192 re-run from patched state.\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=cfg,\n                subgraphs=True,\n            )\n\n            # #region agent log\n            import json\n            snapshot_has_tasks = bool(getattr(snapshot, \"tasks\", None))\n            snapshot_next = getattr(snapshot, \"next\", None)\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"C\",\"location\":\"memory_manager.py:504\",\"message\":\"ainvoke_from_checkpoint snapshot inspection\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":checkpoint_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":snapshot_has_tasks,\"pending_next\":bool(snapshot_next)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            next_nodes = getattr(snapshot, \"next\", None)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(next_nodes, Sequence) and next_nodes:\n                # #region agent log\n                import json as _json_resume_next\n                next_preview = list(next_nodes)[:3]\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(\n                        _json_resume_next.dumps(\n                            {\n                                \"sessionId\": \"debug-session\",\n                                \"runId\": \"pre-fix\",\n                                \"hypothesisId\": \"K\",\n                                \"location\": \"memory_manager.py:509\",\n                                \"message\": \"resuming graph from checkpoint pending next\",\n                                \"data\": {\n                                    \"graph_id\": graph_id,\n                                    \"next_nodes\": next_preview,\n                                    \"graph_input_is_none\": graph_input is None,\n                                },\n                                \"timestamp\": __import__(\"time\").time() * 1000,\n                            }\n                        )\n                        + \"\\n\"\n                    )\n                # #endregion\n                return await self.ainvoke_with_durability(\n                    graph=graph,\n                    graph_input=None,\n                    config=cfg,\n                    context=context,\n                    durability=durability,\n                    local_checkpointer=effective_local_checkpointer,\n                )\n\n            # IMPORTANT:\n            # If the checkpoint is COMPLETE (no pending next nodes), we DO NOT attempt to\n            # \"restart\" the graph by invoking without checkpoint_id. In a shared thread_id\n            # architecture (multiple graphs in the same thread), dropping checkpoint_id\n            # would cause LangGraph to load the latest checkpoint for the thread+ns,\n            # which may belong to a different graph_id \u2192 cross-graph contamination.\n            #\n            # Callers that need to re-run a completed checkpoint should first \"arm\" it\n            # via `graph.update_state(..., as_node=\"__start__\")` (e.g., our refinement\n            # injection path does this), which produces a checkpoint with pending next nodes.\n            if isinstance(values, Mapping):\n                materialized_values, writes_found = self._materialize_checkpoint_values(\n                    values,\n                    checkpoint_record,\n                    graph_id=str(graph_id),\n                )\n                if writes_found or self._has_meaningful_values(materialized_values):\n                    # #region agent log\n                    import json as _json_resume\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            _json_resume.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"J\",\n                                    \"location\": \"memory_manager.py:944\",\n                                    \"message\": \"returning checkpoint values\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"keys\": list(materialized_values.keys()),\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return dict(materialized_values)\n\n                # Values are incomplete (e.g., only messages). Fallback to fresh invoke.\n                rerun_cfg: RunnableConfig = dict(merged)\n                rerun_conf = rerun_cfg.get(\"configurable\", {})\n                if isinstance(rerun_conf, Mapping):\n                    rerun_conf_dict = dict(rerun_conf)\n                    rerun_conf_dict.pop(\"checkpoint_id\", None)\n                    rerun_conf_dict.setdefault(\"checkpoint_ns\", str(final_ns))\n                    rerun_cfg[\"configurable\"] = rerun_conf_dict\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=graph_input,\n                config=rerun_cfg,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        if subgraph_resume is not None:\n            # #region agent log\n            import json\n            resume_config, resume_state = subgraph_resume\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"D\",\n                            \"location\": \"memory_manager.py:610\",\n                            \"message\": \"resuming assistant via subgraph config\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"checkpoint_ns\": resume_config.get(\"configurable\", {}).get(\"checkpoint_ns\") if isinstance(resume_config.get(\"configurable\"), Mapping) else None,\n                                \"has_state\": resume_state is not None,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n            # #endregion\n            resume_input = graph_input\n            if resume_state is not None:\n                values = getattr(resume_state, \"values\", None)\n                if isinstance(values, Mapping):\n                    resume_input = dict(values)\n                elif isinstance(resume_state, Mapping):\n                    maybe_values = resume_state.get(\"values\")\n                    if isinstance(maybe_values, Mapping):\n                        resume_input = dict(maybe_values)\n                    else:\n                        resume_input = resume_state\n                else:\n                    resume_input = resume_state\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=resume_input,\n                config=resume_config,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        # SAFETY: Never allow a caller-supplied checkpoint_id to influence execution\n        # when we are NOT explicitly resuming from a checkpoint for this graph_id.\n        #\n        # Without this, a foreign checkpoint_id (from another graph_id in the same\n        # thread) could be accidentally consumed by LangGraph, violating isolation.\n        fresh_cfg: RunnableConfig = dict(merged)\n        fresh_conf = fresh_cfg.get(\"configurable\", {})\n        if isinstance(fresh_conf, Mapping):\n            fresh_conf_dict = dict(fresh_conf)\n            fresh_conf_dict.pop(\"checkpoint_id\", None)\n            # Keep checkpoint_ns stable (LangGraph may assume the key exists).\n            fresh_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            fresh_cfg[\"configurable\"] = fresh_conf_dict\n\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=graph_input,\n            config=fresh_cfg,\n            context=context,\n            durability=durability,\n            local_checkpointer=effective_local_checkpointer,\n        )\n\n    async def append_messages_to_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        new_messages: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Append messages to the latest checkpoint for ``graph_id`` and return new checkpoint id.\n\n        This uses ``graph.update_state`` / ``graph.aupdate_state`` so reducers (e.g. `add_messages`)\n        are honored. The update is applied as a fork of the latest checkpoint for ``graph_id``.\n        \"\"\"\n\n        if not new_messages:\n            return None\n\n        merged, _ = self.ensure_thread_id(config)\n        resolved_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n        latest_checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n        \n        if not latest_checkpoint_id:\n            return None\n        \n        patch_config: RunnableConfig = dict(merged)\n        configurable = patch_config.get(\"configurable\", {})\n        configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n        configurable_dict[\"checkpoint_id\"] = latest_checkpoint_id\n        patch_config[\"configurable\"] = configurable_dict\n\n        # Ensure patched checkpoints remain discoverable by metadata scoping.\n        metadata = patch_config.get(\"metadata\")\n        if not isinstance(metadata, Mapping):\n            metadata = {}\n        metadata_dict = dict[str, Any](metadata)\n        metadata_dict.setdefault(\"graph_id\", str(graph_id))\n        patch_config[\"metadata\"] = metadata_dict\n\n\n        # Best-effort idempotency: avoid appending messages already present in the checkpoint.\n        # This is critical for durable resume where refinement planning may be replayed.\n        filtered_messages: list[Any] = list(new_messages)\n        try:\n            snapshot = None\n            getter_async = getattr(graph, \"aget_state\", None)\n            if callable(getter_async):\n                snapshot = await getter_async(patch_config)\n            if snapshot is None:\n                getter_sync = getattr(graph, \"get_state\", None)\n                if callable(getter_sync):\n                    snapshot = getter_sync(patch_config)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(values, Mapping):\n                existing = values.get(\"messages\")\n                if isinstance(existing, Sequence) and not isinstance(existing, (str, bytes)):\n                    existing_contents: set[str] = set()\n                    for message in existing:\n                        content = getattr(message, \"content\", None)\n                        if content:\n                            existing_contents.add(str(content))\n                    if existing_contents:\n                        filtered_messages = [\n                            message\n                            for message in filtered_messages\n                            if str(getattr(message, \"content\", \"\")) not in existing_contents\n                        ]\n        except Exception:\n            filtered_messages = list(new_messages)\n\n        if not filtered_messages:\n            return latest_checkpoint_id\n\n        updates: dict[str, Any] = {\"messages\": filtered_messages}\n\n        updater_async = getattr(graph, \"aupdate_state\", None)\n        updater_sync = getattr(graph, \"update_state\", None)\n        resolved_as_node = as_node or \"__start__\"\n        try:\n            if callable(updater_async):\n                await updater_async(patch_config, updates, as_node=resolved_as_node)\n            elif callable(updater_sync):\n                updater_sync(patch_config, updates, as_node=resolved_as_node)\n            else:\n                return None\n        except Exception as e:\n            return None\n\n        return await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n\n    async def inject_distribution_refinement_messages(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        requests: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Patch a graph checkpoint by appending refinement instruction messages.\n\n        Mirrors the extraction rules used by `_distribution_inject_refinement_messages`:\n        each request may carry `payload.messages` items shaped like\n        `{ \"content\": \"...\", \"metadata\": {...} }`.\n        \"\"\"\n\n        try:\n            from langchain_core.messages import HumanMessage\n        except Exception:\n            return None\n\n        injected: list[Any] = []\n        seen_contents: set[str] = set()\n        for request in requests:\n            payload = getattr(request, \"payload\", None)\n            if not isinstance(payload, Mapping):\n                payload = payload if isinstance(payload, dict) else {}\n            messages_payload = payload.get(\"messages\") or []\n            if not isinstance(messages_payload, Sequence) or isinstance(\n                messages_payload, (str, bytes)\n            ):\n                continue\n            for message in messages_payload:\n                if not isinstance(message, Mapping):\n                    continue\n                content = message.get(\"content\")\n                if not content:\n                    continue\n                content_str = str(content)\n                if content_str in seen_contents:\n                    continue\n                metadata = message.get(\"metadata\") or {}\n                additional_kwargs = dict(metadata) if isinstance(metadata, Mapping) else {}\n                injected.append(\n                    HumanMessage(content=content_str, additional_kwargs=additional_kwargs)\n                )\n                seen_contents.add(content_str)\n\n        if not injected:\n            return None\n\n        return await self.append_messages_to_checkpoint(\n            graph=graph,\n            graph_id=graph_id,\n            config=config,\n            new_messages=injected,\n            as_node=as_node,\n            local_checkpointer=local_checkpointer,\n        )\n\n    @staticmethod\n    def extract_thread_id(config: Optional[RunnableConfig]) -> Optional[ThreadId]:\n        if not config:\n            return None\n        configurable = config.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            return None\n        thread_id = configurable.get(\"thread_id\")\n        return str(thread_id) if thread_id else None\n\n    async def aget_platform_thread_state(self, *, thread_id: ThreadId) -> Optional[Any]:\n        \"\"\"Get latest persisted state from platform via LangGraph SDK (if available).\"\"\"\n\n        try:\n            from langgraph_sdk import get_client  # type: ignore\n        except Exception:\n            return None\n\n        try:\n            client = get_client()\n            return await client.threads.get_state(thread_id)\n        except Exception:\n            return None\n\n\n    async def has_persisted_checkpoint(\n        self,\n        *,\n        config: Optional[RunnableConfig],\n        local_checkpointer: Optional[Any] = None,\n    ) -> bool:\n        \"\"\"Return True if a checkpoint exists for config (platform or local).\"\"\"\n\n        if config is None:\n            return False\n\n        if self.is_production_mode():\n            thread_id = self.extract_thread_id(config)\n            if not thread_id:\n                return False\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n            values = getattr(snapshot, \"values\", None)\n            return isinstance(values, Mapping)\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if not checkpointer:\n            return False\n\n        getter_async = getattr(checkpointer, \"aget_tuple\", None)\n        try:\n            if callable(getter_async):\n                checkpoint_tuple = await getter_async(config)\n            else:\n                getter_sync = getattr(checkpointer, \"get_tuple\", None)\n                if not callable(getter_sync):\n                    return False\n                checkpoint_tuple = getter_sync(config)\n        except Exception:\n            return False\n\n        return checkpoint_tuple is not None\n\n    async def restore_state_from_latest_checkpoint(\n        self,\n        *,\n        state: StateDict,\n        config: Optional[RunnableConfig],\n        local_graph: Optional[Any],\n    ) -> bool:\n        \"\"\"Merge latest persisted state into the caller-owned `state` mapping.\"\"\"\n\n        if config is None:\n            return False\n\n        snapshot = None\n        thread_id = self.extract_thread_id(config)\n        if self.is_production_mode() and thread_id:\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n\n        if snapshot is None and local_graph is not None:\n            getter = getattr(local_graph, \"aget_state\", None)\n            if callable(getter):\n                try:\n                    snapshot = await getter(config)\n                except Exception:\n                    snapshot = None\n            if snapshot is None:\n                getter_sync = getattr(local_graph, \"get_state\", None)\n                if callable(getter_sync):\n                    try:\n                        snapshot = getter_sync(config)\n                    except Exception:\n                        snapshot = None\n\n        values = getattr(snapshot, \"values\", None)\n        if not isinstance(values, Mapping):\n            return False\n\n        for key, value in values.items():\n            state[key] = value\n        return True\n\n    async def ainvoke_with_durability(\n        self,\n        *,\n        graph: Any,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph with durability when supported.\"\"\"\n\n        # In production mode, platform may inject durability backends automatically.\n        # In dev mode, only attempt durability when the runnable itself was compiled\n        # with a checkpointer so LangGraph sets up its AsyncPregel loop correctly.\n        graph_bound_checkpointer = _extract_graph_checkpointer(graph)\n        resolved_local_checkpointer = local_checkpointer or graph_bound_checkpointer\n        checkpointer = resolved_local_checkpointer or self.checkpointer\n\n        if self.is_production_mode():\n            use_durability = durability\n        else:\n            use_durability = durability if (checkpointer and _graph_supports_durability(graph)) else None\n        try:\n            if use_durability:\n                return await graph.ainvoke(\n                    graph_input,\n                    config=config,\n                    context=context,\n                    durability=use_durability,\n                )\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n        except (TypeError, AttributeError):\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n\n\n__all__ = [\n    \"resolve_graph_checkpointer\",\n    \"resolve_graph_store\",\n    \"GraphMemoryRuntime\",\n]"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3819-0772-75e0-8c74-aa2a246e7378",
    "content": "**\u041c\u044b \u00ab\u043f\u0435\u0440\u0435\u0434\u0432\u0438\u0433\u0430\u0435\u043c\u0441\u044f \u043d\u0430 `__start__`\u00bb, \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e LangGraph \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0432 \u043c\u043e\u043c\u0435\u043d\u0442 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u043d\u0438\u0442\u0438 (Thread), \u0435\u0449\u0435 \u0434\u043e \u0442\u043e\u0433\u043e, \u043a\u0430\u043a \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d \u043f\u0435\u0440\u0432\u044b\u0439 \u0444\u0443\u043d\u043a\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0443\u0437\u0435\u043b \u0433\u0440\u0430\u0444\u0430.**\n\n\u041a\u043e\u0433\u0434\u0430 \u0432\u044b \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0435 \u0432\u043e\u0440\u043a\u0435\u0440\u0430 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043f\u043e\u0441\u043b\u0435 \u0441\u0431\u043e\u044f \u0438\u043b\u0438 \u0432 \u0440\u0430\u043c\u043a\u0430\u0445 \u0446\u0438\u043a\u043b\u0430 \u0440\u0435\u0442\u0440\u0438\u0435\u0432), \u0432\u0430\u0448\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u044f `find_latest_checkpoint_id` \u043d\u0430\u0445\u043e\u0434\u0438\u0442 \u044d\u0442\u043e\u0442 \u0441\u0430\u043c\u044b\u0439 \u043f\u0435\u0440\u0432\u044b\u0439 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442. \u0414\u043b\u044f LangGraph \u044d\u0442\u043e\u0442 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442: \u00ab\u042f \u0433\u043e\u0442\u043e\u0432 \u043a \u0440\u0430\u0431\u043e\u0442\u0435, \u0432\u0445\u043e\u0434\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u044b, \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u0448\u0430\u0433\u043e\u043c \u044f \u0437\u0430\u043f\u0443\u0449\u0443 \u0443\u0437\u0435\u043b `__start__`\u00bb.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043b\u043e\u043c\u0430\u0435\u0442 \u043b\u043e\u0433\u0438\u043a\u0443 \u0441 `input=None`\n\n\u0412 LangGraph \u0435\u0441\u0442\u044c \u0434\u0432\u0430 \u0440\u0435\u0436\u0438\u043c\u0430 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f (`resume`):\n1.  **\u0412\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0438\u0437 \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u044b:** \u0415\u0441\u043b\u0438 \u0433\u0440\u0430\u0444 \u0443\u043f\u0430\u043b \u043d\u0430 \u0443\u0437\u043b\u0435 `Node_A`, \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0433\u043e\u0432\u043e\u0440\u0438\u0442: `next=[\"Node_A\"]`. \u0412 \u044d\u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u043d\u0443\u0436\u043d\u043e \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c `invoke(None)`, \u0442\u0430\u043a \u043a\u0430\u043a \u0434\u0430\u043d\u043d\u044b\u0435 \u0443\u0436\u0435 \u043b\u0435\u0436\u0430\u0442 \u0432 \u043a\u0430\u043d\u0430\u043b\u0430\u0445 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f.\n2.  **\u0412\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0441 \u0441\u0430\u043c\u043e\u0433\u043e \u043d\u0430\u0447\u0430\u043b\u0430:** \u0415\u0441\u043b\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0441\u043e\u0437\u0434\u0430\u043d \u0442\u043e\u043b\u044c\u043a\u043e \u0447\u0442\u043e, \u043e\u043d \u0433\u043e\u0432\u043e\u0440\u0438\u0442: `next=[\"__start__\"]`. \u041d\u0430 \u044d\u0442\u043e\u043c \u044d\u0442\u0430\u043f\u0435 \u043a\u0430\u043d\u0430\u043b\u044b \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0435\u0449\u0435 **\u043f\u0443\u0441\u0442\u044b\u0435**. \u0415\u0441\u043b\u0438 \u0432\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0434\u0438\u0442\u0435 `None`, \u0432\u043e\u0437\u043d\u0438\u043a\u043d\u0435\u0442 `EmptyInputError`, \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u0433\u0440\u0430\u0444\u0443 \u043d\u0435 \u0438\u0437 \u0447\u0435\u0433\u043e \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0442\u0435\u0439\u0442.\n\n### \u041a\u0430\u043a \u044d\u0442\u043e \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u0432 \u0432\u0430\u0448\u0438\u0445 \u043b\u043e\u0433\u0430\u0445\n\n\u0412\u0430\u0448 \u043b\u043e\u0433 `hypothesisId: \"C\"` (\u0438\u043d\u0441\u043f\u0435\u043a\u0446\u0438\u044f snapshot) \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442:\n`\"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true`\n\n\u0410 \u0437\u0430\u0442\u0435\u043c \u0432\u044b\u043b\u0435\u0442\u0430\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0430:\n`langgraph.errors.EmptyInputError: Received no input for __start__`\n\n\u042d\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u043f\u043e\u0442\u043e\u043c\u0443, \u0447\u0442\u043e \u0432 \u0441\u043f\u0438\u0441\u043a\u0435 `pending_next` \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0438\u043c\u0435\u043d\u043d\u043e \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0439 \u0443\u0437\u0435\u043b `__start__`, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 `graph_input`.\n\n### \u041e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u0432 `memory_manager.py`\n\n\u0412\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u043d\u0430\u0443\u0447\u0438\u0442\u044c `ainvoke_from_checkpoint` \u043e\u0442\u043b\u0438\u0447\u0430\u0442\u044c \u00ab\u0441\u0442\u0430\u0440\u0442\u00bb \u043e\u0442 \u00ab\u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430\u00bb. \u0418\u0437\u043c\u0435\u043d\u0438\u0442\u0435 \u043b\u043e\u0433\u0438\u043a\u0443 \u0432\u044b\u0431\u043e\u0440\u0430 `graph_input` \u0432 \u0444\u0430\u0439\u043b\u0435 `memory_manager.py` (\u043f\u0440\u0438\u043c\u0435\u0440\u043d\u043e \u043b\u0438\u043d\u0438\u044f 508):\n\n```python\n# \u0418\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u043c \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0445 \u0443\u0437\u043b\u043e\u0432\nnext_nodes = getattr(snapshot, \"next\", None)\nnext_nodes_list = list(next_nodes) if isinstance(next_nodes, Sequence) else []\n\nif next_nodes_list:\n    # \u041e\u0420\u0413\u0410\u041d\u0418\u0427\u041d\u042b\u0419 \u0424\u0418\u041a\u0421:\n    # \u0415\u0441\u043b\u0438 \u043c\u044b \u0441\u0442\u043e\u0438\u043c \u043d\u0430 \u0441\u0442\u0430\u0440\u0442\u0435, \u043d\u0430\u043c \u041d\u0423\u0416\u0415\u041d graph_input \u0434\u043b\u044f \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438.\n    # \u0415\u0441\u043b\u0438 \u043c\u044b \u0443\u0436\u0435 \u043f\u0440\u043e\u0448\u043b\u0438 \u0441\u0442\u0430\u0440\u0442, \u0448\u043b\u0435\u043c None, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c \u0438\u0437 \u0441\u0442\u0435\u0439\u0442\u0430.\n    is_at_start = next_nodes_list == [\"__start__\"]\n    effective_input = graph_input if is_at_start else None\n\n    return await self.ainvoke_with_durability(\n        graph=graph,\n        graph_input=effective_input, # <-- \u0422\u0435\u043f\u0435\u0440\u044c \u0437\u0434\u0435\u0441\u044c \u0431\u0443\u0434\u0435\u0442 \u043b\u0438\u0431\u043e \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b, \u043b\u0438\u0431\u043e None\n        config=cfg,\n        context=context,\n        durability=durability,\n        local_checkpointer=effective_local_checkpointer,\n    )\n```\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e:\n1.  **\u0423\u0441\u0442\u0440\u0430\u043d\u044f\u0435\u0442 `EmptyInputError`:** \u0413\u0440\u0430\u0444 \u043f\u043e\u043b\u0443\u0447\u0438\u0442 \u0441\u0432\u043e\u0438 \u0441\u0442\u0430\u0440\u0442\u043e\u0432\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435.\n2.  **\u0421\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 Durable Resume:** \u0415\u0441\u043b\u0438 \u0433\u0440\u0430\u0444 \u043f\u0440\u043e\u0448\u0435\u043b \u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u0438\u043d \u0440\u0435\u0430\u043b\u044c\u043d\u044b\u0439 \u0443\u0437\u0435\u043b, `next` \u0431\u0443\u0434\u0435\u0442 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0438\u043c\u044f \u044d\u0442\u043e\u0433\u043e \u0443\u0437\u043b\u0430 (\u043d\u0435 `__start__`), \u0441\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 `effective_input = None`, \u0438 LangGraph \u043f\u043e\u0434\u0445\u0432\u0430\u0442\u0438\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430.\n3.  **\u0418\u0434\u0435\u043c\u043f\u043e\u0442\u0435\u043d\u0442\u043d\u043e\u0441\u0442\u044c:** \u0414\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u0432\u044b \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0435 \u0441\u0442\u0430\u0440\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e, LangGraph \u043f\u0440\u043e\u0441\u0442\u043e \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0448\u0435\u0442 \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u0442\u0435\u0439\u0442 \u0442\u0435\u043c\u0438 \u0436\u0435 \u0434\u0430\u043d\u043d\u044b\u043c\u0438.\n\n**Relevant docs:**\n- [Time Travel: Resume with input=None](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)\n- [Persistence and Checkpoints](https://docs.langchain.com/oss/python/langgraph/persistence)\n- [LangGraph Errors: EmptyInputError](https://docs.langchain.com/langsmith/use-threads#empty-thread)"
  },
  {
    "role": "user",
    "id": "3cae9cc8-77b8-4096-8645-d4acaf7c62d0",
    "content": "from __future__ import annotations\n\nimport uuid\nimport os\nfrom datetime import datetime\nfrom typing import Any, Mapping, MutableMapping, Optional, Sequence, TypeAlias, Protocol, runtime_checkable, cast\n\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom langchain.embeddings import init_embeddings\nfrom shared.project_settings import ProjectSettings\n\ntry:\n    from pydantic_core import core_schema\nexcept ImportError:\n    core_schema = None  # type: ignore\n\ntry:\n    from langgraph.store.memory import InMemoryStore  # type: ignore\nexcept Exception:  # pragma: no cover\n    InMemoryStore = None  # type: ignore\n\n_CHECKPOINTER_SYNC: Optional[Any] = None\n_CHECKPOINTER_ASYNC: Optional[Any] = None\n_STORE: Optional[Any] = None\n\nThreadId: TypeAlias = str\nGraphId: TypeAlias = str\nCheckpointId: TypeAlias = str\nStateDict: TypeAlias = MutableMapping[str, Any]\n\n\n@runtime_checkable\nclass _SupportsGraphCheckpoint(Protocol):\n    \"\"\"Minimal protocol describing compiled LangGraph runnables we inspect for durability support.\"\"\"\n\n    checkpointer: Any | None\n    _pregel: Any | None\n    app: Any | None\n    name: str\n\n\nGraphRunnableWithPregel: TypeAlias = _SupportsGraphCheckpoint\n\n\ndef _extract_graph_checkpointer(graph: Any) -> Any:\n    \"\"\"Return the checkpointer bound directly to a compiled runnable, if any.\"\"\"\n\n    if graph is None:\n        return None\n\n    candidate = getattr(graph, \"checkpointer\", None)\n    if candidate is not None:\n        return candidate\n\n    pregel = getattr(graph, \"_pregel\", None)\n    if pregel is not None:\n        inner = getattr(pregel, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    app = getattr(graph, \"app\", None)\n    if app is not None:\n        inner = getattr(app, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    loop = getattr(graph, \"_loop\", None)\n    if loop is not None:\n        inner = getattr(loop, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    return None\n\n\ndef _graph_supports_durability(graph: Any) -> bool:\n    \"\"\"Return True if the runnable was compiled with a checkpointer.\"\"\"\n\n    return _extract_graph_checkpointer(graph) is not None\n\n\ndef _resolve_local_checkpointer(graph: Any, override: Optional[Any]) -> Optional[Any]:\n    \"\"\"Prefer explicit override, otherwise inspect the runnable for a bound saver.\"\"\"\n\n    if override is not None:\n        return override\n    return _extract_graph_checkpointer(graph)\n\n\ndef resolve_graph_checkpointer(*, async_mode: bool) -> Any:\n    \"\"\"Return a checkpointer compatible with the chosen execution mode.\n\n    Important:\n    - Async LangGraph execution expects async checkpointer methods. If only a\n      sync checkpointer is available (e.g., SqliteSaver), we fall back to the\n      async-safe InMemorySaver to keep `.ainvoke()` reliable.\n    - Production deployments can replace this with an async-capable durable\n      backend (Postgres/SQLite async) without touching graph code.\n    \"\"\"\n\n    global _CHECKPOINTER_SYNC, _CHECKPOINTER_ASYNC\n    CHECKPOINTER_DATABASE_URL = os.getenv(\"CHECKPOINTER_DATABASE_URL\")\n\n    # In production, LangGraph Platform injects the checkpointer automatically.\n    # We keep local checkpointers disabled to avoid shadowing the platform backend.\n    if ProjectSettings().mode == \"production\":\n        return None\n\n\n    if async_mode:\n        if _CHECKPOINTER_ASYNC is None:\n            _CHECKPOINTER_ASYNC = InMemorySaver()\n        return _CHECKPOINTER_ASYNC\n\n    if _CHECKPOINTER_SYNC is None:\n        _CHECKPOINTER_SYNC =  InMemorySaver()\n    return _CHECKPOINTER_SYNC\n\n\ndef resolve_graph_store() -> Any:\n    \"\"\"Return a store implementation for dev/tests; None in production/platform.\n\n    In production, LangGraph Platform injects the store automatically at runtime\n    (via ToolRuntime). We keep local stores disabled to avoid shadowing the\n    platform backend.\n    \"\"\"\n\n    global _STORE\n    if ProjectSettings().mode == \"production\":\n        return None\n    if InMemoryStore is None:\n        return None\n    if _STORE is not None:\n        return _STORE\n\n    # In development/tests we prefer an in-process store. Vector indexing is optional;\n    # if embeddings cannot be initialised (missing deps/keys), fall back to a plain store.\n    try:\n        _STORE = InMemoryStore(\n            index={\n                \"embed\": init_embeddings(\"openai:text-embedding-3-small\"),\n                \"dims\": 1536,\n                \"fields\": [\"content\"],\n            }\n        )\n    except Exception:\n        _STORE = InMemoryStore(index=None)\n    return _STORE\n\n\nclass GraphMemoryRuntime:\n    \"\"\"Encapsulates durable-checkpoint + long-memory access for dev and platform production.\n\n    This class centralizes:\n    - thread_id extraction\n    - platform SDK fallback for checkpoint state/history (no local checkpointer needed)\n    - local (dev) graph/checkpointer checkpoint inspection\n    \"\"\"\n    THREAD_ID_KEY: str = \"thread_id\"\n\n    @classmethod\n    def __get_pydantic_core_schema__(\n        cls,\n        source_type: Any,\n        handler: Any,\n    ) -> Any:\n        \"\"\"Provide Pydantic schema for GraphMemoryRuntime to allow arbitrary types.\n\n        This enables GraphMemoryRuntime to be used in Pydantic models (e.g., when\n        ContextTravelGuideAgent is used as context_schema in StateGraph).\n        \n        Since GraphMemoryRuntime is a runtime helper (not meant for serialization),\n        we use any_schema() to allow it without validation.\n        \"\"\"\n        if core_schema is None:\n            # pydantic_core should always be available in this project\n            raise ImportError(\"pydantic_core is required but not available\")\n        \n        # Use any_schema() to allow GraphMemoryRuntime without validation\n        # This is appropriate since it's a runtime helper with init=False\n        return core_schema.any_schema()\n\n    def __init__(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        # These are intentionally mutable bindings:\n        # - Root graph wiring binds the single checkpointer/store once per process/run.\n        # - Nested graphs MUST reuse the bound instance via runtime context.\n        self.checkpointer: Optional[Any] = checkpointer\n        self.store: Optional[Any] = store\n\n    def bind(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        \"\"\"Bind durable backends onto this runtime helper.\n\n        Idempotent by design: does not overwrite existing non-null bindings unless\n        explicitly provided.\n        \"\"\"\n\n        if checkpointer is not None:\n            self.checkpointer = checkpointer\n        if store is not None:\n            self.store = store\n\n    def is_production_mode(self) -> bool:\n        return ProjectSettings().mode == \"production\"\n\n    def ensure_thread_id(\n        self,\n        config: Optional[RunnableConfig],\n    ) -> tuple[RunnableConfig, ThreadId]:\n        \"\"\"Ensure ``configurable.thread_id`` exists and return ``(config, thread_id)``.\n\n        Contract (required by project checkpointing rules):\n        - One thread_id should be used for the *entire* root graph run.\n        - If caller did not provide a thread_id, we generate a new one from:\n          ``user_id`` (from RunnableConfig.configurable.user_id) + UUID4 suffix.\n        - Callers must reuse the returned config to keep the thread_id stable.\n        \"\"\"\n\n        from shared.config.long_memory import LongMemory\n\n        merged: RunnableConfig = dict(config) if config else {}\n        configurable = merged.get(\"configurable\", {})\n        if not isinstance(configurable, MutableMapping):\n            configurable = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable = dict(configurable)\n\n        existing = configurable.get(self.THREAD_ID_KEY)\n        if existing:\n            thread_id: ThreadId = str(existing)\n            configurable[self.THREAD_ID_KEY] = thread_id\n            merged[\"configurable\"] = configurable\n            return merged, thread_id\n\n        long_memory = LongMemory.from_runnable_config(merged)\n        user_id = long_memory.user_id\n        if not configurable.get(\"user_id\"):\n            configurable[\"user_id\"] = user_id\n\n        thread_id = f\"user_{user_id}_{uuid.uuid4().hex}\"\n        configurable[self.THREAD_ID_KEY] = thread_id\n        merged[\"configurable\"] = configurable\n        return merged, thread_id\n\n    async def list_thread_checkpoints(\n        self,\n        *,\n        config: RunnableConfig,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> list[Any]:\n        \"\"\"Return raw checkpoint records for the given thread config.\n\n        Notes:\n        - In production (LangGraph Platform), we fall back to the SDK thread history.\n        - In dev/tests, we prefer the provided ``local_checkpointer`` (or the default dev\n          checkpointer) to list checkpoints, because it exposes metadata (`graph_id`).\n        - As a last resort, we attempt to list state snapshots via ``graph.get_state_history``.\n        \"\"\"\n\n        thread_id = self.extract_thread_id(config)\n        if not thread_id:\n            return []\n\n        if self.is_production_mode():\n            try:\n                from langgraph_sdk import get_client  # type: ignore\n            except Exception:\n                return []\n            try:\n                client = get_client()\n                history = await client.threads.get_history(thread_id)\n                return list(history)\n            except Exception:\n                return []\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if checkpointer is not None:\n            lister = getattr(checkpointer, \"list\", None)\n            if callable(lister):\n                try:\n                    return list(lister(config))\n                except Exception:\n                    return []\n\n        if local_graph is not None:\n            getter_async = getattr(local_graph, \"aget_state_history\", None)\n            if callable(getter_async):\n                try:\n                    return [snapshot async for snapshot in getter_async(config)]\n                except Exception:\n                    return []\n            getter_sync = getattr(local_graph, \"get_state_history\", None)\n            if callable(getter_sync):\n                try:\n                    return list(getter_sync(config))\n                except Exception:\n                    return []\n\n        return []\n\n    @staticmethod\n    def _extract_checkpoint_metadata(record: Any) -> Mapping[str, Any]:\n        candidate = getattr(record, \"metadata\", None)\n        if isinstance(candidate, Mapping):\n            return cast(Mapping[str, Any], candidate)\n        if isinstance(record, Mapping):\n            meta = record.get(\"metadata\")\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            meta = getattr(checkpoint, \"metadata\", None)\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        return {}\n\n    @staticmethod\n    def _extract_checkpoint_id(record: Any) -> Optional[CheckpointId]:\n        candidate = getattr(record, \"checkpoint_id\", None)\n        if candidate:\n            return str(candidate)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            inner = getattr(checkpoint, \"checkpoint_id\", None)\n            if inner:\n                return str(inner)\n            inner = getattr(checkpoint, \"id\", None)\n            if inner:\n                return str(inner)\n        if isinstance(record, Mapping):\n            candidate = record.get(\"checkpoint_id\") or record.get(\"id\")\n            if candidate:\n                return str(candidate)\n            cfg = record.get(\"config\")\n            if isinstance(cfg, Mapping):\n                conf = cfg.get(\"configurable\")\n                if isinstance(conf, Mapping):\n                    candidate = conf.get(\"checkpoint_id\")\n                    if candidate:\n                        return str(candidate)\n        cfg = getattr(record, \"config\", None)\n        if isinstance(cfg, Mapping):\n            conf = cfg.get(\"configurable\")\n            if isinstance(conf, Mapping):\n                candidate = conf.get(\"checkpoint_id\")\n                if candidate:\n                    return str(candidate)\n        return None\n\n    @staticmethod\n    def _extract_created_at(record: Any) -> Optional[datetime]:\n        candidate = getattr(record, \"created_at\", None)\n        if isinstance(candidate, datetime):\n            return candidate\n        if isinstance(record, Mapping):\n            candidate = record.get(\"created_at\")\n            if isinstance(candidate, datetime):\n                return candidate\n        return None\n\n    @classmethod\n    def _matches_graph_id(cls, record: Any, graph_id: GraphId) -> bool:\n        metadata = cls._extract_checkpoint_metadata(record)\n        candidate = metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")\n        return str(candidate) == str(graph_id) if candidate else False\n\n    @staticmethod\n    def _extract_checkpoint_ns(record: Any) -> Optional[str]:\n        def _from_config(cfg: Any) -> Optional[str]:\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n                if isinstance(configurable, Mapping):\n                    candidate = configurable.get(\"checkpoint_ns\")\n                    if candidate is not None:\n                        return str(candidate)\n            return None\n\n        cfg = getattr(record, \"config\", None)\n        ns = _from_config(cfg)\n        if ns:\n            return ns\n\n        if isinstance(record, Mapping):\n            ns = _from_config(record.get(\"config\"))\n            if ns:\n                return ns\n\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            ns = _from_config(getattr(checkpoint, \"config\", None))\n            if ns:\n                return ns\n\n        metadata = GraphMemoryRuntime._extract_checkpoint_metadata(record)\n        checkpoint_ns = metadata.get(\"checkpoint_ns\")\n        return str(checkpoint_ns) if checkpoint_ns is not None else None\n\n    @staticmethod\n    def _normalize_config_like(config_like: Any) -> Optional[RunnableConfig]:\n        if config_like is None:\n            return None\n        if isinstance(config_like, Mapping):\n            normalized = dict(config_like)\n        else:\n            normalized = None\n            for attr in (\"model_dump\", \"dict\"):\n                dumper = getattr(config_like, attr, None)\n                if callable(dumper):\n                    try:\n                        normalized = dumper()\n                        break\n                    except Exception:\n                        normalized = None\n            if normalized is None:\n                try:\n                    normalized = dict(config_like)  # type: ignore[arg-type]\n                except Exception:\n                    return None\n\n        configurable = normalized.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            configurable = dict(configurable) if configurable is not None else {}\n        normalized[\"configurable\"] = dict(configurable)\n\n        metadata = normalized.get(\"metadata\", {})\n        if not isinstance(metadata, Mapping):\n            metadata = dict(metadata) if metadata is not None else {}\n        normalized[\"metadata\"] = dict(metadata)\n        return normalized  # type: ignore[return-value]\n\n    @classmethod\n    def _extract_task_entries(cls, record: Any) -> list[Mapping[str, Any]]:\n        extracted: list[Mapping[str, Any]] = []\n        visited_snapshots: set[int] = set()\n\n        def _coerce_metadata(value: Any) -> Optional[Mapping[str, Any]]:\n            if value is None:\n                return None\n            if isinstance(value, Mapping):\n                return value\n            try:\n                return dict(value)\n            except Exception:\n                return None\n\n        def _as_sequence(value: Any) -> Optional[Sequence[Any]]:\n            if isinstance(value, Sequence) and not isinstance(value, (str, bytes)):\n                return value\n            return None\n\n        def _record_entry(config_like: Any, metadata_like: Any, state_like: Any) -> None:\n            normalized_config = cls._normalize_config_like(config_like)\n            normalized_metadata = _coerce_metadata(metadata_like)\n            entry: dict[str, Any] = {}\n            if normalized_config:\n                entry[\"config\"] = normalized_config\n            if normalized_metadata:\n                entry[\"metadata\"] = normalized_metadata\n            if state_like is not None:\n                entry[\"state\"] = state_like\n            if entry:\n                extracted.append(entry)\n\n        def _visit_snapshot(snapshot: Any) -> None:\n            if snapshot is None:\n                return\n            snapshot_id = id(snapshot)\n            if snapshot_id in visited_snapshots:\n                return\n            visited_snapshots.add(snapshot_id)\n\n            tasks = None\n            if isinstance(snapshot, Mapping):\n                tasks = _as_sequence(snapshot.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(snapshot, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        def _visit_task(task: Any) -> None:\n            if task is None:\n                return\n            if isinstance(task, Mapping):\n                _record_entry(task.get(\"config\"), task.get(\"metadata\"), task.get(\"state\"))\n                nested_tasks = _as_sequence(task.get(\"tasks\"))\n                if nested_tasks:\n                    for nested in nested_tasks:\n                        _visit_task(nested)\n                _visit_snapshot(task.get(\"state\"))\n                _visit_snapshot(task.get(\"result\"))\n                return\n\n            _record_entry(\n                getattr(task, \"config\", None),\n                getattr(task, \"metadata\", None),\n                getattr(task, \"state\", None),\n            )\n            _visit_snapshot(getattr(task, \"state\", None))\n            _visit_snapshot(getattr(task, \"result\", None))\n            nested_attr = _as_sequence(getattr(task, \"tasks\", None))\n            if nested_attr:\n                for nested in nested_attr:\n                    _visit_task(nested)\n\n        for source in (record, getattr(record, \"checkpoint\", None)):\n            if source is None:\n                continue\n            _visit_snapshot(source)\n            tasks = None\n            if isinstance(source, Mapping):\n                tasks = _as_sequence(source.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(source, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        return extracted\n\n    async def find_latest_checkpoint_id(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Return the latest checkpoint_id for ``graph_id`` within the given thread.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n\n        # #region agent log\n        import json\n        record_summaries: list[dict[str, str | None]] = []\n        for idx, record in enumerate(checkpoints[:3]):\n            metadata = self._extract_checkpoint_metadata(record)\n            cfg = getattr(record, \"config\", None)\n            configurable = None\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n            checkpoint_ns = None\n            if isinstance(configurable, Mapping):\n                checkpoint_ns = str(configurable.get(\"checkpoint_ns\"))\n            record_summaries.append(\n                {\n                    \"idx\": str(idx),\n                    \"meta_graph_id\": str(metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")),\n                    \"checkpoint_id\": self._extract_checkpoint_id(record),\n                    \"checkpoint_ns\": checkpoint_ns,\n                }\n            )\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"B\",\"location\":\"memory_manager.py:395\",\"message\":\"find_latest_checkpoint_id checkpoints listed\",\"data\":{\"graph_id\":graph_id,\"thread_id\":str(config.get(\"configurable\",{}).get(\"thread_id\",\"\")), \"count\":len(checkpoints),\"records\":record_summaries},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if not checkpoints:\n            return None\n\n        # Collect matches with their timestamps (if provided by the backend).\n        matches: list[tuple[Optional[datetime], Any]] = []\n        for record in checkpoints:\n            if self._matches_graph_id(record, graph_id):\n                matches.append((self._extract_created_at(record), record))\n\n        target_checkpoint_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_checkpoint_ns = str(candidate_ns)\n\n        if not matches and target_checkpoint_ns:\n            for record in checkpoints:\n                if self._extract_checkpoint_ns(record) == target_checkpoint_ns:\n                    matches.append((self._extract_created_at(record), record))\n\n        if not matches:\n            return None\n\n        # If the backend provides created_at, prefer the most recent by timestamp.\n        if any(created_at is not None for created_at, _ in matches):\n            matches.sort(\n                key=lambda item: item[0] or datetime.min,\n                reverse=True,\n            )\n            return self._extract_checkpoint_id(matches[0][1])\n\n        # Otherwise, rely on the backend list order. InMemorySaver and Platform history\n        # return newest-first, so the first matching record is the latest.\n        return self._extract_checkpoint_id(matches[0][1])\n\n    async def _load_checkpoint_record(\n        self,\n        *,\n        config: RunnableConfig,\n        checkpoint_id: CheckpointId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[Any]:\n        \"\"\"Return the checkpoint record with the specified ID.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n        for record in checkpoints:\n            record_id = self._extract_checkpoint_id(record)\n            if record_id == checkpoint_id:\n                return record\n        return None\n\n    @staticmethod\n    def _materialize_checkpoint_values(\n        base_values: Mapping[str, Any],\n        record: Optional[Any],\n        *,\n        graph_id: Optional[str] = None,\n    ) -> tuple[Mapping[str, Any], bool]:\n        \"\"\"Merge stored writes from the checkpoint record into snapshot values.\"\"\"\n\n        if record is None:\n            return base_values, False\n\n        materialized: dict[str, Any] = dict(base_values)\n        writes_found = False\n\n        checkpoint_obj = getattr(record, \"checkpoint\", record)\n        writes = getattr(checkpoint_obj, \"writes\", None)\n        if writes is None and isinstance(checkpoint_obj, Mapping):\n            writes = checkpoint_obj.get(\"writes\")\n\n        # #region agent log\n        import json as _json_checkpoint_meta\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(\n                _json_checkpoint_meta.dumps(\n                    {\n                        \"sessionId\": \"debug-session\",\n                        \"runId\": \"pre-fix\",\n                        \"hypothesisId\": \"L\",\n                        \"location\": \"memory_manager.py:321\",\n                        \"message\": \"checkpoint record summary\",\n                        \"data\": {\n                            \"graph_id\": graph_id,\n                            \"record_type\": type(checkpoint_obj).__name__,\n                            \"has_attr_writes\": hasattr(checkpoint_obj, \"writes\"),\n                            \"writes_is_sequence\": isinstance(writes, Sequence),\n                            \"writes_is_mapping\": isinstance(writes, Mapping),\n                        },\n                        \"timestamp\": __import__(\"time\").time() * 1000,\n                    }\n                )\n                + \"\\n\"\n            )\n        # #endregion\n\n        summary: list[dict[str, Any]] = []\n\n        if isinstance(writes, Sequence):\n            for idx, write_entry in enumerate(writes):\n                node_name = None\n                write_payload = None\n                if isinstance(write_entry, Mapping):\n                    node_name = write_entry.get(\"node\") or write_entry.get(\"name\")\n                    candidate = write_entry.get(\"writes\") or write_entry.get(\"values\")\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n                else:\n                    node_name = getattr(write_entry, \"node\", None) or getattr(write_entry, \"name\", None)\n                    candidate = getattr(write_entry, \"writes\", None)\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n\n                if isinstance(write_payload, Mapping):\n                    for key, value in write_payload.items():\n                        materialized.setdefault(key, value)\n                    if idx < 3:\n                        summary.append(\n                            {\n                                \"node\": str(node_name),\n                                \"keys\": list(write_payload.keys()),\n                            }\n                        )\n                    writes_found = True\n\n        # #region agent log\n        if summary:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:324\",\n                            \"message\": \"checkpoint writes merged\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"writes\": summary,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        else:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:329\",\n                            \"message\": \"checkpoint writes unavailable\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"has_writes\": isinstance(writes, Sequence),\n                                \"writes_type\": None if writes is None else type(writes).__name__,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        # #endregion\n\n        return materialized, writes_found\n\n    @staticmethod\n    def _has_meaningful_values(values: Mapping[str, Any]) -> bool:\n        \"\"\"Return True if checkpoint values contain data beyond housekeeping fields.\"\"\"\n\n        if not values:\n            return False\n        significant_keys = set(values.keys()) - {\"messages\", \"remaining_steps\"}\n        return bool(significant_keys)\n\n    async def _find_subgraph_resume_config(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        checkpoints: Sequence[Any],\n    ) -> Optional[tuple[RunnableConfig, Any]]:\n        target_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_ns = str(candidate_ns)\n\n        for record_idx, record in enumerate(checkpoints):\n            task_entries = self._extract_task_entries(record)\n            if not task_entries:\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:562\",\"message\":\"checkpoint missing task entries\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"parent_checkpoint_id\":self._extract_checkpoint_id(record)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n                continue\n            for task_idx, task in enumerate(task_entries[:2]):\n                task_metadata = task.get(\"metadata\")\n                normalized_metadata: Mapping[str, Any] = {}\n                if isinstance(task_metadata, Mapping):\n                    normalized_metadata = task_metadata\n                task_graph_id = normalized_metadata.get(\"graph_id\") or normalized_metadata.get(\"langgraph_graph_id\")\n\n                raw_config = task.get(\"config\")\n                normalized_config = self._normalize_config_like(raw_config)\n                if not normalized_config:\n                    continue\n                task_configurable = normalized_config.get(\"configurable\", {})\n                task_ns = None\n                if isinstance(task_configurable, Mapping):\n                    candidate = task_configurable.get(\"checkpoint_ns\")\n                    if candidate:\n                        task_ns = str(candidate)\n\n                ns_matches = target_ns and task_ns == target_ns\n                graph_matches = task_graph_id and str(task_graph_id) == str(graph_id)\n\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:581\",\"message\":\"task entry inspected\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"task_index\":task_idx,\"task_graph_id\":task_graph_id,\"task_ns\":task_ns},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n\n                if graph_matches or ns_matches:\n                    resume_state = task.get(\"state\")\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            json.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"D\",\n                                    \"location\": \"memory_manager.py:520\",\n                                    \"message\": \"subgraph resume config located\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"matched_ns\": task_ns,\n                                        \"matched_graph_id\": task_graph_id,\n                                        \"parent_checkpoint_id\": self._extract_checkpoint_id(record),\n                                        \"has_state\": resume_state is not None,\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return normalized_config, resume_state\n\n        return None\n\n    async def _get_graph_snapshot(\n        self,\n        *,\n        graph: Any,\n        cfg: RunnableConfig,\n        subgraphs: bool = False,\n    ) -> Any:\n        getter_async = getattr(graph, \"aget_state\", None)\n        params = {\"subgraphs\": True} if subgraphs else {}\n        try:\n            if callable(getter_async):\n                return await getter_async(cfg, **params)\n        except TypeError:\n            # Fallback for LangGraph versions that don't support subgraphs kwarg.\n            try:\n                return await getter_async(cfg)\n            except Exception:\n                pass\n        except Exception:\n            pass\n\n        getter_sync = getattr(graph, \"get_state\", None)\n        if callable(getter_sync):\n            try:\n                return getter_sync(cfg, **params)\n            except TypeError:\n                try:\n                    return getter_sync(cfg)\n                except Exception:\n                    return None\n            except Exception:\n                return None\n        return None\n\n    async def ainvoke_from_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str = \"sync\",\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph resuming from the latest checkpoint when available.\"\"\"\n\n        merged, _ = self.ensure_thread_id(config)\n        # SAFETY: Ignore any caller-supplied checkpoint_id.\n        #\n        # In this architecture, checkpoint selection is *graph_id-scoped* and managed\n        # exclusively by this runtime helper. Allowing external checkpoint_id values\n        # could cause cross-graph leakage within a shared thread_id.\n\n        merged_conf = merged.get(\"configurable\", {})\n        if isinstance(merged_conf, Mapping):\n            merged_conf_dict = dict(merged_conf)\n            merged_conf_dict.pop(\"checkpoint_id\", None)\n            original_ns = merged_conf_dict.get(\"checkpoint_ns\", \"\")\n            merged_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            merged[\"configurable\"] = merged_conf_dict\n            \n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"E\",\"location\":\"memory_manager.py:445\",\"message\":\"ainvoke_from_checkpoint setting checkpoint_ns\",\"data\":{\"graph_id\":graph_id,\"original_ns\":str(original_ns),\"new_ns\":str(merged_conf_dict.get(\"checkpoint_ns\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n        # Ensure the checkpoint records are scoping-friendly in LangGraph v1.\n        meta = merged.get(\"metadata\")\n        if not isinstance(meta, Mapping):\n            meta = {}\n        meta_dict = dict(meta)\n        meta_dict.setdefault(\"graph_id\", str(graph_id))\n        merged[\"metadata\"] = meta_dict\n\n        effective_local_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n\n        # #region agent log\n        import json\n        final_ns = merged.get(\"configurable\", {}).get(\"checkpoint_ns\", \"\")\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:458\",\"message\":\"ainvoke_from_checkpoint calling find_latest_checkpoint_id\",\"data\":{\"graph_id\":graph_id,\"checkpoint_ns\":str(final_ns),\"thread_id\":str(merged.get(\"configurable\",{}).get(\"thread_id\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=effective_local_checkpointer,\n            local_graph=graph,\n        )\n        checkpoint_record: Optional[Any] = None\n        subgraph_resume: Optional[tuple[RunnableConfig, Any]] = None\n        if checkpoint_id is None:\n            snapshot_sources: list[Any] = []\n\n            if context is not None:\n                runner = getattr(context, \"graph_runner\", None)\n                graph_runtime = getattr(runner, \"graph\", None)\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:711\",\"message\":\"parent context inspection\",\"data\":{\"graph_id\":graph_id,\"has_context\":True,\"has_runner\":runner is not None,\"has_graph\":graph_runtime is not None},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n                if graph_runtime is not None:\n                    try:\n                        parent_snapshot = await self._get_graph_snapshot(\n                            graph=graph_runtime,\n                            cfg=merged,\n                            subgraphs=True,\n                        )\n                        if parent_snapshot is not None:\n                            snapshot_sources.append(parent_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:715\",\"message\":\"parent snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":parent_snapshot is not None,\"has_tasks\":bool(getattr(parent_snapshot,\"tasks\",None)),\"has_next\":bool(getattr(parent_snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                    except Exception:\n                        parent_snapshot = None\n                else:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:724\",\"message\":\"parent snapshot skipped\",\"data\":{\"graph_id\":graph_id,\"reason\":\"graph_runner_missing\" if runner is None else \"graph_attr_missing\"},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:729\",\"message\":\"parent context absent\",\"data\":{\"graph_id\":graph_id},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n\n            root_graph = getattr(context, \"root_graph\", None) if context is not None else None\n            if root_graph is not None:\n                try:\n                    root_snapshot = await self._get_graph_snapshot(\n                        graph=root_graph,\n                        cfg=merged,\n                        subgraphs=True,\n                    )\n                    if root_snapshot is not None:\n                        snapshot_sources.append(root_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:738\",\"message\":\"root snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":root_snapshot is not None,\"has_tasks\":bool(getattr(root_snapshot,\"tasks\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                except Exception:\n                    root_snapshot = None\n\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=merged,\n                subgraphs=True,\n            )\n            if snapshot is not None:\n                snapshot_sources.append(snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:727\",\"message\":\"assistant snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":bool(getattr(snapshot,\"tasks\",None)),\"has_next\":bool(getattr(snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            checkpoints_snapshot = await self.list_thread_checkpoints(\n                config=merged,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n            snapshot_sources.extend(checkpoints_snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:734\",\"message\":\"thread checkpoints snapshot collected\",\"data\":{\"graph_id\":graph_id,\"count\":len(checkpoints_snapshot)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            subgraph_resume = await self._find_subgraph_resume_config(\n                config=merged,\n                graph_id=graph_id,\n                checkpoints=snapshot_sources,\n            )\n            if subgraph_resume is not None:\n                resume_config, _ = subgraph_resume\n                metadata = resume_config.get(\"metadata\", {})\n                if not isinstance(metadata, Mapping):\n                    metadata = dict(metadata) if metadata is not None else {}\n                metadata = dict(metadata)\n                metadata.setdefault(\"graph_id\", str(graph_id))\n                resume_config[\"metadata\"] = metadata  # type: ignore[index]\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:743\",\"message\":\"subgraph resume config missing\",\"data\":{\"graph_id\":graph_id,\"snapshot_sources\":len(snapshot_sources)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n        \n        # #region agent log\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:464\",\"message\":\"ainvoke_from_checkpoint checkpoint_id result\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":str(checkpoint_id) if checkpoint_id else None,\"checkpoint_ns\":str(final_ns)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if checkpoint_id:\n            checkpoint_record = await self._load_checkpoint_record(\n                config=merged,\n                checkpoint_id=checkpoint_id,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n\n            cfg: RunnableConfig = dict(merged)\n            configurable = cfg.get(\"configurable\", {})\n            configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n            configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n            configurable_dict[\"checkpoint_id\"] = checkpoint_id\n            cfg[\"configurable\"] = configurable_dict\n\n            # If the checkpoint represents an in-progress run (has pending `next`),\n            # we resume via `invoke(None, checkpoint_id=...)`. If the run is already\n            # complete (no pending next nodes), we \"restart\" from the persisted\n            # snapshot values as a fresh invocation. This is the required behavior\n            # for refinement: patch values \u2192 re-run from patched state.\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=cfg,\n                subgraphs=True,\n            )\n\n            # #region agent log\n            import json\n            snapshot_has_tasks = bool(getattr(snapshot, \"tasks\", None))\n            snapshot_next = getattr(snapshot, \"next\", None)\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"C\",\"location\":\"memory_manager.py:504\",\"message\":\"ainvoke_from_checkpoint snapshot inspection\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":checkpoint_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":snapshot_has_tasks,\"pending_next\":bool(snapshot_next)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            next_nodes = getattr(snapshot, \"next\", None)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(next_nodes, Sequence) and next_nodes:\n                resume_graph_input = graph_input\n                # #region agent log\n                import json as _json_resume_next\n                next_preview = list(next_nodes)[:3]\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(\n                        _json_resume_next.dumps(\n                            {\n                                \"sessionId\": \"debug-session\",\n                                \"runId\": \"pre-fix\",\n                                \"hypothesisId\": \"K\",\n                                \"location\": \"memory_manager.py:509\",\n                                \"message\": \"resuming graph from checkpoint pending next\",\n                                \"data\": {\n                                    \"graph_id\": graph_id,\n                                    \"next_nodes\": next_preview,\n                                    \"graph_input_is_none\": graph_input is None,\n                                },\n                                \"timestamp\": __import__(\"time\").time() * 1000,\n                            }\n                        )\n                        + \"\\n\"\n                    )\n                # #endregion\n                return await self.ainvoke_with_durability(\n                    graph=graph,\n                    graph_input=resume_graph_input,\n                    config=cfg,\n                    context=context,\n                    durability=durability,\n                    local_checkpointer=effective_local_checkpointer,\n                )\n\n            # IMPORTANT:\n            # If the checkpoint is COMPLETE (no pending next nodes), we DO NOT attempt to\n            # \"restart\" the graph by invoking without checkpoint_id. In a shared thread_id\n            # architecture (multiple graphs in the same thread), dropping checkpoint_id\n            # would cause LangGraph to load the latest checkpoint for the thread+ns,\n            # which may belong to a different graph_id \u2192 cross-graph contamination.\n            #\n            # Callers that need to re-run a completed checkpoint should first \"arm\" it\n            # via `graph.update_state(..., as_node=\"__start__\")` (e.g., our refinement\n            # injection path does this), which produces a checkpoint with pending next nodes.\n            if isinstance(values, Mapping):\n                materialized_values, writes_found = self._materialize_checkpoint_values(\n                    values,\n                    checkpoint_record,\n                    graph_id=str(graph_id),\n                )\n                if writes_found or self._has_meaningful_values(materialized_values):\n                    # #region agent log\n                    import json as _json_resume\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            _json_resume.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"J\",\n                                    \"location\": \"memory_manager.py:944\",\n                                    \"message\": \"returning checkpoint values\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"keys\": list(materialized_values.keys()),\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return dict(materialized_values)\n\n                # Values are incomplete (e.g., only messages). Fallback to fresh invoke.\n                rerun_cfg: RunnableConfig = dict(merged)\n                rerun_conf = rerun_cfg.get(\"configurable\", {})\n                if isinstance(rerun_conf, Mapping):\n                    rerun_conf_dict = dict(rerun_conf)\n                    rerun_conf_dict.pop(\"checkpoint_id\", None)\n                    rerun_conf_dict.setdefault(\"checkpoint_ns\", str(final_ns))\n                    rerun_cfg[\"configurable\"] = rerun_conf_dict\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=graph_input,\n                config=rerun_cfg,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        if subgraph_resume is not None:\n            # #region agent log\n            import json\n            resume_config, resume_state = subgraph_resume\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"D\",\n                            \"location\": \"memory_manager.py:610\",\n                            \"message\": \"resuming assistant via subgraph config\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"checkpoint_ns\": resume_config.get(\"configurable\", {}).get(\"checkpoint_ns\") if isinstance(resume_config.get(\"configurable\"), Mapping) else None,\n                                \"has_state\": resume_state is not None,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n            # #endregion\n            resume_input = graph_input\n            if resume_state is not None:\n                values = getattr(resume_state, \"values\", None)\n                if isinstance(values, Mapping):\n                    resume_input = dict(values)\n                elif isinstance(resume_state, Mapping):\n                    maybe_values = resume_state.get(\"values\")\n                    if isinstance(maybe_values, Mapping):\n                        resume_input = dict(maybe_values)\n                    else:\n                        resume_input = resume_state\n                else:\n                    resume_input = resume_state\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=resume_input,\n                config=resume_config,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        # SAFETY: Never allow a caller-supplied checkpoint_id to influence execution\n        # when we are NOT explicitly resuming from a checkpoint for this graph_id.\n        #\n        # Without this, a foreign checkpoint_id (from another graph_id in the same\n        # thread) could be accidentally consumed by LangGraph, violating isolation.\n        fresh_cfg: RunnableConfig = dict(merged)\n        fresh_conf = fresh_cfg.get(\"configurable\", {})\n        if isinstance(fresh_conf, Mapping):\n            fresh_conf_dict = dict(fresh_conf)\n            fresh_conf_dict.pop(\"checkpoint_id\", None)\n            # Keep checkpoint_ns stable (LangGraph may assume the key exists).\n            fresh_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            fresh_cfg[\"configurable\"] = fresh_conf_dict\n\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=graph_input,\n            config=fresh_cfg,\n            context=context,\n            durability=durability,\n            local_checkpointer=effective_local_checkpointer,\n        )\n\n    async def append_messages_to_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        new_messages: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Append messages to the latest checkpoint for ``graph_id`` and return new checkpoint id.\n\n        This uses ``graph.update_state`` / ``graph.aupdate_state`` so reducers (e.g. `add_messages`)\n        are honored. The update is applied as a fork of the latest checkpoint for ``graph_id``.\n        \"\"\"\n\n        if not new_messages:\n            return None\n\n        merged, _ = self.ensure_thread_id(config)\n        resolved_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n        latest_checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n        \n        if not latest_checkpoint_id:\n            return None\n        \n        patch_config: RunnableConfig = dict(merged)\n        configurable = patch_config.get(\"configurable\", {})\n        configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n        configurable_dict[\"checkpoint_id\"] = latest_checkpoint_id\n        patch_config[\"configurable\"] = configurable_dict\n\n        # Ensure patched checkpoints remain discoverable by metadata scoping.\n        metadata = patch_config.get(\"metadata\")\n        if not isinstance(metadata, Mapping):\n            metadata = {}\n        metadata_dict = dict[str, Any](metadata)\n        metadata_dict.setdefault(\"graph_id\", str(graph_id))\n        patch_config[\"metadata\"] = metadata_dict\n\n\n        # Best-effort idempotency: avoid appending messages already present in the checkpoint.\n        # This is critical for durable resume where refinement planning may be replayed.\n        filtered_messages: list[Any] = list(new_messages)\n        try:\n            snapshot = None\n            getter_async = getattr(graph, \"aget_state\", None)\n            if callable(getter_async):\n                snapshot = await getter_async(patch_config)\n            if snapshot is None:\n                getter_sync = getattr(graph, \"get_state\", None)\n                if callable(getter_sync):\n                    snapshot = getter_sync(patch_config)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(values, Mapping):\n                existing = values.get(\"messages\")\n                if isinstance(existing, Sequence) and not isinstance(existing, (str, bytes)):\n                    existing_contents: set[str] = set()\n                    for message in existing:\n                        content = getattr(message, \"content\", None)\n                        if content:\n                            existing_contents.add(str(content))\n                    if existing_contents:\n                        filtered_messages = [\n                            message\n                            for message in filtered_messages\n                            if str(getattr(message, \"content\", \"\")) not in existing_contents\n                        ]\n        except Exception:\n            filtered_messages = list(new_messages)\n\n        if not filtered_messages:\n            return latest_checkpoint_id\n\n        updates: dict[str, Any] = {\"messages\": filtered_messages}\n\n        updater_async = getattr(graph, \"aupdate_state\", None)\n        updater_sync = getattr(graph, \"update_state\", None)\n        resolved_as_node = as_node or \"__start__\"\n        try:\n            if callable(updater_async):\n                await updater_async(patch_config, updates, as_node=resolved_as_node)\n            elif callable(updater_sync):\n                updater_sync(patch_config, updates, as_node=resolved_as_node)\n            else:\n                return None\n        except Exception as e:\n            return None\n\n        return await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n\n    async def inject_distribution_refinement_messages(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        requests: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Patch a graph checkpoint by appending refinement instruction messages.\n\n        Mirrors the extraction rules used by `_distribution_inject_refinement_messages`:\n        each request may carry `payload.messages` items shaped like\n        `{ \"content\": \"...\", \"metadata\": {...} }`.\n        \"\"\"\n\n        try:\n            from langchain_core.messages import HumanMessage\n        except Exception:\n            return None\n\n        injected: list[Any] = []\n        seen_contents: set[str] = set()\n        for request in requests:\n            payload = getattr(request, \"payload\", None)\n            if not isinstance(payload, Mapping):\n                payload = payload if isinstance(payload, dict) else {}\n            messages_payload = payload.get(\"messages\") or []\n            if not isinstance(messages_payload, Sequence) or isinstance(\n                messages_payload, (str, bytes)\n            ):\n                continue\n            for message in messages_payload:\n                if not isinstance(message, Mapping):\n                    continue\n                content = message.get(\"content\")\n                if not content:\n                    continue\n                content_str = str(content)\n                if content_str in seen_contents:\n                    continue\n                metadata = message.get(\"metadata\") or {}\n                additional_kwargs = dict(metadata) if isinstance(metadata, Mapping) else {}\n                injected.append(\n                    HumanMessage(content=content_str, additional_kwargs=additional_kwargs)\n                )\n                seen_contents.add(content_str)\n\n        if not injected:\n            return None\n\n        return await self.append_messages_to_checkpoint(\n            graph=graph,\n            graph_id=graph_id,\n            config=config,\n            new_messages=injected,\n            as_node=as_node,\n            local_checkpointer=local_checkpointer,\n        )\n\n    @staticmethod\n    def extract_thread_id(config: Optional[RunnableConfig]) -> Optional[ThreadId]:\n        if not config:\n            return None\n        configurable = config.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            return None\n        thread_id = configurable.get(\"thread_id\")\n        return str(thread_id) if thread_id else None\n\n    async def aget_platform_thread_state(self, *, thread_id: ThreadId) -> Optional[Any]:\n        \"\"\"Get latest persisted state from platform via LangGraph SDK (if available).\"\"\"\n\n        try:\n            from langgraph_sdk import get_client  # type: ignore\n        except Exception:\n            return None\n\n        try:\n            client = get_client()\n            return await client.threads.get_state(thread_id)\n        except Exception:\n            return None\n\n\n    async def has_persisted_checkpoint(\n        self,\n        *,\n        config: Optional[RunnableConfig],\n        local_checkpointer: Optional[Any] = None,\n    ) -> bool:\n        \"\"\"Return True if a checkpoint exists for config (platform or local).\"\"\"\n\n        if config is None:\n            return False\n\n        if self.is_production_mode():\n            thread_id = self.extract_thread_id(config)\n            if not thread_id:\n                return False\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n            values = getattr(snapshot, \"values\", None)\n            return isinstance(values, Mapping)\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if not checkpointer:\n            return False\n\n        getter_async = getattr(checkpointer, \"aget_tuple\", None)\n        try:\n            if callable(getter_async):\n                checkpoint_tuple = await getter_async(config)\n            else:\n                getter_sync = getattr(checkpointer, \"get_tuple\", None)\n                if not callable(getter_sync):\n                    return False\n                checkpoint_tuple = getter_sync(config)\n        except Exception:\n            return False\n\n        return checkpoint_tuple is not None\n\n    async def restore_state_from_latest_checkpoint(\n        self,\n        *,\n        state: StateDict,\n        config: Optional[RunnableConfig],\n        local_graph: Optional[Any],\n    ) -> bool:\n        \"\"\"Merge latest persisted state into the caller-owned `state` mapping.\"\"\"\n\n        if config is None:\n            return False\n\n        snapshot = None\n        thread_id = self.extract_thread_id(config)\n        if self.is_production_mode() and thread_id:\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n\n        if snapshot is None and local_graph is not None:\n            getter = getattr(local_graph, \"aget_state\", None)\n            if callable(getter):\n                try:\n                    snapshot = await getter(config)\n                except Exception:\n                    snapshot = None\n            if snapshot is None:\n                getter_sync = getattr(local_graph, \"get_state\", None)\n                if callable(getter_sync):\n                    try:\n                        snapshot = getter_sync(config)\n                    except Exception:\n                        snapshot = None\n\n        values = getattr(snapshot, \"values\", None)\n        if not isinstance(values, Mapping):\n            return False\n\n        for key, value in values.items():\n            state[key] = value\n        return True\n\n    async def ainvoke_with_durability(\n        self,\n        *,\n        graph: Any,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph with durability when supported.\"\"\"\n\n        # In production mode, platform may inject durability backends automatically.\n        # In dev mode, only attempt durability when the runnable itself was compiled\n        # with a checkpointer so LangGraph sets up its AsyncPregel loop correctly.\n        graph_bound_checkpointer = _extract_graph_checkpointer(graph)\n        resolved_local_checkpointer = local_checkpointer or graph_bound_checkpointer\n        checkpointer = resolved_local_checkpointer or self.checkpointer\n\n        if self.is_production_mode():\n            use_durability = durability\n        else:\n            use_durability = durability if (checkpointer and _graph_supports_durability(graph)) else None\n        try:\n            if use_durability:\n                return await graph.ainvoke(\n                    graph_input,\n                    config=config,\n                    context=context,\n                    durability=use_durability,\n                )\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n        except (TypeError, AttributeError):\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n\n\n__all__ = [\n    \"resolve_graph_checkpointer\",\n    \"resolve_graph_store\",\n    \"GraphMemoryRuntime\",\n]\n\n\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:eb385d0f-b046-5e73-6340-ec3e53588780\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766172450237.651}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766172450237.7588}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:eb385d0f-b046-5e73-6340-ec3e53588780\", \"new_ns\": \"user_preferences:eb385d0f-b046-5e73-6340-ec3e53588780\"}, \"timestamp\": 1766172450237.8171}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:eb385d0f-b046-5e73-6340-ec3e53588780\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\"}, \"timestamp\": 1766172450237.854}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172450238.163}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172450238.1948}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172450238.2742}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172450238.3179}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172450238.3572}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766172450238.593}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172450238.72}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172450238.757}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766172450238.812}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:eb385d0f-b046-5e73-6340-ec3e53588780\"}, \"timestamp\": 1766172450238.843}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766172457046.1572}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:ceddf945-ac08-e6c0-0266-40465f942f12\", \"new_ns\": \"route_drafting:ceddf945-ac08-e6c0-0266-40465f942f12\"}, \"timestamp\": 1766172457052.17}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:ceddf945-ac08-e6c0-0266-40465f942f12\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\"}, \"timestamp\": 1766172457052.237}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172457052.522}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172457052.563}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172457052.622}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172457052.6687}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172457052.723}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766172457052.9631}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172457053.007}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172457053.105}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766172457053.1477}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:ceddf945-ac08-e6c0-0266-40465f942f12\"}, \"timestamp\": 1766172457053.182}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:ceddf945-ac08-e6c0-0266-40465f942f12|graph:5c4af161-e4d8-4d47-c3b7-71964e79fbce\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766172457307.575}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172457307.716}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:ceddf945-ac08-e6c0-0266-40465f942f12|graph:5c4af161-e4d8-4d47-c3b7-71964e79fbce\", \"new_ns\": \"route_drafting:ceddf945-ac08-e6c0-0266-40465f942f12|graph:5c4af161-e4d8-4d47-c3b7-71964e79fbce\"}, \"timestamp\": 1766172457307.782}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:ceddf945-ac08-e6c0-0266-40465f942f12|graph:5c4af161-e4d8-4d47-c3b7-71964e79fbce\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\"}, \"timestamp\": 1766172457307.831}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172457308.163}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766172457308.2083}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172457308.2822}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766172457308.532}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172457308.633}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766172457308.679}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:ceddf945-ac08-e6c0-0266-40465f942f12|graph:5c4af161-e4d8-4d47-c3b7-71964e79fbce\"}, \"timestamp\": 1766172457308.721}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766172475711.331}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:1\", \"new_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:1\"}, \"timestamp\": 1766172475790.987}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\"}, \"timestamp\": 1766172475791.1748}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172475791.9622}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172475792.047}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172475792.151}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172475792.206}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172475792.258}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766172475792.573}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172475792.618}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172475792.653}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766172475792.6929}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:1\"}, \"timestamp\": 1766172475792.7197}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:2\", \"new_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:2\"}, \"timestamp\": 1766172475855.178}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\"}, \"timestamp\": 1766172475855.317}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172475856.1458}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172475856.216}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172475856.2878}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172475856.337}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172475856.383}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766172475856.679}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172475856.729}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172475856.7678}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766172475856.8052}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:2\"}, \"timestamp\": 1766172475856.8352}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:3\", \"new_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:3\"}, \"timestamp\": 1766172475919.6082}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\"}, \"timestamp\": 1766172475919.746}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172475920.0571}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172475920.117}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172475920.1829}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172475920.232}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172475920.325}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766172475920.585}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172475920.633}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172475920.674}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766172475920.7239}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:3\"}, \"timestamp\": 1766172475920.768}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:4\", \"new_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:4\"}, \"timestamp\": 1766172475984.247}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\"}, \"timestamp\": 1766172475984.4138}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172475985.2202}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172475985.3352}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172475985.421}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172475985.482}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172475985.585}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766172475985.854}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172475985.909}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172475985.9563}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766172475986.001}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:4\"}, \"timestamp\": 1766172475986.076}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:1|1|graph:65587375-ce28-50b6-3ec4-f50c61a696e4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172476575.888}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172476576.0132}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:1|1|graph:65587375-ce28-50b6-3ec4-f50c61a696e4\", \"new_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:1|1|graph:65587375-ce28-50b6-3ec4-f50c61a696e4\"}, \"timestamp\": 1766172476576.0908}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:1|1|graph:65587375-ce28-50b6-3ec4-f50c61a696e4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\"}, \"timestamp\": 1766172476576.158}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172476576.489}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766172476576.586}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172476576.649}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766172476576.894}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172476576.938}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766172476576.969}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:1|1|graph:65587375-ce28-50b6-3ec4-f50c61a696e4\"}, \"timestamp\": 1766172476576.996}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:2|2|graph:0e4e649d-bf3f-a7e0-7f1c-57f84d46a1f5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172476611.87}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172476612.0022}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:2|2|graph:0e4e649d-bf3f-a7e0-7f1c-57f84d46a1f5\", \"new_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:2|2|graph:0e4e649d-bf3f-a7e0-7f1c-57f84d46a1f5\"}, \"timestamp\": 1766172476612.051}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:2|2|graph:0e4e649d-bf3f-a7e0-7f1c-57f84d46a1f5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\"}, \"timestamp\": 1766172476612.092}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172476612.4412}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766172476612.501}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172476612.575}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766172476612.8142}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172476612.874}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766172476612.911}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:2|2|graph:0e4e649d-bf3f-a7e0-7f1c-57f84d46a1f5\"}, \"timestamp\": 1766172476612.9402}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:3|3|graph:3d34bac6-a06b-8fdd-27ad-1bb2039c1d2f\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172476650.521}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172476650.6392}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:3|3|graph:3d34bac6-a06b-8fdd-27ad-1bb2039c1d2f\", \"new_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:3|3|graph:3d34bac6-a06b-8fdd-27ad-1bb2039c1d2f\"}, \"timestamp\": 1766172476650.6902}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:3|3|graph:3d34bac6-a06b-8fdd-27ad-1bb2039c1d2f\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\"}, \"timestamp\": 1766172476650.735}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172476651.144}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766172476651.198}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172476651.267}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766172476651.5146}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172476651.5688}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766172476651.6062}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:3|3|graph:3d34bac6-a06b-8fdd-27ad-1bb2039c1d2f\"}, \"timestamp\": 1766172476651.641}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:4|4|graph:d1653c31-0200-b59d-5381-d88b44efda40\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172476687.1082}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172476687.238}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:4|4|graph:d1653c31-0200-b59d-5381-d88b44efda40\", \"new_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:4|4|graph:d1653c31-0200-b59d-5381-d88b44efda40\"}, \"timestamp\": 1766172476687.3013}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:4|4|graph:d1653c31-0200-b59d-5381-d88b44efda40\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\"}, \"timestamp\": 1766172476687.3523}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172476687.708}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766172476687.757}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172476687.8281}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766172476688.076}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172476688.132}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766172476688.1753}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:4|4|graph:d1653c31-0200-b59d-5381-d88b44efda40\"}, \"timestamp\": 1766172476688.342}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:2|2|graph:0e4e649d-bf3f-a7e0-7f1c-57f84d46a1f5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172492339.7988}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172492339.9402}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:2|2|graph:0e4e649d-bf3f-a7e0-7f1c-57f84d46a1f5\", \"new_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:2|2|graph:0e4e649d-bf3f-a7e0-7f1c-57f84d46a1f5\"}, \"timestamp\": 1766172492340.002}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:2|2|graph:0e4e649d-bf3f-a7e0-7f1c-57f84d46a1f5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\"}, \"timestamp\": 1766172492340.065}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:f99edc82\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd10d-24fb-6390-8000-d789212d7f7d\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:2|2|graph:0e4e649d-bf3f-a7e0-7f1c-57f84d46a1f5\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd10d-24fa-6bd4-bfff-17b51d9d8d89\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:2|2|graph:0e4e649d-bf3f-a7e0-7f1c-57f84d46a1f5\"}]}, \"timestamp\": 1766172492340.721}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd10d-24fb-6390-8000-d789212d7f7d\", \"checkpoint_ns\": \"wide_funnel:3cbe9ece-bf04-db04-a0dc-d44435ef10a3|worker:2|2|graph:0e4e649d-bf3f-a7e0-7f1c-57f84d46a1f5\"}, \"timestamp\": 1766172492340.7842}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd10d-24fb-6390-8000-d789212d7f7d\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766172492341.374}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false}, \"timestamp\": 1766172492341.4158}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:9dde5834-9ce5-0d40-d985-915d7d1c7bd5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766172496857.045}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766172496857.233}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:9dde5834-9ce5-0d40-d985-915d7d1c7bd5\", \"new_ns\": \"user_preferences:9dde5834-9ce5-0d40-d985-915d7d1c7bd5\"}, \"timestamp\": 1766172496857.6992}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:9dde5834-9ce5-0d40-d985-915d7d1c7bd5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\"}, \"timestamp\": 1766172496857.761}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172496858.1162}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172496858.1682}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172496858.238}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172496858.294}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172496858.345}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766172496858.5952}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172496858.658}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172496858.707}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766172496858.751}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:9dde5834-9ce5-0d40-d985-915d7d1c7bd5\"}, \"timestamp\": 1766172496858.7893}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766172503514.404}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:a58a9bae-a076-32d1-2f4e-4d12acb32737\", \"new_ns\": \"route_drafting:a58a9bae-a076-32d1-2f4e-4d12acb32737\"}, \"timestamp\": 1766172503519.691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:a58a9bae-a076-32d1-2f4e-4d12acb32737\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\"}, \"timestamp\": 1766172503519.7817}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172503520.121}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172503520.177}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172503520.249}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172503520.299}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172503520.345}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766172503520.586}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172503520.632}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172503520.67}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766172503520.707}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:a58a9bae-a076-32d1-2f4e-4d12acb32737\"}, \"timestamp\": 1766172503520.74}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:a58a9bae-a076-32d1-2f4e-4d12acb32737|graph:a4ff5d05-2e96-beb9-dbda-53bb0c97fa8e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766172503625.257}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172503625.459}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:a58a9bae-a076-32d1-2f4e-4d12acb32737|graph:a4ff5d05-2e96-beb9-dbda-53bb0c97fa8e\", \"new_ns\": \"route_drafting:a58a9bae-a076-32d1-2f4e-4d12acb32737|graph:a4ff5d05-2e96-beb9-dbda-53bb0c97fa8e\"}, \"timestamp\": 1766172503625.996}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:a58a9bae-a076-32d1-2f4e-4d12acb32737|graph:a4ff5d05-2e96-beb9-dbda-53bb0c97fa8e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\"}, \"timestamp\": 1766172503626.07}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172503626.397}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766172503626.449}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172503626.584}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766172503626.848}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172503626.9077}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766172503626.951}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:a58a9bae-a076-32d1-2f4e-4d12acb32737|graph:a4ff5d05-2e96-beb9-dbda-53bb0c97fa8e\"}, \"timestamp\": 1766172503627.0872}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766172523923.419}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:1\", \"new_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:1\"}, \"timestamp\": 1766172524207.0771}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\"}, \"timestamp\": 1766172524207.2607}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172524207.5952}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172524207.6428}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172524207.7173}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172524207.768}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172524207.816}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766172524208.066}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172524208.118}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172524208.158}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766172524208.196}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:1\"}, \"timestamp\": 1766172524208.227}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:2\", \"new_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:2\"}, \"timestamp\": 1766172524312.206}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\"}, \"timestamp\": 1766172524312.313}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172524312.64}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172524312.696}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172524312.774}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172524312.83}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172524312.887}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766172524313.139}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172524313.198}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172524313.3152}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766172524313.431}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:2\"}, \"timestamp\": 1766172524313.48}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:3\", \"new_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:3\"}, \"timestamp\": 1766172524437.268}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\"}, \"timestamp\": 1766172524437.3838}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172524437.721}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172524437.7751}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172524437.8691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172524437.927}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172524437.977}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766172524438.2239}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172524438.2961}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172524438.34}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766172524438.383}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:3\"}, \"timestamp\": 1766172524438.418}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:4\", \"new_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:4\"}, \"timestamp\": 1766172524508.659}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\"}, \"timestamp\": 1766172524508.776}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172524509.123}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172524509.1729}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172524509.247}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172524509.3}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172524509.3691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766172524509.638}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172524509.705}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172524509.8062}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766172524509.8682}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:4\"}, \"timestamp\": 1766172524509.9268}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:1|1|graph:89607677-dc61-108a-cd40-8ccb12d5bfa7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172525209.991}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172525210.0952}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:1|1|graph:89607677-dc61-108a-cd40-8ccb12d5bfa7\", \"new_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:1|1|graph:89607677-dc61-108a-cd40-8ccb12d5bfa7\"}, \"timestamp\": 1766172525210.2668}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:1|1|graph:89607677-dc61-108a-cd40-8ccb12d5bfa7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\"}, \"timestamp\": 1766172525210.325}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172525210.634}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766172525210.6729}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172525210.8691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766172525211.165}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172525211.22}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766172525211.257}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:1|1|graph:89607677-dc61-108a-cd40-8ccb12d5bfa7\"}, \"timestamp\": 1766172525211.2908}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:2|2|graph:92210f7c-f051-8f76-8209-6ea7647ef163\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172525252.0571}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172525252.1658}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:2|2|graph:92210f7c-f051-8f76-8209-6ea7647ef163\", \"new_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:2|2|graph:92210f7c-f051-8f76-8209-6ea7647ef163\"}, \"timestamp\": 1766172525252.219}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:2|2|graph:92210f7c-f051-8f76-8209-6ea7647ef163\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\"}, \"timestamp\": 1766172525252.262}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172525252.581}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766172525252.6191}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172525252.682}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766172525252.922}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172525252.9678}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766172525253.002}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:2|2|graph:92210f7c-f051-8f76-8209-6ea7647ef163\"}, \"timestamp\": 1766172525253.0361}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:3|3|graph:b760cc5f-fe1e-28a7-5ff8-7023259d6581\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172525293.6057}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172525293.728}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:3|3|graph:b760cc5f-fe1e-28a7-5ff8-7023259d6581\", \"new_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:3|3|graph:b760cc5f-fe1e-28a7-5ff8-7023259d6581\"}, \"timestamp\": 1766172525293.783}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:3|3|graph:b760cc5f-fe1e-28a7-5ff8-7023259d6581\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\"}, \"timestamp\": 1766172525293.8281}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172525294.1438}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766172525294.262}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172525294.39}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766172525294.7021}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172525294.7532}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766172525294.788}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:3|3|graph:b760cc5f-fe1e-28a7-5ff8-7023259d6581\"}, \"timestamp\": 1766172525294.818}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:4|4|graph:1990a8f4-f3c9-b3b0-c592-56062cfc2fe5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172525339.003}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172525339.114}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:4|4|graph:1990a8f4-f3c9-b3b0-c592-56062cfc2fe5\", \"new_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:4|4|graph:1990a8f4-f3c9-b3b0-c592-56062cfc2fe5\"}, \"timestamp\": 1766172525339.183}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:4|4|graph:1990a8f4-f3c9-b3b0-c592-56062cfc2fe5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\"}, \"timestamp\": 1766172525339.2488}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172525339.595}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766172525339.7178}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172525339.8}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766172525340.064}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172525340.231}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766172525340.3298}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:4|4|graph:1990a8f4-f3c9-b3b0-c592-56062cfc2fe5\"}, \"timestamp\": 1766172525340.3862}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:3|3|graph:b760cc5f-fe1e-28a7-5ff8-7023259d6581\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172538430.0571}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172538430.1682}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:3|3|graph:b760cc5f-fe1e-28a7-5ff8-7023259d6581\", \"new_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:3|3|graph:b760cc5f-fe1e-28a7-5ff8-7023259d6581\"}, \"timestamp\": 1766172538430.219}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:3|3|graph:b760cc5f-fe1e-28a7-5ff8-7023259d6581\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\"}, \"timestamp\": 1766172538430.261}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:859b749b\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd10e-f53f-669a-8000-4e72b97689ee\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:3|3|graph:b760cc5f-fe1e-28a7-5ff8-7023259d6581\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd10e-f53e-6f10-bfff-445f6e36e7f3\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:3|3|graph:b760cc5f-fe1e-28a7-5ff8-7023259d6581\"}]}, \"timestamp\": 1766172538430.758}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd10e-f53f-669a-8000-4e72b97689ee\", \"checkpoint_ns\": \"wide_funnel:fd4a718b-6e48-f1cc-3f6c-cf8125f75e77|worker:3|3|graph:b760cc5f-fe1e-28a7-5ff8-7023259d6581\"}, \"timestamp\": 1766172538430.8213}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd10e-f53f-669a-8000-4e72b97689ee\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766172538431.3691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false}, \"timestamp\": 1766172538431.42}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:19693c71-e87e-1d0c-07ba-2599fb32e97c\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766172796326.832}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766172796326.914}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:19693c71-e87e-1d0c-07ba-2599fb32e97c\", \"new_ns\": \"user_preferences:19693c71-e87e-1d0c-07ba-2599fb32e97c\"}, \"timestamp\": 1766172796326.963}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:19693c71-e87e-1d0c-07ba-2599fb32e97c\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\"}, \"timestamp\": 1766172796327.001}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172796327.314}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172796327.394}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172796327.5298}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172796327.59}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172796327.698}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766172796328.0808}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172796328.259}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172796328.31}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766172796328.351}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:19693c71-e87e-1d0c-07ba-2599fb32e97c\"}, \"timestamp\": 1766172796328.387}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766172803723.289}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:5580a01e-3898-85e5-b210-eb8597c77643\", \"new_ns\": \"route_drafting:5580a01e-3898-85e5-b210-eb8597c77643\"}, \"timestamp\": 1766172803729.412}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:5580a01e-3898-85e5-b210-eb8597c77643\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\"}, \"timestamp\": 1766172803729.472}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172803729.744}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172803729.783}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172803729.839}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172803729.8848}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172803729.9312}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766172803730.1672}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172803730.211}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172803730.251}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766172803730.288}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:5580a01e-3898-85e5-b210-eb8597c77643\"}, \"timestamp\": 1766172803730.3171}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:5580a01e-3898-85e5-b210-eb8597c77643|graph:0ffea087-36ff-6a7d-ea9e-ead2f61e7c1e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766172803965.6692}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172803965.75}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:5580a01e-3898-85e5-b210-eb8597c77643|graph:0ffea087-36ff-6a7d-ea9e-ead2f61e7c1e\", \"new_ns\": \"route_drafting:5580a01e-3898-85e5-b210-eb8597c77643|graph:0ffea087-36ff-6a7d-ea9e-ead2f61e7c1e\"}, \"timestamp\": 1766172803965.7979}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:5580a01e-3898-85e5-b210-eb8597c77643|graph:0ffea087-36ff-6a7d-ea9e-ead2f61e7c1e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\"}, \"timestamp\": 1766172803965.837}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172803966.1309}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766172803966.1702}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172803966.2312}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766172803966.482}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172803966.5261}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766172803966.556}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:5580a01e-3898-85e5-b210-eb8597c77643|graph:0ffea087-36ff-6a7d-ea9e-ead2f61e7c1e\"}, \"timestamp\": 1766172803966.592}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766172816666.82}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:1\", \"new_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:1\"}, \"timestamp\": 1766172816741.2888}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\"}, \"timestamp\": 1766172816741.4602}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172816742.2788}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172816742.322}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172816742.4}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172816742.451}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172816742.496}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766172816742.7368}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172816742.78}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172816742.816}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766172816742.85}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:1\"}, \"timestamp\": 1766172816742.878}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2\", \"new_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2\"}, \"timestamp\": 1766172816800.906}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\"}, \"timestamp\": 1766172816801.0627}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172816801.681}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172816801.7212}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172816801.78}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172816801.826}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172816801.8691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766172816802.102}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172816802.144}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172816802.1792}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766172816802.2102}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2\"}, \"timestamp\": 1766172816802.239}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:3\", \"new_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:3\"}, \"timestamp\": 1766172816859.3018}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\"}, \"timestamp\": 1766172816859.5688}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172816860.252}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172816860.2922}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172816860.3499}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172816860.3962}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172816860.438}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766172816860.669}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172816860.7092}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172816860.743}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766172816860.775}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:3\"}, \"timestamp\": 1766172816860.8088}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:4\", \"new_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:4\"}, \"timestamp\": 1766172816918.2131}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\"}, \"timestamp\": 1766172816918.349}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172816918.981}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766172816919.023}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172816919.083}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766172816919.1282}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172816919.1711}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766172816919.404}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172816919.445}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172816919.48}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766172816919.512}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:4\"}, \"timestamp\": 1766172816919.54}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:1|1|graph:2effbd5d-6579-536c-ebba-f6f2ab021667\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172817495.617}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172817495.7012}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:1|1|graph:2effbd5d-6579-536c-ebba-f6f2ab021667\", \"new_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:1|1|graph:2effbd5d-6579-536c-ebba-f6f2ab021667\"}, \"timestamp\": 1766172817495.763}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:1|1|graph:2effbd5d-6579-536c-ebba-f6f2ab021667\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\"}, \"timestamp\": 1766172817495.855}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172817496.174}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766172817496.213}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172817496.28}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766172817496.5178}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172817496.563}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766172817496.5972}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:1|1|graph:2effbd5d-6579-536c-ebba-f6f2ab021667\"}, \"timestamp\": 1766172817496.629}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|2|graph:51e58c3d-441a-de65-e177-7c60b03313fa\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172817529.73}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172817529.846}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|2|graph:51e58c3d-441a-de65-e177-7c60b03313fa\", \"new_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|2|graph:51e58c3d-441a-de65-e177-7c60b03313fa\"}, \"timestamp\": 1766172817530.0}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|2|graph:51e58c3d-441a-de65-e177-7c60b03313fa\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\"}, \"timestamp\": 1766172817530.0632}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172817530.3691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766172817530.4229}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172817530.491}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766172817530.7278}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172817530.7761}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766172817530.814}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|2|graph:51e58c3d-441a-de65-e177-7c60b03313fa\"}, \"timestamp\": 1766172817530.8499}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:3|3|graph:e475db61-2728-c4e0-c6d9-7fa24614cdb9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172817563.349}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172817563.463}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:3|3|graph:e475db61-2728-c4e0-c6d9-7fa24614cdb9\", \"new_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:3|3|graph:e475db61-2728-c4e0-c6d9-7fa24614cdb9\"}, \"timestamp\": 1766172817563.514}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:3|3|graph:e475db61-2728-c4e0-c6d9-7fa24614cdb9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\"}, \"timestamp\": 1766172817563.5562}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172817563.8442}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766172817563.88}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172817563.9392}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766172817564.1758}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172817564.22}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766172817564.2542}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:3|3|graph:e475db61-2728-c4e0-c6d9-7fa24614cdb9\"}, \"timestamp\": 1766172817564.2852}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:4|4|graph:cdc552e0-9636-a55f-af8e-b12cf9d198d1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172817597.389}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172817597.5083}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:4|4|graph:cdc552e0-9636-a55f-af8e-b12cf9d198d1\", \"new_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:4|4|graph:cdc552e0-9636-a55f-af8e-b12cf9d198d1\"}, \"timestamp\": 1766172817597.564}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:4|4|graph:cdc552e0-9636-a55f-af8e-b12cf9d198d1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\"}, \"timestamp\": 1766172817597.603}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172817597.9111}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766172817597.9478}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172817598.012}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766172817598.249}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172817598.291}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766172817598.321}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:4|4|graph:cdc552e0-9636-a55f-af8e-b12cf9d198d1\"}, \"timestamp\": 1766172817598.356}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:1|1|graph:2effbd5d-6579-536c-ebba-f6f2ab021667\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172826450.29}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172826450.443}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:1|1|graph:2effbd5d-6579-536c-ebba-f6f2ab021667\", \"new_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:1|1|graph:2effbd5d-6579-536c-ebba-f6f2ab021667\"}, \"timestamp\": 1766172826450.872}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:1|1|graph:2effbd5d-6579-536c-ebba-f6f2ab021667\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\"}, \"timestamp\": 1766172826450.925}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd119-d7e6-6f84-8000-8ea99988b45c\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:1|1|graph:2effbd5d-6579-536c-ebba-f6f2ab021667\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd119-d7e6-689a-bfff-11c85be9c86c\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:1|1|graph:2effbd5d-6579-536c-ebba-f6f2ab021667\"}]}, \"timestamp\": 1766172826451.5042}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd119-d7e6-6f84-8000-8ea99988b45c\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:1|1|graph:2effbd5d-6579-536c-ebba-f6f2ab021667\"}, \"timestamp\": 1766172826451.584}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd119-d7e6-6f84-8000-8ea99988b45c\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766172826452.2}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false}, \"timestamp\": 1766172826452.2559}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:3|3|graph:e475db61-2728-c4e0-c6d9-7fa24614cdb9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172833683.819}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172833684.0042}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:3|3|graph:e475db61-2728-c4e0-c6d9-7fa24614cdb9\", \"new_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:3|3|graph:e475db61-2728-c4e0-c6d9-7fa24614cdb9\"}, \"timestamp\": 1766172833684.401}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:3|3|graph:e475db61-2728-c4e0-c6d9-7fa24614cdb9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\"}, \"timestamp\": 1766172833684.4412}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd119-d88b-6b4c-8000-aa28180c49b8\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:3|3|graph:e475db61-2728-c4e0-c6d9-7fa24614cdb9\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd119-d88b-64c6-bfff-434338ea4b22\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:3|3|graph:e475db61-2728-c4e0-c6d9-7fa24614cdb9\"}]}, \"timestamp\": 1766172833684.922}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd119-d88b-6b4c-8000-aa28180c49b8\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:3|3|graph:e475db61-2728-c4e0-c6d9-7fa24614cdb9\"}, \"timestamp\": 1766172833684.985}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd119-d88b-6b4c-8000-aa28180c49b8\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766172833685.534}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false}, \"timestamp\": 1766172833685.587}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|2|graph:51e58c3d-441a-de65-e177-7c60b03313fa\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172848533.638}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172848533.8052}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|2|graph:51e58c3d-441a-de65-e177-7c60b03313fa\", \"new_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|2|graph:51e58c3d-441a-de65-e177-7c60b03313fa\"}, \"timestamp\": 1766172848534.2168}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|2|graph:51e58c3d-441a-de65-e177-7c60b03313fa\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\"}, \"timestamp\": 1766172848534.26}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd119-d839-6ec8-8000-9c62295e4347\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|2|graph:51e58c3d-441a-de65-e177-7c60b03313fa\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd119-d839-6888-bfff-760c98dd5163\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|2|graph:51e58c3d-441a-de65-e177-7c60b03313fa\"}]}, \"timestamp\": 1766172848534.7332}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd119-d839-6ec8-8000-9c62295e4347\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|2|graph:51e58c3d-441a-de65-e177-7c60b03313fa\"}, \"timestamp\": 1766172848534.799}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd119-d839-6ec8-8000-9c62295e4347\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766172848535.36}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false}, \"timestamp\": 1766172848535.403}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"result_keys\": [\"general_route_draft\", \"user_preferences\", \"wide_funnel_options\", \"messages\", \"distribution_scope\"]}, \"timestamp\": 1766172900023.035}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"I\", \"location\": \"workflow_distribution.py:628\", \"message\": \"worker workflow result\", \"data\": {\"has_options\": true, \"keys\": [\"general_route_draft\", \"user_preferences\", \"wide_funnel_options\", \"distribution_scope\", \"messages\"]}, \"timestamp\": 1766172900027.0588}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"result_keys\": [\"general_route_draft\", \"user_preferences\", \"wide_funnel_options\", \"messages\", \"distribution_scope\"]}, \"timestamp\": 1766172904761.374}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"I\", \"location\": \"workflow_distribution.py:628\", \"message\": \"worker workflow result\", \"data\": {\"has_options\": true, \"keys\": [\"general_route_draft\", \"user_preferences\", \"wide_funnel_options\", \"distribution_scope\", \"messages\"]}, \"timestamp\": 1766172904767.039}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"result_keys\": [\"general_route_draft\", \"user_preferences\", \"wide_funnel_options\", \"messages\", \"distribution_scope\"]}, \"timestamp\": 1766172923179.755}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"I\", \"location\": \"workflow_distribution.py:628\", \"message\": \"worker workflow result\", \"data\": {\"has_options\": true, \"keys\": [\"general_route_draft\", \"user_preferences\", \"wide_funnel_options\", \"distribution_scope\", \"messages\"]}, \"timestamp\": 1766172923183.862}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|5|graph:e4069ff7-c2a9-c4c4-7dcb-1d6bffe89b94\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766172935182.476}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766172935182.578}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|5|graph:e4069ff7-c2a9-c4c4-7dcb-1d6bffe89b94\", \"new_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|5|graph:e4069ff7-c2a9-c4c4-7dcb-1d6bffe89b94\"}, \"timestamp\": 1766172935182.6328}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|5|graph:e4069ff7-c2a9-c4c4-7dcb-1d6bffe89b94\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\"}, \"timestamp\": 1766172935182.676}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d7db0d5e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766172935182.993}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766172935183.029}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766172935183.0881}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766172935183.3699}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766172935183.744}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766172935183.831}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:a934e277-a0c1-56ad-d1a2-6003372de2d4|worker:2|5|graph:e4069ff7-c2a9-c4c4-7dcb-1d6bffe89b94\"}, \"timestamp\": 1766172935183.907}\n"
  },
  {
    "role": "assistant",
    "tool_calls": [
      {
        "type": "function",
        "id": "1046454f-d1b9-499c-8045-c4f0f5b56064",
        "function": {
          "name": "SearchDocsByLangChain",
          "arguments": "{\"query\": \"update_state as_node __start__\"}"
        }
      }
    ],
    "id": "lc_run--019b381c-cf5c-7931-b8cd-c97b621bdf83",
    "content": ""
  },
  {
    "role": "tool",
    "name": "SearchDocsByLangChain",
    "tool_call_id": "1046454f-d1b9-499c-8045-c4f0f5b56064",
    "id": "a8120272-12b4-4a90-9f43-09316ad33c0c",
    "content": "Result 1:\nTitle: Persistence\nLink: https://docs.langchain.comoss/javascript/langgraph/persistence\nContent: as_node\nThe final thing you can optionally specify when calling updateState is asNode . If you provide it, the update will be applied as if it came from node asNode . If asNode is not provided, it will be set to the last node that updated the state, if not ambiguous. The reason this matters is that the next steps to execute depend on the last node to have given an update, so this can be used to control which node executes next. See this how to guide on time-travel to learn more about forking state.\n\nvalues\nThese are the values that will be used to update the state. Note that this update is treated exactly as any update from a node is treated. This means that these values will be passed to the reducer functions, if they are defined for some of the channels in the graph state. This means that update_state does NOT automatically overwrite the channel values for every channel, but only for the channels without reducers. Let's walk through an example. Let's assume you have defined the state of your graph with the following schema (see full example above): Let's now assume the current state of the graph is If you update the state as below: await graph.updateState(config, { foo: 2, bar: [\"b\"] });\n\nvalues\nThese are the values that will be used to update the state. Note that this update is treated exactly as any update from a node is treated. This means that these values will be passed to the reducer functions, if they are defined for some of the channels in the graph state. This means that update_state does NOT automatically overwrite the channel values for every channel, but only for the channels without reducers. Let's walk through an example. Let's assume you have defined the state of your graph with the following schema (see full example above): Let's now assume the current state of the graph is { foo: 1, bar: [\"a\"] }\n\n---\n\nResult 2:\nTitle: Persistence\nLink: https://docs.langchain.comoss/python/langgraph/persistence\nContent: as_node\nThe final thing you can optionally specify when calling update_state is as_node . If you provided it, the update will be applied as if it came from node as_node . If as_node is not provided, it will be set to the last node that updated the state, if not ambiguous. The reason this matters is that the next steps to execute depend on the last node to have given an update, so this can be used to control which node executes next. See this how to guide on time-travel to learn more about forking state.\n\nGet state\nWhen interacting with the saved graph state, you must specify a thread identifier . You can view the latest state of the graph by calling graph.get_state(config) . This will return a StateSnapshot object that corresponds to the latest checkpoint associated with the thread ID provided in the config or a checkpoint associated with a checkpoint ID for the thread, if provided. In our example, the output of get_state will look like this: StateSnapshot(\n    values={'foo': 'b', 'bar': ['a', 'b']},\n    next=(),\n    config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1ef663ba-28fe-6528-8002-5a559208592c'}},\n    metadata={'source': 'loop', 'writes': {'node_b': {'foo': 'b', 'bar': ['b']}}, 'step': 2},\n    created_at='2024-08-29T19:19:38.821749+00:00',\n    parent_config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1ef663ba-28f9-6ec4-8001-31981c2c39f8'}}, tasks=()\n)\n\nUpdate state\nIn addition to re-playing the graph from specific checkpoints , we can also edit the graph state. We do this using update_state . This method accepts three different arguments:\n\n---\n\nResult 3:\nTitle: Use the graph API\nLink: https://docs.langchain.comoss/python/langgraph/use-graph-api\nContent: Update state\nLet's build an example graph with a single node. Our node is just a Python function that reads our graph's state and makes updates to it. The first argument to this function will always be the state: from langchain.messages import AIMessage\n\ndef node(state: State):\n    messages = state[\"messages\"]\n    new_message = AIMessage(\"Hello!\")\n    return {\"messages\": messages + [new_message], \"extra_field\": 10}\n\nUpdate state\nLet's build an example graph with a single node. Our node is just a Python function that reads our graph's state and makes updates to it. The first argument to this function will always be the state: This node simply appends a message to our message list, and populates an extra field. Nodes should return updates to the state directly, instead of mutating the state. Let's next define a simple graph containing this node. We use StateGraph to define a graph that operates on this state. We then use add_node populate our graph. from langgraph.graph import StateGraph\n\nbuilder = StateGraph(State)\nbuilder.add_node(node)\nbuilder.set_entry_point(\"node\")\ngraph = builder.compile()\n\nNavigate to a node in a parent graph\nIf you are using subgraphs , you might want to navigate from a node within a subgraph to a different subgraph (i.e. a different node in the parent graph). To do so, you can specify graph=Command.PARENT in Command: Let's demonstrate this using the above example. We'll do so by changing nodeA in the above example into a single-node graph that we'll add as a subgraph to our parent graph. State updates with Command.PARENT When you send updates from a subgraph node to a parent graph node for a key that's shared by both parent and subgraph state schemas , you must define a reducer for the key you're updating in the parent graph state. See the example below. import operator\nfrom typing_extensions import Annotated\n\nclass State(TypedDict):\n    # NOTE: we define a reducer here\n    foo: Annotated[str, operator.add]  # [!code highlight]\n\ndef node_a(state: State):\n    print(\"Called A\")\n    value = random.choice([\"a\", \"b\"])\n    # this is a replacement for a conditional edge function\n    if value == \"a\":\n        goto = \"node_b\"\n    else:\n        goto = \"node_c\"\n\n    # note how Command allows you to BOTH update the graph state AND route to the next node\n    return Command(\n        update={\"foo\": value},\n        goto=goto,\n        # this tells LangGraph to navigate to node_b or node_c in the parent graph\n        # NOTE: this will navigate to the closest parent graph relative to the subgraph\n        graph=Command.PARENT,  # [!code highlight]\n    )\n\nsubgraph = StateGraph(State).add_node(node_a).add_edge(START, \"node_a\").compile()\n\ndef node_b(state: State):\n    print(\"Called B\")\n    # NOTE: since we've defined a reducer, we don't need to manually append\n    # new characters to existing 'foo' value. instead, reducer will append these\n    # automatically (via operator.add)\n    return {\"foo\": \"b\"}  # [!code highlight]\n\ndef node_c(state: State):\n    print(\"Called C\")\n    return {\"foo\": \"c\"}  # [!code highlight]\n\nbuilder = StateGraph(State)\nbuilder.add_edge(START, \"subgraph\")\nbuilder.add_node(\"subgraph\", subgraph)\nbuilder.add_node(node_b)\nbuilder.add_node(node_c)\n\ngraph = builder.compile()\n"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b381d-3844-7881-a966-e92c5d63d3d6",
    "content": "**\u041f\u0440\u0438\u0447\u0438\u043d\u0430 \u00ab\u043f\u0435\u0440\u0435\u0434\u0432\u0438\u0436\u0435\u043d\u0438\u044f \u043d\u0430 `__start__`\u00bb \u0438 \u0432\u043e\u0437\u043d\u0438\u043a\u043d\u043e\u0432\u0435\u043d\u0438\u044f `EmptyInputError` \u043a\u0440\u043e\u0435\u0442\u0441\u044f \u0432 \u043b\u043e\u0433\u0438\u043a\u0435 \u00ab\u043f\u0430\u0442\u0447\u0438\u043d\u0433\u0430\u00bb \u0441\u0442\u0435\u0439\u0442\u0430, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0434\u043e\u0443\u0447\u0438\u0432\u0430\u043d\u0438\u044f \u0438\u043b\u0438 \u0443\u0442\u043e\u0447\u043d\u0435\u043d\u0438\u044f (refinement) \u0430\u0433\u0435\u043d\u0442\u0430.**\n\n\u0412 \u0432\u0430\u0448\u0435\u043c \u043a\u043e\u0434\u0435 `memory_manager.py` \u0435\u0441\u0442\u044c \u0436\u0435\u0441\u0442\u043a\u0430\u044f \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0430 \u043a \u0443\u0437\u043b\u0443 `__start__` \u043f\u0440\u0438 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u043c\u044b \u00ab\u0434\u0432\u0438\u0433\u0430\u0435\u043c\u0441\u044f\u00bb \u043d\u0430 `__start__`?\n\n1.  **\u0422\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043f\u0440\u0438\u0447\u0438\u043d\u0430 (\u0441\u0442\u0440\u043e\u043a\u0430 ~923 \u0432 `memory_manager.py`):**\n    \u0412 \u043c\u0435\u0442\u043e\u0434\u0435 `append_messages_to_checkpoint` (\u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043f\u0440\u0438 \u0438\u043d\u0436\u0435\u043a\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0441\u0443\u0434\u0435\u0439\u0441\u0442\u0432\u0430) \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435:\n    ```python\n    resolved_as_node = as_node or \"__start__\"\n    # ...\n    await updater_async(patch_config, updates, as_node=resolved_as_node)\n    ```\n    \u041a\u043e\u0433\u0434\u0430 \u0432\u044b \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0435 `update_state` \u0441 `as_node=\"__start__\"`, LangGraph \u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u043d\u043e\u0432\u044b\u0439 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u00ab\u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f\u00bb \u0441\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0432 \u043d\u0430\u0447\u0430\u043b\u043e. \u042d\u0442\u043e \u0437\u0430\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0433\u0440\u0430\u0444 \u0441\u0447\u0438\u0442\u0430\u0442\u044c, \u0447\u0442\u043e \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u0448\u0430\u0433\u043e\u043c \u043d\u0443\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044e.\n\n2.  **\u0410\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u0430\u044f \u043f\u0440\u0438\u0447\u0438\u043d\u0430 (Refinement Loop):**\n    \u0414\u043b\u044f \u0446\u0438\u043a\u043b\u0430 \u0443\u0442\u043e\u0447\u043d\u0435\u043d\u0438\u044f (\u043a\u043e\u0433\u0434\u0430 \u0441\u0443\u0434\u044c\u044f \u0434\u0430\u0435\u0442 \u043f\u0440\u0430\u0432\u043a\u0438) \u0430\u0433\u0435\u043d\u0442 \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u0435\u0440\u0435\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0432\u0441\u0451 \u0441\u0432\u043e\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u0437\u0430\u043d\u043e\u0432\u043e \u0441 \u0443\u0447\u0435\u0442\u043e\u043c \u043d\u043e\u0432\u044b\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439. \u0421\u0430\u043c\u044b\u0439 \u043d\u0430\u0434\u0435\u0436\u043d\u044b\u0439 \u0441\u043f\u043e\u0441\u043e\u0431 \u0437\u0430\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0433\u0440\u0430\u0444 \u043f\u0435\u0440\u0435\u0441\u0447\u0438\u0442\u0430\u0442\u044c \u043b\u043e\u0433\u0438\u043a\u0443 \u2014 \u044d\u0442\u043e \u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0435\u0433\u043e \u043d\u0430 \u0432\u0445\u043e\u0434 (`__start__`).\n\n---\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 `EmptyInputError`?\n\n\u041e\u0448\u0438\u0431\u043a\u0430 `Received no input for __start__` \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0438\u0437-\u0437\u0430 \u043a\u043e\u043d\u0444\u043b\u0438\u043a\u0442\u0430 \u043c\u0435\u0436\u0434\u0443 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435\u043c \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430 \u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c\u0438 \u0432\u044b\u0437\u043e\u0432\u0430 `ainvoke`:\n\n-   **\u0421\u0438\u0442\u0443\u0430\u0446\u0438\u044f:** \u0427\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0433\u043e\u0432\u043e\u0440\u0438\u0442: \u00ab\u042f \u043d\u0430\u0445\u043e\u0436\u0443\u0441\u044c \u043d\u0430 \u0443\u0437\u043b\u0435 `__start__`\u00bb.\n-   **\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0435:** \u0412\u0430\u0448 \u043a\u043e\u0434 \u0432 `ainvoke_from_checkpoint` \u0432\u0438\u0434\u0438\u0442, \u0447\u0442\u043e \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442, \u0438 (\u0432 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0432\u0435\u0442\u043a\u0430\u0445 \u043b\u043e\u0433\u0438\u043a\u0438) \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 `ainvoke(None, config=cfg)`.\n-   **\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442:** LangGraph \u0432\u0438\u0434\u0438\u0442, \u0447\u0442\u043e \u043e\u043d \u043d\u0430 \u0441\u0442\u0430\u0440\u0442\u0435, \u043d\u043e \u0432\u0432\u043e\u0434 (`None`) \u043f\u0443\u0441\u0442\u043e\u0439. \u041e\u043d \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u0430\u043d\u0430\u043b\u044b \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0438 \u0432\u044b\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442 `EmptyInputError`.\n\n### \u041a\u0430\u043a \u044d\u0442\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e?\n\n\u0412\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u0447\u0435\u0442\u043a\u043e \u0440\u0430\u0437\u0434\u0435\u043b\u044f\u0442\u044c \u00ab\u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u0435\u00bb (Resume) \u0438 \u00ab\u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a \u0441\u043e \u0441\u0442\u0430\u0440\u0442\u0430\u00bb (Reset/Refinement). \n\n**\u0412 \u0444\u0430\u0439\u043b\u0435 `memory_manager.py` (\u043c\u0435\u0442\u043e\u0434 `ainvoke_from_checkpoint`):**\n\n```python\nif isinstance(next_nodes, Sequence) and next_nodes:\n    # \u041e\u0420\u0413\u0410\u041d\u0418\u0427\u041d\u042b\u0419 \u0424\u0418\u041a\u0421:\n    # \u0415\u0441\u043b\u0438 \u043c\u044b \u0441\u0442\u043e\u0438\u043c \u043d\u0430 __start__, \u043d\u0430\u043c \u041e\u0411\u042f\u0417\u0410\u0422\u0415\u041b\u042c\u041d\u041e \u043d\u0443\u0436\u0435\u043d graph_input.\n    # \u0415\u0441\u043b\u0438 \u043c\u044b \u0441\u0442\u043e\u0438\u043c \u043d\u0430 \u0440\u0430\u0431\u043e\u0447\u0435\u043c \u0443\u0437\u043b\u0435 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, 'agent'), \u0448\u043b\u0435\u043c None.\n    is_at_start = list(next_nodes) == [\"__start__\"]\n    resume_graph_input = graph_input if is_at_start else None\n    \n    # #region log hypothesis K\n    # \u0417\u0434\u0435\u0441\u044c \u0432 \u043b\u043e\u0433\u0430\u0445 \u0432\u044b \u0443\u0432\u0438\u0434\u0438\u0442\u0435: next_nodes: [\"__start__\"], graph_input_is_none: False\n    # #endregion\n\n    return await self.ainvoke_with_durability(\n        graph=graph,\n        graph_input=resume_graph_input, # \u0422\u0435\u043f\u0435\u0440\u044c \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 None \u0434\u043b\u044f \u0441\u0442\u0430\u0440\u0442\u0430\n        config=cfg,\n        # ...\n    )\n```\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u0433\u0438\u043f\u043e\u0442\u0435\u0437\u0430 L (Writes never materialize) \u0432\u0430\u0436\u043d\u0430:\n\u0415\u0441\u043b\u0438 `_materialize_checkpoint_values` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u0442\u0435\u0439\u0442, \u0430 \u0432\u044b \u043f\u0440\u0438 \u044d\u0442\u043e\u043c \u0441\u0442\u043e\u0438\u0442\u0435 \u043d\u0430 `__start__`, \u0442\u043e \u0434\u0430\u0436\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 `graph_input` \u043c\u043e\u0436\u0435\u0442 \u043d\u0435 \u0441\u043f\u0430\u0441\u0442\u0438, \u0435\u0441\u043b\u0438 \u043a\u043b\u044e\u0447\u0438 \u0432\u043d\u0443\u0442\u0440\u0438 `graph_input` \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0442 \u0441\u0445\u0435\u043c\u0435. \u041d\u043e \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u0442\u0440\u0438\u0433\u0433\u0435\u0440 \u0441\u0435\u0439\u0447\u0430\u0441 \u2014 \u0438\u043c\u0435\u043d\u043d\u043e \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 `None` \u0442\u0430\u043c, \u0433\u0434\u0435 \u043e\u0436\u0438\u0434\u0430\u0435\u0442\u0441\u044f \u0441\u0442\u0430\u0440\u0442\u043e\u0432\u044b\u0439 \u043f\u0430\u043a\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445.\n\n**\u0418\u0442\u043e\u0433:** \u0412\u044b \u00ab\u0434\u0432\u0438\u0433\u0430\u0435\u0442\u0435\u0441\u044c \u043d\u0430 \u0441\u0442\u0430\u0440\u0442\u00bb \u043d\u0430\u043c\u0435\u0440\u0435\u043d\u043d\u043e \u0434\u043b\u044f \u0443\u0442\u043e\u0447\u043d\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445, \u043d\u043e \u043b\u043e\u043c\u0430\u0435\u0442\u0435 \u0437\u0430\u043f\u0443\u0441\u043a, \u043d\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u044f \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u044b\u0439 \u0432\u0432\u043e\u0434 \u043f\u0440\u0438 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 \u0438\u0437 \u044d\u0442\u043e\u0433\u043e \u00ab\u0441\u0442\u0430\u0440\u0442\u043e\u0432\u043e\u0433\u043e\u00bb \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430.\n\n**Relevant docs:**\n- [Persistence: Update State (as_node)](https://docs.langchain.com/oss/python/langgraph/persistence#update-state)\n- [Time Travel: Resume from Checkpoint](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)\n- [LangGraph Errors: EmptyInputError](https://docs.langchain.com/langsmith/use-threads#empty-thread)"
  },
  {
    "role": "user",
    "id": "6a7e580f-7e3c-4eb9-8c7a-03ce6abf00ec",
    "content": "New hypothesis was that LangGraph refuses to resume mid-run when the checkpoint has pending next nodes but no persisted __start__ writes, so handing it graph_input=None triggers the EmptyInputError. Passing the original payload (what we tried earlier) doesn\u2019t help because LangGraph ignores inputs whenever a checkpoint_id is provided. The fix is now:\nWhen we detect pending next tasks (snapshot.next non-empty), we peek at the checkpoint record. If it actually captured any writes, we resume in the canonical way (graph_input=None, checkpoint-based replay). If the record has no writes (the tool died before __start__ completed), we abandon that checkpoint and re-run the worker graph from scratch with the original input (and without checkpoint_id). The instrumentation log (hypothesisId=\"K\") now reports whether we resumed via checkpoint or reran fresh, and _materialize_checkpoint_values is re-used to probe for stored writes.\nPlease rerun for fresh evidence so we can see whether the EmptyInputError is gone and what happens with the tool failure:"
  },
  {
    "role": "assistant",
    "tool_calls": [
      {
        "type": "function",
        "id": "f9d3b358-44ed-48bd-983f-57925147bc82",
        "function": {
          "name": "SearchDocsByLangChain",
          "arguments": "{\"query\": \"EmptyInputError __start__ checkpoint_id\"}"
        }
      },
      {
        "type": "function",
        "id": "99c80022-1452-40bf-9040-dbe2acb1434c",
        "function": {
          "name": "SearchDocsByLangChain",
          "arguments": "{\"query\": \"resume graph without checkpoint writes\"}"
        }
      }
    ],
    "id": "lc_run--019b381f-f526-72a2-b82d-02b72f9eba04",
    "content": ""
  },
  {
    "role": "tool",
    "name": "SearchDocsByLangChain",
    "tool_call_id": "f9d3b358-44ed-48bd-983f-57925147bc82",
    "id": "c4bc02e8-4623-4ee7-ba94-ad0b1e02ceee",
    "content": "Result 1:\nTitle: Use threads\nLink: https://docs.langchain.comlangsmith/use-threads\nContent: Empty thread\nTo create a new thread, use one of: curl --request POST \\\n    --url <DEPLOYMENT_URL>/threads \\\n    --header 'Content-Type: application/json' \\\n    --data '{}'\n\nEmpty thread\nTo create a new thread, use one of: For more information, refer to the Python and JS SDK docs, or the REST API reference. Output:\n\nEmpty thread\nTo create a new thread, use one of: from langgraph_sdk import get_client\n\n# Initialize the client with your deployment URL\nclient = get_client(url=<DEPLOYMENT_URL>)\n\n# Create an empty thread\n# This creates a new thread with no initial state\nthread = await client.threads.create()\n\nprint(thread)\n\n---\n\nResult 2:\nTitle: Structured output\nLink: https://docs.langchain.comoss/javascript/langchain/structured-output\nContent: Structured output allows agents to return data in a specific, predictable format. Instead of parsing natural language responses, you get typed structured data.\n\nLangChain's prebuilt ReAct agent `createAgent` handles structured output automatically. The user sets their desired structured output schema, and when the model generates the structured data, it's captured, validated, and returned in the `structuredResponse` key of the agent's state.\n\n```ts  theme={null}\ntype ResponseFormat = (\n    | ZodSchema<StructuredResponseT> // a Zod schema\n    | Record<string, unknown> // a JSON Schema\n)\n\nconst agent = createAgent({\n    // ...\n    responseFormat: ResponseFormat | ResponseFormat[]\n})\n```\n\n## Response Format\n\nControls how the agent returns structured data. You can provide either a Zod object or JSON schema. By default, the agent uses a tool calling strategy, in which the output is created by an additional tool call. Certain models support native structured output, in which case the agent will use that strategy instead.\n\nYou can control the behavior by wrapping `ResponseFormat` in a `toolStrategy` or `providerStrategy` function call:\n\n```ts  theme={null}\nimport { toolStrategy, providerStrategy } from \"langchain\";\n\nconst agent = createAgent({\n    // use a provider strategy if supported by the model\n    responseFormat: providerStrategy(z.object({ ... }))\n    // or enforce a tool strategy\n    responseFormat: toolStrategy(z.object({ ... }))\n})\n```\n\nThe structured response is returned in the `structuredResponse` key of the agent's final state.\n\n<Tip>\n  Support for native structured output features is read dynamically from the model's [profile data](/oss/javascript/langchain/models#model-profiles) if using `langchain>=1.1`. If data are not available, use another condition or specify manually:\n\n  ```typescript  theme={null}\n  const customProfile: ModelProfile = {\n      structuredOutput: true,\n      // ...\n  }\n  const model = await initChatModel(\"...\", { profile: customProfile });\n  ```\n\n  If tools are specified, the model must support simultaneous use of tools and structured output.\n</Tip>\n\n## Provider strategy\n\nSome model providers support structured output natively through their APIs (e.g. OpenAI, Grok, Gemini). This is the most reliable method when available.\n\nTo use this strategy, configure a `ProviderStrategy`:\n\n```ts  theme={null}\nfunction providerStrategy<StructuredResponseT>(\n    schema: ZodSchema<StructuredResponseT> | JsonSchemaFormat\n): ProviderStrategy<StructuredResponseT>\n```\n\n<ParamField path=\"schema\" required>\n  The schema defining the structured output format. Supports:\n\n  * **Zod Schema**: A zod schema\n  * **JSON Schema**: A JSON schema object\n</ParamField>\n\nLangChain automatically uses `ProviderStrategy` when you pass a schema type directly to `createAgent.responseFormat` and the model supports native structured output:\n\n<CodeGroup>\n  ```ts Zod Schema theme={null}\n  import * as z from \"zod\";\n  import { createAgent, providerStrategy } from \"langchain\";\n\n  const ContactInfo = z.object({\n      name: z.string().describe(\"The name of the person\"),\n      email: z.string().describe(\"The email address of the person\"),\n      phone: z.string().describe(\"The phone number of the person\"),\n  });\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: providerStrategy(ContactInfo)\n  });\n\n  const result = await agent.invoke({\n      messages: [{\"role\": \"user\", \"content\": \"Extract contact info from: John Doe, john@example.com, (555) 123-4567\"}]\n  });\n\n  console.log(result.structuredResponse);\n  // { name: \"John Doe\", email: \"john@example.com\", phone: \"(555) 123-4567\" }\n  ```\n\n  ```ts JSON Schema theme={null}\n  import { createAgent, providerStrategy } from \"langchain\";\n\n  const contactInfoSchema = {\n      \"type\": \"object\",\n      \"description\": \"Contact information for a person.\",\n      \"properties\": {\n          \"name\": {\"type\": \"string\", \"description\": \"The name of the person\"},\n          \"email\": {\"type\": \"string\", \"description\": \"The email address of the person\"},\n          \"phone\": {\"type\": \"string\", \"description\": \"The phone number of the person\"}\n      },\n      \"required\": [\"name\", \"email\", \"phone\"]\n  }\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: providerStrategy(contactInfoSchema)\n  });\n\n  const result = await agent.invoke({\n      messages: [{\"role\": \"user\", \"content\": \"Extract contact info from: John Doe, john@example.com, (555) 123-4567\"}]\n  });\n\n  console.log(result.structuredResponse);\n  // { name: \"John Doe\", email: \"john@example.com\", phone: \"(555) 123-4567\" }\n  ```\n</CodeGroup>\n\nProvider-native structured output provides high reliability and strict validation because the model provider enforces the schema. Use it when available.\n\n<Note>\n  If the provider natively supports structured output for your model choice, it is functionally equivalent to write `responseFormat: contactInfoSchema` instead of `responseFormat: providerStrategy(contactInfoSchema)`. In either case, if structured output is not supported, the agent will fall back to a tool calling strategy.\n</Note>\n\n## Tool calling strategy\n\nFor models that don't support native structured output, LangChain uses tool calling to achieve the same result. This works with all models that support tool calling, which is most modern models.\n\nTo use this strategy, configure a `ToolStrategy`:\n\n```ts  theme={null}\nfunction toolStrategy<StructuredResponseT>(\n    responseFormat:\n        | JsonSchemaFormat\n        | ZodSchema<StructuredResponseT>\n        | (ZodSchema<StructuredResponseT> | JsonSchemaFormat)[]\n    options?: ToolStrategyOptions\n): ToolStrategy<StructuredResponseT>\n```\n\n<ParamField path=\"schema\" required>\n  The schema defining the structured output format. Supports:\n\n  * **Zod Schema**: A zod schema\n  * **JSON Schema**: A JSON schema object\n</ParamField>\n\n<ParamField path=\"options.toolMessageContent\">\n  Custom content for the tool message returned when structured output is generated.\n  If not provided, defaults to a message showing the structured response data.\n</ParamField>\n\n<ParamField path=\"options.handleError\">\n  Options parameter containing an optional `handleError` parameter for customizing the error handling strategy.\n\n  * **`true`**: Catch all errors with default error template (default)\n  * **`False`**: No retry, let exceptions propagate\n  * **`(error: ToolStrategyError) => string | Promise<string>`**: retry with the provided message or throw the error\n</ParamField>\n\n<CodeGroup>\n  ```ts Zod Schema theme={null}\n  import * as z from \"zod\";\n  import { createAgent, toolStrategy } from \"langchain\";\n\n  const ProductReview = z.object({\n      rating: z.number().min(1).max(5).optional(),\n      sentiment: z.enum([\"positive\", \"negative\"]),\n      keyPoints: z.array(z.string()).describe(\"The key points of the review. Lowercase, 1-3 words each.\"),\n  });\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: toolStrategy(ProductReview)\n  })\n\n  const result = await agent.invoke({\n      \"messages\": [{\"role\": \"user\", \"content\": \"Analyze this review: 'Great product: 5 out of 5 stars. Fast shipping, but expensive'\"}]\n  })\n\n  console.log(result.structuredResponse);\n  // { \"rating\": 5, \"sentiment\": \"positive\", \"keyPoints\": [\"fast shipping\", \"expensive\"] }\n  ```\n\n  ```ts JSON Schema theme={null}\n  import { createAgent, toolStrategy } from \"langchain\";\n\n  const productReviewSchema = {\n      \"type\": \"object\",\n      \"description\": \"Analysis of a product review.\",\n      \"properties\": {\n          \"rating\": {\n              \"type\": [\"integer\", \"null\"],\n              \"description\": \"The rating of the product (1-5)\",\n              \"minimum\": 1,\n              \"maximum\": 5\n          },\n          \"sentiment\": {\n              \"type\": \"string\",\n              \"enum\": [\"positive\", \"negative\"],\n              \"description\": \"The sentiment of the review\"\n          },\n          \"key_points\": {\n              \"type\": \"array\",\n              \"items\": {\"type\": \"string\"},\n              \"description\": \"The key points of the review\"\n          }\n      },\n      \"required\": [\"sentiment\", \"key_points\"]\n  }\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: toolStrategy(productReviewSchema)\n  });\n\n  const result = await agent.invoke({\n      messages: [{\"role\": \"user\", \"content\": \"Analyze this review: 'Great product: 5 out of 5 stars. Fast shipping, but expensive'\"}]\n  })\n\n  console.log(result.structuredResponse);\n  // { \"rating\": 5, \"sentiment\": \"positive\", \"keyPoints\": [\"fast shipping\", \"expensive\"] }\n  ```\n\n  ```ts Union Types theme={null}\n  import * as z from \"zod\";\n  import { createAgent, toolStrategy } from \"langchain\";\n\n  const ProductReview = z.object({\n      rating: z.number().min(1).max(5).optional(),\n      sentiment: z.enum([\"positive\", \"negative\"]),\n      keyPoints: z.array(z.string()).describe(\"The key points of the review. Lowercase, 1-3 words each.\"),\n  });\n\n  const CustomerComplaint = z.object({\n      issueType: z.enum([\"product\", \"service\", \"shipping\", \"billing\"]),\n      severity: z.enum([\"low\", \"medium\", \"high\"]),\n      description: z.string().describe(\"Brief description of the complaint\"),\n  });\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: toolStrategy([ProductReview, CustomerComplaint])\n  });\n\n  const result = await agent.invoke({\n      messages: [{\"role\": \"user\", \"content\": \"Analyze this review: 'Great product: 5 out of 5 stars. Fast shipping, but expensive'\"}]\n  })\n\n  console.log(result.structuredResponse);\n  // { \"rating\": 5, \"sentiment\": \"positive\", \"keyPoints\": [\"fast shipping\", \"expensive\"] }\n  ```\n</CodeGroup>\n\n### Custom tool message content\n\nThe `toolMessageContent` parameter allows you to customize the message that appears in the conversation history when structured output is generated:\n\n```ts  theme={null}\nimport * as z from \"zod\";\nimport { createAgent, toolStrategy } from \"langchain\";\n\nconst MeetingAction = z.object({\n    task: z.string().describe(\"The specific task to be completed\"),\n    assignee: z.string().describe(\"Person responsible for the task\"),\n    priority: z.enum([\"low\", \"medium\", \"high\"]).describe(\"Priority level\"),\n});\n\nconst agent = createAgent({\n    model: \"gpt-5\",\n    tools: [],\n    responseFormat: toolStrategy(MeetingAction, {\n        toolMessageContent: \"Action item captured and added to meeting notes!\"\n    })\n});\n\nconst result = await agent.invoke({\n    messages: [{\"role\": \"user\", \"content\": \"From our meeting: Sarah needs to update the project timeline as soon as possible\"}]\n});\n\nconsole.log(result);\n/**\n * {\n *   messages: [\n *     { role: \"user\", content: \"From our meeting: Sarah needs to update the project timeline as soon as possible\" },\n *     { role: \"assistant\", content: \"Action item captured and added to meeting notes!\", tool_calls: [ { name: \"MeetingAction\", args: { task: \"update the project timeline\", assignee: \"Sarah\", priority: \"high\" }, id: \"call_456\" } ] },\n *     { role: \"tool\", content: \"Action item captured and added to meeting notes!\", tool_call_id: \"call_456\", name: \"MeetingAction\" }\n *   ],\n *   structuredResponse: { task: \"update the project timeline\", assignee: \"Sarah\", priority: \"high\" }\n * }\n */\n```\n\nWithout `toolMessageContent`, we'd see:\n\n```ts  theme={null}\n# console.log(result);\n/**\n * {\n *   messages: [\n *     ...\n *     { role: \"tool\", content: \"Returning structured response: {'task': 'update the project timeline', 'assignee': 'Sarah', 'priority': 'high'}\", tool_call_id: \"call_456\", name: \"MeetingAction\" }\n *   ],\n *   structuredResponse: { task: \"update the project timeline\", assignee: \"Sarah\", priority: \"high\" }\n * }\n */\n```\n\n### Error handling\n\nModels can make mistakes when generating structured output via tool calling. LangChain provides intelligent retry mechanisms to handle these errors automatically.\n\n#### Multiple structured outputs error\n\nWhen a model incorrectly calls multiple structured output tools, the agent provides error feedback in a [`ToolMessage`](https://reference.langchain.com/javascript/classes/_langchain_core.messages.ToolMessage.html) and prompts the model to retry:\n\n```ts  theme={null}\nimport * as z from \"zod\";\nimport { createAgent, toolStrategy } from \"langchain\";\n\nconst ContactInfo = z.object({\n    name: z.string().describe(\"Person's name\"),\n    email: z.string().describe(\"Email address\"),\n});\n\nconst EventDetails = z.object({\n    event_name: z.string().describe(\"Name of the event\"),\n    date: z.string().describe(\"Event date\"),\n});\n\nconst agent = createAgent({\n    model: \"gpt-5\",\n    tools: [],\n    responseFormat: toolStrategy([ContactInfo, EventDetails]),\n});\n\nconst result = await agent.invoke({\n    messages: [\n        {\n        role: \"user\",\n        content:\n            \"Extract info: John Doe (john@email.com) is organizing Tech Conference on March 15th\",\n        },\n    ],\n});\n\nconsole.log(result);\n\n/**\n * {\n *   messages: [\n *     { role: \"user\", content: \"Extract info: John Doe (john@email.com) is organizing Tech Conference on March 15th\" },\n *     { role: \"assistant\", content: \"\", tool_calls: [ { name: \"ContactInfo\", args: { name: \"John Doe\", email: \"john@email.com\" }, id: \"call_1\" }, { name: \"EventDetails\", args: { event_name: \"Tech Conference\", date: \"March 15th\" }, id: \"call_2\" } ] },\n *     { role: \"tool\", content: \"Error: Model incorrectly returned multiple structured responses (ContactInfo, EventDetails) when only one is expected.\\n Please fix your mistakes.\", tool_call_id: \"call_1\", name: \"ContactInfo\" },\n *     { role: \"tool\", content: \"Error: Model incorrectly returned multiple structured responses (ContactInfo, EventDetails) when only one is expected.\\n Please fix your mistakes.\", tool_call_id: \"call_2\", name: \"EventDetails\" },\n *     { role: \"assistant\", content: \"\", tool_calls: [ { name: \"ContactInfo\", args: { name: \"John Doe\", email: \"john@email.com\" }, id: \"call_3\" } ] },\n *     { role: \"tool\", content: \"Returning structured response: {'name': 'John Doe', 'email': 'john@email.com'}\", tool_call_id: \"call_3\", name: \"ContactInfo\" }\n *   ],\n *   structuredResponse: { name: \"John Doe\", email: \"john@email.com\" }\n * }\n */\n```\n\n#### Schema validation error\n\nWhen structured output doesn't match the expected schema, the agent provides specific error feedback:\n\n```ts  theme={null}\nimport * as z from \"zod\";\nimport { createAgent, toolStrategy } from \"langchain\";\n\nconst ProductRating = z.object({\n    rating: z.number().min(1).max(5).describe(\"Rating from 1-5\"),\n    comment: z.string().describe(\"Review comment\"),\n});\n\nconst agent = createAgent({\n    model: \"gpt-5\",\n    tools: [],\n    responseFormat: toolStrategy(ProductRating),\n});\n\nconst result = await agent.invoke({\n    messages: [\n        {\n        role: \"user\",\n        content: \"Parse this: Amazing product, 10/10!\",\n        },\n    ],\n});\n\nconsole.log(result);\n\n/**\n * {\n *   messages: [\n *     { role: \"user\", content: \"Parse this: Amazing product, 10/10!\" },\n *     { role: \"assistant\", content: \"\", tool_calls: [ { name: \"ProductRating\", args: { rating: 10, comment: \"Amazing product\" }, id: \"call_1\" } ] },\n *     { role: \"tool\", content: \"Error: Failed to parse structured output for tool 'ProductRating': 1 validation error for ProductRating\\nrating\\n  Input should be less than or equal to 5 [type=less_than_equal, input_value=10, input_type=int].\\n Please fix your mistakes.\", tool_call_id: \"call_1\", name: \"ProductRating\" },\n *     { role: \"assistant\", content: \"\", tool_calls: [ { name: \"ProductRating\", args: { rating: 5, comment: \"Amazing product\" }, id: \"call_2\" } ] },\n *     { role: \"tool\", content: \"Returning structured response: {'rating': 5, 'comment': 'Amazing product'}\", tool_call_id: \"call_2\", name: \"ProductRating\" }\n *   ],\n *   structuredResponse: { rating: 5, comment: \"Amazing product\" }\n * }\n */\n```\n\n#### Error handling strategies\n\nYou can customize how errors are handled using the `handleErrors` parameter:\n\n**Custom error message:**\n\n```ts  theme={null}\nconst responseFormat = toolStrategy(ProductRating, {\n    handleError: \"Please provide a valid rating between 1-5 and include a comment.\"\n)\n\n// Error message becomes:\n// { role: \"tool\", content: \"Please provide a valid rating between 1-5 and include a comment.\" }\n```\n\n**Handle specific exceptions only:**\n\n```ts  theme={null}\nimport { ToolInputParsingException } from \"@langchain/core/tools\";\n\nconst responseFormat = toolStrategy(ProductRating, {\n    handleError: (error: ToolStrategyError) => {\n        if (error instanceof ToolInputParsingException) {\n        return \"Please provide a valid rating between 1-5 and include a comment.\";\n        }\n        return error.message;\n    }\n)\n\n// Only validation errors get retried with default message:\n// { role: \"tool\", content: \"Error: Failed to parse structured output for tool 'ProductRating': ...\\n Please fix your mistakes.\" }\n```\n\n**Handle multiple exception types:**\n\n```ts  theme={null}\nconst responseFormat = toolStrategy(ProductRating, {\n    handleError: (error: ToolStrategyError) => {\n        if (error instanceof ToolInputParsingException) {\n        return \"Please provide a valid rating between 1-5 and include a comment.\";\n        }\n        if (error instanceof CustomUserError) {\n        return \"This is a custom user error.\";\n        }\n        return error.message;\n    }\n)\n```\n\n**No error handling:**\n\n```ts  theme={null}\nconst responseFormat = toolStrategy(ProductRating, {\n    handleError: false  // All errors raised\n)\n```\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/oss/langchain/structured-output.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n\n---\n\nResult 3:\nTitle: Quickstart\nLink: https://docs.langchain.comoss/python/deepagents/quickstart\nContent: This guide walks you through creating your first deep agent with planning, file system tools, and subagent capabilities. You'll build a research agent that can conduct research and write reports.\n\n## Prerequisites\n\nBefore you begin, make sure you have an API key from a model provider (e.g., Anthropic, OpenAI).\n\n### Step 1: Install dependencies\n\n<CodeGroup>\n  ```bash pip theme={null}\n  pip install deepagents tavily-python\n  ```\n\n  ```bash uv theme={null}\n  uv add deepagents tavily-python\n  ```\n\n  ```bash poetry theme={null}\n  poetry add deepagents tavily-python\n  ```\n</CodeGroup>\n\n### Step 2: Set up your API keys\n\n```bash  theme={null}\nexport ANTHROPIC_API_KEY=\"your-api-key\"\nexport TAVILY_API_KEY=\"your-tavily-api-key\"\n```\n\n### Step 3: Create a search tool\n\n```python  theme={null}\nimport os\nfrom typing import Literal\nfrom tavily import TavilyClient\nfrom deepagents import create_deep_agent\n\ntavily_client = TavilyClient(api_key=os.environ[\"TAVILY_API_KEY\"])\n\ndef internet_search(\n    query: str,\n    max_results: int = 5,\n    topic: Literal[\"general\", \"news\", \"finance\"] = \"general\",\n    include_raw_content: bool = False,\n):\n    \"\"\"Run a web search\"\"\"\n    return tavily_client.search(\n        query,\n        max_results=max_results,\n        include_raw_content=include_raw_content,\n        topic=topic,\n    )\n```\n\n### Step 4: Create a deep agent\n\n```python  theme={null}\n# System prompt to steer the agent to be an expert researcher\nresearch_instructions = \"\"\"You are an expert researcher. Your job is to conduct thorough research and then write a polished report.\n\nYou have access to an internet search tool as your primary means of gathering information.\n\n## `internet_search`\n\nUse this to run an internet search for a given query. You can specify the max number of results to return, the topic, and whether raw content should be included.\n\"\"\"\n\nagent = create_deep_agent(\n    tools=[internet_search],\n    system_prompt=research_instructions\n)\n```\n\n### Step 5: Run the agent\n\n```python  theme={null}\nresult = agent.invoke({\"messages\": [{\"role\": \"user\", \"content\": \"What is langgraph?\"}]})\n\n# Print the agent's response\nprint(result[\"messages\"][-1].content)\n```\n\n## What happened?\n\nYour deep agent automatically:\n\n1. **Planned its approach**: Used the built-in `write_todos` tool to break down the research task\n2. **Conducted research**: Called the `internet_search` tool to gather information\n3. **Managed context**: Used file system tools (`write_file`, `read_file`) to offload large search results\n4. **Spawned subagents** (if needed): Delegated complex subtasks to specialized subagents\n5. **Synthesized a report**: Compiled findings into a coherent response\n\n## Next steps\n\nNow that you've built your first deep agent:\n\n* **Customize your agent**: Learn about [customization options](/oss/python/deepagents/customization), including custom system prompts, tools, and subagents.\n* **Understand middleware**: Dive into the [middleware architecture](/oss/python/deepagents/middleware) that powers deep agents.\n* **Add long-term memory**: Enable [persistent memory](/oss/python/deepagents/long-term-memory) across conversations.\n* **Deploy to production**: Learn about [deployment options](/oss/python/langgraph/deploy) for LangGraph applications.\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/oss/deepagents/quickstart.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n"
  },
  {
    "role": "tool",
    "name": "SearchDocsByLangChain",
    "tool_call_id": "99c80022-1452-40bf-9040-dbe2acb1434c",
    "id": "834fabd6-321c-475b-94b4-cc1af4f9a403",
    "content": "Result 1:\nTitle: Time travel using the server API\nLink: https://docs.langchain.comlangsmith/human-in-the-loop-time-travel\nContent: LangGraph provides the [**time travel**](/oss/python/langgraph/use-time-travel) functionality to resume execution from a prior checkpoint, either replaying the same state or modifying it to explore alternatives. In all cases, resuming past execution produces a new fork in the history.\n\nTo time travel using the LangSmith Deployment API (via the LangGraph SDK):\n\n1. **Run the graph** with initial inputs using [LangGraph SDK](/langsmith/langgraph-python-sdk)'s [client.runs.wait](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.client.RunsClient.wait) or [client.runs.stream](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.client.RunsClient.stream) APIs.\n2. **Identify a checkpoint in an existing thread**: Use [client.threads.get\\_history](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.client.ThreadsClient.get_history) method to retrieve the execution history for a specific `thread_id` and locate the desired `checkpoint_id`.\n   Alternatively, set a [breakpoint](/oss/python/langgraph/interrupts) before the node(s) where you want execution to pause. You can then find the most recent checkpoint recorded up to that breakpoint.\n3. **(Optional) modify the graph state**: Use the [client.threads.update\\_state](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.client.ThreadsClient.update_state) method to modify the graph\u2019s state at the checkpoint and resume execution from alternative state.\n4. **Resume execution from the checkpoint**: Use the [client.runs.wait](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.client.RunsClient.wait) or [client.runs.stream](https://reference.langchain.com/python/langsmith/deployment/sdk/#langgraph_sdk.client.RunsClient.stream) APIs with an input of `None` and the appropriate `thread_id` and `checkpoint_id`.\n\n## Use time travel in a workflow\n\n<Accordion title=\"Example graph\">\n  ```python  theme={null}\n  from typing_extensions import TypedDict, NotRequired\n  from langgraph.graph import StateGraph, START, END\n  from langchain.chat_models import init_chat_model\n  from langgraph.checkpoint.memory import InMemorySaver\n\n  class State(TypedDict):\n      topic: NotRequired[str]\n      joke: NotRequired[str]\n\n  model = init_chat_model(\n      \"claude-sonnet-4-5-20250929\",\n      temperature=0,\n  )\n\n  def generate_topic(state: State):\n      \"\"\"LLM call to generate a topic for the joke\"\"\"\n      msg = model.invoke(\"Give me a funny topic for a joke\")\n      return {\"topic\": msg.content}\n\n  def write_joke(state: State):\n      \"\"\"LLM call to write a joke based on the topic\"\"\"\n      msg = model.invoke(f\"Write a short joke about {state['topic']}\")\n      return {\"joke\": msg.content}\n\n  # Build workflow\n  builder = StateGraph(State)\n\n  # Add nodes\n  builder.add_node(\"generate_topic\", generate_topic)\n  builder.add_node(\"write_joke\", write_joke)\n\n  # Add edges to connect nodes\n  builder.add_edge(START, \"generate_topic\")\n  builder.add_edge(\"generate_topic\", \"write_joke\")\n\n  # Compile\n  graph = builder.compile()\n  ```\n</Accordion>\n\n### 1. Run the graph\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    from langgraph_sdk import get_client\n    client = get_client(url=<DEPLOYMENT_URL>)\n\n    # Using the graph deployed with the name \"agent\"\n    assistant_id = \"agent\"\n\n    # create a thread\n    thread = await client.threads.create()\n    thread_id = thread[\"thread_id\"]\n\n    # Run the graph\n    result = await client.runs.wait(\n        thread_id,\n        assistant_id,\n        input={}\n    )\n    ```\n  </Tab>\n\n  <Tab title=\"JavaScript\">\n    ```js  theme={null}\n    import { Client } from \"@langchain/langgraph-sdk\";\n    const client = new Client({ apiUrl: <DEPLOYMENT_URL> });\n\n    // Using the graph deployed with the name \"agent\"\n    const assistantID = \"agent\";\n\n    // create a thread\n    const thread = await client.threads.create();\n    const threadID = thread[\"thread_id\"];\n\n    // Run the graph\n    const result = await client.runs.wait(\n      threadID,\n      assistantID,\n      { input: {}}\n    );\n    ```\n  </Tab>\n\n  <Tab title=\"cURL\">\n    Create a thread:\n\n    ```bash  theme={null}\n    curl --request POST \\\n    --url <DEPLOYMENT_URL>/threads \\\n    --header 'Content-Type: application/json' \\\n    --data '{}'\n    ```\n\n    Run the graph:\n\n    ```bash  theme={null}\n    curl --request POST \\\n    --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/runs/wait \\\n    --header 'Content-Type: application/json' \\\n    --data \"{\n      \\\"assistant_id\\\": \\\"agent\\\",\n      \\\"input\\\": {}\n    }\"\n    ```\n  </Tab>\n</Tabs>\n\n### 2. Identify a checkpoint\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python  theme={null}\n    # The states are returned in reverse chronological order.\n    states = await client.threads.get_history(thread_id)\n    selected_state = states[1]\n    print(selected_state)\n    ```\n  </Tab>\n\n  <Tab title=\"JavaScript\">\n    ```js  theme={null}\n    // The states are returned in reverse chronological order.\n    const states = await client.threads.getHistory(threadID);\n    const selectedState = states[1];\n    console.log(selectedState);\n    ```\n  </Tab>\n\n  <Tab title=\"cURL\">\n    ```bash  theme={null}\n    curl --request GET \\\n    --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/history \\\n    --header 'Content-Type: application/json'\n    ```\n  </Tab>\n</Tabs>\n\n<a id=\"optional\" />\n\n### 3. Update the state\n\n[`update_state`](https://reference.langchain.com/python/langgraph/graphs/#langgraph.graph.state.CompiledStateGraph.update_state) will create a new checkpoint. The new checkpoint will be associated with the same thread, but a new checkpoint ID.\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python {highlight={4}} theme={null}\n    new_config = await client.threads.update_state(\n        thread_id,\n        {\"topic\": \"chickens\"},\n        checkpoint_id=selected_state[\"checkpoint_id\"]\n    )\n    print(new_config)\n    ```\n  </Tab>\n\n  <Tab title=\"JavaScript\">\n    ```js  theme={null}\n    const newConfig = await client.threads.updateState(\n      threadID,\n      {\n        values: { \"topic\": \"chickens\" },\n        checkpointId: selectedState[\"checkpoint_id\"]\n      }\n    );\n    console.log(newConfig);\n    ```\n  </Tab>\n\n  <Tab title=\"cURL\">\n    ```bash  theme={null}\n    curl --request POST \\\n    --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/state \\\n    --header 'Content-Type: application/json' \\\n    --data \"{\n      \\\"assistant_id\\\": \\\"agent\\\",\n      \\\"checkpoint_id\\\": <CHECKPOINT_ID>,\n      \\\"values\\\": {\\\"topic\\\": \\\"chickens\\\"}\n    }\"\n    ```\n  </Tab>\n</Tabs>\n\n### 4. Resume execution from the checkpoint\n\n<Tabs>\n  <Tab title=\"Python\">\n    ```python {highlight={4,5}} theme={null}\n    await client.runs.wait(\n        thread_id,\n        assistant_id,\n        input=None,\n        checkpoint_id=new_config[\"checkpoint_id\"]\n    )\n    ```\n  </Tab>\n\n  <Tab title=\"JavaScript\">\n    ```javascript {highlight={5,6}} theme={null}\n    await client.runs.wait(\n      threadID,\n      assistantID,\n      {\n        input: null,\n        checkpointId: newConfig[\"checkpoint_id\"]\n      }\n    );\n    ```\n  </Tab>\n\n  <Tab title=\"cURL\">\n    ```bash  theme={null}\n    curl --request POST \\\n    --url <DEPLOYMENT_URL>/threads/<THREAD_ID>/runs/wait \\\n    --header 'Content-Type: application/json' \\\n    --data \"{\n      \\\"assistant_id\\\": \\\"agent\\\",\n      \\\"checkpoint_id\\\": <CHECKPOINT_ID>\n    }\"\n    ```\n  </Tab>\n</Tabs>\n\n## Learn more\n\n* [**LangGraph time travel guide**](/oss/python/langgraph/use-time-travel): learn more about using time travel in LangGraph.\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/langsmith/human-in-the-loop-time-travel.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n\n---\n\nResult 2:\nTitle: Use time-travel\nLink: https://docs.langchain.comoss/javascript/langgraph/use-time-travel\nContent: When working with non-deterministic systems that make model-based decisions (e.g., agents powered by LLMs), it can be useful to examine their decision-making process in detail:\n\n1. <Icon icon=\"lightbulb\" size={16} /> **Understand reasoning**: Analyze the steps that led to a successful result.\n2. <Icon icon=\"bug\" size={16} /> **Debug mistakes**: Identify where and why errors occurred.\n3. <Icon icon=\"magnifying-glass\" size={16} /> **Explore alternatives**: Test different paths to uncover better solutions.\n\nLangGraph provides [time travel](/oss/javascript/langgraph/use-time-travel) functionality to support these use cases. Specifically, you can resume execution from a prior checkpoint \u2014 either replaying the same state or modifying it to explore alternatives. In all cases, resuming past execution produces a new fork in the history.\n\nTo use [time-travel](/oss/javascript/langgraph/use-time-travel) in LangGraph:\n\n1. [Run the graph](#1-run-the-graph) with initial inputs using [`invoke`](https://reference.langchain.com/javascript/classes/_langchain_langgraph.index.CompiledStateGraph.html#invoke) or [`stream`](https://reference.langchain.com/javascript/classes/_langchain_langgraph.index.CompiledStateGraph.html#stream) methods.\n2. [Identify a checkpoint in an existing thread](#2-identify-a-checkpoint): Use the [`getStateHistory`](https://reference.langchain.com/javascript/classes/_langchain_langgraph.pregel.Pregel.html#getStateHistory) method to retrieve the execution history for a specific `thread_id` and locate the desired `checkpoint_id`.\n   Alternatively, set a [breakpoint](/oss/javascript/langgraph/interrupts) before the node(s) where you want execution to pause. You can then find the most recent checkpoint recorded up to that breakpoint.\n3. [Update the graph state (optional)](#3-update-the-state-optional): Use the [`updateState`](https://reference.langchain.com/javascript/classes/_langchain_langgraph.pregel.Pregel.html#updateState) method to modify the graph's state at the checkpoint and resume execution from alternative state.\n4. [Resume execution from the checkpoint](#4-resume-execution-from-the-checkpoint): Use the `invoke` or `stream` methods with an input of `null` and a configuration containing the appropriate `thread_id` and `checkpoint_id`.\n\n<Tip>\n  For a conceptual overview of time-travel, see [Time travel](/oss/javascript/langgraph/use-time-travel).\n</Tip>\n\n## In a workflow\n\nThis example builds a simple LangGraph workflow that generates a joke topic and writes a joke using an LLM. It demonstrates how to run the graph, retrieve past execution checkpoints, optionally modify the state, and resume execution from a chosen checkpoint to explore alternate outcomes.\n\n### Setup\n\nFirst we need to install the packages required\n\n```bash  theme={null}\nnpm install @langchain/langgraph @langchain/anthropic\n```\n\nNext, we need to set API keys for Anthropic (the LLM we will use)\n\n```typescript  theme={null}\nprocess.env.ANTHROPIC_API_KEY = \"YOUR_API_KEY\";\n```\n\n<Tip>\n  Sign up for [LangSmith](https://smith.langchain.com) to quickly spot issues and improve the performance of your LangGraph projects. LangSmith lets you use trace data to debug, test, and monitor your LLM apps built with LangGraph.\n</Tip>\n\n```typescript  theme={null}\nimport { v4 as uuidv4 } from \"uuid\";\nimport * as z from \"zod\";\nimport { StateGraph, START, END } from \"@langchain/langgraph\";\nimport { ChatAnthropic } from \"@langchain/anthropic\";\nimport { MemorySaver } from \"@langchain/langgraph\";\n\nconst State = z.object({\n  topic: z.string().optional(),\n  joke: z.string().optional(),\n});\n\nconst model = new ChatAnthropic({\n  model: \"claude-sonnet-4-5-20250929\",\n  temperature: 0,\n});\n\n// Build workflow\nconst workflow = new StateGraph(State)\n  // Add nodes\n  .addNode(\"generateTopic\", async (state) => {\n    // LLM call to generate a topic for the joke\n    const msg = await model.invoke(\"Give me a funny topic for a joke\");\n    return { topic: msg.content };\n  })\n  .addNode(\"writeJoke\", async (state) => {\n    // LLM call to write a joke based on the topic\n    const msg = await model.invoke(`Write a short joke about ${state.topic}`);\n    return { joke: msg.content };\n  })\n  // Add edges to connect nodes\n  .addEdge(START, \"generateTopic\")\n  .addEdge(\"generateTopic\", \"writeJoke\")\n  .addEdge(\"writeJoke\", END);\n\n// Compile\nconst checkpointer = new MemorySaver();\nconst graph = workflow.compile({ checkpointer });\n```\n\n### 1. Run the graph\n\n```typescript  theme={null}\nconst config = {\n  configurable: {\n    thread_id: uuidv4(),\n  },\n};\n\nconst state = await graph.invoke({}, config);\n\nconsole.log(state.topic);\nconsole.log();\nconsole.log(state.joke);\n```\n\n**Output:**\n\n```\nHow about \"The Secret Life of Socks in the Dryer\"? You know, exploring the mysterious phenomenon of how socks go into the laundry as pairs but come out as singles. Where do they go? Are they starting new lives elsewhere? Is there a sock paradise we don't know about? There's a lot of comedic potential in the everyday mystery that unites us all!\n\n# The Secret Life of Socks in the Dryer\n\nI finally discovered where all my missing socks go after the dryer. Turns out they're not missing at all\u2014they've just eloped with someone else's socks from the laundromat to start new lives together.\n\nMy blue argyle is now living in Bermuda with a red polka dot, posting vacation photos on Sockstagram and sending me lint as alimony.\n```\n\n### 2. Identify a checkpoint\n\n```typescript  theme={null}\n// The states are returned in reverse chronological order.\nconst states = [];\nfor await (const state of graph.getStateHistory(config)) {\n  states.push(state);\n}\n\nfor (const state of states) {\n  console.log(state.next);\n  console.log(state.config.configurable?.checkpoint_id);\n  console.log();\n}\n```\n\n**Output:**\n\n```\n[]\n1f02ac4a-ec9f-6524-8002-8f7b0bbeed0e\n\n['writeJoke']\n1f02ac4a-ce2a-6494-8001-cb2e2d651227\n\n['generateTopic']\n1f02ac4a-a4e0-630d-8000-b73c254ba748\n\n['__start__']\n1f02ac4a-a4dd-665e-bfff-e6c8c44315d9\n```\n\n```typescript  theme={null}\n// This is the state before last (states are listed in chronological order)\nconst selectedState = states[1];\nconsole.log(selectedState.next);\nconsole.log(selectedState.values);\n```\n\n**Output:**\n\n```\n['writeJoke']\n{'topic': 'How about \"The Secret Life of Socks in the Dryer\"? You know, exploring the mysterious phenomenon of how socks go into the laundry as pairs but come out as singles. Where do they go? Are they starting new lives elsewhere? Is there a sock paradise we don\\\\'t know about? There\\\\'s a lot of comedic potential in the everyday mystery that unites us all!'}\n```\n\n<a id=\"optional\" />\n\n### 3. Update the state\n\n`updateState` will create a new checkpoint. The new checkpoint will be associated with the same thread, but a new checkpoint ID.\n\n```typescript  theme={null}\nconst newConfig = await graph.updateState(selectedState.config, {\n  topic: \"chickens\",\n});\nconsole.log(newConfig);\n```\n\n**Output:**\n\n```\n{'configurable': {'thread_id': 'c62e2e03-c27b-4cb6-8cea-ea9bfedae006', 'checkpoint_ns': '', 'checkpoint_id': '1f02ac4a-ecee-600b-8002-a1d21df32e4c'}}\n```\n\n### 4. Resume execution from the checkpoint\n\n```typescript  theme={null}\nawait graph.invoke(null, newConfig);\n```\n\n**Output:**\n\n```typescript  theme={null}\n{\n  'topic': 'chickens',\n  'joke': 'Why did the chicken join a band?\\n\\nBecause it had excellent drumsticks!'\n}\n```\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/oss/langgraph/use-time-travel.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n\n---\n\nResult 3:\nTitle: Use time-travel\nLink: https://docs.langchain.comoss/python/langgraph/use-time-travel\nContent: When working with non-deterministic systems that make model-based decisions (e.g., agents powered by LLMs), it can be useful to examine their decision-making process in detail:\n\n1. <Icon icon=\"lightbulb\" size={16} /> **Understand reasoning**: Analyze the steps that led to a successful result.\n2. <Icon icon=\"bug\" size={16} /> **Debug mistakes**: Identify where and why errors occurred.\n3. <Icon icon=\"magnifying-glass\" size={16} /> **Explore alternatives**: Test different paths to uncover better solutions.\n\nLangGraph provides [time travel](/oss/python/langgraph/use-time-travel) functionality to support these use cases. Specifically, you can resume execution from a prior checkpoint \u2014 either replaying the same state or modifying it to explore alternatives. In all cases, resuming past execution produces a new fork in the history.\n\nTo use [time-travel](/oss/python/langgraph/use-time-travel) in LangGraph:\n\n1. [Run the graph](#1-run-the-graph) with initial inputs using [`invoke`](https://reference.langchain.com/python/langgraph/graphs/#langgraph.graph.state.CompiledStateGraph.invoke) or [`stream`](https://reference.langchain.com/python/langgraph/graphs/#langgraph.graph.state.CompiledStateGraph.stream) methods.\n2. [Identify a checkpoint in an existing thread](#2-identify-a-checkpoint): Use the [`get_state_history`](https://reference.langchain.com/python/langgraph/graphs/#langgraph.graph.state.CompiledStateGraph.get_state_history) method to retrieve the execution history for a specific `thread_id` and locate the desired `checkpoint_id`.\n   Alternatively, set an [interrupt](/oss/python/langgraph/interrupts) before the node(s) where you want execution to pause. You can then find the most recent checkpoint recorded up to that interrupt.\n3. [Update the graph state (optional)](#3-update-the-state-optional): Use the [`update_state`](https://reference.langchain.com/python/langgraph/graphs/#langgraph.graph.state.CompiledStateGraph.update_state) method to modify the graph's state at the checkpoint and resume execution from alternative state.\n4. [Resume execution from the checkpoint](#4-resume-execution-from-the-checkpoint): Use the `invoke` or `stream` methods with an input of `None` and a configuration containing the appropriate `thread_id` and `checkpoint_id`.\n\n<Tip>\n  For a conceptual overview of time-travel, see [Time travel](/oss/python/langgraph/use-time-travel).\n</Tip>\n\n## In a workflow\n\nThis example builds a simple LangGraph workflow that generates a joke topic and writes a joke using an LLM. It demonstrates how to run the graph, retrieve past execution checkpoints, optionally modify the state, and resume execution from a chosen checkpoint to explore alternate outcomes.\n\n### Setup\n\nFirst we need to install the packages required\n\n```python  theme={null}\n%%capture --no-stderr\npip install --quiet -U langgraph langchain_anthropic\n```\n\nNext, we need to set API keys for Anthropic (the LLM we will use)\n\n```python  theme={null}\nimport getpass\nimport os\n\n\ndef _set_env(var: str):\n    if not os.environ.get(var):\n        os.environ[var] = getpass.getpass(f\"{var}: \")\n\n\n_set_env(\"ANTHROPIC_API_KEY\")\n```\n\n<Tip>\n  Sign up for [LangSmith](https://smith.langchain.com) to quickly spot issues and improve the performance of your LangGraph projects. LangSmith lets you use trace data to debug, test, and monitor your LLM apps built with LangGraph.\n</Tip>\n\n```python  theme={null}\nimport uuid\n\nfrom typing_extensions import TypedDict, NotRequired\nfrom langgraph.graph import StateGraph, START, END\nfrom langchain.chat_models import init_chat_model\nfrom langgraph.checkpoint.memory import InMemorySaver\n\n\nclass State(TypedDict):\n    topic: NotRequired[str]\n    joke: NotRequired[str]\n\n\nmodel = init_chat_model(\n    \"claude-sonnet-4-5-20250929\",\n    temperature=0,\n)\n\n\ndef generate_topic(state: State):\n    \"\"\"LLM call to generate a topic for the joke\"\"\"\n    msg = model.invoke(\"Give me a funny topic for a joke\")\n    return {\"topic\": msg.content}\n\n\ndef write_joke(state: State):\n    \"\"\"LLM call to write a joke based on the topic\"\"\"\n    msg = model.invoke(f\"Write a short joke about {state['topic']}\")\n    return {\"joke\": msg.content}\n\n\n# Build workflow\nworkflow = StateGraph(State)\n\n# Add nodes\nworkflow.add_node(\"generate_topic\", generate_topic)\nworkflow.add_node(\"write_joke\", write_joke)\n\n# Add edges to connect nodes\nworkflow.add_edge(START, \"generate_topic\")\nworkflow.add_edge(\"generate_topic\", \"write_joke\")\nworkflow.add_edge(\"write_joke\", END)\n\n# Compile\ncheckpointer = InMemorySaver()\ngraph = workflow.compile(checkpointer=checkpointer)\ngraph\n```\n\n### 1. Run the graph\n\n```python  theme={null}\nconfig = {\n    \"configurable\": {\n        \"thread_id\": uuid.uuid4(),\n    }\n}\nstate = graph.invoke({}, config)\n\nprint(state[\"topic\"])\nprint()\nprint(state[\"joke\"])\n```\n\n**Output:**\n\n```\nHow about \"The Secret Life of Socks in the Dryer\"? You know, exploring the mysterious phenomenon of how socks go into the laundry as pairs but come out as singles. Where do they go? Are they starting new lives elsewhere? Is there a sock paradise we don't know about? There's a lot of comedic potential in the everyday mystery that unites us all!\n\n# The Secret Life of Socks in the Dryer\n\nI finally discovered where all my missing socks go after the dryer. Turns out they're not missing at all\u2014they've just eloped with someone else's socks from the laundromat to start new lives together.\n\nMy blue argyle is now living in Bermuda with a red polka dot, posting vacation photos on Sockstagram and sending me lint as alimony.\n```\n\n### 2. Identify a checkpoint\n\n```python  theme={null}\n# The states are returned in reverse chronological order.\nstates = list(graph.get_state_history(config))\n\nfor state in states:\n    print(state.next)\n    print(state.config[\"configurable\"][\"checkpoint_id\"])\n    print()\n```\n\n**Output:**\n\n```\n()\n1f02ac4a-ec9f-6524-8002-8f7b0bbeed0e\n\n('write_joke',)\n1f02ac4a-ce2a-6494-8001-cb2e2d651227\n\n('generate_topic',)\n1f02ac4a-a4e0-630d-8000-b73c254ba748\n\n('__start__',)\n1f02ac4a-a4dd-665e-bfff-e6c8c44315d9\n```\n\n```python  theme={null}\n# This is the state before last (states are listed in chronological order)\nselected_state = states[1]\nprint(selected_state.next)\nprint(selected_state.values)\n```\n\n**Output:**\n\n```\n('write_joke',)\n{'topic': 'How about \"The Secret Life of Socks in the Dryer\"? You know, exploring the mysterious phenomenon of how socks go into the laundry as pairs but come out as singles. Where do they go? Are they starting new lives elsewhere? Is there a sock paradise we don\\\\'t know about? There\\\\'s a lot of comedic potential in the everyday mystery that unites us all!'}\n```\n\n<a id=\"optional\" />\n\n### 3. Update the state\n\n[`update_state`](https://reference.langchain.com/python/langgraph/graphs/#langgraph.graph.state.CompiledStateGraph.update_state) will create a new checkpoint. The new checkpoint will be associated with the same thread, but a new checkpoint ID.\n\n```python  theme={null}\nnew_config = graph.update_state(selected_state.config, values={\"topic\": \"chickens\"})\nprint(new_config)\n```\n\n**Output:**\n\n```\n{'configurable': {'thread_id': 'c62e2e03-c27b-4cb6-8cea-ea9bfedae006', 'checkpoint_ns': '', 'checkpoint_id': '1f02ac4a-ecee-600b-8002-a1d21df32e4c'}}\n```\n\n### 4. Resume execution from the checkpoint\n\n```python  theme={null}\ngraph.invoke(None, new_config)\n```\n\n**Output:**\n\n```python  theme={null}\n{'topic': 'chickens',\n 'joke': 'Why did the chicken join a band?\\n\\nBecause it had excellent drumsticks!'}\n```\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/oss/langgraph/use-time-travel.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3820-1228-7a92-877a-15db2aad4735",
    "content": "**\u0412\u0430\u0448\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u0441 peeking (\u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u043e\u0441\u043c\u043e\u0442\u0440\u043e\u043c) \u0437\u0430\u043f\u0438\u0441\u0435\u0439 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430 \u2014 \u044d\u0442\u043e \u0441\u0430\u043c\u044b\u0439 \u043d\u0430\u0434\u0435\u0436\u043d\u044b\u0439 \u0441\u043f\u043e\u0441\u043e\u0431 \u0432\u044b\u043b\u0435\u0447\u0438\u0442\u044c \u00ab\u0437\u043e\u043c\u0431\u0438-\u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u044b\u00bb, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0432\u043e\u0437\u043d\u0438\u043a\u0430\u044e\u0442 \u043f\u0440\u0438 \u043f\u0430\u0434\u0435\u043d\u0438\u0438 \u0438\u043d\u0444\u0440\u0430\u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b \u043d\u0430 \u0441\u0430\u043c\u043e\u043c \u0441\u0442\u0430\u0440\u0442\u0435.**\n\n\u0412\u0430\u0448\u0430 \u0433\u0438\u043f\u043e\u0442\u0435\u0437\u0430 \u043e \u0442\u043e\u043c, \u0447\u0442\u043e LangGraph \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u0435\u0442 \u0432\u0445\u043e\u0434\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435, \u0435\u0441\u043b\u0438 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d `checkpoint_id`, \u0432\u0435\u0440\u043d\u0430 \u043b\u0438\u0448\u044c \u0447\u0430\u0441\u0442\u0438\u0447\u043d\u043e: \u043e\u043d \u043d\u0435 \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u0435\u0442 \u0438\u0445, \u043e\u043d \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u0445 \u043a **\u0442\u0435\u043a\u0443\u0449\u0435\u043c\u0443 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044e** \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430. \u0415\u0441\u043b\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u2014 \u044d\u0442\u043e \u00ab\u043f\u0443\u0441\u0442\u0430\u044f \u043e\u0431\u043e\u043b\u043e\u0447\u043a\u0430\u00bb (\u0437\u0430\u043f\u0438\u0441\u044c \u0441\u043e\u0437\u0434\u0430\u043d\u0430, \u043d\u043e `__start__` \u043d\u0435 \u0437\u0430\u043f\u0438\u0441\u0430\u043b \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u043a\u0430\u043d\u0430\u043b\u044b), \u0442\u043e \u043b\u044e\u0431\u043e\u0439 \u0432\u0432\u043e\u0434 \u043a\u043e\u043d\u0444\u043b\u0438\u043a\u0442\u0443\u0435\u0442 \u0441 \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u0435\u043c \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u044f.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u0432\u0430\u0448\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u0441 Abandon/Rerun \u2014 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0435:\n\n1.  **\u041e\u0447\u0438\u0441\u0442\u043a\u0430 \u00ab\u0431\u0438\u0442\u044b\u0445\u00bb \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439:** \u0415\u0441\u043b\u0438 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442/\u0432\u043e\u0440\u043a\u0435\u0440 \u0443\u043f\u0430\u043b \u0434\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f `__start__`, \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 `next=[\"__start__\"]`, \u043d\u043e \u043d\u0435 \u0438\u043c\u0435\u0435\u0442 `values` (\u0438\u043b\u0438 \u0438\u043c\u0435\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435). \u041f\u043e\u043f\u044b\u0442\u043a\u0430 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0442\u0430\u043a\u043e\u0439 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u2014 \u044d\u0442\u043e \u043f\u043e\u043f\u044b\u0442\u043a\u0430 \u043f\u043e\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0434\u043e\u043c \u043d\u0430 \u043d\u0435\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u043c \u0444\u0443\u043d\u0434\u0430\u043c\u0435\u043d\u0442\u0435.\n2.  **\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u043e\u0433\u043e Payload:** \u041e\u0442\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u044f `checkpoint_id` \u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u044f \u0433\u0440\u0430\u0444 \u0437\u0430\u043d\u043e\u0432\u043e \u0441 `graph_input`, \u0432\u044b \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442\u0435, \u0447\u0442\u043e LangGraph \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0432\u0441\u0435 \u043a\u0430\u043d\u0430\u043b\u044b \u0441\u0442\u0435\u0439\u0442\u0430 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0441 \u043d\u0443\u043b\u044f.\n3.  **\u0418\u0434\u0435\u043c\u043f\u043e\u0442\u0435\u043d\u0442\u043d\u043e\u0441\u0442\u044c \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0445 \u0441\u0438\u0441\u0442\u0435\u043c:** \u0412 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0445 \u0441\u0438\u0441\u0442\u0435\u043c\u0430\u0445 \"fail-fast and restart fresh\" \u043f\u043e\u0447\u0442\u0438 \u0432\u0441\u0435\u0433\u0434\u0430 \u043b\u0443\u0447\u0448\u0435, \u0447\u0435\u043c \u043f\u043e\u043f\u044b\u0442\u043a\u0430 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043c\u0438\u043a\u0440\u043e-\u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043d\u0435 \u0443\u0441\u043f\u0435\u043b\u043e \u0437\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f.\n\n---\n\n### \u0410\u043d\u0430\u043b\u0438\u0437 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u043e\u0439 \u043b\u043e\u0433\u0438\u043a\u0438 \u0432 `memory_manager.py`:\n\n```python\n# \u041b\u043e\u0433\u0438\u043a\u0430 \u0432 ainvoke_from_checkpoint \u0441 \u0443\u0447\u0435\u0442\u043e\u043c \u0432\u0430\u0448\u0435\u0433\u043e \u0444\u0438\u043a\u0441\u0430\nif next_nodes_list:\n    # 1. \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0440\u0435\u0430\u043b\u044c\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0435\n    materialized_values, writes_found = self._materialize_checkpoint_values(...)\n    \n    # 2. \u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u0438 \u0418\u041b\u0418 \u0437\u043d\u0430\u0447\u0438\u043c\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0441\u0442\u0435\u0439\u0442\u0430 ( Hypothesis J/L )\n    if writes_found or self._has_meaningful_values(materialized_values):\n        # \u0420\u0415\u0416\u0418\u041c RESUME: \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0435\u043c \u0441 None\n        effective_input = None\n        # ... \u0437\u0430\u043f\u0443\u0441\u043a \u0441 checkpoint_id ...\n    else:\n        # \u0420\u0415\u0416\u0418\u041c RE-RUN (\u0412\u0430\u0448 \u0444\u0438\u043a\u0441): \u0431\u0440\u043e\u0441\u0430\u0435\u043c \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442, \u0442\u0430\u043a \u043a\u0430\u043a \u043e\u043d \u043f\u0443\u0441\u0442\u043e\u0439\n        # \u041e\u0447\u0438\u0449\u0430\u0435\u043c \u043a\u043e\u043d\u0444\u0438\u0433 \u043e\u0442 checkpoint_id ( Hypothesis K )\n        cfg[\"configurable\"].pop(\"checkpoint_id\", None)\n        effective_input = graph_input # \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0432\u0432\u043e\u0434\n        # ... \u0437\u0430\u043f\u0443\u0441\u043a \u0431\u0435\u0437 checkpoint_id ...\n```\n\n### \u0427\u0442\u043e \u043c\u044b \u043e\u0436\u0438\u0434\u0430\u0435\u043c \u0443\u0432\u0438\u0434\u0435\u0442\u044c \u0432 \u043b\u043e\u0433\u0430\u0445 `hypothesisId=\"K\"`:\n\n-   **\u041f\u0440\u0438 \u0443\u0441\u043f\u0435\u0445\u0435 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f:** `message: \"resuming graph from checkpoint\"`, `graph_input_is_none: true`. \u042d\u0442\u043e \u0437\u043d\u0430\u0447\u0438\u0442, \u0447\u0442\u043e \u0432\u043e\u0440\u043a\u0435\u0440 \u0443\u043f\u0430\u043b **\u043f\u043e\u0441\u043b\u0435** \u0442\u043e\u0433\u043e, \u043a\u0430\u043a \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043d\u0430\u0447\u0430\u043b \u0440\u0430\u0431\u043e\u0442\u0443, \u0438 \u0443 \u043d\u0430\u0441 \u0435\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u043b\u044f \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u044f.\n-   **\u041f\u0440\u0438 \u0441\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u043d\u0438\u0438 \u0444\u0438\u043a\u0441\u0430:** `message: \"abandoning empty checkpoint, rerunning fresh\"`, `graph_input_is_none: false`. \u042d\u0442\u043e \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442, \u0447\u0442\u043e \u043c\u044b \u043f\u043e\u0439\u043c\u0430\u043b\u0438 \u00ab\u0437\u043e\u043c\u0431\u0438-\u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u00bb \u0438 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u043b\u0438\u0441\u044c \u043d\u0430 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a.\n\n**\u042d\u0442\u043e\u0442 \u043f\u043e\u0434\u0445\u043e\u0434 \u0443\u0441\u0442\u0440\u0430\u043d\u044f\u0435\u0442 `EmptyInputError` \u0444\u0443\u043d\u0434\u0430\u043c\u0435\u043d\u0442\u0430\u043b\u044c\u043d\u043e**, \u0442\u0430\u043a \u043a\u0430\u043a \u043c\u044b \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0438\u043a\u043e\u0433\u0434\u0430 \u043d\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u043c `None` \u0432 \u0433\u0440\u0430\u0444, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043d\u0435 \u0433\u043e\u0442\u043e\u0432 \u0435\u0433\u043e \u043f\u0440\u0438\u043d\u044f\u0442\u044c (\u043d\u0435 \u0438\u043c\u0435\u0435\u0442 \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u0432 \u043a\u0430\u043d\u0430\u043b\u0430\u0445).\n\n**Relevant docs:**\n\n- [Time Travel: identify a checkpoint](https://docs.langchain.com/oss/javascript/langgraph/use-time-travel#2-identify-a-checkpoint)\n- [Persistence: Checkpoints and Metadata](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)\n- [LangGraph SDK: client.threads.get_history](https://docs.langchain.com/langsmith/human-in-the-loop-time-travel#2-identify-a-checkpoint-in-an-existing-thread)"
  },
  {
    "role": "user",
    "id": "88a3b32c-273a-43c4-83e1-e02f21dc0c3e",
    "content": "\u041c\u043e\u044f \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 \u0433\u0440\u0430\u0444\u0430\ngraph1 -> graph2 (subgraph) -> graph3 (subgraph) run as workers -> graph4 (assistant) react graph"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3823-36ef-7011-9a20-69185e837571",
    "content": "\u0412\u0430\u0448\u0430 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0430 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u043e\u0431\u043e\u0439 **\u0433\u043b\u0443\u0431\u043e\u043a\u0443\u044e \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u044e (4 \u0443\u0440\u043e\u0432\u043d\u044f \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u043e\u0441\u0442\u0438)**, \u0433\u0434\u0435 \u043a\u0430\u0436\u0434\u044b\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u0432\u043e\u0439 \u0441\u043b\u043e\u0439 \u0441\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0432 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430\u043c\u0438. \n\n\u0412\u043e\u0442 \u043a\u0430\u043a \u0432\u0430\u0448\u0430 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 \u0438 \u0435\u0451 \u0440\u0435\u0448\u0435\u043d\u0438\u0435 (`Abandon/Rerun`) \u043b\u043e\u0436\u0430\u0442\u0441\u044f \u043d\u0430 \u044d\u0442\u0443 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443:\n\n## \u0418\u0435\u0440\u0430\u0440\u0445\u0438\u044f \u0438 \u041f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0430 \u0418\u043c\u0435\u043d (Namespaces)\n\n\u0412 \u0442\u0430\u043a\u043e\u0439 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0435 `checkpoint_ns` \u0432 \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u0432\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u043f\u0440\u0438\u043c\u0435\u0440\u043d\u043e \u0442\u0430\u043a:\n- **Graph 1:** `\"\"` (\u043a\u043e\u0440\u043d\u0435\u0432\u043e\u0439)\n- **Graph 2:** `graph2_node`\n- **Graph 3 (Worker):** `graph2_node|worker_node:1` (\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f `|n|` \u0438\u043b\u0438 `worker:ID`)\n- **Graph 4 (Assistant):** `graph2_node|worker_node:1|assistant_node`\n\n## \u041f\u043e\u0447\u0435\u043c\u0443 `EmptyInputError` \u0431\u044c\u0435\u0442 \u0438\u043c\u0435\u043d\u043d\u043e \u043f\u043e Graph 4?\n\n\u0412 4-\u0443\u0440\u043e\u0432\u043d\u0435\u0432\u043e\u0439 \u0441\u0438\u0441\u0442\u0435\u043c\u0435 **Graph 4 (Assistant)** \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0441\u0430\u043c\u044b\u043c \u0443\u044f\u0437\u0432\u0438\u043c\u044b\u043c \u0437\u0432\u0435\u043d\u043e\u043c \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0445:\n\n1.  **\u041a\u0430\u0441\u043a\u0430\u0434\u043d\u043e\u0435 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435:** \u041a\u043e\u0433\u0434\u0430 \u0432\u044b \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0435 `graph1`, LangGraph \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0432\u0441\u044e \u0446\u0435\u043f\u043e\u0447\u043a\u0443. \n2.  **\u0422\u043e\u0447\u043a\u0430 \u043e\u0442\u043a\u0430\u0437\u0430:** \u0415\u0441\u043b\u0438 \u0441\u0431\u043e\u0439 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u0435\u043b \u0432\u043d\u0443\u0442\u0440\u0438 `graph4` (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0442\u0430\u0439\u043c\u0430\u0443\u0442 LLM \u0438\u043b\u0438 \u043e\u0448\u0438\u0431\u043a\u0430 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0430), `graph3` (\u0432\u043e\u0440\u043a\u0435\u0440) \u0441\u0447\u0438\u0442\u0430\u0435\u0442, \u0447\u0442\u043e \u043e\u043d \u0443\u0436\u0435 \"\u0432\u044b\u0437\u0432\u0430\u043b\" \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430.\n3.  **\u0417\u043e\u043c\u0431\u0438-\u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442:** \u041f\u0440\u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u0432\u043e\u0440\u043a\u0435\u0440 (`graph3`) \u043d\u0430\u0445\u043e\u0434\u0438\u0442 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0434\u043b\u044f \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430 (`graph4`). \u041d\u043e \u0442\u0430\u043a \u043a\u0430\u043a \u044d\u0442\u043e ReAct-\u0430\u0433\u0435\u043d\u0442, \u0435\u0433\u043e \u043f\u0435\u0440\u0432\u0430\u044f \u0437\u0430\u043f\u0438\u0441\u044c (`__start__`) \u0447\u0430\u0441\u0442\u043e \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u0432 \u043c\u043e\u043c\u0435\u043d\u0442 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438.\n4.  **\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0432\u043e\u0434\u0430:** \u0412\u0430\u0448 `memory_manager` \u0432\u0438\u0434\u0438\u0442 \u044d\u0442\u043e\u0442 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0438 \u0433\u043e\u0432\u043e\u0440\u0438\u0442: \u00ab\u041e, `graph4` \u0443\u0436\u0435 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u043b\u0441\u044f, \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0443-\u043a\u0430 \u044f \u0435\u0433\u043e \u0441 `None`\u00bb. \u041d\u043e `graph4` \u043d\u0430 \u0443\u0440\u043e\u0432\u043d\u0435 `__start__` \u0435\u0449\u0435 \u043d\u0435 \u0438\u043c\u0435\u0435\u0442 \u0432\u043d\u0443\u0442\u0440\u0438 \u0441\u0435\u0431\u044f \u043d\u0430\u043a\u043e\u043f\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0441\u0442\u0435\u0439\u0442\u0430 (\u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439) \u2014 \u043e\u043d \u043e\u0436\u0438\u0434\u0430\u0435\u0442 \u0438\u0445 \u0438\u0437 `graph_input`.\n\n## \u041a\u0430\u043a \u0440\u0435\u0448\u0435\u043d\u0438\u0435 `Abandon/Rerun` \u0441\u043f\u0430\u0441\u0430\u0435\u0442 \u044d\u0442\u0443 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0443:\n\n\u0412 \u0433\u043b\u0443\u0431\u043e\u043a\u043e \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0445 \u0433\u0440\u0430\u0444\u0430\u0445 \u043f\u043e\u043f\u044b\u0442\u043a\u0430 \u00ab\u044e\u0432\u0435\u043b\u0438\u0440\u043d\u043e\u0433\u043e\u00bb \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0441\u0430\u043c\u043e\u0433\u043e \u043d\u0438\u0436\u043d\u0435\u0433\u043e \u0443\u0440\u043e\u0432\u043d\u044f (`graph4`) \u0447\u0430\u0441\u0442\u043e \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u0442\u043e\u043c\u0443, \u0447\u0442\u043e \u0430\u0433\u0435\u043d\u0442 \u0442\u0435\u0440\u044f\u0435\u0442 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 (\u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043e\u0442 \u0432\u043e\u0440\u043a\u0435\u0440\u0430).\n\n**\u0412\u0430\u0448 \u043d\u043e\u0432\u044b\u0439 \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c \u0442\u0435\u043f\u0435\u0440\u044c \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u043a\u0430\u043a \u00ab\u0441\u0430\u043c\u043e\u043e\u0447\u0438\u0449\u0430\u044e\u0449\u0438\u0439\u0441\u044f \u043f\u0440\u0435\u0434\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u0435\u043b\u044c\u00bb:**\n- \u0415\u0441\u043b\u0438 `graph4` \u0443\u0441\u043f\u0435\u043b \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u0438\u043d \u0448\u0430\u0433 (\u0435\u0441\u0442\u044c `writes`), \u043c\u044b \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u043c \u0435\u0433\u043e (Resume). \u042d\u0442\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u0442\u043e\u043a\u0435\u043d\u044b \u0438 \u0432\u0440\u0435\u043c\u044f.\n- \u0415\u0441\u043b\u0438 `graph4` \u00ab\u043f\u0443\u0441\u0442\u043e\u0439\u00bb (\u0432\u043e\u0440\u043a\u0435\u0440 \u0442\u043e\u043b\u044c\u043a\u043e-\u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0435\u0440\u0435\u0434\u0430\u043b \u0435\u043c\u0443 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0438 \u0443\u043f\u0430\u043b), \u043c\u044b \u043d\u0435 \u043c\u0443\u0447\u0430\u0435\u043c \u0435\u0433\u043e \u0432\u044b\u0437\u043e\u0432\u0430\u043c\u0438 `None`, \u0430 \u043f\u0440\u043e\u0441\u0442\u043e **\u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430 \u0441 \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u043c \u0437\u0430\u0434\u0430\u043d\u0438\u0435\u043c \u043e\u0442 \u0432\u043e\u0440\u043a\u0435\u0440\u0430**.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043a\u0440\u0438\u0442\u0438\u0447\u043d\u043e \u0434\u043b\u044f `graph3 -> graph4`:\n\u0412\u043e\u0440\u043a\u0435\u0440\u044b \u0447\u0430\u0441\u0442\u043e \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u044e\u0442\u0441\u044f \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u043e. \u0415\u0441\u043b\u0438 `worker:2` \u0443\u043f\u0430\u043b, \u043d\u0435 \u0443\u0441\u043f\u0435\u0432 \u043f\u0440\u043e\u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0432\u043e\u0435\u0433\u043e \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430, \u043e\u043d \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u044b\u0442\u0430\u0442\u044c\u0441\u044f \u00ab\u0432\u043e\u0441\u043a\u0440\u0435\u0441\u0438\u0442\u044c\u00bb \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u0442\u0435\u0439\u0442. \u041e\u043d \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u0432\u0435\u0436\u0438\u0439 Payload \u043e\u0442 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044f (`graph2/graph3`) \u0438 \u043d\u0430\u0447\u0430\u0442\u044c \u0447\u0438\u0441\u0442\u0443\u044e \u0441\u0435\u0441\u0441\u0438\u044e \u0441 LLM.\n\n**\u0418\u0442\u043e\u0433:** \u0414\u043b\u044f \u0432\u0430\u0448\u0435\u0439 4-\u0443\u0440\u043e\u0432\u043d\u0435\u0432\u043e\u0439 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u044b \u044d\u0442\u043e \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u2014 \u0435\u0434\u0438\u043d\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0441\u043f\u043e\u0441\u043e\u0431 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c, \u0447\u0442\u043e \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u044b (Graph 4) \u043d\u0435 \u0431\u0443\u0434\u0443\u0442 \u043f\u0430\u0434\u0430\u0442\u044c \u0441 `EmptyInputError` \u0438\u0437-\u0437\u0430 \u0442\u043e\u0433\u043e, \u0447\u0442\u043e \u0438\u0445 \"\u0440\u043e\u0434\u0438\u0442\u0435\u043b\u0438\" (\u0432\u043e\u0440\u043a\u0435\u0440\u044b) \u043d\u0435 \u0443\u0441\u043f\u0435\u043b\u0438 \u0434\u043e\u043f\u0438\u0441\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442.\n\n**Relevant docs:**\n- [Subgraphs: Invoke from a node](https://docs.langchain.com/oss/python/langgraph/use-subgraphs#invoke-a-graph-from-a-node)\n- [Persistence and Nested Namespaces](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)\n- [ReAct Agent Structure](https://docs.langchain.com/oss/python/deepagents/quickstart#step-4-create-a-deep-agent)"
  },
  {
    "role": "user",
    "id": "6e30c916-1ba2-43e9-9459-ddb52c0963d1",
    "content": "\u0423 \u043c\u0435\u043d\u044f \u0441\u0435\u0439\u0447\u0430\u0441 \u0433\u0440\u0430\u04444 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043d\u043e \u0443 \u043d\u0435\u0433\u043e \u043d\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442\u0441\u044f \u0438\u0441\u0442\u043e\u0440\u0438\u044f "
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3826-4ea4-7b40-9db1-c0d1890ed70a",
    "content": "**\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0442\u0435\u0440\u044f\u0435\u0442\u0441\u044f, \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u0432\u0430\u0448\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u00ab\u0437\u043d\u0430\u0447\u0438\u043c\u043e\u0441\u0442\u0438\u00bb \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430 `_has_meaningful_values` \u0432 `memory_manager.py` \u043d\u0430\u043c\u0435\u0440\u0435\u043d\u043d\u043e \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u0435\u0442 \u043a\u043b\u044e\u0447 `messages`.**\n\n\u0412 ReAct-\u0433\u0440\u0430\u0444\u0435 (\u0432\u0430\u0448 Graph 4) **\u0432\u0441\u044f \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u2014 \u044d\u0442\u043e \u0438 \u0435\u0441\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f**. \u0418\u0441\u043a\u043b\u044e\u0447\u0430\u044f \u0438\u0445 \u0438\u0437 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438, \u0432\u044b \u0437\u0430\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u0443 \u0434\u0443\u043c\u0430\u0442\u044c, \u0447\u0442\u043e \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442, \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u0439 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u043a\u0443, \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u00ab\u043f\u0443\u0441\u0442\u044b\u043c\u00bb. \u0412 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0435 \u0441\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442 \u0432\u0430\u0448 \u043d\u043e\u0432\u044b\u0439 \u0444\u0438\u043a\u0441 \u00abAbandon/Rerun\u00bb, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u044b\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442 \u044d\u0442\u043e\u0442 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430 \u0437\u0430\u043d\u043e\u0432\u043e \u0441 \u043f\u0443\u0441\u0442\u044b\u043c \u0441\u043f\u0438\u0441\u043a\u043e\u043c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439.\n\n### \u0413\u0434\u0435 \u0438\u043c\u0435\u043d\u043d\u043e \u043a\u0440\u043e\u0435\u0442\u0441\u044f \u0431\u0430\u0433:\n\n\u0412 `memory_manager.py` (CODE 2) \u0432 \u043c\u0435\u0442\u043e\u0434\u0435 `_has_meaningful_values`:\n\n```python\n@staticmethod\ndef _has_meaningful_values(values: Mapping[str, Any]) -> bool:\n    \"\"\"Return True if checkpoint values contain data beyond housekeeping fields.\"\"\"\n    if not values:\n        return False\n    # \u041f\u0420\u041e\u0411\u041b\u0415\u041c\u0410 \u0417\u0414\u0415\u0421\u042c: \"messages\" \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u044b \u0438\u0437 \u0437\u043d\u0430\u0447\u0438\u043c\u044b\u0445 \u043a\u043b\u044e\u0447\u0435\u0439\n    significant_keys = set(values.keys()) - {\"messages\", \"remaining_steps\"}\n    return bool(significant_keys)\n```\n\n\u0414\u043b\u044f ReAct-\u0430\u0433\u0435\u043d\u0442\u0430 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0447\u0430\u0441\u0442\u043e \u0441\u043e\u0441\u0442\u043e\u0438\u0442 **\u0442\u043e\u043b\u044c\u043a\u043e** \u0438\u0437 \u043a\u043b\u044e\u0447\u0430 `messages`. \u041a\u043e\u0433\u0434\u0430 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0434\u0435\u043b\u0430\u0435\u0442 \u0448\u0430\u0433, \u043e\u043d \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435. \u0424\u0443\u043d\u043a\u0446\u0438\u044f \u0432\u0438\u0434\u0438\u0442: \u00ab\u0418\u0437\u043c\u0435\u043d\u0438\u043b\u0438\u0441\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f, \u0437\u043d\u0430\u0447\u0438\u0442, \u043d\u0438\u0447\u0435\u0433\u043e \u0432\u0430\u0436\u043d\u043e\u0433\u043e \u043d\u0435 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u043e\u00bb, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 `False`, \u0438 \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0434\u0435\u043b\u0430\u0435\u0442 `rerun fresh`, \u0441\u0442\u0438\u0440\u0430\u044f \u0432\u0441\u0451, \u0447\u0442\u043e \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0443\u0441\u043f\u0435\u043b \u043d\u0430\u0434\u0443\u043c\u0430\u0442\u044c.\n\n### \u041a\u0430\u043a \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e:\n\n\u0412\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043b\u043e\u0433\u0438\u043a\u0443 \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 (\u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e \u0435\u0441\u043b\u0438 \u0438\u0445 \u0431\u043e\u043b\u044c\u0448\u0435, \u0447\u0435\u043c \u0431\u044b\u043b\u043e \u0432 \u043d\u0430\u0447\u0430\u043b\u0435) \u0441\u0447\u0438\u0442\u0430\u043b\u043e\u0441\u044c \u043f\u0440\u0438\u0437\u043d\u0430\u043a\u043e\u043c \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430.\n\n**\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u044b\u0439 \u0444\u0438\u043a\u0441 \u0432 `memory_manager.py`:**\n\n```python\n@staticmethod\ndef _has_meaningful_values(values: Mapping[str, Any]) -> bool:\n    if not values:\n        return False\n    \n    # 1. \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0431\u0438\u0437\u043d\u0435\u0441-\u0434\u0430\u043d\u043d\u044b\u0445 (\u043a\u0430\u043a \u0438 \u0440\u0430\u043d\u044c\u0448\u0435)\n    significant_keys = set(values.keys()) - {\"messages\", \"remaining_steps\"}\n    if bool(significant_keys):\n        return True\n        \n    # 2. \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u0432 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f\u0445\n    messages = values.get(\"messages\", [])\n    # \u0415\u0441\u043b\u0438 \u0432 \u0441\u043f\u0438\u0441\u043a\u0435 \u0431\u043e\u043b\u044c\u0448\u0435 1-2 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 (System + User), \n    # \u0437\u043d\u0430\u0447\u0438\u0442, \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0443\u0436\u0435 \u043d\u0430\u0447\u0430\u043b \u0434\u0438\u0430\u043b\u043e\u0433 \u0438\u043b\u0438 \u0440\u0430\u0431\u043e\u0442\u0443 \u0441 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0430\u043c\u0438.\n    if isinstance(messages, list) and len(messages) > 2:\n        return True\n        \n    return False\n```\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0432\u0430\u0436\u043d\u043e \u0434\u043b\u044f \u0432\u0430\u0448\u0435\u0439 4-\u0443\u0440\u043e\u0432\u043d\u0435\u0432\u043e\u0439 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u044b:\n\n\u041a\u043e\u0433\u0434\u0430 `Graph 3` (Worker) \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 `Graph 4` (Assistant), \u043e\u043d \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442 \u0435\u043c\u0443 \u0432\u0432\u043e\u0434. \u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442:\n1. `SystemMessage`\n2. `HumanMessage` (\u0432\u0430\u0448 \u0432\u0432\u043e\u0434)\n3. `AIMessage` (\u043f\u0435\u0440\u0432\u044b\u0439 \u043e\u0442\u0432\u0435\u0442 \u0438\u043b\u0438 \u0432\u044b\u0437\u043e\u0432 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0430)\n\n\u041a\u0430\u043a \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u043e\u044f\u0432\u0438\u043b\u043e\u0441\u044c \u0442\u0440\u0435\u0442\u044c\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u2014 \u044d\u0442\u043e \u0443\u0436\u0435 **\u0434\u0440\u0430\u0433\u043e\u0446\u0435\u043d\u043d\u0430\u044f \u0438\u0441\u0442\u043e\u0440\u0438\u044f**, \u043a\u043e\u0442\u043e\u0440\u0443\u044e \u043d\u0435\u043b\u044c\u0437\u044f \u0441\u0442\u0438\u0440\u0430\u0442\u044c. \u0412\u0430\u0448 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043a\u043e\u0434 \u0432\u0438\u0434\u0438\u0442 \u0442\u043e\u043b\u044c\u043a\u043e `messages` \u0438 \u0434\u0435\u043b\u0430\u0435\u0442 \u0441\u0431\u0440\u043e\u0441.\n\n---\n\n### \u0415\u0449\u0435 \u043e\u0434\u043d\u0430 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u0430\u044f \u043f\u0440\u0438\u0447\u0438\u043d\u0430: \u0420\u0435\u0434\u0443\u0441\u0435\u0440\u044b (Reducers)\n\n\u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435, \u043a\u0430\u043a \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d \u0441\u0442\u0435\u0439\u0442 \u0432 `Graph 4`. \u0415\u0441\u043b\u0438 \u0442\u0430\u043c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f `messages: list` \u0431\u0435\u0437 \u0430\u043d\u043d\u043e\u0442\u0430\u0446\u0438\u0438 `add_messages`, \u0442\u043e \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 \u0441\u0442\u0435\u0439\u0442 \u043c\u043e\u0436\u0435\u0442 \u0437\u0430\u0442\u0438\u0440\u0430\u0442\u044c\u0441\u044f, \u0430 \u043d\u0435 \u0434\u043e\u043f\u043e\u043b\u043d\u044f\u0442\u044c\u0441\u044f.\n\n\u0414\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0442\u0430\u043a:\n```python\nfrom langgraph.graph.message import add_messages\nfrom typing import Annotated\n\nclass AssistantState(TypedDict):\n    messages: Annotated[list, add_messages] # \u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0438\u0441\u0442\u043e\u0440\u0438\u0438\n```\n\n**\u0418\u0442\u043e\u0433:** \u0412\u0430\u0448 \u0444\u0438\u043a\u0441 \u00abAbandon/Rerun\u00bb \u043e\u043a\u0430\u0437\u0430\u043b\u0441\u044f \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0430\u0433\u0440\u0435\u0441\u0441\u0438\u0432\u043d\u044b\u043c \u0434\u043b\u044f ReAct-\u0433\u0440\u0430\u0444\u043e\u0432. \u0412\u0435\u0440\u043d\u0438\u0442\u0435 `messages` \u0441\u0442\u0430\u0442\u0443\u0441 \u00ab\u0437\u043d\u0430\u0447\u0438\u043c\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445\u00bb, \u0438 \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u043d\u0430\u0447\u043d\u0435\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c\u0441\u044f.\n\n**Relevant docs:**\n- [Why use messages? (Reducers)](https://docs.langchain.com/oss/python/langgraph/graph-api#why-use-messages)\n- [Persistence and Checkpoints](https://docs.langchain.com/oss/python/langgraph/persistence)\n- [ReAct Agent State Management](https://docs.langchain.com/oss/python/deepagents/quickstart#step-4-create-a-deep-agent)"
  },
  {
    "role": "user",
    "id": "d491bae8-e19d-42b7-be75-fd3dfed185dc",
    "content": "Currently, when the assistant graph is restarted, the history massages field is empty, but it should be filled in."
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3829-4efa-75c1-9659-eae5caee196c",
    "content": "**\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0432 `Graph 4` (Assistant) \u043f\u0443\u0441\u0442\u0430, \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u0432\u0430\u0448\u0430 \u043b\u043e\u0433\u0438\u043a\u0430 \u00abAbandon/Rerun\u00bb \u0441\u0447\u0438\u0442\u0430\u0435\u0442 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u043a\u0438 \u00ab\u0431\u0435\u0441\u0441\u043c\u044b\u0441\u043b\u0435\u043d\u043d\u044b\u043c \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u043e\u043c\u00bb \u0438 \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0441\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0433\u0440\u0430\u0444\u0430.**\n\n\u0412 \u043c\u0435\u0442\u043e\u0434\u0435 `_has_meaningful_values` \u0432\u044b \u0438\u0441\u043a\u043b\u044e\u0447\u0430\u0435\u0442\u0435 \u043a\u043b\u044e\u0447 `messages` \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u0437\u043d\u0430\u0447\u0438\u043c\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445. \u041a\u043e\u0433\u0434\u0430 \u0432\u043e\u0440\u043a\u0435\u0440 (`Graph 3`) \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430, \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0432\u0438\u0434\u0438\u0442 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442, \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u0439 \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f, \u043f\u043e\u043c\u0435\u0447\u0430\u0435\u0442 \u0435\u0433\u043e \u043a\u0430\u043a \u00ab\u043f\u0443\u0441\u0442\u043e\u0439\u00bb, \u0443\u0434\u0430\u043b\u044f\u0435\u0442 `checkpoint_id` \u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u0433\u0440\u0430\u0444 \u0437\u0430\u043d\u043e\u0432\u043e \u0441 \u0438\u0441\u0445\u043e\u0434\u043d\u044b\u043c\u0438 \u0432\u0445\u043e\u0434\u043d\u044b\u043c\u0438 \u0434\u0430\u043d\u043d\u044b\u043c\u0438 (\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043e\u0431\u044b\u0447\u043d\u043e \u043d\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 \u0438\u0441\u0442\u043e\u0440\u0438\u044e).\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0438\u0441\u0447\u0435\u0437\u0430\u0435\u0442:\n\n1.  **\u0424\u0438\u043b\u044c\u0442\u0440\u0430\u0446\u0438\u044f \u0432 `_has_meaningful_values`:** \u0424\u0443\u043d\u043a\u0446\u0438\u044f \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 `False`, \u0435\u0441\u043b\u0438 \u0432 \u0441\u0442\u0435\u0439\u0442\u0435 \u043d\u0435\u0442 \u043d\u0438\u0447\u0435\u0433\u043e, \u043a\u0440\u043e\u043c\u0435 `messages`.\n2.  **\u0421\u0431\u0440\u043e\u0441 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430:** \u0420\u0430\u0437 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u00ab\u043d\u0435\u0437\u043d\u0430\u0447\u0438\u043c\u044b\u0439\u00bb, \u0441\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442 \u0432\u0435\u0442\u043a\u0430 `Abandon`:\n    ```python\n    cfg[\"configurable\"].pop(\"checkpoint_id\", None) # \u0423\u0434\u0430\u043b\u044f\u0435\u043c \u0438\u0441\u0442\u043e\u0440\u0438\u044e\n    effective_input = graph_input # \u0411\u0435\u0440\u0435\u043c \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u0430\u043c\u043e\u0435 \u043f\u0435\u0440\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435\n    ```\n3.  **\u0421\u0432\u0435\u0436\u0438\u0439 \u0437\u0430\u043f\u0443\u0441\u043a:** \u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f \u043a\u0430\u043a \u0432 \u043f\u0435\u0440\u0432\u044b\u0439 \u0440\u0430\u0437, \u043d\u0435 \u0432\u0438\u0434\u044f \u0441\u0432\u043e\u0438\u0445 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0440\u0430\u0437\u043c\u044b\u0448\u043b\u0435\u043d\u0438\u0439 \u0438 \u0432\u044b\u0437\u043e\u0432\u043e\u0432 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u043e\u0432.\n\n### \u041a\u0430\u043a \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c (\u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435):\n\n\u0412\u0430\u043c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043b\u043e\u0433\u0438\u043a\u0443 \u043e\u0446\u0435\u043d\u043a\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430, \u0447\u0442\u043e\u0431\u044b \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 (\u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430 \u0434\u0438\u0430\u043b\u043e\u0433\u0430) \u043f\u0440\u0435\u0434\u043e\u0442\u0432\u0440\u0430\u0449\u0430\u043b\u043e \u0441\u0431\u0440\u043e\u0441 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f.\n\n**\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u0435 `memory_manager.py`:**\n\n```python\n@staticmethod\ndef _has_meaningful_values(values: Mapping[str, Any]) -> bool:\n    \"\"\"Return True if checkpoint values contain data beyond housekeeping fields.\"\"\"\n    if not values:\n        return False\n\n    # 1. \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0431\u0438\u0437\u043d\u0435\u0441-\u043f\u043e\u043b\u0435\u0439 (Selection, Plan \u0438 \u0442.\u0434.)\n    significant_keys = set(values.keys()) - {\"messages\", \"remaining_steps\", \"distribution_scope\"}\n    if bool(significant_keys):\n        return True\n\n    # 2. \u041e\u0420\u0413\u0410\u041d\u0418\u0427\u041d\u042b\u0419 \u0424\u0418\u041a\u0421: \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u0434\u0438\u0430\u043b\u043e\u0433\u0430\n    messages = values.get(\"messages\", [])\n    # \u0415\u0441\u043b\u0438 \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0443\u0436\u0435 \u0431\u043e\u043b\u044c\u0448\u0435 2 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 (System + Human), \n    # \u0437\u043d\u0430\u0447\u0438\u0442, \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0443\u0436\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u043b \u0438 \u044d\u0442\u043e\u0442 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u043d\u0435\u043b\u044c\u0437\u044f \u0442\u0435\u0440\u044f\u0442\u044c.\n    if isinstance(messages, Sequence) and len(messages) > 2:\n        return True\n\n    return False\n```\n\n### \u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430: \u0420\u0435\u0434\u0443\u0441\u0435\u0440\u044b (Reducers)\n\n\u0427\u0442\u043e\u0431\u044b \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0432\u043e\u043e\u0431\u0449\u0435 \u043d\u0430\u043a\u0430\u043f\u043b\u0438\u0432\u0430\u043b\u0430\u0441\u044c \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430\u0445, \u0443\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e \u0432 \u0441\u0442\u0435\u0439\u0442\u0435 `Graph 4` (Assistant) \u043f\u043e\u043b\u0435 `messages` \u043e\u0431\u0435\u0440\u043d\u0443\u0442\u043e \u0432 `add_messages`. \u0411\u0435\u0437 \u044d\u0442\u043e\u0433\u043e \u043a\u0430\u0436\u0434\u043e\u0435 \u043d\u043e\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0431\u0443\u0434\u0435\u0442 **\u0437\u0430\u043c\u0435\u043d\u044f\u0442\u044c** \u0441\u043f\u0438\u0441\u043e\u043a, \u0430 \u043d\u0435 \u0434\u043e\u043f\u043e\u043b\u043d\u044f\u0442\u044c \u0435\u0433\u043e:\n\n```python\nfrom langgraph.graph.message import add_messages\nfrom typing import Annotated, TypedDict\n\nclass AssistantState(TypedDict):\n    # \u0411\u0435\u0437 Annotated[..., add_messages] \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c\u0441\u044f \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442!\n    messages: Annotated[list, add_messages] \n```\n\n**\u0418\u0442\u043e\u0433:** \u0412\u0430\u0448\u0430 \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0437\u0430\u0449\u0438\u0442\u044b \u043e\u0442 `EmptyInputError` \u043e\u043a\u0430\u0437\u0430\u043b\u0430\u0441\u044c \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0430\u0433\u0440\u0435\u0441\u0441\u0438\u0432\u043d\u043e\u0439 \u0434\u043b\u044f \u0434\u0438\u0430\u043b\u043e\u0433\u043e\u0432\u044b\u0445 \u0430\u0433\u0435\u043d\u0442\u043e\u0432. \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0434\u043b\u0438\u043d\u044b \u0441\u043f\u0438\u0441\u043a\u0430 `messages` \u043f\u043e\u0437\u0432\u043e\u043b\u0438\u0442 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0443 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443 \u0441 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435\u043c \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0430.\n\n**Relevant docs:**\n\n- [Why use messages? (Reducers)](https://docs.langchain.com/oss/python/langgraph/graph-api#why-use-messages)\n- [Persistence: Checkpoints and State](https://docs.langchain.com/oss/python/langgraph/persistence)\n- [Time Travel: identify a checkpoint](https://docs.langchain.com/oss/javascript/langgraph/use-time-travel#2-identify-a-checkpoint)"
  },
  {
    "role": "user",
    "id": "375b7223-e1c8-4c36-a2b7-935bfb7ad710",
    "content": "\u0441\u0435\u0439\u0447\u0430\u0441 \u043f\u0440\u0438 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 assistant \u0433\u0440\u0430\u0444\u0430 \u0438\u0441\u0442\u043e\u0440\u0438\u044f massages \u043f\u0443\u0441\u0442\u0430\u044f, \u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0430"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3829-a51a-7c52-b87b-421dedc960d8",
    "content": "**\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0432 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0435 \u0442\u0435\u0440\u044f\u0435\u0442\u0441\u044f, \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u0432\u0430\u0448\u0430 \u043b\u043e\u0433\u0438\u043a\u0430 \u00abAbandon/Rerun\u00bb \u0432 `memory_manager.py` \u043a\u043b\u0430\u0441\u0441\u0438\u0444\u0438\u0446\u0438\u0440\u0443\u0435\u0442 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u044b \u0441 \u0438\u0441\u0442\u043e\u0440\u0438\u0435\u0439 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u043a\u0438 \u043a\u0430\u043a \u00ab\u043d\u0435\u0437\u043d\u0430\u0447\u0438\u043c\u044b\u0435\u00bb \u0438 \u0441\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442 \u0438\u0445.**\n\n\u0412 ReAct-\u0433\u0440\u0430\u0444\u0430\u0445 (\u0432\u0430\u0448 Graph 4) \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u2014 \u044d\u0442\u043e \u0435\u0434\u0438\u043d\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u043f\u0440\u0438\u0437\u043d\u0430\u043a \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430. \u0412\u0430\u0448\u0430 \u0442\u0435\u043a\u0443\u0449\u0430\u044f \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f `_has_meaningful_values` \u043d\u0430\u043c\u0435\u0440\u0435\u043d\u043d\u043e \u0438\u0441\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u043a\u043b\u044e\u0447 `messages` \u0438\u0437 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438, \u0438\u0437-\u0437\u0430 \u0447\u0435\u0433\u043e \u043b\u044e\u0431\u043e\u0439 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430 \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u00ab\u043f\u0443\u0441\u0442\u044b\u043c\u00bb, \u0438 \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 \u0441\u0432\u0435\u0436\u0438\u0439 \u0437\u0430\u043f\u0443\u0441\u043a (`rerun fresh`), \u0441\u0442\u0438\u0440\u0430\u044f \u0432\u0441\u0451, \u0447\u0442\u043e \u0431\u044b\u043b\u043e \u043d\u0430\u043a\u043e\u043f\u043b\u0435\u043d\u043e.\n\n## \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\n\n\u0412 \u0444\u0430\u0439\u043b\u0435 `memory_manager.py` (\u043c\u0435\u0442\u043e\u0434 `_has_meaningful_values`) \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0435:\n1. \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u0432\u0438\u0434\u0438\u0442 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u0435\u0441\u0442\u044c 5 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439.\n2. \u041a\u043e\u0434 \u0432\u044b\u0447\u0438\u0442\u0430\u0435\u0442 \u043a\u043b\u044e\u0447 `messages` \u0438\u0437 \u043d\u0430\u0431\u043e\u0440\u0430 \u043a\u043b\u044e\u0447\u0435\u0439 \u0441\u0442\u0435\u0439\u0442\u0430.\n3. \u041e\u0441\u0442\u0430\u0432\u0448\u0438\u0439\u0441\u044f \u043d\u0430\u0431\u043e\u0440 \u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043f\u0443\u0441\u0442\u044b\u043c (`set()`), \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 `False`.\n4. \u0412 \u043c\u0435\u0442\u043e\u0434\u0435 `ainvoke_from_checkpoint` \u0441\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442 \u0432\u0435\u0442\u043a\u0430 `else` (Re-run): \u0443\u0434\u0430\u043b\u044f\u0435\u0442\u0441\u044f `checkpoint_id` \u0438 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f `ainvoke` \u0441 \u0438\u0441\u0445\u043e\u0434\u043d\u044b\u043c \u0432\u0432\u043e\u0434\u043e\u043c, \u0433\u0434\u0435 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0435\u0449\u0435 \u043d\u0435\u0442.\n\n## \u0418\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0432 `memory_manager.py`\n\n\u0412\u0430\u043c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043b\u043e\u0433\u0438\u043a\u0443 \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 (\u0435\u0441\u043b\u0438 \u0438\u0445 \u0431\u043e\u043b\u044c\u0448\u0435, \u0447\u0435\u043c \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u044b\u0439 \u0432\u0432\u043e\u0434) \u0441\u0447\u0438\u0442\u0430\u043b\u043e\u0441\u044c \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u043e\u043c, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043d\u0435\u043b\u044c\u0437\u044f \u0443\u0434\u0430\u043b\u044f\u0442\u044c.\n\n```python\n@staticmethod\ndef _has_meaningful_values(values: Mapping[str, Any]) -> bool:\n    \"\"\"\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442, \u043d\u0443\u0436\u043d\u043e \u043b\u0438 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0442\u044c \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0438\u043b\u0438 \u043c\u043e\u0436\u043d\u043e \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0437\u0430\u043d\u043e\u0432\u043e.\"\"\"\n    if not values:\n        return False\n\n    # 1. \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0431\u0438\u0437\u043d\u0435\u0441-\u0434\u0430\u043d\u043d\u044b\u0445 (\u043f\u043b\u0430\u043d\u044b, \u0441\u0435\u043b\u0435\u043a\u0448\u0435\u043d\u044b \u0438 \u0442.\u0434.)\n    significant_keys = set(values.keys()) - {\"messages\", \"remaining_steps\", \"distribution_scope\"}\n    if bool(significant_keys):\n        return True\n\n    # 2. \u0424\u0418\u041a\u0421: \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u0434\u0438\u0430\u043b\u043e\u0433\u0430\n    messages = values.get(\"messages\", [])\n    # \u0415\u0441\u043b\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0431\u043e\u043b\u044c\u0448\u0435 1 (System) \u0438\u043b\u0438 2 (System + User), \n    # \u0437\u043d\u0430\u0447\u0438\u0442, \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0443\u0436\u0435 \u0441\u043e\u0432\u0435\u0440\u0448\u0438\u043b \u0448\u0430\u0433\u0438 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0432\u044b\u0437\u0432\u0430\u043b \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442).\n    if isinstance(messages, Sequence) and len(messages) > 2:\n        return True\n\n    return False\n```\n\n## \u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b Graph 4\n\n\u0427\u0442\u043e\u0431\u044b \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u043b\u0430\u0441\u044c \u0432 \u0441\u0430\u043c \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442, \u0443\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e \u0441\u0442\u0435\u0439\u0442 \u0432\u0430\u0448\u0435\u0433\u043e \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430 (`AssistantState`) \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0430\u043d\u043d\u043e\u0442\u0430\u0446\u0438\u044e `add_messages`. \u0411\u0435\u0437 \u043d\u0435\u0451 \u043a\u0430\u0436\u0434\u043e\u0435 \u043d\u043e\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0431\u0443\u0434\u0435\u0442 **\u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0442\u044c** \u043f\u043e\u043b\u0435 `messages`, \u0438 \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0435 \u0432\u0441\u0435\u0433\u0434\u0430 \u0431\u0443\u0434\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u043e\u0442\u0432\u0435\u0442:\n\n```python\nfrom langgraph.graph.message import add_messages\nfrom typing import Annotated, TypedDict\n\nclass AssistantState(TypedDict):\n    # \u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 add_messages \u0434\u043b\u044f \u043d\u0430\u043a\u043e\u043f\u043b\u0435\u043d\u0438\u044f \u0438\u0441\u0442\u043e\u0440\u0438\u0438\n    messages: Annotated[list, add_messages] \n```\n\n\u041f\u043e\u0441\u043b\u0435 \u044d\u0442\u0438\u0445 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439 `memory_manager` \u0443\u0432\u0438\u0434\u0438\u0442, \u0447\u0442\u043e \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0435 \u0435\u0441\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044f (len > 2), \u0432\u0435\u0440\u043d\u0435\u0442 `True` \u0434\u043b\u044f `_has_meaningful_values`, \u0438 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u0438\u0442\u0441\u044f \u0441 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435\u043c \u0432\u0441\u0435\u0445 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439.\n\n**Relevant docs:**\n\n- [Why use messages? (Reducers)](https://docs.langchain.com/oss/python/langgraph/graph-api#why-use-messages)\n- [Persistence and State Management](https://docs.langchain.com/oss/python/langgraph/persistence)\n- [Subgraphs: Shared vs Isolated State](https://docs.langchain.com/oss/python/langgraph/use-subgraphs)"
  },
  {
    "role": "user",
    "id": "6d688b00-4d22-4159-8aeb-c86b2ea077fc",
    "content": "\u041a\u0430\u043a \u044d\u0442\u043e \u043f\u043e\u043c\u043e\u0436\u0435\u0442 ? "
  },
  {
    "role": "assistant",
    "id": "lc_run--019b382b-81b2-7a00-990e-98248a463f30",
    "content": "\u042d\u0442\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0442\u0435\u043c, \u0447\u0442\u043e **\u043e\u043d\u043e \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442 \u043b\u043e\u0433\u0438\u043a\u0443 \u0432\u0430\u0448\u0435\u0433\u043e `memory_manager` \u0438\u0437 \u0440\u0435\u0436\u0438\u043c\u0430 \u00ab\u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u0441\u0431\u0440\u043e\u0441\u0430\u00bb \u0432 \u0440\u0435\u0436\u0438\u043c \u00ab\u0443\u043c\u043d\u043e\u0433\u043e \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f\u00bb \u0434\u043b\u044f \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430.**\n\n\u0412\u043e\u0442 \u043f\u043e\u0448\u0430\u0433\u043e\u0432\u044b\u0439 \u0440\u0430\u0437\u0431\u043e\u0440 \u0442\u043e\u0433\u043e, \u043a\u0430\u043a \u044d\u0442\u043e \u0440\u0435\u0448\u0430\u0435\u0442 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0443 \u043f\u0443\u0441\u0442\u043e\u0439 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0432 Graph 4 (Assistant):\n\n### 1. \u041a\u0430\u043a \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0421\u0415\u0419\u0427\u0410\u0421 (\u0411\u0430\u0433):\n1.  **\u041f\u043e\u0438\u0441\u043a:** \u0412\u043e\u0440\u043a\u0435\u0440 (`Graph 3`) \u043f\u0430\u0434\u0430\u0435\u0442 \u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f. \u041e\u043d \u043d\u0430\u0445\u043e\u0434\u0438\u0442 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0441\u0432\u043e\u0435\u0433\u043e \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430 (`Graph 4`), \u0433\u0434\u0435 \u0443\u0436\u0435 \u043b\u0435\u0436\u0430\u0442, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, 4 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f.\n2.  **\u041e\u0446\u0435\u043d\u043a\u0430:** \u0412\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f `_has_meaningful_values`. \u041e\u043d\u0430 \u0432\u0438\u0434\u0438\u0442 \u043a\u043b\u044e\u0447 `messages`, \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0435\u0433\u043e \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u043a \u0438 \u0433\u043e\u0432\u043e\u0440\u0438\u0442: \u00ab\u041d\u0438\u043a\u0430\u043a\u0438\u0445 \u0437\u043d\u0430\u0447\u0438\u043c\u044b\u0445 \u0431\u0438\u0437\u043d\u0435\u0441-\u0434\u0430\u043d\u043d\u044b\u0445 (\u0442\u0438\u043f\u0430 \u043f\u043b\u0430\u043d\u043e\u0432 \u0438\u043b\u0438 \u0441\u0435\u043b\u0435\u043a\u0448\u0435\u043d\u043e\u0432) \u043d\u0435\u0442, \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 **\u043f\u0443\u0441\u0442\u043e\u0439** (False)\u00bb.\n3.  **\u0421\u0431\u0440\u043e\u0441:** \u041f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 `False`, \u043c\u0435\u0442\u043e\u0434 `ainvoke_from_checkpoint` \u0434\u0435\u043b\u0430\u0435\u0442 `pop(\"checkpoint_id\")`.\n4.  **\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442:** \u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f \u0441 \u0438\u0441\u0445\u043e\u0434\u043d\u044b\u043c \u0432\u0432\u043e\u0434\u043e\u043c (\u0442\u043e\u043b\u044c\u043a\u043e 1 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442 \u0432\u043e\u0440\u043a\u0435\u0440\u0430), \u0430 \u0432\u0441\u0435 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0435 4 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0438\u0437 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430 **\u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u044e\u0442\u0441\u044f**. \u0418\u0441\u0442\u043e\u0440\u0438\u044f \u043f\u043e\u0442\u0435\u0440\u044f\u043d\u0430.\n\n### 2. \u041a\u0430\u043a \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u041f\u041e\u0421\u041b\u0415 \u0444\u0438\u043a\u0441\u0430:\n1.  **\u041f\u043e\u0438\u0441\u043a:** \u0422\u043e\u0442 \u0436\u0435 \u0432\u043e\u0440\u043a\u0435\u0440 \u043d\u0430\u0445\u043e\u0434\u0438\u0442 \u0442\u043e\u0442 \u0436\u0435 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0441 4 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f\u043c\u0438.\n2.  **\u041e\u0446\u0435\u043d\u043a\u0430:** \u0422\u0435\u043f\u0435\u0440\u044c `_has_meaningful_values` \u0432\u0438\u0434\u0438\u0442: \u00ab\u0411\u0438\u0437\u043d\u0435\u0441-\u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0435\u0442, \u041d\u041e \u0432 \u0441\u043f\u0438\u0441\u043a\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0443\u0436\u0435 4 \u0437\u0430\u043f\u0438\u0441\u0438 (\u0431\u043e\u043b\u044c\u0448\u0435 2). \u0417\u043d\u0430\u0447\u0438\u0442, \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0443\u0436\u0435 \u043d\u0430\u0447\u0430\u043b \u0440\u0430\u0431\u043e\u0442\u0443 \u0438 \u044d\u0442\u043e **\u0437\u043d\u0430\u0447\u0438\u043c\u044b\u0439 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441** (True)\u00bb.\n3.  **\u0412\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435:** \u041c\u0435\u0442\u043e\u0434 `ainvoke_from_checkpoint` **\u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442** `checkpoint_id`.\n4.  **\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442:** \u0412\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f `ainvoke(None, config=cfg_with_id)`. LangGraph \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442 \u0438\u0437 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 **\u043f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u0438\u0437 4 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439** \u0438 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u0443 \u0441 5-\u0433\u043e \u0448\u0430\u0433\u0430. \u0418\u0441\u0442\u043e\u0440\u0438\u044f \u043d\u0430 \u043c\u0435\u0441\u0442\u0435.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043a\u0440\u0438\u0442\u0438\u0447\u043d\u043e \u0434\u043b\u044f \u0432\u0430\u0448\u0435\u0439 4-\u0443\u0440\u043e\u0432\u043d\u0435\u0432\u043e\u0439 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u044b:\n\u0412 \u0432\u0430\u0448\u0435\u0439 \u0441\u0445\u0435\u043c\u0435 `Graph 4` \u2014 \u044d\u0442\u043e ReAct-\u0430\u0433\u0435\u043d\u0442. \u0415\u0433\u043e \u00ab\u043f\u0430\u043c\u044f\u0442\u044c\u00bb \u0438 \u00ab\u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u00bb \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0438 \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f **\u0442\u043e\u043b\u044c\u043a\u043e** \u0432\u043d\u0443\u0442\u0440\u0438 \u0441\u043f\u0438\u0441\u043a\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439. \u0415\u0441\u043b\u0438 \u0432\u044b \u0438\u0441\u043a\u043b\u044e\u0447\u0430\u0435\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0438\u0437 \u043a\u0440\u0438\u0442\u0435\u0440\u0438\u0435\u0432 \u0437\u043d\u0430\u0447\u0438\u043c\u043e\u0441\u0442\u0438, \u0432\u044b \u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0437\u0430\u043f\u0440\u0435\u0449\u0430\u0435\u0442\u0435 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0443 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0442\u044c\u0441\u044f \u043f\u043e\u0441\u043b\u0435 \u043e\u0448\u0438\u0431\u043e\u043a, \u0437\u0430\u0441\u0442\u0430\u0432\u043b\u044f\u044f \u0435\u0433\u043e \u043a\u0430\u0436\u0434\u044b\u0439 \u0440\u0430\u0437 \u00ab\u0437\u0430\u0431\u044b\u0432\u0430\u0442\u044c\u00bb \u0432\u0441\u0451 \u0441\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0435.\n\n## \u0418\u0442\u043e\u0433\u043e\u0432\u044b\u0439 \u043a\u043e\u0434 \u0444\u0438\u043a\u0441\u0430 \u0432 `memory_manager.py`:\n\n```python\n@staticmethod\ndef _has_meaningful_values(values: Mapping[str, Any]) -> bool:\n    if not values:\n        return False\n\n    # \u0421\u0447\u0438\u0442\u0430\u0435\u043c \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0437\u043d\u0430\u0447\u0438\u043c\u044b\u043c, \u0435\u0441\u043b\u0438 \u0432 \u043d\u0435\u043c \u0435\u0441\u0442\u044c \u0431\u0438\u0437\u043d\u0435\u0441-\u0434\u0430\u043d\u043d\u044b\u0435...\n    significant_keys = set(values.keys()) - {\"messages\", \"remaining_steps\", \"distribution_scope\"}\n    if bool(significant_keys):\n        return True\n\n    # ...\u0418\u041b\u0418 \u0435\u0441\u043b\u0438 \u0432 \u043d\u0435\u043c \u043d\u0430\u043a\u043e\u043f\u0438\u043b\u0430\u0441\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 (\u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u0434\u0438\u0430\u043b\u043e\u0433\u0430)\n    messages = values.get(\"messages\", [])\n    if isinstance(messages, list) and len(messages) > 2: # \u0411\u043e\u043b\u044c\u0448\u0435 \u0447\u0435\u043c System + User\n        return True\n\n    return False\n```\n\n**Relevant docs:**\n- [Persistence and State history](https://docs.langchain.com/oss/python/langgraph/persistence)\n- [How to add memory to your graph](https://docs.langchain.com/oss/python/langgraph/add-memory)\n- [Time Travel: identify a checkpoint](https://docs.langchain.com/oss/javascript/langgraph/use-time-travel#2-identify-a-checkpoint)"
  },
  {
    "role": "user",
    "id": "e90532ee-9a0e-499b-bbb6-d0cc6e18e3b7",
    "content": "\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0441\u0435 \u0435\u0449\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442\u0441\u044f \n\nfrom __future__ import annotations\n\nimport uuid\nimport os\nfrom datetime import datetime\nfrom typing import Any, Mapping, MutableMapping, Optional, Sequence, TypeAlias, Protocol, runtime_checkable, cast\n\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom langchain.embeddings import init_embeddings\nfrom shared.project_settings import ProjectSettings\n\ntry:\n    from pydantic_core import core_schema\nexcept ImportError:\n    core_schema = None  # type: ignore\n\ntry:\n    from langgraph.store.memory import InMemoryStore  # type: ignore\nexcept Exception:  # pragma: no cover\n    InMemoryStore = None  # type: ignore\n\n_CHECKPOINTER_SYNC: Optional[Any] = None\n_CHECKPOINTER_ASYNC: Optional[Any] = None\n_STORE: Optional[Any] = None\n\nThreadId: TypeAlias = str\nGraphId: TypeAlias = str\nCheckpointId: TypeAlias = str\nStateDict: TypeAlias = MutableMapping[str, Any]\n\n\n@runtime_checkable\nclass _SupportsGraphCheckpoint(Protocol):\n    \"\"\"Minimal protocol describing compiled LangGraph runnables we inspect for durability support.\"\"\"\n\n    checkpointer: Any | None\n    _pregel: Any | None\n    app: Any | None\n    name: str\n\n\nGraphRunnableWithPregel: TypeAlias = _SupportsGraphCheckpoint\n\n\ndef _extract_graph_checkpointer(graph: Any) -> Any:\n    \"\"\"Return the checkpointer bound directly to a compiled runnable, if any.\"\"\"\n\n    if graph is None:\n        return None\n\n    candidate = getattr(graph, \"checkpointer\", None)\n    if candidate is not None:\n        return candidate\n\n    pregel = getattr(graph, \"_pregel\", None)\n    if pregel is not None:\n        inner = getattr(pregel, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    app = getattr(graph, \"app\", None)\n    if app is not None:\n        inner = getattr(app, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    loop = getattr(graph, \"_loop\", None)\n    if loop is not None:\n        inner = getattr(loop, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    return None\n\n\ndef _graph_supports_durability(graph: Any) -> bool:\n    \"\"\"Return True if the runnable was compiled with a checkpointer.\"\"\"\n\n    return _extract_graph_checkpointer(graph) is not None\n\n\ndef _resolve_local_checkpointer(graph: Any, override: Optional[Any]) -> Optional[Any]:\n    \"\"\"Prefer explicit override, otherwise inspect the runnable for a bound saver.\"\"\"\n\n    if override is not None:\n        return override\n    return _extract_graph_checkpointer(graph)\n\n\ndef resolve_graph_checkpointer(*, async_mode: bool) -> Any:\n    \"\"\"Return a checkpointer compatible with the chosen execution mode.\n\n    Important:\n    - Async LangGraph execution expects async checkpointer methods. If only a\n      sync checkpointer is available (e.g., SqliteSaver), we fall back to the\n      async-safe InMemorySaver to keep `.ainvoke()` reliable.\n    - Production deployments can replace this with an async-capable durable\n      backend (Postgres/SQLite async) without touching graph code.\n    \"\"\"\n\n    global _CHECKPOINTER_SYNC, _CHECKPOINTER_ASYNC\n    CHECKPOINTER_DATABASE_URL = os.getenv(\"CHECKPOINTER_DATABASE_URL\")\n\n    # In production, LangGraph Platform injects the checkpointer automatically.\n    # We keep local checkpointers disabled to avoid shadowing the platform backend.\n    if ProjectSettings().mode == \"production\":\n        return None\n\n\n    if async_mode:\n        if _CHECKPOINTER_ASYNC is None:\n            _CHECKPOINTER_ASYNC = InMemorySaver()\n        return _CHECKPOINTER_ASYNC\n\n    if _CHECKPOINTER_SYNC is None:\n        _CHECKPOINTER_SYNC =  InMemorySaver()\n    return _CHECKPOINTER_SYNC\n\n\ndef resolve_graph_store() -> Any:\n    \"\"\"Return a store implementation for dev/tests; None in production/platform.\n\n    In production, LangGraph Platform injects the store automatically at runtime\n    (via ToolRuntime). We keep local stores disabled to avoid shadowing the\n    platform backend.\n    \"\"\"\n\n    global _STORE\n    if ProjectSettings().mode == \"production\":\n        return None\n    if InMemoryStore is None:\n        return None\n    if _STORE is not None:\n        return _STORE\n\n    # In development/tests we prefer an in-process store. Vector indexing is optional;\n    # if embeddings cannot be initialised (missing deps/keys), fall back to a plain store.\n    try:\n        _STORE = InMemoryStore(\n            index={\n                \"embed\": init_embeddings(\"openai:text-embedding-3-small\"),\n                \"dims\": 1536,\n                \"fields\": [\"content\"],\n            }\n        )\n    except Exception:\n        _STORE = InMemoryStore(index=None)\n    return _STORE\n\n\nclass GraphMemoryRuntime:\n    \"\"\"Encapsulates durable-checkpoint + long-memory access for dev and platform production.\n\n    This class centralizes:\n    - thread_id extraction\n    - platform SDK fallback for checkpoint state/history (no local checkpointer needed)\n    - local (dev) graph/checkpointer checkpoint inspection\n    \"\"\"\n    THREAD_ID_KEY: str = \"thread_id\"\n\n    @classmethod\n    def __get_pydantic_core_schema__(\n        cls,\n        source_type: Any,\n        handler: Any,\n    ) -> Any:\n        \"\"\"Provide Pydantic schema for GraphMemoryRuntime to allow arbitrary types.\n\n        This enables GraphMemoryRuntime to be used in Pydantic models (e.g., when\n        ContextTravelGuideAgent is used as context_schema in StateGraph).\n        \n        Since GraphMemoryRuntime is a runtime helper (not meant for serialization),\n        we use any_schema() to allow it without validation.\n        \"\"\"\n        if core_schema is None:\n            # pydantic_core should always be available in this project\n            raise ImportError(\"pydantic_core is required but not available\")\n        \n        # Use any_schema() to allow GraphMemoryRuntime without validation\n        # This is appropriate since it's a runtime helper with init=False\n        return core_schema.any_schema()\n\n    def __init__(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        # These are intentionally mutable bindings:\n        # - Root graph wiring binds the single checkpointer/store once per process/run.\n        # - Nested graphs MUST reuse the bound instance via runtime context.\n        self.checkpointer: Optional[Any] = checkpointer\n        self.store: Optional[Any] = store\n\n    def bind(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        \"\"\"Bind durable backends onto this runtime helper.\n\n        Idempotent by design: does not overwrite existing non-null bindings unless\n        explicitly provided.\n        \"\"\"\n\n        if checkpointer is not None:\n            self.checkpointer = checkpointer\n        if store is not None:\n            self.store = store\n\n    def is_production_mode(self) -> bool:\n        return ProjectSettings().mode == \"production\"\n\n    def ensure_thread_id(\n        self,\n        config: Optional[RunnableConfig],\n    ) -> tuple[RunnableConfig, ThreadId]:\n        \"\"\"Ensure ``configurable.thread_id`` exists and return ``(config, thread_id)``.\n\n        Contract (required by project checkpointing rules):\n        - One thread_id should be used for the *entire* root graph run.\n        - If caller did not provide a thread_id, we generate a new one from:\n          ``user_id`` (from RunnableConfig.configurable.user_id) + UUID4 suffix.\n        - Callers must reuse the returned config to keep the thread_id stable.\n        \"\"\"\n\n        from shared.config.long_memory import LongMemory\n\n        merged: RunnableConfig = dict(config) if config else {}\n        configurable = merged.get(\"configurable\", {})\n        if not isinstance(configurable, MutableMapping):\n            configurable = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable = dict(configurable)\n\n        existing = configurable.get(self.THREAD_ID_KEY)\n        if existing:\n            thread_id: ThreadId = str(existing)\n            configurable[self.THREAD_ID_KEY] = thread_id\n            merged[\"configurable\"] = configurable\n            return merged, thread_id\n\n        long_memory = LongMemory.from_runnable_config(merged)\n        user_id = long_memory.user_id\n        if not configurable.get(\"user_id\"):\n            configurable[\"user_id\"] = user_id\n\n        thread_id = f\"user_{user_id}_{uuid.uuid4().hex}\"\n        configurable[self.THREAD_ID_KEY] = thread_id\n        merged[\"configurable\"] = configurable\n        return merged, thread_id\n\n    async def list_thread_checkpoints(\n        self,\n        *,\n        config: RunnableConfig,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> list[Any]:\n        \"\"\"Return raw checkpoint records for the given thread config.\n\n        Notes:\n        - In production (LangGraph Platform), we fall back to the SDK thread history.\n        - In dev/tests, we prefer the provided ``local_checkpointer`` (or the default dev\n          checkpointer) to list checkpoints, because it exposes metadata (`graph_id`).\n        - As a last resort, we attempt to list state snapshots via ``graph.get_state_history``.\n        \"\"\"\n\n        thread_id = self.extract_thread_id(config)\n        if not thread_id:\n            return []\n\n        if self.is_production_mode():\n            try:\n                from langgraph_sdk import get_client  # type: ignore\n            except Exception:\n                return []\n            try:\n                client = get_client()\n                history = await client.threads.get_history(thread_id)\n                return list(history)\n            except Exception:\n                return []\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if checkpointer is not None:\n            lister = getattr(checkpointer, \"list\", None)\n            if callable(lister):\n                try:\n                    return list(lister(config))\n                except Exception:\n                    return []\n\n        if local_graph is not None:\n            getter_async = getattr(local_graph, \"aget_state_history\", None)\n            if callable(getter_async):\n                try:\n                    return [snapshot async for snapshot in getter_async(config)]\n                except Exception:\n                    return []\n            getter_sync = getattr(local_graph, \"get_state_history\", None)\n            if callable(getter_sync):\n                try:\n                    return list(getter_sync(config))\n                except Exception:\n                    return []\n\n        return []\n\n    @staticmethod\n    def _extract_checkpoint_metadata(record: Any) -> Mapping[str, Any]:\n        candidate = getattr(record, \"metadata\", None)\n        if isinstance(candidate, Mapping):\n            return cast(Mapping[str, Any], candidate)\n        if isinstance(record, Mapping):\n            meta = record.get(\"metadata\")\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            meta = getattr(checkpoint, \"metadata\", None)\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        return {}\n\n    @staticmethod\n    def _extract_checkpoint_id(record: Any) -> Optional[CheckpointId]:\n        candidate = getattr(record, \"checkpoint_id\", None)\n        if candidate:\n            return str(candidate)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            inner = getattr(checkpoint, \"checkpoint_id\", None)\n            if inner:\n                return str(inner)\n            inner = getattr(checkpoint, \"id\", None)\n            if inner:\n                return str(inner)\n        if isinstance(record, Mapping):\n            candidate = record.get(\"checkpoint_id\") or record.get(\"id\")\n            if candidate:\n                return str(candidate)\n            cfg = record.get(\"config\")\n            if isinstance(cfg, Mapping):\n                conf = cfg.get(\"configurable\")\n                if isinstance(conf, Mapping):\n                    candidate = conf.get(\"checkpoint_id\")\n                    if candidate:\n                        return str(candidate)\n        cfg = getattr(record, \"config\", None)\n        if isinstance(cfg, Mapping):\n            conf = cfg.get(\"configurable\")\n            if isinstance(conf, Mapping):\n                candidate = conf.get(\"checkpoint_id\")\n                if candidate:\n                    return str(candidate)\n        return None\n\n    @staticmethod\n    def _extract_created_at(record: Any) -> Optional[datetime]:\n        candidate = getattr(record, \"created_at\", None)\n        if isinstance(candidate, datetime):\n            return candidate\n        if isinstance(record, Mapping):\n            candidate = record.get(\"created_at\")\n            if isinstance(candidate, datetime):\n                return candidate\n        return None\n\n    @classmethod\n    def _matches_graph_id(cls, record: Any, graph_id: GraphId) -> bool:\n        metadata = cls._extract_checkpoint_metadata(record)\n        candidate = metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")\n        return str(candidate) == str(graph_id) if candidate else False\n\n    @staticmethod\n    def _extract_checkpoint_ns(record: Any) -> Optional[str]:\n        def _from_config(cfg: Any) -> Optional[str]:\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n                if isinstance(configurable, Mapping):\n                    candidate = configurable.get(\"checkpoint_ns\")\n                    if candidate is not None:\n                        return str(candidate)\n            return None\n\n        cfg = getattr(record, \"config\", None)\n        ns = _from_config(cfg)\n        if ns:\n            return ns\n\n        if isinstance(record, Mapping):\n            ns = _from_config(record.get(\"config\"))\n            if ns:\n                return ns\n\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            ns = _from_config(getattr(checkpoint, \"config\", None))\n            if ns:\n                return ns\n\n        metadata = GraphMemoryRuntime._extract_checkpoint_metadata(record)\n        checkpoint_ns = metadata.get(\"checkpoint_ns\")\n        return str(checkpoint_ns) if checkpoint_ns is not None else None\n\n    @staticmethod\n    def _normalize_config_like(config_like: Any) -> Optional[RunnableConfig]:\n        if config_like is None:\n            return None\n        if isinstance(config_like, Mapping):\n            normalized = dict(config_like)\n        else:\n            normalized = None\n            for attr in (\"model_dump\", \"dict\"):\n                dumper = getattr(config_like, attr, None)\n                if callable(dumper):\n                    try:\n                        normalized = dumper()\n                        break\n                    except Exception:\n                        normalized = None\n            if normalized is None:\n                try:\n                    normalized = dict(config_like)  # type: ignore[arg-type]\n                except Exception:\n                    return None\n\n        configurable = normalized.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            configurable = dict(configurable) if configurable is not None else {}\n        normalized[\"configurable\"] = dict(configurable)\n\n        metadata = normalized.get(\"metadata\", {})\n        if not isinstance(metadata, Mapping):\n            metadata = dict(metadata) if metadata is not None else {}\n        normalized[\"metadata\"] = dict(metadata)\n        return normalized  # type: ignore[return-value]\n\n    @classmethod\n    def _extract_task_entries(cls, record: Any) -> list[Mapping[str, Any]]:\n        extracted: list[Mapping[str, Any]] = []\n        visited_snapshots: set[int] = set()\n\n        def _coerce_metadata(value: Any) -> Optional[Mapping[str, Any]]:\n            if value is None:\n                return None\n            if isinstance(value, Mapping):\n                return value\n            try:\n                return dict(value)\n            except Exception:\n                return None\n\n        def _as_sequence(value: Any) -> Optional[Sequence[Any]]:\n            if isinstance(value, Sequence) and not isinstance(value, (str, bytes)):\n                return value\n            return None\n\n        def _record_entry(config_like: Any, metadata_like: Any, state_like: Any) -> None:\n            normalized_config = cls._normalize_config_like(config_like)\n            normalized_metadata = _coerce_metadata(metadata_like)\n            entry: dict[str, Any] = {}\n            if normalized_config:\n                entry[\"config\"] = normalized_config\n            if normalized_metadata:\n                entry[\"metadata\"] = normalized_metadata\n            if state_like is not None:\n                entry[\"state\"] = state_like\n            if entry:\n                extracted.append(entry)\n\n        def _visit_snapshot(snapshot: Any) -> None:\n            if snapshot is None:\n                return\n            snapshot_id = id(snapshot)\n            if snapshot_id in visited_snapshots:\n                return\n            visited_snapshots.add(snapshot_id)\n\n            tasks = None\n            if isinstance(snapshot, Mapping):\n                tasks = _as_sequence(snapshot.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(snapshot, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        def _visit_task(task: Any) -> None:\n            if task is None:\n                return\n            if isinstance(task, Mapping):\n                _record_entry(task.get(\"config\"), task.get(\"metadata\"), task.get(\"state\"))\n                nested_tasks = _as_sequence(task.get(\"tasks\"))\n                if nested_tasks:\n                    for nested in nested_tasks:\n                        _visit_task(nested)\n                _visit_snapshot(task.get(\"state\"))\n                _visit_snapshot(task.get(\"result\"))\n                return\n\n            _record_entry(\n                getattr(task, \"config\", None),\n                getattr(task, \"metadata\", None),\n                getattr(task, \"state\", None),\n            )\n            _visit_snapshot(getattr(task, \"state\", None))\n            _visit_snapshot(getattr(task, \"result\", None))\n            nested_attr = _as_sequence(getattr(task, \"tasks\", None))\n            if nested_attr:\n                for nested in nested_attr:\n                    _visit_task(nested)\n\n        for source in (record, getattr(record, \"checkpoint\", None)):\n            if source is None:\n                continue\n            _visit_snapshot(source)\n            tasks = None\n            if isinstance(source, Mapping):\n                tasks = _as_sequence(source.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(source, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        return extracted\n\n    async def find_latest_checkpoint_id(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Return the latest checkpoint_id for ``graph_id`` within the given thread.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n\n        # #region agent log\n        import json\n        record_summaries: list[dict[str, str | None]] = []\n        for idx, record in enumerate(checkpoints[:3]):\n            metadata = self._extract_checkpoint_metadata(record)\n            cfg = getattr(record, \"config\", None)\n            configurable = None\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n            checkpoint_ns = None\n            if isinstance(configurable, Mapping):\n                checkpoint_ns = str(configurable.get(\"checkpoint_ns\"))\n            record_summaries.append(\n                {\n                    \"idx\": str(idx),\n                    \"meta_graph_id\": str(metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")),\n                    \"checkpoint_id\": self._extract_checkpoint_id(record),\n                    \"checkpoint_ns\": checkpoint_ns,\n                }\n            )\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"B\",\"location\":\"memory_manager.py:395\",\"message\":\"find_latest_checkpoint_id checkpoints listed\",\"data\":{\"graph_id\":graph_id,\"thread_id\":str(config.get(\"configurable\",{}).get(\"thread_id\",\"\")), \"count\":len(checkpoints),\"records\":record_summaries},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if not checkpoints:\n            return None\n\n        # Collect matches with their timestamps (if provided by the backend).\n        matches: list[tuple[Optional[datetime], Any]] = []\n        for record in checkpoints:\n            if self._matches_graph_id(record, graph_id):\n                matches.append((self._extract_created_at(record), record))\n\n        target_checkpoint_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_checkpoint_ns = str(candidate_ns)\n\n        if not matches and target_checkpoint_ns:\n            for record in checkpoints:\n                if self._extract_checkpoint_ns(record) == target_checkpoint_ns:\n                    matches.append((self._extract_created_at(record), record))\n\n        if not matches:\n            return None\n\n        # If the backend provides created_at, prefer the most recent by timestamp.\n        if any(created_at is not None for created_at, _ in matches):\n            matches.sort(\n                key=lambda item: item[0] or datetime.min,\n                reverse=True,\n            )\n            return self._extract_checkpoint_id(matches[0][1])\n\n        # Otherwise, rely on the backend list order. InMemorySaver and Platform history\n        # return newest-first, so the first matching record is the latest.\n        return self._extract_checkpoint_id(matches[0][1])\n\n    async def _load_checkpoint_record(\n        self,\n        *,\n        config: RunnableConfig,\n        checkpoint_id: CheckpointId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[Any]:\n        \"\"\"Return the checkpoint record with the specified ID.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n        for record in checkpoints:\n            record_id = self._extract_checkpoint_id(record)\n            if record_id == checkpoint_id:\n                return record\n        return None\n\n    @staticmethod\n    def _materialize_checkpoint_values(\n        base_values: Mapping[str, Any],\n        record: Optional[Any],\n        *,\n        graph_id: Optional[str] = None,\n    ) -> tuple[Mapping[str, Any], bool]:\n        \"\"\"Merge stored writes from the checkpoint record into snapshot values.\"\"\"\n\n        if record is None:\n            return base_values, False\n\n        materialized: dict[str, Any] = dict(base_values)\n        writes_found = False\n\n        checkpoint_obj = getattr(record, \"checkpoint\", record)\n        writes = getattr(checkpoint_obj, \"writes\", None)\n        if writes is None and isinstance(checkpoint_obj, Mapping):\n            writes = checkpoint_obj.get(\"writes\")\n\n        # #region agent log\n        import json as _json_checkpoint_meta\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(\n                _json_checkpoint_meta.dumps(\n                    {\n                        \"sessionId\": \"debug-session\",\n                        \"runId\": \"pre-fix\",\n                        \"hypothesisId\": \"L\",\n                        \"location\": \"memory_manager.py:321\",\n                        \"message\": \"checkpoint record summary\",\n                        \"data\": {\n                            \"graph_id\": graph_id,\n                            \"record_type\": type(checkpoint_obj).__name__,\n                            \"has_attr_writes\": hasattr(checkpoint_obj, \"writes\"),\n                            \"writes_is_sequence\": isinstance(writes, Sequence),\n                            \"writes_is_mapping\": isinstance(writes, Mapping),\n                        },\n                        \"timestamp\": __import__(\"time\").time() * 1000,\n                    }\n                )\n                + \"\\n\"\n            )\n        # #endregion\n\n        summary: list[dict[str, Any]] = []\n\n        if isinstance(writes, Sequence):\n            for idx, write_entry in enumerate(writes):\n                node_name = None\n                write_payload = None\n                if isinstance(write_entry, Mapping):\n                    node_name = write_entry.get(\"node\") or write_entry.get(\"name\")\n                    candidate = write_entry.get(\"writes\") or write_entry.get(\"values\")\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n                else:\n                    node_name = getattr(write_entry, \"node\", None) or getattr(write_entry, \"name\", None)\n                    candidate = getattr(write_entry, \"writes\", None)\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n\n                if isinstance(write_payload, Mapping):\n                    for key, value in write_payload.items():\n                        materialized.setdefault(key, value)\n                    if idx < 3:\n                        summary.append(\n                            {\n                                \"node\": str(node_name),\n                                \"keys\": list(write_payload.keys()),\n                            }\n                        )\n                    writes_found = True\n\n        # #region agent log\n        if summary:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:324\",\n                            \"message\": \"checkpoint writes merged\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"writes\": summary,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        else:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:329\",\n                            \"message\": \"checkpoint writes unavailable\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"has_writes\": isinstance(writes, Sequence),\n                                \"writes_type\": None if writes is None else type(writes).__name__,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        # #endregion\n\n        return materialized, writes_found\n\n    @staticmethod\n    def _has_meaningful_values(values: Mapping[str, Any]) -> bool:\n        \"\"\"Return True if checkpoint values contain data beyond housekeeping fields.\"\"\"\n\n        if not values:\n            return False\n        significant_keys = set(values.keys()) - {\"messages\", \"remaining_steps\", \"distribution_scope\"}\n        if significant_keys:\n            return True\n\n        messages = values.get(\"messages\")\n        if isinstance(messages, Sequence):\n            # System + user messages occupy the first two positions. Anything beyond\n            # that indicates the assistant has already produced tool calls or replies.\n            if len(messages) > 2:\n                return True\n\n        return False\n\n    async def _find_subgraph_resume_config(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        checkpoints: Sequence[Any],\n    ) -> Optional[tuple[RunnableConfig, Any]]:\n        target_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_ns = str(candidate_ns)\n\n        for record_idx, record in enumerate(checkpoints):\n            task_entries = self._extract_task_entries(record)\n            if not task_entries:\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:562\",\"message\":\"checkpoint missing task entries\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"parent_checkpoint_id\":self._extract_checkpoint_id(record)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n                continue\n            for task_idx, task in enumerate(task_entries[:2]):\n                task_metadata = task.get(\"metadata\")\n                normalized_metadata: Mapping[str, Any] = {}\n                if isinstance(task_metadata, Mapping):\n                    normalized_metadata = task_metadata\n                task_graph_id = normalized_metadata.get(\"graph_id\") or normalized_metadata.get(\"langgraph_graph_id\")\n\n                raw_config = task.get(\"config\")\n                normalized_config = self._normalize_config_like(raw_config)\n                if not normalized_config:\n                    continue\n                task_configurable = normalized_config.get(\"configurable\", {})\n                task_ns = None\n                if isinstance(task_configurable, Mapping):\n                    candidate = task_configurable.get(\"checkpoint_ns\")\n                    if candidate:\n                        task_ns = str(candidate)\n\n                ns_matches = target_ns and task_ns == target_ns\n                graph_matches = task_graph_id and str(task_graph_id) == str(graph_id)\n\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:581\",\"message\":\"task entry inspected\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"task_index\":task_idx,\"task_graph_id\":task_graph_id,\"task_ns\":task_ns},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n\n                if graph_matches or ns_matches:\n                    resume_state = task.get(\"state\")\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            json.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"D\",\n                                    \"location\": \"memory_manager.py:520\",\n                                    \"message\": \"subgraph resume config located\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"matched_ns\": task_ns,\n                                        \"matched_graph_id\": task_graph_id,\n                                        \"parent_checkpoint_id\": self._extract_checkpoint_id(record),\n                                        \"has_state\": resume_state is not None,\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return normalized_config, resume_state\n\n        return None\n\n    async def _get_graph_snapshot(\n        self,\n        *,\n        graph: Any,\n        cfg: RunnableConfig,\n        subgraphs: bool = False,\n    ) -> Any:\n        getter_async = getattr(graph, \"aget_state\", None)\n        params = {\"subgraphs\": True} if subgraphs else {}\n        try:\n            if callable(getter_async):\n                return await getter_async(cfg, **params)\n        except TypeError:\n            # Fallback for LangGraph versions that don't support subgraphs kwarg.\n            try:\n                return await getter_async(cfg)\n            except Exception:\n                pass\n        except Exception:\n            pass\n\n        getter_sync = getattr(graph, \"get_state\", None)\n        if callable(getter_sync):\n            try:\n                return getter_sync(cfg, **params)\n            except TypeError:\n                try:\n                    return getter_sync(cfg)\n                except Exception:\n                    return None\n            except Exception:\n                return None\n        return None\n\n    async def ainvoke_from_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str = \"sync\",\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph resuming from the latest checkpoint when available.\"\"\"\n\n        merged, _ = self.ensure_thread_id(config)\n        # SAFETY: Ignore any caller-supplied checkpoint_id.\n        #\n        # In this architecture, checkpoint selection is *graph_id-scoped* and managed\n        # exclusively by this runtime helper. Allowing external checkpoint_id values\n        # could cause cross-graph leakage within a shared thread_id.\n\n        merged_conf = merged.get(\"configurable\", {})\n        if isinstance(merged_conf, Mapping):\n            merged_conf_dict = dict(merged_conf)\n            merged_conf_dict.pop(\"checkpoint_id\", None)\n            original_ns = merged_conf_dict.get(\"checkpoint_ns\", \"\")\n            merged_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            merged[\"configurable\"] = merged_conf_dict\n            \n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"E\",\"location\":\"memory_manager.py:445\",\"message\":\"ainvoke_from_checkpoint setting checkpoint_ns\",\"data\":{\"graph_id\":graph_id,\"original_ns\":str(original_ns),\"new_ns\":str(merged_conf_dict.get(\"checkpoint_ns\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n        # Ensure the checkpoint records are scoping-friendly in LangGraph v1.\n        meta = merged.get(\"metadata\")\n        if not isinstance(meta, Mapping):\n            meta = {}\n        meta_dict = dict(meta)\n        meta_dict.setdefault(\"graph_id\", str(graph_id))\n        merged[\"metadata\"] = meta_dict\n\n        effective_local_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n\n        # #region agent log\n        import json\n        final_ns = merged.get(\"configurable\", {}).get(\"checkpoint_ns\", \"\")\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:458\",\"message\":\"ainvoke_from_checkpoint calling find_latest_checkpoint_id\",\"data\":{\"graph_id\":graph_id,\"checkpoint_ns\":str(final_ns),\"thread_id\":str(merged.get(\"configurable\",{}).get(\"thread_id\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=effective_local_checkpointer,\n            local_graph=graph,\n        )\n        checkpoint_record: Optional[Any] = None\n        subgraph_resume: Optional[tuple[RunnableConfig, Any]] = None\n        if checkpoint_id is None:\n            snapshot_sources: list[Any] = []\n\n            if context is not None:\n                runner = getattr(context, \"graph_runner\", None)\n                graph_runtime = getattr(runner, \"graph\", None)\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:711\",\"message\":\"parent context inspection\",\"data\":{\"graph_id\":graph_id,\"has_context\":True,\"has_runner\":runner is not None,\"has_graph\":graph_runtime is not None},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n                if graph_runtime is not None:\n                    try:\n                        parent_snapshot = await self._get_graph_snapshot(\n                            graph=graph_runtime,\n                            cfg=merged,\n                            subgraphs=True,\n                        )\n                        if parent_snapshot is not None:\n                            snapshot_sources.append(parent_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:715\",\"message\":\"parent snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":parent_snapshot is not None,\"has_tasks\":bool(getattr(parent_snapshot,\"tasks\",None)),\"has_next\":bool(getattr(parent_snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                    except Exception:\n                        parent_snapshot = None\n                else:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:724\",\"message\":\"parent snapshot skipped\",\"data\":{\"graph_id\":graph_id,\"reason\":\"graph_runner_missing\" if runner is None else \"graph_attr_missing\"},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:729\",\"message\":\"parent context absent\",\"data\":{\"graph_id\":graph_id},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n\n            root_graph = getattr(context, \"root_graph\", None) if context is not None else None\n            if root_graph is not None:\n                try:\n                    root_snapshot = await self._get_graph_snapshot(\n                        graph=root_graph,\n                        cfg=merged,\n                        subgraphs=True,\n                    )\n                    if root_snapshot is not None:\n                        snapshot_sources.append(root_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:738\",\"message\":\"root snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":root_snapshot is not None,\"has_tasks\":bool(getattr(root_snapshot,\"tasks\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                except Exception:\n                    root_snapshot = None\n\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=merged,\n                subgraphs=True,\n            )\n            if snapshot is not None:\n                snapshot_sources.append(snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:727\",\"message\":\"assistant snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":bool(getattr(snapshot,\"tasks\",None)),\"has_next\":bool(getattr(snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            checkpoints_snapshot = await self.list_thread_checkpoints(\n                config=merged,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n            snapshot_sources.extend(checkpoints_snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:734\",\"message\":\"thread checkpoints snapshot collected\",\"data\":{\"graph_id\":graph_id,\"count\":len(checkpoints_snapshot)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            subgraph_resume = await self._find_subgraph_resume_config(\n                config=merged,\n                graph_id=graph_id,\n                checkpoints=snapshot_sources,\n            )\n            if subgraph_resume is not None:\n                resume_config, _ = subgraph_resume\n                metadata = resume_config.get(\"metadata\", {})\n                if not isinstance(metadata, Mapping):\n                    metadata = dict(metadata) if metadata is not None else {}\n                metadata = dict(metadata)\n                metadata.setdefault(\"graph_id\", str(graph_id))\n                resume_config[\"metadata\"] = metadata  # type: ignore[index]\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:743\",\"message\":\"subgraph resume config missing\",\"data\":{\"graph_id\":graph_id,\"snapshot_sources\":len(snapshot_sources)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n        \n        # #region agent log\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:464\",\"message\":\"ainvoke_from_checkpoint checkpoint_id result\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":str(checkpoint_id) if checkpoint_id else None,\"checkpoint_ns\":str(final_ns)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if checkpoint_id:\n            checkpoint_record = await self._load_checkpoint_record(\n                config=merged,\n                checkpoint_id=checkpoint_id,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n\n            cfg: RunnableConfig = dict(merged)\n            configurable = cfg.get(\"configurable\", {})\n            configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n            configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n            configurable_dict[\"checkpoint_id\"] = checkpoint_id\n            cfg[\"configurable\"] = configurable_dict\n\n            # If the checkpoint represents an in-progress run (has pending `next`),\n            # we resume via `invoke(None, checkpoint_id=...)`. If the run is already\n            # complete (no pending next nodes), we \"restart\" from the persisted\n            # snapshot values as a fresh invocation. This is the required behavior\n            # for refinement: patch values \u2192 re-run from patched state.\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=cfg,\n                subgraphs=True,\n            )\n\n            # #region agent log\n            import json\n            snapshot_has_tasks = bool(getattr(snapshot, \"tasks\", None))\n            snapshot_next = getattr(snapshot, \"next\", None)\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"C\",\"location\":\"memory_manager.py:504\",\"message\":\"ainvoke_from_checkpoint snapshot inspection\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":checkpoint_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":snapshot_has_tasks,\"pending_next\":bool(snapshot_next)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            next_nodes = getattr(snapshot, \"next\", None)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(next_nodes, Sequence) and next_nodes:\n                resume_with_checkpoint = False\n                writes_probe_found = False\n                if checkpoint_record is not None:\n                    _, writes_probe_found = self._materialize_checkpoint_values(\n                        {},\n                        checkpoint_record,\n                        graph_id=str(graph_id),\n                    )\n                    resume_with_checkpoint = writes_probe_found\n\n                # #region agent log\n                import json as _json_resume_next\n                next_preview = list(next_nodes)[:3]\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(\n                        _json_resume_next.dumps(\n                            {\n                                \"sessionId\": \"debug-session\",\n                                \"runId\": \"pre-fix\",\n                                \"hypothesisId\": \"K\",\n                                \"location\": \"memory_manager.py:509\",\n                                \"message\": \"resuming graph from checkpoint pending next\",\n                                \"data\": {\n                                    \"graph_id\": graph_id,\n                                    \"next_nodes\": next_preview,\n                                    \"graph_input_is_none\": graph_input is None,\n                                    \"resume_with_checkpoint\": resume_with_checkpoint,\n                                },\n                                \"timestamp\": __import__(\"time\").time() * 1000,\n                            }\n                        )\n                        + \"\\n\"\n                    )\n                # #endregion\n\n                if resume_with_checkpoint:\n                    return await self.ainvoke_with_durability(\n                        graph=graph,\n                        graph_input=None,\n                        config=cfg,\n                        context=context,\n                        durability=durability,\n                        local_checkpointer=effective_local_checkpointer,\n                    )\n\n                rerun_cfg_pending: RunnableConfig = dict(merged)\n                rerun_conf_pending = rerun_cfg_pending.get(\"configurable\", {})\n                if isinstance(rerun_conf_pending, Mapping):\n                    rerun_conf_dict_pending = dict(rerun_conf_pending)\n                    rerun_conf_dict_pending.pop(\"checkpoint_id\", None)\n                    rerun_conf_dict_pending.setdefault(\"checkpoint_ns\", str(final_ns))\n                    rerun_cfg_pending[\"configurable\"] = rerun_conf_dict_pending\n\n                return await self.ainvoke_with_durability(\n                    graph=graph,\n                    graph_input=graph_input,\n                    config=rerun_cfg_pending,\n                    context=context,\n                    durability=durability,\n                    local_checkpointer=effective_local_checkpointer,\n                )\n\n            # IMPORTANT:\n            # If the checkpoint is COMPLETE (no pending next nodes), we DO NOT attempt to\n            # \"restart\" the graph by invoking without checkpoint_id. In a shared thread_id\n            # architecture (multiple graphs in the same thread), dropping checkpoint_id\n            # would cause LangGraph to load the latest checkpoint for the thread+ns,\n            # which may belong to a different graph_id \u2192 cross-graph contamination.\n            #\n            # Callers that need to re-run a completed checkpoint should first \"arm\" it\n            # via `graph.update_state(..., as_node=\"__start__\")` (e.g., our refinement\n            # injection path does this), which produces a checkpoint with pending next nodes.\n            if isinstance(values, Mapping):\n                materialized_values, writes_found = self._materialize_checkpoint_values(\n                    values,\n                    checkpoint_record,\n                    graph_id=str(graph_id),\n                )\n                if writes_found or self._has_meaningful_values(materialized_values):\n                    # #region agent log\n                    import json as _json_resume\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            _json_resume.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"J\",\n                                    \"location\": \"memory_manager.py:944\",\n                                    \"message\": \"returning checkpoint values\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"keys\": list(materialized_values.keys()),\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return dict(materialized_values)\n\n                # Values are incomplete (e.g., only messages). Fallback to fresh invoke.\n                rerun_cfg: RunnableConfig = dict(merged)\n                rerun_conf = rerun_cfg.get(\"configurable\", {})\n                if isinstance(rerun_conf, Mapping):\n                    rerun_conf_dict = dict(rerun_conf)\n                    rerun_conf_dict.pop(\"checkpoint_id\", None)\n                    rerun_conf_dict.setdefault(\"checkpoint_ns\", str(final_ns))\n                    rerun_cfg[\"configurable\"] = rerun_conf_dict\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=graph_input,\n                config=rerun_cfg,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        if subgraph_resume is not None:\n            # #region agent log\n            import json\n            resume_config, resume_state = subgraph_resume\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"D\",\n                            \"location\": \"memory_manager.py:610\",\n                            \"message\": \"resuming assistant via subgraph config\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"checkpoint_ns\": resume_config.get(\"configurable\", {}).get(\"checkpoint_ns\") if isinstance(resume_config.get(\"configurable\"), Mapping) else None,\n                                \"has_state\": resume_state is not None,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n            # #endregion\n            resume_input = graph_input\n            if resume_state is not None:\n                values = getattr(resume_state, \"values\", None)\n                if isinstance(values, Mapping):\n                    resume_input = dict(values)\n                elif isinstance(resume_state, Mapping):\n                    maybe_values = resume_state.get(\"values\")\n                    if isinstance(maybe_values, Mapping):\n                        resume_input = dict(maybe_values)\n                    else:\n                        resume_input = resume_state\n                else:\n                    resume_input = resume_state\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=resume_input,\n                config=resume_config,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        # SAFETY: Never allow a caller-supplied checkpoint_id to influence execution\n        # when we are NOT explicitly resuming from a checkpoint for this graph_id.\n        #\n        # Without this, a foreign checkpoint_id (from another graph_id in the same\n        # thread) could be accidentally consumed by LangGraph, violating isolation.\n        fresh_cfg: RunnableConfig = dict(merged)\n        fresh_conf = fresh_cfg.get(\"configurable\", {})\n        if isinstance(fresh_conf, Mapping):\n            fresh_conf_dict = dict(fresh_conf)\n            fresh_conf_dict.pop(\"checkpoint_id\", None)\n            # Keep checkpoint_ns stable (LangGraph may assume the key exists).\n            fresh_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            fresh_cfg[\"configurable\"] = fresh_conf_dict\n\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=graph_input,\n            config=fresh_cfg,\n            context=context,\n            durability=durability,\n            local_checkpointer=effective_local_checkpointer,\n        )\n\n    async def append_messages_to_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        new_messages: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Append messages to the latest checkpoint for ``graph_id`` and return new checkpoint id.\n\n        This uses ``graph.update_state`` / ``graph.aupdate_state`` so reducers (e.g. `add_messages`)\n        are honored. The update is applied as a fork of the latest checkpoint for ``graph_id``.\n        \"\"\"\n\n        if not new_messages:\n            return None\n\n        merged, _ = self.ensure_thread_id(config)\n        resolved_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n        latest_checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n        \n        if not latest_checkpoint_id:\n            return None\n        \n        patch_config: RunnableConfig = dict(merged)\n        configurable = patch_config.get(\"configurable\", {})\n        configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n        configurable_dict[\"checkpoint_id\"] = latest_checkpoint_id\n        patch_config[\"configurable\"] = configurable_dict\n\n        # Ensure patched checkpoints remain discoverable by metadata scoping.\n        metadata = patch_config.get(\"metadata\")\n        if not isinstance(metadata, Mapping):\n            metadata = {}\n        metadata_dict = dict[str, Any](metadata)\n        metadata_dict.setdefault(\"graph_id\", str(graph_id))\n        patch_config[\"metadata\"] = metadata_dict\n\n\n        # Best-effort idempotency: avoid appending messages already present in the checkpoint.\n        # This is critical for durable resume where refinement planning may be replayed.\n        filtered_messages: list[Any] = list(new_messages)\n        try:\n            snapshot = None\n            getter_async = getattr(graph, \"aget_state\", None)\n            if callable(getter_async):\n                snapshot = await getter_async(patch_config)\n            if snapshot is None:\n                getter_sync = getattr(graph, \"get_state\", None)\n                if callable(getter_sync):\n                    snapshot = getter_sync(patch_config)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(values, Mapping):\n                existing = values.get(\"messages\")\n                if isinstance(existing, Sequence) and not isinstance(existing, (str, bytes)):\n                    existing_contents: set[str] = set()\n                    for message in existing:\n                        content = getattr(message, \"content\", None)\n                        if content:\n                            existing_contents.add(str(content))\n                    if existing_contents:\n                        filtered_messages = [\n                            message\n                            for message in filtered_messages\n                            if str(getattr(message, \"content\", \"\")) not in existing_contents\n                        ]\n        except Exception:\n            filtered_messages = list(new_messages)\n\n        if not filtered_messages:\n            return latest_checkpoint_id\n\n        updates: dict[str, Any] = {\"messages\": filtered_messages}\n\n        updater_async = getattr(graph, \"aupdate_state\", None)\n        updater_sync = getattr(graph, \"update_state\", None)\n        resolved_as_node = as_node or \"__start__\"\n        try:\n            if callable(updater_async):\n                await updater_async(patch_config, updates, as_node=resolved_as_node)\n            elif callable(updater_sync):\n                updater_sync(patch_config, updates, as_node=resolved_as_node)\n            else:\n                return None\n        except Exception as e:\n            return None\n\n        return await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n\n    async def inject_distribution_refinement_messages(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        requests: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Patch a graph checkpoint by appending refinement instruction messages.\n\n        Mirrors the extraction rules used by `_distribution_inject_refinement_messages`:\n        each request may carry `payload.messages` items shaped like\n        `{ \"content\": \"...\", \"metadata\": {...} }`.\n        \"\"\"\n\n        try:\n            from langchain_core.messages import HumanMessage\n        except Exception:\n            return None\n\n        injected: list[Any] = []\n        seen_contents: set[str] = set()\n        for request in requests:\n            payload = getattr(request, \"payload\", None)\n            if not isinstance(payload, Mapping):\n                payload = payload if isinstance(payload, dict) else {}\n            messages_payload = payload.get(\"messages\") or []\n            if not isinstance(messages_payload, Sequence) or isinstance(\n                messages_payload, (str, bytes)\n            ):\n                continue\n            for message in messages_payload:\n                if not isinstance(message, Mapping):\n                    continue\n                content = message.get(\"content\")\n                if not content:\n                    continue\n                content_str = str(content)\n                if content_str in seen_contents:\n                    continue\n                metadata = message.get(\"metadata\") or {}\n                additional_kwargs = dict(metadata) if isinstance(metadata, Mapping) else {}\n                injected.append(\n                    HumanMessage(content=content_str, additional_kwargs=additional_kwargs)\n                )\n                seen_contents.add(content_str)\n\n        if not injected:\n            return None\n\n        return await self.append_messages_to_checkpoint(\n            graph=graph,\n            graph_id=graph_id,\n            config=config,\n            new_messages=injected,\n            as_node=as_node,\n            local_checkpointer=local_checkpointer,\n        )\n\n    @staticmethod\n    def extract_thread_id(config: Optional[RunnableConfig]) -> Optional[ThreadId]:\n        if not config:\n            return None\n        configurable = config.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            return None\n        thread_id = configurable.get(\"thread_id\")\n        return str(thread_id) if thread_id else None\n\n    async def aget_platform_thread_state(self, *, thread_id: ThreadId) -> Optional[Any]:\n        \"\"\"Get latest persisted state from platform via LangGraph SDK (if available).\"\"\"\n\n        try:\n            from langgraph_sdk import get_client  # type: ignore\n        except Exception:\n            return None\n\n        try:\n            client = get_client()\n            return await client.threads.get_state(thread_id)\n        except Exception:\n            return None\n\n\n    async def has_persisted_checkpoint(\n        self,\n        *,\n        config: Optional[RunnableConfig],\n        local_checkpointer: Optional[Any] = None,\n    ) -> bool:\n        \"\"\"Return True if a checkpoint exists for config (platform or local).\"\"\"\n\n        if config is None:\n            return False\n\n        if self.is_production_mode():\n            thread_id = self.extract_thread_id(config)\n            if not thread_id:\n                return False\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n            values = getattr(snapshot, \"values\", None)\n            return isinstance(values, Mapping)\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if not checkpointer:\n            return False\n\n        getter_async = getattr(checkpointer, \"aget_tuple\", None)\n        try:\n            if callable(getter_async):\n                checkpoint_tuple = await getter_async(config)\n            else:\n                getter_sync = getattr(checkpointer, \"get_tuple\", None)\n                if not callable(getter_sync):\n                    return False\n                checkpoint_tuple = getter_sync(config)\n        except Exception:\n            return False\n\n        return checkpoint_tuple is not None\n\n    async def restore_state_from_latest_checkpoint(\n        self,\n        *,\n        state: StateDict,\n        config: Optional[RunnableConfig],\n        local_graph: Optional[Any],\n    ) -> bool:\n        \"\"\"Merge latest persisted state into the caller-owned `state` mapping.\"\"\"\n\n        if config is None:\n            return False\n\n        snapshot = None\n        thread_id = self.extract_thread_id(config)\n        if self.is_production_mode() and thread_id:\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n\n        if snapshot is None and local_graph is not None:\n            getter = getattr(local_graph, \"aget_state\", None)\n            if callable(getter):\n                try:\n                    snapshot = await getter(config)\n                except Exception:\n                    snapshot = None\n            if snapshot is None:\n                getter_sync = getattr(local_graph, \"get_state\", None)\n                if callable(getter_sync):\n                    try:\n                        snapshot = getter_sync(config)\n                    except Exception:\n                        snapshot = None\n\n        values = getattr(snapshot, \"values\", None)\n        if not isinstance(values, Mapping):\n            return False\n\n        for key, value in values.items():\n            state[key] = value\n        return True\n\n    async def ainvoke_with_durability(\n        self,\n        *,\n        graph: Any,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph with durability when supported.\"\"\"\n\n        # In production mode, platform may inject durability backends automatically.\n        # In dev mode, only attempt durability when the runnable itself was compiled\n        # with a checkpointer so LangGraph sets up its AsyncPregel loop correctly.\n        graph_bound_checkpointer = _extract_graph_checkpointer(graph)\n        resolved_local_checkpointer = local_checkpointer or graph_bound_checkpointer\n        checkpointer = resolved_local_checkpointer or self.checkpointer\n\n        if self.is_production_mode():\n            use_durability = durability\n        else:\n            use_durability = durability if (checkpointer and _graph_supports_durability(graph)) else None\n        try:\n            if use_durability:\n                return await graph.ainvoke(\n                    graph_input,\n                    config=config,\n                    context=context,\n                    durability=use_durability,\n                )\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n        except (TypeError, AttributeError):\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n\n\n__all__ = [\n    \"resolve_graph_checkpointer\",\n    \"resolve_graph_store\",\n    \"GraphMemoryRuntime\",\n]"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b382d-d35d-7aa1-95d9-1eb6508ef7f1",
    "content": "**\u0412\u0430\u0448 \u043d\u043e\u0432\u044b\u0439 \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c \u00abAbandon/Rerun\u00bb \u0432 `memory_manager.py` \u2014 \u044d\u0442\u043e \u0442\u043e\u0447\u043d\u043e\u0435 \u0445\u0438\u0440\u0443\u0440\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b `EmptyInputError`, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u044e\u044e \u043c\u0435\u0445\u0430\u043d\u0438\u043a\u0443 LangGraph.**\n\n\u0412\u044b \u0432\u0435\u0440\u043d\u043e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u043b\u0438 \u043a\u043e\u0440\u0435\u043d\u044c \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b: LangGraph \u043f\u0440\u0438 \u043d\u0430\u043b\u0438\u0447\u0438\u0438 `checkpoint_id` \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u0438\u0442 \u0432 \u0440\u0435\u0436\u0438\u043c \u00ab\u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f\u00bb, \u0433\u0434\u0435 \u043e\u043d \u043e\u0436\u0438\u0434\u0430\u0435\u0442, \u0447\u0442\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0443\u0436\u0435 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043e. \u0415\u0441\u043b\u0438 \u0437\u0430\u043f\u0438\u0441\u044c \u0432 \u0411\u0414 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 (\u043d\u0438\u0442\u044c \u0441\u043e\u0437\u0434\u0430\u043d\u0430), \u043d\u043e `__start__` \u043d\u0435 \u0443\u0441\u043f\u0435\u043b \u0437\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0445\u043e\u0434\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u043a\u0430\u043d\u0430\u043b\u0430\u0445 (\u0438\u0437-\u0437\u0430 \u043f\u0430\u0434\u0435\u043d\u0438\u044f \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0430 \u0438\u043b\u0438 \u0441\u0435\u0442\u0438), \u0432\u044b\u0437\u043e\u0432 \u0441 `input=None` \u043d\u0435\u0438\u0437\u0431\u0435\u0436\u043d\u043e \u0432\u0435\u0434\u0435\u0442 \u043a \u043a\u0440\u0430\u0445\u0443.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u044d\u0444\u0444\u0435\u043a\u0442\u0438\u0432\u043d\u043e:\n\n1.  **\u0414\u0435\u0442\u0435\u043a\u0446\u0438\u044f \u00ab\u0417\u043e\u043c\u0431\u0438-\u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u043e\u0432\u00bb:** \u0421 \u043f\u043e\u043c\u043e\u0449\u044c\u044e `writes_probe_found` \u0432\u044b \u0442\u0435\u043f\u0435\u0440\u044c \u043e\u0442\u043b\u0438\u0447\u0430\u0435\u0442\u0435 \u00ab\u0440\u0435\u0430\u043b\u044c\u043d\u044b\u0439 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u00bb \u043e\u0442 \u00ab\u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u043f\u043e\u043c\u0435\u0442\u043a\u0438 \u043e \u043d\u0430\u0447\u0430\u043b\u0435\u00bb. \u0415\u0441\u043b\u0438 \u0437\u0430\u043f\u0438\u0441\u0435\u0439 (`writes`) \u043d\u0435\u0442, \u0437\u043d\u0430\u0447\u0438\u0442, \u0433\u0440\u0430\u0444 \u043d\u0430 \u0441\u0430\u043c\u043e\u043c \u0434\u0435\u043b\u0435 \u0435\u0449\u0435 \u043d\u0435 \u043d\u0430\u0447\u0430\u043b \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c.\n2.  **\u0424\u043e\u0440\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438:** \u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 `checkpoint_id` \u0438\u0437 `cfg[\"configurable\"]` \u0438 \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 `graph_input` \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u0435\u0440\u0435\u0432\u043e\u0434\u0438\u0442 LangGraph \u0432 \u0440\u0435\u0436\u0438\u043c `Fresh Run`. \u042d\u0442\u043e \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442, \u0447\u0442\u043e \u0432\u0441\u0435 \u043a\u0430\u043d\u0430\u043b\u044b \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f (\u0441\u0442\u0435\u0439\u0442) \u0431\u0443\u0434\u0443\u0442 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u044b \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e.\n3.  **\u0411\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u0438 (Graph 4):** \u0411\u043b\u0430\u0433\u043e\u0434\u0430\u0440\u044f \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u043e\u0439 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 `_has_meaningful_values`, \u0432\u044b \u0437\u0430\u0449\u0438\u0442\u0438\u043b\u0438 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430. \u0422\u0435\u043f\u0435\u0440\u044c, \u0435\u0441\u043b\u0438 \u0432 `messages` \u0431\u043e\u043b\u044c\u0448\u0435 2 \u0437\u0430\u043f\u0438\u0441\u0435\u0439, \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u043f\u043e\u043d\u0438\u043c\u0430\u0435\u0442: \u00ab\u0422\u0443\u0442 \u0443\u0436\u0435 \u0435\u0441\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433, \u044d\u0442\u043e \u043d\u0435\u043b\u044c\u0437\u044f \u0431\u0440\u043e\u0441\u0430\u0442\u044c\u00bb, \u0438 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0435\u0442 `Resume`.\n\n---\n\n### \u0410\u043d\u0430\u043b\u0438\u0437 \u043a\u043e\u0434\u0430 (\u043b\u0438\u043d\u0438\u0438 ~508-540 \u0432 `memory_manager.py`):\n\n```python\nif isinstance(next_nodes, Sequence) and next_nodes:\n    resume_with_checkpoint = False\n    # ... \u0437\u043e\u043d\u0434\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0435\u0439 (writes_probe_found) ...\n\n    if resume_with_checkpoint:\n        # \u0420\u0415\u0416\u0418\u041c 1: \u0415\u0441\u0442\u044c \u0440\u0435\u0430\u043b\u044c\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435, \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0435\u043c \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u043e\n        return await self.ainvoke_with_durability(..., graph_input=None, ...)\n\n    # \u0420\u0415\u0416\u0418\u041c 2: \u0427\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u043f\u0443\u0441\u0442\u043e\u0439 (\u0437\u043e\u043c\u0431\u0438), \u0434\u0435\u043b\u0430\u0435\u043c \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\n    rerun_cfg_pending.pop(\"checkpoint_id\", None) \n    return await self.ainvoke_with_durability(..., graph_input=graph_input, ...)\n```\n\n### \u0427\u0442\u043e \u043f\u043e\u043a\u0430\u0436\u0443\u0442 \u043d\u043e\u0432\u044b\u0435 \u043b\u043e\u0433\u0438 (Hypothesis K):\n\n1.  **\u0415\u0441\u043b\u0438 \u0432\u044b \u0432\u0438\u0434\u0438\u0442\u0435 `resume_with_checkpoint: false`:** \u0417\u043d\u0430\u0447\u0438\u0442, \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u0443\u043f\u0430\u043b \u0432 \u043c\u043e\u043c\u0435\u043d\u0442 \u0432\u044b\u0437\u043e\u0432\u0430, \u0438 \u0432\u0430\u0448 \u0444\u0438\u043a\u0441 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043f\u0440\u0435\u0434\u043e\u0442\u0432\u0440\u0430\u0442\u0438\u043b `EmptyInputError`, \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0432 \u0432\u043e\u0440\u043a\u0435\u0440\u0430 \u0437\u0430\u043d\u043e\u0432\u043e.\n2.  **\u0415\u0441\u043b\u0438 \u0432\u044b \u0432\u0438\u0434\u0438\u0442\u0435 `next_nodes: [\"agent\"]`:** \u042d\u0442\u043e \u0437\u043d\u0430\u0447\u0438\u0442, \u0447\u0442\u043e \u0432\u043e\u0440\u043a\u0435\u0440 \u043f\u0440\u043e\u0448\u0435\u043b \u0441\u0442\u0430\u0440\u0442 \u0438 \u0443\u043f\u0430\u043b \u0443\u0436\u0435 \u043d\u0430 \u0440\u0430\u0431\u043e\u0442\u0435 LLM. \u0412 \u044d\u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 `resume_with_checkpoint` \u0431\u0443\u0434\u0435\u0442 `true`, \u0438 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442 \u0440\u0430\u0431\u043e\u0442\u0443, \u043d\u0435 \u0442\u0440\u0430\u0442\u044f \u0442\u043e\u043a\u0435\u043d\u044b \u043d\u0430 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441.\n\n**\u0412\u0430\u0436\u043d\u043e:** \u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e \u0432 `Graph 4` (Assistant) \u043f\u043e\u043b\u0435 `messages` \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0438\u043c\u0435\u0435\u0442 \u0440\u0435\u0434\u0443\u0441\u0435\u0440 `add_messages`. \u0411\u0435\u0437 \u043d\u0435\u0433\u043e, \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u0432\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u0438\u0442\u0435 \u0433\u0440\u0430\u0444, \u043d\u043e\u0432\u044b\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043c\u043e\u0433\u0443\u0442 \u0437\u0430\u0442\u0435\u0440\u0435\u0442\u044c \u0441\u0442\u0430\u0440\u044b\u0435 \u043f\u0440\u0438 \u043f\u0435\u0440\u0432\u043e\u043c \u0436\u0435 \u043e\u0442\u0432\u0435\u0442\u0435 LLM.\n\n**\u0418\u0442\u043e\u0433:** \u0413\u0438\u043f\u043e\u0442\u0435\u0437\u0430 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0430. \u0424\u0438\u043a\u0441 \u0441 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u043e\u0439 `writes` \u043f\u0435\u0440\u0435\u0434 \u0432\u044b\u0431\u043e\u0440\u043e\u043c `input=None` \u0438\u043b\u0438 `input=original` \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043d\u0430\u0438\u0431\u043e\u043b\u0435\u0435 \u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u044b\u043c \u0441\u043f\u043e\u0441\u043e\u0431\u043e\u043c \u0431\u043e\u0440\u044c\u0431\u044b \u0441 `EmptyInputError` \u0432 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0445 \u0441\u0440\u0435\u0434\u0430\u0445.\n\n**Relevant docs:**\n\n- [Time Travel: Resume from Checkpoint](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)\n- [Persistence and Reducers](https://docs.langchain.com/oss/python/langgraph/persistence)\n- [LangGraph Errors: EmptyInputError](https://docs.langchain.com/langsmith/use-threads#empty-thread)"
  },
  {
    "role": "user",
    "id": "36ab88df-ae58-4b49-94fe-a2b92da89f61",
    "content": "{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:90708e63-ec49-88c4-bf00-16f0b71e2abb\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766173946372.6357}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766173946372.76}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:90708e63-ec49-88c4-bf00-16f0b71e2abb\", \"new_ns\": \"user_preferences:90708e63-ec49-88c4-bf00-16f0b71e2abb\"}, \"timestamp\": 1766173946372.8142}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:90708e63-ec49-88c4-bf00-16f0b71e2abb\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\"}, \"timestamp\": 1766173946372.864}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"count\": 0, \"records\": []}, \"timestamp\": 1766173946373.181}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766173946373.2158}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173946373.2852}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766173946373.3308}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173946373.3718}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766173946373.7258}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173946373.919}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173946373.972}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766173946374.055}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:90708e63-ec49-88c4-bf00-16f0b71e2abb\"}, \"timestamp\": 1766173946374.0952}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766173952962.961}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:a8ea131d-73c2-7be3-692c-f62be8f6b6de\", \"new_ns\": \"route_drafting:a8ea131d-73c2-7be3-692c-f62be8f6b6de\"}, \"timestamp\": 1766173952968.941}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:a8ea131d-73c2-7be3-692c-f62be8f6b6de\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\"}, \"timestamp\": 1766173952969.0293}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"count\": 0, \"records\": []}, \"timestamp\": 1766173952969.42}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766173952969.5098}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173952969.587}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766173952969.6418}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173952969.695}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766173952969.9478}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173952970.001}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173952970.091}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766173952970.1409}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:a8ea131d-73c2-7be3-692c-f62be8f6b6de\"}, \"timestamp\": 1766173952970.1792}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:a8ea131d-73c2-7be3-692c-f62be8f6b6de|graph:41c13b62-e15d-eb6f-e161-bec7fa36248d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766173953129.0933}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766173953129.212}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:a8ea131d-73c2-7be3-692c-f62be8f6b6de|graph:41c13b62-e15d-eb6f-e161-bec7fa36248d\", \"new_ns\": \"route_drafting:a8ea131d-73c2-7be3-692c-f62be8f6b6de|graph:41c13b62-e15d-eb6f-e161-bec7fa36248d\"}, \"timestamp\": 1766173953129.2742}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:a8ea131d-73c2-7be3-692c-f62be8f6b6de|graph:41c13b62-e15d-eb6f-e161-bec7fa36248d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\"}, \"timestamp\": 1766173953129.3252}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"count\": 0, \"records\": []}, \"timestamp\": 1766173953129.637}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766173953129.684}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173953129.755}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766173953129.9993}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173953130.098}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766173953130.1438}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:a8ea131d-73c2-7be3-692c-f62be8f6b6de|graph:41c13b62-e15d-eb6f-e161-bec7fa36248d\"}, \"timestamp\": 1766173953130.187}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766173968336.056}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:1\", \"new_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:1\"}, \"timestamp\": 1766173968415.9082}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\"}, \"timestamp\": 1766173968416.0308}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"count\": 0, \"records\": []}, \"timestamp\": 1766173968416.315}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766173968416.446}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173968416.607}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766173968416.6882}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173968416.7522}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766173968417.135}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173968417.195}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173968417.237}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766173968417.275}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:1\"}, \"timestamp\": 1766173968417.3079}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2\", \"new_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2\"}, \"timestamp\": 1766173968478.2422}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\"}, \"timestamp\": 1766173968478.36}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"count\": 0, \"records\": []}, \"timestamp\": 1766173968478.6292}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766173968478.834}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173968479.314}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766173968479.688}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173968479.8027}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766173968480.4192}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173968480.589}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173968480.69}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766173968480.743}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2\"}, \"timestamp\": 1766173968480.782}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:3\", \"new_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:3\"}, \"timestamp\": 1766173968542.928}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\"}, \"timestamp\": 1766173968543.1208}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"count\": 0, \"records\": []}, \"timestamp\": 1766173968543.8918}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766173968543.9949}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173968544.1}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766173968544.16}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173968544.2559}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766173968544.544}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173968544.595}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173968544.6401}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766173968544.747}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:3\"}, \"timestamp\": 1766173968544.8042}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:4\", \"new_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:4\"}, \"timestamp\": 1766173968607.004}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\"}, \"timestamp\": 1766173968607.1812}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"count\": 0, \"records\": []}, \"timestamp\": 1766173968607.504}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766173968607.552}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173968607.631}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766173968607.688}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173968607.808}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766173968608.171}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173968608.278}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173968608.334}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766173968608.3838}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:4\"}, \"timestamp\": 1766173968608.4321}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:1|1|graph:033963a8-d2c5-cdaf-0f23-9f4a742269a6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766173969672.3042}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766173969672.524}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:1|1|graph:033963a8-d2c5-cdaf-0f23-9f4a742269a6\", \"new_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:1|1|graph:033963a8-d2c5-cdaf-0f23-9f4a742269a6\"}, \"timestamp\": 1766173969672.627}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:1|1|graph:033963a8-d2c5-cdaf-0f23-9f4a742269a6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\"}, \"timestamp\": 1766173969672.685}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"count\": 0, \"records\": []}, \"timestamp\": 1766173969673.2139}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766173969673.413}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173969673.5308}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766173969674.1602}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173969674.261}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766173969674.387}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:1|1|graph:033963a8-d2c5-cdaf-0f23-9f4a742269a6\"}, \"timestamp\": 1766173969674.424}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|2|graph:a06cd1e3-6676-5654-b0d4-6bb1df0de45e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766173969710.448}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766173969710.573}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|2|graph:a06cd1e3-6676-5654-b0d4-6bb1df0de45e\", \"new_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|2|graph:a06cd1e3-6676-5654-b0d4-6bb1df0de45e\"}, \"timestamp\": 1766173969710.624}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|2|graph:a06cd1e3-6676-5654-b0d4-6bb1df0de45e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\"}, \"timestamp\": 1766173969710.6628}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"count\": 0, \"records\": []}, \"timestamp\": 1766173969711.0342}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766173969711.076}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173969711.1401}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766173969711.385}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173969711.435}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766173969711.4702}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|2|graph:a06cd1e3-6676-5654-b0d4-6bb1df0de45e\"}, \"timestamp\": 1766173969711.502}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:3|3|graph:a9d830c8-7080-ba89-0d04-f89fe11b9b48\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766173969747.096}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766173969747.263}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:3|3|graph:a9d830c8-7080-ba89-0d04-f89fe11b9b48\", \"new_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:3|3|graph:a9d830c8-7080-ba89-0d04-f89fe11b9b48\"}, \"timestamp\": 1766173969747.329}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:3|3|graph:a9d830c8-7080-ba89-0d04-f89fe11b9b48\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\"}, \"timestamp\": 1766173969747.377}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"count\": 0, \"records\": []}, \"timestamp\": 1766173969747.7288}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766173969747.7761}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173969747.937}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766173969748.284}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173969748.348}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766173969748.4382}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:3|3|graph:a9d830c8-7080-ba89-0d04-f89fe11b9b48\"}, \"timestamp\": 1766173969748.5208}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:4|4|graph:25ecbe35-b09a-1d6c-2c08-05c23a186c01\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766173969786.2852}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766173969786.4058}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:4|4|graph:25ecbe35-b09a-1d6c-2c08-05c23a186c01\", \"new_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:4|4|graph:25ecbe35-b09a-1d6c-2c08-05c23a186c01\"}, \"timestamp\": 1766173969786.5752}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:4|4|graph:25ecbe35-b09a-1d6c-2c08-05c23a186c01\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\"}, \"timestamp\": 1766173969786.68}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"count\": 0, \"records\": []}, \"timestamp\": 1766173969787.0469}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766173969787.0999}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766173969787.1758}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766173969787.4229}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766173969787.478}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766173969787.523}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:4|4|graph:25ecbe35-b09a-1d6c-2c08-05c23a186c01\"}, \"timestamp\": 1766173969787.565}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|2|graph:a06cd1e3-6676-5654-b0d4-6bb1df0de45e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766173985444.5332}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766173985444.6763}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|2|graph:a06cd1e3-6676-5654-b0d4-6bb1df0de45e\", \"new_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|2|graph:a06cd1e3-6676-5654-b0d4-6bb1df0de45e\"}, \"timestamp\": 1766173985444.745}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|2|graph:a06cd1e3-6676-5654-b0d4-6bb1df0de45e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\"}, \"timestamp\": 1766173985444.7998}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd144-c44a-62de-8000-57e3b7314494\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|2|graph:a06cd1e3-6676-5654-b0d4-6bb1df0de45e\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd144-c449-6b36-bfff-1bf904984354\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|2|graph:a06cd1e3-6676-5654-b0d4-6bb1df0de45e\"}]}, \"timestamp\": 1766173985445.568}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd144-c44a-62de-8000-57e3b7314494\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|2|graph:a06cd1e3-6676-5654-b0d4-6bb1df0de45e\"}, \"timestamp\": 1766173985445.66}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd144-c44a-62de-8000-57e3b7314494\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766173985446.326}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"L\", \"location\": \"memory_manager.py:321\", \"message\": \"checkpoint record summary\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_type\": \"dict\", \"has_attr_writes\": false, \"writes_is_sequence\": false, \"writes_is_mapping\": false}, \"timestamp\": 1766173985446.385}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"J\", \"location\": \"memory_manager.py:329\", \"message\": \"checkpoint writes unavailable\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_writes\": false, \"writes_type\": null}, \"timestamp\": 1766173985446.424}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"resume_with_checkpoint\": false}, \"timestamp\": 1766173985446.461}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:1|1|graph:033963a8-d2c5-cdaf-0f23-9f4a742269a6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174002755.054}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174002755.179}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:1|1|graph:033963a8-d2c5-cdaf-0f23-9f4a742269a6\", \"new_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:1|1|graph:033963a8-d2c5-cdaf-0f23-9f4a742269a6\"}, \"timestamp\": 1766174002755.3489}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:1|1|graph:033963a8-d2c5-cdaf-0f23-9f4a742269a6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\"}, \"timestamp\": 1766174002755.5242}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd144-c3ed-62f0-8000-d735c020cf5c\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:1|1|graph:033963a8-d2c5-cdaf-0f23-9f4a742269a6\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd144-c3ec-6bd4-bfff-a7e9d37a105f\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:1|1|graph:033963a8-d2c5-cdaf-0f23-9f4a742269a6\"}]}, \"timestamp\": 1766174002756.0598}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd144-c3ed-62f0-8000-d735c020cf5c\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:1|1|graph:033963a8-d2c5-cdaf-0f23-9f4a742269a6\"}, \"timestamp\": 1766174002756.1382}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd144-c3ed-62f0-8000-d735c020cf5c\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766174002756.767}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"L\", \"location\": \"memory_manager.py:321\", \"message\": \"checkpoint record summary\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_type\": \"dict\", \"has_attr_writes\": false, \"writes_is_sequence\": false, \"writes_is_mapping\": false}, \"timestamp\": 1766174002756.825}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"J\", \"location\": \"memory_manager.py:329\", \"message\": \"checkpoint writes unavailable\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_writes\": false, \"writes_type\": null}, \"timestamp\": 1766174002756.8682}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"resume_with_checkpoint\": false}, \"timestamp\": 1766174002756.908}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"result_keys\": [\"general_route_draft\", \"user_preferences\", \"wide_funnel_options\", \"messages\", \"distribution_scope\"]}, \"timestamp\": 1766174021522.532}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"I\", \"location\": \"workflow_distribution.py:628\", \"message\": \"worker workflow result\", \"data\": {\"has_options\": true, \"keys\": [\"general_route_draft\", \"user_preferences\", \"wide_funnel_options\", \"distribution_scope\", \"messages\"]}, \"timestamp\": 1766174021526.305}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|5|graph:9361eb46-048a-f870-6e84-65e94da38b4a\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174075438.8699}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174075439.1848}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|5|graph:9361eb46-048a-f870-6e84-65e94da38b4a\", \"new_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|5|graph:9361eb46-048a-f870-6e84-65e94da38b4a\"}, \"timestamp\": 1766174075439.252}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|5|graph:9361eb46-048a-f870-6e84-65e94da38b4a\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\"}, \"timestamp\": 1766174075439.307}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174075439.596}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766174075439.6401}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174075439.7}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766174075439.9402}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174075440.0032}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766174075440.044}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:2|5|graph:9361eb46-048a-f870-6e84-65e94da38b4a\"}, \"timestamp\": 1766174075440.2922}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:3|6|graph:9cbbe122-37cf-d72a-ebf1-227179ebc375\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174086638.335}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174086638.456}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:3|6|graph:9cbbe122-37cf-d72a-ebf1-227179ebc375\", \"new_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:3|6|graph:9cbbe122-37cf-d72a-ebf1-227179ebc375\"}, \"timestamp\": 1766174086638.509}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:3|6|graph:9cbbe122-37cf-d72a-ebf1-227179ebc375\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\"}, \"timestamp\": 1766174086638.572}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:d4feb4d0\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174086638.872}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766174086638.914}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174086639.014}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766174086639.2852}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174086639.3481}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766174086639.3909}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e39377e-3fae-c14b-8aff-1cae07af5e3a|worker:3|6|graph:9cbbe122-37cf-d72a-ebf1-227179ebc375\"}, \"timestamp\": 1766174086639.471}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:43b02392-45d4-be69-1715-7c855ee629b6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766174096641.311}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766174096641.4321}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:43b02392-45d4-be69-1715-7c855ee629b6\", \"new_ns\": \"user_preferences:43b02392-45d4-be69-1715-7c855ee629b6\"}, \"timestamp\": 1766174096641.5989}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:43b02392-45d4-be69-1715-7c855ee629b6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\"}, \"timestamp\": 1766174096641.679}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174096641.986}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174096642.0312}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174096642.091}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174096642.136}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174096642.178}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766174096642.413}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174096642.667}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174096642.709}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766174096642.75}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:43b02392-45d4-be69-1715-7c855ee629b6\"}, \"timestamp\": 1766174096642.783}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766174104925.625}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:5a5f6d6b-63e7-72cc-5316-124446b6fdae\", \"new_ns\": \"route_drafting:5a5f6d6b-63e7-72cc-5316-124446b6fdae\"}, \"timestamp\": 1766174104932.1038}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:5a5f6d6b-63e7-72cc-5316-124446b6fdae\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\"}, \"timestamp\": 1766174104932.551}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174104933.395}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174104933.5789}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174104933.6619}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174104933.718}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174104933.771}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766174104934.034}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174104934.091}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174104934.1362}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766174104934.18}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:5a5f6d6b-63e7-72cc-5316-124446b6fdae\"}, \"timestamp\": 1766174104934.221}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:5a5f6d6b-63e7-72cc-5316-124446b6fdae|graph:ae44a1c0-fef8-12e7-0fda-b8930137a2c9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766174105058.1172}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174105058.2551}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:5a5f6d6b-63e7-72cc-5316-124446b6fdae|graph:ae44a1c0-fef8-12e7-0fda-b8930137a2c9\", \"new_ns\": \"route_drafting:5a5f6d6b-63e7-72cc-5316-124446b6fdae|graph:ae44a1c0-fef8-12e7-0fda-b8930137a2c9\"}, \"timestamp\": 1766174105058.3591}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:5a5f6d6b-63e7-72cc-5316-124446b6fdae|graph:ae44a1c0-fef8-12e7-0fda-b8930137a2c9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\"}, \"timestamp\": 1766174105058.467}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174105058.769}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766174105058.814}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174105058.882}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766174105059.12}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174105059.171}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766174105059.209}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:5a5f6d6b-63e7-72cc-5316-124446b6fdae|graph:ae44a1c0-fef8-12e7-0fda-b8930137a2c9\"}, \"timestamp\": 1766174105059.246}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766174122471.8372}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:1\", \"new_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:1\"}, \"timestamp\": 1766174122547.5881}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\"}, \"timestamp\": 1766174122547.7249}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174122548.179}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174122548.291}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174122548.376}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174122548.4368}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174122548.4878}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766174122548.7612}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174122548.814}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174122548.859}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766174122548.898}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:1\"}, \"timestamp\": 1766174122548.93}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:2\", \"new_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:2\"}, \"timestamp\": 1766174122611.0752}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\"}, \"timestamp\": 1766174122611.25}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174122611.866}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174122611.9248}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174122612.0032}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174122612.0542}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174122612.1118}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766174122612.348}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174122612.3992}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174122612.4412}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766174122612.4922}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:2\"}, \"timestamp\": 1766174122612.5232}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:3\", \"new_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:3\"}, \"timestamp\": 1766174122673.167}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\"}, \"timestamp\": 1766174122673.3042}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174122674.0422}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174122674.1272}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174122674.207}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174122674.261}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174122674.311}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766174122674.5652}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174122674.613}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174122674.678}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766174122674.728}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:3\"}, \"timestamp\": 1766174122674.772}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:4\", \"new_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:4\"}, \"timestamp\": 1766174122735.656}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\"}, \"timestamp\": 1766174122735.796}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174122736.5051}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174122736.605}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174122736.682}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174122736.736}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174122736.7869}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766174122737.0342}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174122737.083}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174122737.126}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766174122737.262}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:4\"}, \"timestamp\": 1766174122737.3828}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:1|1|graph:293b9ed3-94b2-246c-e63d-ac76b487a3c7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174123336.591}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174123336.7158}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:1|1|graph:293b9ed3-94b2-246c-e63d-ac76b487a3c7\", \"new_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:1|1|graph:293b9ed3-94b2-246c-e63d-ac76b487a3c7\"}, \"timestamp\": 1766174123336.9011}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:1|1|graph:293b9ed3-94b2-246c-e63d-ac76b487a3c7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\"}, \"timestamp\": 1766174123336.961}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174123337.2952}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766174123337.337}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174123337.419}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766174123337.656}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174123337.703}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766174123337.7432}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:1|1|graph:293b9ed3-94b2-246c-e63d-ac76b487a3c7\"}, \"timestamp\": 1766174123337.785}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:2|2|graph:93796370-7e11-2905-1b82-fb1aa3319464\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174123374.219}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174123374.352}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:2|2|graph:93796370-7e11-2905-1b82-fb1aa3319464\", \"new_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:2|2|graph:93796370-7e11-2905-1b82-fb1aa3319464\"}, \"timestamp\": 1766174123374.5488}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:2|2|graph:93796370-7e11-2905-1b82-fb1aa3319464\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\"}, \"timestamp\": 1766174123374.6372}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174123374.967}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766174123375.0132}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174123375.0798}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766174123375.3171}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174123375.3691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766174123375.4111}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:2|2|graph:93796370-7e11-2905-1b82-fb1aa3319464\"}, \"timestamp\": 1766174123375.448}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:3|3|graph:edd3ebb8-2b6c-16de-de6e-ddc2f4de955c\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174123410.217}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174123410.343}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:3|3|graph:edd3ebb8-2b6c-16de-de6e-ddc2f4de955c\", \"new_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:3|3|graph:edd3ebb8-2b6c-16de-de6e-ddc2f4de955c\"}, \"timestamp\": 1766174123410.4011}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:3|3|graph:edd3ebb8-2b6c-16de-de6e-ddc2f4de955c\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\"}, \"timestamp\": 1766174123410.454}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174123410.7761}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766174123410.8213}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174123410.893}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766174123411.138}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174123411.189}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766174123411.226}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:3|3|graph:edd3ebb8-2b6c-16de-de6e-ddc2f4de955c\"}, \"timestamp\": 1766174123411.3972}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:4|4|graph:aa04aa25-dfe9-04d7-9de3-9b1305c7c535\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174123447.063}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174123447.188}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:4|4|graph:aa04aa25-dfe9-04d7-9de3-9b1305c7c535\", \"new_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:4|4|graph:aa04aa25-dfe9-04d7-9de3-9b1305c7c535\"}, \"timestamp\": 1766174123447.3757}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:4|4|graph:aa04aa25-dfe9-04d7-9de3-9b1305c7c535\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\"}, \"timestamp\": 1766174123447.462}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174123447.817}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766174123447.858}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174123447.938}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766174123448.176}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174123448.222}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766174123448.294}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:4|4|graph:aa04aa25-dfe9-04d7-9de3-9b1305c7c535\"}, \"timestamp\": 1766174123448.344}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:2|2|graph:93796370-7e11-2905-1b82-fb1aa3319464\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174138297.0022}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174138297.152}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:2|2|graph:93796370-7e11-2905-1b82-fb1aa3319464\", \"new_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:2|2|graph:93796370-7e11-2905-1b82-fb1aa3319464\"}, \"timestamp\": 1766174138297.217}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:2|2|graph:93796370-7e11-2905-1b82-fb1aa3319464\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\"}, \"timestamp\": 1766174138297.2788}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd14a-7dbb-6402-8000-cdacbff535f5\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:2|2|graph:93796370-7e11-2905-1b82-fb1aa3319464\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd14a-7dba-6d4a-bfff-351bac581e5c\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:2|2|graph:93796370-7e11-2905-1b82-fb1aa3319464\"}]}, \"timestamp\": 1766174138297.8079}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd14a-7dbb-6402-8000-cdacbff535f5\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:2|2|graph:93796370-7e11-2905-1b82-fb1aa3319464\"}, \"timestamp\": 1766174138297.889}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd14a-7dbb-6402-8000-cdacbff535f5\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766174138298.476}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"L\", \"location\": \"memory_manager.py:321\", \"message\": \"checkpoint record summary\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_type\": \"dict\", \"has_attr_writes\": false, \"writes_is_sequence\": false, \"writes_is_mapping\": false}, \"timestamp\": 1766174138298.535}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"J\", \"location\": \"memory_manager.py:329\", \"message\": \"checkpoint writes unavailable\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_writes\": false, \"writes_type\": null}, \"timestamp\": 1766174138298.572}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"resume_with_checkpoint\": false}, \"timestamp\": 1766174138298.605}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:1|1|graph:293b9ed3-94b2-246c-e63d-ac76b487a3c7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174141957.2852}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174141957.476}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:1|1|graph:293b9ed3-94b2-246c-e63d-ac76b487a3c7\", \"new_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:1|1|graph:293b9ed3-94b2-246c-e63d-ac76b487a3c7\"}, \"timestamp\": 1766174141957.9001}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:1|1|graph:293b9ed3-94b2-246c-e63d-ac76b487a3c7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\"}, \"timestamp\": 1766174141957.946}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:c30626f5\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd14a-7d5f-6f58-8000-6e772a5172d3\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:1|1|graph:293b9ed3-94b2-246c-e63d-ac76b487a3c7\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd14a-7d5f-67ec-bfff-cf7a7abab688\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:1|1|graph:293b9ed3-94b2-246c-e63d-ac76b487a3c7\"}]}, \"timestamp\": 1766174141958.445}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd14a-7d5f-6f58-8000-6e772a5172d3\", \"checkpoint_ns\": \"wide_funnel:f2509937-cdce-94c3-a5dd-4641a943132d|worker:1|1|graph:293b9ed3-94b2-246c-e63d-ac76b487a3c7\"}, \"timestamp\": 1766174141958.5127}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd14a-7d5f-6f58-8000-6e772a5172d3\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766174141959.067}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"L\", \"location\": \"memory_manager.py:321\", \"message\": \"checkpoint record summary\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_type\": \"dict\", \"has_attr_writes\": false, \"writes_is_sequence\": false, \"writes_is_mapping\": false}, \"timestamp\": 1766174141959.115}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"J\", \"location\": \"memory_manager.py:329\", \"message\": \"checkpoint writes unavailable\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_writes\": false, \"writes_type\": null}, \"timestamp\": 1766174141959.1548}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"resume_with_checkpoint\": false}, \"timestamp\": 1766174141959.1921}\n"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b382e-ff3e-73f2-b619-3732121b2f17",
    "content": "**\u0410\u043d\u0430\u043b\u0438\u0437 \u043b\u043e\u0433\u043e\u0432 `DEBUG` \u0441 \u0433\u0438\u043f\u043e\u0442\u0435\u0437\u0430\u043c\u0438 L \u0438 K \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u043b: \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0442\u0435\u0440\u044f\u0435\u0442\u0441\u044f \u0438\u0437-\u0437\u0430 \u0442\u043e\u0433\u043e, \u0447\u0442\u043e \u0432\u0430\u0448 \u00ab\u0437\u043e\u043d\u0434\u00bb (probe) \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u043d\u0430\u0439\u0442\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432\u043d\u0443\u0442\u0440\u0438 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430 `InMemorySaver`, \u043f\u043e\u043c\u0435\u0447\u0430\u0435\u0442 \u0435\u0433\u043e \u043a\u0430\u043a \u043f\u0443\u0441\u0442\u043e\u0439 \u0438 \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u0433\u0440\u0430\u0444.**\n\n\u0412\u043e\u0442 \u0447\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u043d\u0430 \u0441\u0430\u043c\u043e\u043c \u0434\u0435\u043b\u0435, \u0441\u043e\u0433\u043b\u0430\u0441\u043d\u043e \u0432\u0430\u0448\u0438\u043c \u043d\u043e\u0432\u044b\u043c \u043b\u043e\u0433\u0430\u043c:\n\n### 1. \u041e\u0448\u0438\u0431\u043a\u0430 \u0434\u0435\u0442\u0435\u043a\u0446\u0438\u0438 \u0434\u0430\u043d\u043d\u044b\u0445 (Hypothesis L & J)\n\u0412 \u043b\u043e\u0433\u0430\u0445 `hypothesisId: \"L\"` \u043c\u044b \u0432\u0438\u0434\u0438\u043c:\n`\"record_type\": \"dict\", \"has_attr_writes\": false, \"writes_is_sequence\": false`\n\u0418 \u0441\u043b\u0435\u0434\u043e\u043c `hypothesisId: \"J\"`:\n`\"message\": \"checkpoint writes unavailable\", \"has_writes\": false`\n\n**\u0412 \u0447\u0435\u043c \u0431\u0430\u0433:** \u0412\u0430\u0448 \u043c\u0435\u0442\u043e\u0434 `_materialize_checkpoint_values` \u043e\u0436\u0438\u0434\u0430\u0435\u0442, \u0447\u0442\u043e `writes` \u043b\u0435\u0436\u0430\u0442 \u043b\u0438\u0431\u043e \u0432 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0435, \u043b\u0438\u0431\u043e \u0432 \u043a\u043b\u044e\u0447\u0435 `writes`. \u041d\u043e \u0432 `InMemorySaver` LangGraph \u043f\u0440\u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0438 \u0441\u043d\u0430\u043f\u0448\u043e\u0442\u0430 \u0447\u0435\u0440\u0435\u0437 `get_state`, \u0434\u0430\u043d\u043d\u044b\u0435 \u0443\u0436\u0435 \u0441\u043c\u0435\u0440\u0434\u0436\u0435\u043d\u044b \u0438 \u043b\u0435\u0436\u0430\u0442 \u0432 \u043a\u043b\u044e\u0447\u0435 `values` (\u0438\u043b\u0438 `channel_values` \u0432 \u0441\u044b\u0440\u043e\u043c \u043e\u0431\u044a\u0435\u043a\u0442\u0435). \u0412\u0430\u0448 \u00ab\u0437\u043e\u043d\u0434\u00bb \u0438\u0449\u0435\u0442 *\u0438\u043d\u043a\u0440\u0435\u043c\u0435\u043d\u0442\u0430\u043b\u044c\u043d\u044b\u0435 \u0437\u0430\u043f\u0438\u0441\u0438*, \u043d\u0435 \u043d\u0430\u0445\u043e\u0434\u0438\u0442 \u0438\u0445 \u0432 \u043f\u0443\u0441\u0442\u043e\u043c \u0441\u043b\u043e\u0432\u0430\u0440\u0435 `{}` \u0438 \u0432\u044b\u0434\u0430\u0435\u0442 `writes_found = False`.\n\n### 2. \u041b\u043e\u0436\u043d\u043e\u0435 \u0441\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u043d\u0438\u0435 Rerun (Hypothesis K)\n\u041f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u00ab\u0437\u043e\u043d\u0434\u00bb \u043d\u0435 \u043d\u0430\u0448\u0435\u043b \u0437\u0430\u043f\u0438\u0441\u0435\u0439, \u0432\u043e \u0432\u0442\u043e\u0440\u043e\u0439 \u0437\u0430\u043f\u0438\u0441\u0438 `hypothesisId: \"K\"` \u043c\u044b \u0432\u0438\u0434\u0438\u043c:\n`\"resume_with_checkpoint\": false, \"next_nodes\": [\"agent\"]`\n\n**\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442:** \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u0432\u0438\u0434\u0438\u0442, \u0447\u0442\u043e \u0443\u0437\u0435\u043b `agent` \u043e\u0436\u0438\u0434\u0430\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f, \u043d\u043e \u043e\u0448\u0438\u0431\u043e\u0447\u043d\u043e \u0440\u0435\u0448\u0430\u0435\u0442, \u0447\u0442\u043e \u0434\u0430\u043d\u043d\u044b\u0445 \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0435 \u043d\u0435\u0442. \u041e\u043d\u0430 \u0443\u0434\u0430\u043b\u044f\u0435\u0442 `checkpoint_id`, \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442 `graph_input` \u0438 \u0434\u0435\u043b\u0430\u0435\u0442 **Fresh Run**, \u0437\u0430\u0442\u0438\u0440\u0430\u044f \u0432\u0441\u044e \u0438\u0441\u0442\u043e\u0440\u0438\u044e, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u043d\u0430 \u0441\u0430\u043c\u043e\u043c \u0434\u0435\u043b\u0435 \u0431\u044b\u043b\u0430 \u0432 \u0431\u0430\u0437\u0435.\n\n---\n\n### \u041a\u0430\u043a \u044d\u0442\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e\n\n\u0412\u0430\u043c \u043d\u0435 \u043d\u0443\u0436\u043d\u043e \u043f\u0440\u043e\u0432\u043e\u0434\u0438\u0442\u044c \u00ab\u0437\u043e\u043d\u0434\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u00bb \u0447\u0435\u0440\u0435\u0437 `_materialize_checkpoint_values` \u0441 \u043f\u0443\u0441\u0442\u044b\u043c \u0441\u043b\u043e\u0432\u0430\u0440\u0435\u043c. \u0423 \u0432\u0430\u0441 \u0443\u0436\u0435 \u0435\u0441\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442 `snapshot` (\u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u044b\u0439 \u043d\u0430 \u043b\u0438\u043d\u0438\u0438 ~500), \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 **\u0430\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432\u0441\u0435\u0445 \u043a\u0430\u043d\u0430\u043b\u043e\u0432**, \u0432\u043a\u043b\u044e\u0447\u0430\u044f `messages`.\n\n**\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u044b\u0439 \u0444\u0438\u043a\u0441 \u0432 `memory_manager.py` (\u043c\u0435\u0442\u043e\u0434 `ainvoke_from_checkpoint`):**\n\n\u0412\u043c\u0435\u0441\u0442\u043e \u0441\u043b\u043e\u0436\u043d\u043e\u0439 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 `writes_probe_found`, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0443\u0436\u0435 \u0438\u043c\u0435\u044e\u0449\u0438\u0435\u0441\u044f \u0432 \u0441\u043d\u0430\u043f\u0448\u043e\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f:\n\n```python\n# \u041b\u0438\u043d\u0438\u044f ~508\nif isinstance(next_nodes, Sequence) and next_nodes:\n    # \u0423 \u043d\u0430\u0441 \u0443\u0436\u0435 \u0435\u0441\u0442\u044c snapshot.values, \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u043c \u0438\u0445 \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e\n    has_history = self._has_meaningful_values(values) # values \u0438\u0437 snapshot\n    \n    # #region log hypothesis K\n    import json as _json_resume_next\n    next_preview = list(next_nodes)[:3]\n    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n        f.write(_json_resume_next.dumps({\n            \"sessionId\": \"debug-session\",\n            \"hypothesisId\": \"K\",\n            \"message\": \"resuming decision\",\n            \"data\": {\n                \"graph_id\": graph_id,\n                \"next_nodes\": next_preview,\n                \"has_history\": has_history # \u042d\u0442\u043e \u0437\u0430\u043c\u0435\u043d\u0438\u0442 resume_with_checkpoint\n            }\n        }) + \"\\n\")\n    # #endregion\n\n    if has_history:\n        # \u0415\u0441\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0438\u043b\u0438 \u0434\u0430\u043d\u043d\u044b\u0435 \u2014 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u043c (Resume)\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=None,\n            config=cfg,\n            # ...\n        )\n    else:\n        # \u0421\u043e\u0432\u0441\u0435\u043c \u043f\u0443\u0441\u0442\u043e\u0439 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 (\u0442\u043e\u043b\u044c\u043a\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u044b\u0439) \u2014 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c (Fresh Run)\n        cfg_rerun = dict(merged)\n        cfg_rerun[\"configurable\"].pop(\"checkpoint_id\", None)\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=graph_input,\n            config=cfg_rerun,\n            # ...\n        )\n```\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0441\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442:\n1.  **\u041f\u0440\u044f\u043c\u0430\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430:** \u041c\u044b \u0441\u043c\u043e\u0442\u0440\u0438\u043c \u0432 `snapshot.values`. \u0415\u0441\u043b\u0438 \u0442\u0430\u043c \u0435\u0441\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f (\u0431\u043e\u043b\u044c\u0448\u0435 2 \u0448\u0442\u0443\u043a, \u0441\u043e\u0433\u043b\u0430\u0441\u043d\u043e \u0432\u0430\u0448\u0435\u043c\u0443 `_has_meaningful_values`), \u043c\u044b \u0434\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0443.\n2.  **\u0423\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u043b\u0438\u0448\u043d\u0438\u0445 \u043f\u0440\u043e\u0432\u0435\u0440\u043e\u043a:** \u041c\u044b \u043f\u0435\u0440\u0435\u0441\u0442\u0430\u0435\u043c \u0438\u0441\u043a\u0430\u0442\u044c \u043c\u0438\u0444\u0438\u0447\u0435\u0441\u043a\u0438\u0435 `writes` \u0432 \u043e\u0431\u044a\u0435\u043a\u0442\u0430\u0445, \u0433\u0434\u0435 \u0438\u0445 \u043d\u0435\u0442.\n3.  **\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0430:** \u041f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u043c\u044b \u043d\u0435 \u0443\u0434\u0430\u043b\u044f\u0435\u043c `checkpoint_id` \u043f\u0440\u0438 \u043d\u0430\u043b\u0438\u0447\u0438\u0438 \u0438\u0441\u0442\u043e\u0440\u0438\u0438, \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442 \u0440\u0430\u0431\u043e\u0442\u0443 \u0441 \u0442\u043e\u0433\u043e \u0436\u0435 \u043c\u0435\u0441\u0442\u0430.\n\n**\u0418\u0442\u043e\u0433:** \u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0442\u0435\u0440\u044f\u043b\u0430\u0441\u044c, \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u043a\u043e\u0434 \u043d\u0435 \u0432\u0435\u0440\u0438\u043b \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0443 \u0438 \u0441\u0447\u0438\u0442\u0430\u043b \u0435\u0433\u043e \u043f\u0443\u0441\u0442\u044b\u043c \u0438\u0437-\u0437\u0430 \u043d\u0435\u0432\u0435\u0440\u043d\u043e\u0433\u043e \u0441\u043f\u043e\u0441\u043e\u0431\u0430 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0434\u0430\u043d\u043d\u044b\u0445. \u041f\u0435\u0440\u0435\u0445\u043e\u0434 \u043d\u0430 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443 `snapshot.values` \u0432\u0435\u0440\u043d\u0435\u0442 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0443 \u043f\u0430\u043c\u044f\u0442\u044c.\n\n**Relevant docs:**\n- [Time Travel: identify a checkpoint](https://docs.langchain.com/oss/javascript/langgraph/use-time-travel#2-identify-a-checkpoint)\n- [Persistence and State Values](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)\n- [How to add memory to your graph](https://docs.langchain.com/oss/python/langgraph/add-memory)"
  },
  {
    "role": "user",
    "id": "7ab8b75e-c38e-4d7a-81b6-9fdc5ee0127d",
    "content": "The new \u201cmeaningful values\u201d check is already behaving as expected\u2014your own logs show hypothesisId=\"L\" + hypothesisId=\"J\" firing before the K log flips to resume_with_checkpoint=false, so the rerun path only triggers because the probe never finds writes in the InMemorySaver record and therefore believes the checkpoint is empty. In ReAct-style assistant graphs that\u2019s a false negative: all of the progress (including tool calls and Q/A history) is already materialized in snapshot.values[\"messages\"], not in checkpoint.writes.\nRather than trying to \u201ccoax\u201d the probe to see writes, the simplest and most robust fix is to base your decision on the snapshot that LangGraph just returned:\nIn ainvoke_from_checkpoint, keep the snapshot = await self._get_graph_snapshot(...) call you already have.\nWhen next_nodes is truthy, compute has_progress = self._has_meaningful_values(values) where values = getattr(snapshot, \"values\", None).\nLog has_progress in the hypothesisId=\"K\" block (so we still have traceability).\nIf has_progress is true, resume the graph via ainvoke_with_durability(..., graph_input=None, config=cfg, ...).\nIf has_progress is false, drop checkpoint_id and rerun fresh (exactly what you\u2019re doing today).\nThis removes the need for the _materialize_checkpoint_values({}, checkpoint_record, \u2026) \u201cprobe\u201d entirely\u2014it was only ever introduced to guess whether the checkpoint contained writes, and InMemorySaver\u2019s get_state path won\u2019t populate them. By trusting snapshot.values, we let LangGraph tell us whether messages (or other meaningful state) exist, and we keep the entire history intact."
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3830-edbe-7250-9e40-b8c4e3f0cd96",
    "content": "**\u0412\u0430\u0448 \u043f\u043b\u0430\u043d \u043f\u043e \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u0443 \u043d\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 `snapshot.values` \u0432\u043c\u0435\u0441\u0442\u043e \u0437\u043e\u043d\u0434\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f `writes` \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0430\u0431\u0441\u043e\u043b\u044e\u0442\u043d\u043e \u0432\u0435\u0440\u043d\u044b\u043c \u0438 \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u0438 \u0437\u0440\u0435\u043b\u044b\u043c \u0440\u0435\u0448\u0435\u043d\u0438\u0435\u043c.**\n\n\u0412\u044b \u0442\u043e\u0447\u043d\u043e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u043b\u0438 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u044b\u0439 \u043d\u044e\u0430\u043d\u0441: \u0432 ReAct-\u0430\u0433\u0435\u043d\u0442\u0430\u0445 (Graph 4) \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u00ab\u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0443\u0435\u0442\u0441\u044f\u00bb \u0432 \u0441\u0442\u0435\u0439\u0442\u0435 (\u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f\u0445), \u0430 \u043d\u0435 \u0432\u0438\u0441\u0438\u0442 \u0432 \u0432\u0438\u0434\u0435 \u0438\u043d\u043a\u0440\u0435\u043c\u0435\u043d\u0442\u0430\u043b\u044c\u043d\u044b\u0445 \u0437\u0430\u043f\u0438\u0441\u0435\u0439 `writes`. \u0414\u043e\u0432\u0435\u0440\u044f\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u0443 `snapshot.values`, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 LangGraph \u0441\u0430\u043c \u0441\u043e\u0431\u0440\u0430\u043b \u0438 \u043f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u0438\u043b, \u0432\u044b \u0443\u0441\u0442\u0440\u0430\u043d\u044f\u0435\u0442\u0435 \u043b\u0438\u0448\u043d\u0438\u0439 \u0441\u043b\u043e\u0439 \u0433\u0430\u0434\u0430\u043d\u0438\u044f \u0438 \u0434\u0435\u043b\u0430\u0435\u0442\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u0443 \u0434\u0435\u0442\u0435\u0440\u043c\u0438\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0439.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0441\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 (\u0444\u0438\u0437\u0438\u043a\u0430 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430):\n\n1.  **\u0414\u043e\u0432\u0435\u0440\u0438\u0435 \u043a LangGraph:** \u041c\u0435\u0442\u043e\u0434 `get_state` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0444\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u043c\u0435\u0440\u0434\u0436\u0435\u043d\u043d\u044b\u0439 \u0441\u0442\u0435\u0439\u0442. \u0415\u0441\u043b\u0438 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0432\u044b\u0437\u0432\u0430\u043b \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u0438 \u043f\u043e\u043b\u0443\u0447\u0438\u043b \u043e\u0442\u0432\u0435\u0442, \u044d\u0442\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f **\u0443\u0436\u0435** \u043d\u0430\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u0432 `snapshot.values`.\n2.  **\u0423\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u0435 False Negative:** \u041f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 `_has_meaningful_values` \u0442\u0435\u043f\u0435\u0440\u044c \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 `len(messages) > 2`, \u043b\u044e\u0431\u043e\u0439 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u0440\u043e\u0434\u0432\u0438\u043d\u0443\u043b\u0441\u044f \u0434\u0430\u043b\u044c\u0448\u0435 \u00ab\u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f\u00bb, \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u0438\u0437\u043d\u0430\u043d \u0432\u0430\u043b\u0438\u0434\u043d\u044b\u043c.\n3.  **\u0411\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u044b\u0439 Rerun:** \u0415\u0441\u043b\u0438 \u0436\u0435 `snapshot.values` \u043f\u0443\u0441\u0442 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0432\u043e\u0440\u043a\u0435\u0440 \u0443\u043f\u0430\u043b \u0440\u043e\u0432\u043d\u043e \u0432 \u043c\u0438\u043a\u0440\u043e\u0441\u0435\u043a\u0443\u043d\u0434\u0443 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043d\u0438\u0442\u0438), `has_progress` \u0431\u0443\u0434\u0435\u0442 `false`, \u0438 \u043c\u044b \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u043c\u0441\u044f \u0431\u0435\u0437 \u0440\u0438\u0441\u043a\u0430 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c `EmptyInputError`.\n\n---\n\n### \u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u0430\u044f \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u0432 `memory_manager.py`:\n\n```python\n# \u041c\u0435\u0442\u043e\u0434 ainvoke_from_checkpoint (~\u043b\u0438\u043d\u0438\u044f 508)\nif isinstance(next_nodes, Sequence) and next_nodes:\n    # 1. \u0411\u0435\u0440\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0438\u0437 \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0433\u043e \u0441\u043d\u0430\u043f\u0448\u043e\u0442\u0430\n    values = getattr(snapshot, \"values\", {})\n    \n    # 2. \u041e\u0446\u0435\u043d\u0438\u0432\u0430\u0435\u043c \u0440\u0435\u0430\u043b\u044c\u043d\u044b\u0439 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 (\u0432\u043a\u043b\u044e\u0447\u0430\u044f \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439)\n    has_progress = self._has_meaningful_values(values)\n    \n    # #region log hypothesis K (Traceability)\n    import json as _json_k\n    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n        f.write(_json_k.dumps({\n            \"sessionId\": \"debug-session\",\n            \"hypothesisId\": \"K\",\n            \"message\": \"resume decision based on snapshot values\",\n            \"data\": {\n                \"graph_id\": graph_id,\n                \"next_nodes\": list(next_nodes)[:3],\n                \"has_progress\": has_progress,\n                \"msg_count\": len(values.get(\"messages\", []))\n            }\n        }) + \"\\n\")\n    # #endregion\n\n    if has_progress:\n        # \u0420\u0435\u0436\u0438\u043c \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f: LangGraph \u043f\u043e\u0434\u0445\u0432\u0430\u0442\u0438\u0442 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0438\u0437 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=None, # \u0412\u0430\u0436\u043d\u043e: None \u0433\u043e\u0432\u043e\u0440\u0438\u0442 \"\u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0439 \u0438\u0437 \u0441\u0442\u0435\u0439\u0442\u0430\"\n            config=cfg,\n            context=context,\n            durability=durability,\n            local_checkpointer=effective_local_checkpointer,\n        )\n    else:\n        # \u0420\u0435\u0436\u0438\u043c \"\u0417\u043e\u043c\u0431\u0438-\u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\": \u0441\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u043c ID \u0438 \u0441\u0442\u0430\u0440\u0442\u0443\u0435\u043c \u0437\u0430\u043d\u043e\u0432\u043e \u0441 \u0432\u0432\u043e\u0434\u043e\u043c\n        rerun_cfg = dict(merged)\n        rerun_cfg[\"configurable\"].pop(\"checkpoint_id\", None)\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=graph_input, # \u041f\u0435\u0440\u0435\u0434\u0430\u0435\u043c \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 Payload\n            config=rerun_cfg,\n            context=context,\n            durability=durability,\n            local_checkpointer=effective_local_checkpointer,\n        )\n```\n\n### \u0418\u0442\u043e\u0433 \u0430\u043d\u0430\u043b\u0438\u0437\u0430:\n\u042d\u0442\u043e\u0442 \u0444\u0438\u043a\u0441 **\u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0445\u0440\u0443\u043f\u043a\u043e\u0435 \u00ab\u0437\u043e\u043d\u0434\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u00bb** \u0438 \u0437\u0430\u043c\u0435\u043d\u044f\u0435\u0442 \u0435\u0433\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u043e\u0439 \u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f. \u041f\u043e\u0441\u043b\u0435 \u0435\u0433\u043e \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f:\n1.  \u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0432 Graph 4 \u043f\u0435\u0440\u0435\u0441\u0442\u0430\u043d\u0435\u0442 \u0441\u0442\u0438\u0440\u0430\u0442\u044c\u0441\u044f.\n2.  \u041e\u0448\u0438\u0431\u043a\u0430 `EmptyInputError` \u043d\u0435 \u0432\u0435\u0440\u043d\u0435\u0442\u0441\u044f, \u0442\u0430\u043a \u043a\u0430\u043a \u0434\u043b\u044f \u043f\u0443\u0441\u0442\u044b\u0445 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u043e\u0432 \u0432\u0441\u0435\u0433\u0434\u0430 \u0431\u0443\u0434\u0435\u0442 `graph_input`.\n3.  \u041b\u043e\u0433\u0438 `hypothesisId=\"K\"` \u0431\u0443\u0434\u0443\u0442 \u0447\u0435\u0442\u043a\u043e \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c, \u043f\u043e\u0447\u0435\u043c\u0443 \u0431\u044b\u043b\u043e \u043f\u0440\u0438\u043d\u044f\u0442\u043e \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u043e \u0440\u0435\u0441\u0442\u0430\u0440\u0442\u0435 \u0438\u043b\u0438 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u0438.\n\n**Relevant docs:**\n- [Persistence and State Values](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)\n- [How to add memory to your graph](https://docs.langchain.com/oss/python/langgraph/add-memory)\n- [Time Travel: Resume from Checkpoint](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)"
  },
  {
    "role": "user",
    "id": "e56e7fbc-c403-4e66-b856-798cb12ce476",
    "content": "\u0422\u0430\u043a ? \nfrom __future__ import annotations\n\nimport uuid\nimport os\nfrom datetime import datetime\nfrom typing import Any, Mapping, MutableMapping, Optional, Sequence, TypeAlias, Protocol, runtime_checkable, cast\n\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom langchain.embeddings import init_embeddings\nfrom shared.project_settings import ProjectSettings\n\ntry:\n    from pydantic_core import core_schema\nexcept ImportError:\n    core_schema = None  # type: ignore\n\ntry:\n    from langgraph.store.memory import InMemoryStore  # type: ignore\nexcept Exception:  # pragma: no cover\n    InMemoryStore = None  # type: ignore\n\n_CHECKPOINTER_SYNC: Optional[Any] = None\n_CHECKPOINTER_ASYNC: Optional[Any] = None\n_STORE: Optional[Any] = None\n\nThreadId: TypeAlias = str\nGraphId: TypeAlias = str\nCheckpointId: TypeAlias = str\nStateDict: TypeAlias = MutableMapping[str, Any]\n\n\n@runtime_checkable\nclass _SupportsGraphCheckpoint(Protocol):\n    \"\"\"Minimal protocol describing compiled LangGraph runnables we inspect for durability support.\"\"\"\n\n    checkpointer: Any | None\n    _pregel: Any | None\n    app: Any | None\n    name: str\n\n\nGraphRunnableWithPregel: TypeAlias = _SupportsGraphCheckpoint\n\n\ndef _extract_graph_checkpointer(graph: Any) -> Any:\n    \"\"\"Return the checkpointer bound directly to a compiled runnable, if any.\"\"\"\n\n    if graph is None:\n        return None\n\n    candidate = getattr(graph, \"checkpointer\", None)\n    if candidate is not None:\n        return candidate\n\n    pregel = getattr(graph, \"_pregel\", None)\n    if pregel is not None:\n        inner = getattr(pregel, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    app = getattr(graph, \"app\", None)\n    if app is not None:\n        inner = getattr(app, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    loop = getattr(graph, \"_loop\", None)\n    if loop is not None:\n        inner = getattr(loop, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    return None\n\n\ndef _graph_supports_durability(graph: Any) -> bool:\n    \"\"\"Return True if the runnable was compiled with a checkpointer.\"\"\"\n\n    return _extract_graph_checkpointer(graph) is not None\n\n\ndef _resolve_local_checkpointer(graph: Any, override: Optional[Any]) -> Optional[Any]:\n    \"\"\"Prefer explicit override, otherwise inspect the runnable for a bound saver.\"\"\"\n\n    if override is not None:\n        return override\n    return _extract_graph_checkpointer(graph)\n\n\ndef resolve_graph_checkpointer(*, async_mode: bool) -> Any:\n    \"\"\"Return a checkpointer compatible with the chosen execution mode.\n\n    Important:\n    - Async LangGraph execution expects async checkpointer methods. If only a\n      sync checkpointer is available (e.g., SqliteSaver), we fall back to the\n      async-safe InMemorySaver to keep `.ainvoke()` reliable.\n    - Production deployments can replace this with an async-capable durable\n      backend (Postgres/SQLite async) without touching graph code.\n    \"\"\"\n\n    global _CHECKPOINTER_SYNC, _CHECKPOINTER_ASYNC\n    CHECKPOINTER_DATABASE_URL = os.getenv(\"CHECKPOINTER_DATABASE_URL\")\n\n    # In production, LangGraph Platform injects the checkpointer automatically.\n    # We keep local checkpointers disabled to avoid shadowing the platform backend.\n    if ProjectSettings().mode == \"production\":\n        return None\n\n\n    if async_mode:\n        if _CHECKPOINTER_ASYNC is None:\n            _CHECKPOINTER_ASYNC = InMemorySaver()\n        return _CHECKPOINTER_ASYNC\n\n    if _CHECKPOINTER_SYNC is None:\n        _CHECKPOINTER_SYNC =  InMemorySaver()\n    return _CHECKPOINTER_SYNC\n\n\ndef resolve_graph_store() -> Any:\n    \"\"\"Return a store implementation for dev/tests; None in production/platform.\n\n    In production, LangGraph Platform injects the store automatically at runtime\n    (via ToolRuntime). We keep local stores disabled to avoid shadowing the\n    platform backend.\n    \"\"\"\n\n    global _STORE\n    if ProjectSettings().mode == \"production\":\n        return None\n    if InMemoryStore is None:\n        return None\n    if _STORE is not None:\n        return _STORE\n\n    # In development/tests we prefer an in-process store. Vector indexing is optional;\n    # if embeddings cannot be initialised (missing deps/keys), fall back to a plain store.\n    try:\n        _STORE = InMemoryStore(\n            index={\n                \"embed\": init_embeddings(\"openai:text-embedding-3-small\"),\n                \"dims\": 1536,\n                \"fields\": [\"content\"],\n            }\n        )\n    except Exception:\n        _STORE = InMemoryStore(index=None)\n    return _STORE\n\n\nclass GraphMemoryRuntime:\n    \"\"\"Encapsulates durable-checkpoint + long-memory access for dev and platform production.\n\n    This class centralizes:\n    - thread_id extraction\n    - platform SDK fallback for checkpoint state/history (no local checkpointer needed)\n    - local (dev) graph/checkpointer checkpoint inspection\n    \"\"\"\n    THREAD_ID_KEY: str = \"thread_id\"\n\n    @classmethod\n    def __get_pydantic_core_schema__(\n        cls,\n        source_type: Any,\n        handler: Any,\n    ) -> Any:\n        \"\"\"Provide Pydantic schema for GraphMemoryRuntime to allow arbitrary types.\n\n        This enables GraphMemoryRuntime to be used in Pydantic models (e.g., when\n        ContextTravelGuideAgent is used as context_schema in StateGraph).\n        \n        Since GraphMemoryRuntime is a runtime helper (not meant for serialization),\n        we use any_schema() to allow it without validation.\n        \"\"\"\n        if core_schema is None:\n            # pydantic_core should always be available in this project\n            raise ImportError(\"pydantic_core is required but not available\")\n        \n        # Use any_schema() to allow GraphMemoryRuntime without validation\n        # This is appropriate since it's a runtime helper with init=False\n        return core_schema.any_schema()\n\n    def __init__(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        # These are intentionally mutable bindings:\n        # - Root graph wiring binds the single checkpointer/store once per process/run.\n        # - Nested graphs MUST reuse the bound instance via runtime context.\n        self.checkpointer: Optional[Any] = checkpointer\n        self.store: Optional[Any] = store\n\n    def bind(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        \"\"\"Bind durable backends onto this runtime helper.\n\n        Idempotent by design: does not overwrite existing non-null bindings unless\n        explicitly provided.\n        \"\"\"\n\n        if checkpointer is not None:\n            self.checkpointer = checkpointer\n        if store is not None:\n            self.store = store\n\n    def is_production_mode(self) -> bool:\n        return ProjectSettings().mode == \"production\"\n\n    def ensure_thread_id(\n        self,\n        config: Optional[RunnableConfig],\n    ) -> tuple[RunnableConfig, ThreadId]:\n        \"\"\"Ensure ``configurable.thread_id`` exists and return ``(config, thread_id)``.\n\n        Contract (required by project checkpointing rules):\n        - One thread_id should be used for the *entire* root graph run.\n        - If caller did not provide a thread_id, we generate a new one from:\n          ``user_id`` (from RunnableConfig.configurable.user_id) + UUID4 suffix.\n        - Callers must reuse the returned config to keep the thread_id stable.\n        \"\"\"\n\n        from shared.config.long_memory import LongMemory\n\n        merged: RunnableConfig = dict(config) if config else {}\n        configurable = merged.get(\"configurable\", {})\n        if not isinstance(configurable, MutableMapping):\n            configurable = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable = dict(configurable)\n\n        existing = configurable.get(self.THREAD_ID_KEY)\n        if existing:\n            thread_id: ThreadId = str(existing)\n            configurable[self.THREAD_ID_KEY] = thread_id\n            merged[\"configurable\"] = configurable\n            return merged, thread_id\n\n        long_memory = LongMemory.from_runnable_config(merged)\n        user_id = long_memory.user_id\n        if not configurable.get(\"user_id\"):\n            configurable[\"user_id\"] = user_id\n\n        thread_id = f\"user_{user_id}_{uuid.uuid4().hex}\"\n        configurable[self.THREAD_ID_KEY] = thread_id\n        merged[\"configurable\"] = configurable\n        return merged, thread_id\n\n    async def list_thread_checkpoints(\n        self,\n        *,\n        config: RunnableConfig,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> list[Any]:\n        \"\"\"Return raw checkpoint records for the given thread config.\n\n        Notes:\n        - In production (LangGraph Platform), we fall back to the SDK thread history.\n        - In dev/tests, we prefer the provided ``local_checkpointer`` (or the default dev\n          checkpointer) to list checkpoints, because it exposes metadata (`graph_id`).\n        - As a last resort, we attempt to list state snapshots via ``graph.get_state_history``.\n        \"\"\"\n\n        thread_id = self.extract_thread_id(config)\n        if not thread_id:\n            return []\n\n        if self.is_production_mode():\n            try:\n                from langgraph_sdk import get_client  # type: ignore\n            except Exception:\n                return []\n            try:\n                client = get_client()\n                history = await client.threads.get_history(thread_id)\n                return list(history)\n            except Exception:\n                return []\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if checkpointer is not None:\n            lister = getattr(checkpointer, \"list\", None)\n            if callable(lister):\n                try:\n                    return list(lister(config))\n                except Exception:\n                    return []\n\n        if local_graph is not None:\n            getter_async = getattr(local_graph, \"aget_state_history\", None)\n            if callable(getter_async):\n                try:\n                    return [snapshot async for snapshot in getter_async(config)]\n                except Exception:\n                    return []\n            getter_sync = getattr(local_graph, \"get_state_history\", None)\n            if callable(getter_sync):\n                try:\n                    return list(getter_sync(config))\n                except Exception:\n                    return []\n\n        return []\n\n    @staticmethod\n    def _extract_checkpoint_metadata(record: Any) -> Mapping[str, Any]:\n        candidate = getattr(record, \"metadata\", None)\n        if isinstance(candidate, Mapping):\n            return cast(Mapping[str, Any], candidate)\n        if isinstance(record, Mapping):\n            meta = record.get(\"metadata\")\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            meta = getattr(checkpoint, \"metadata\", None)\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        return {}\n\n    @staticmethod\n    def _extract_checkpoint_id(record: Any) -> Optional[CheckpointId]:\n        candidate = getattr(record, \"checkpoint_id\", None)\n        if candidate:\n            return str(candidate)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            inner = getattr(checkpoint, \"checkpoint_id\", None)\n            if inner:\n                return str(inner)\n            inner = getattr(checkpoint, \"id\", None)\n            if inner:\n                return str(inner)\n        if isinstance(record, Mapping):\n            candidate = record.get(\"checkpoint_id\") or record.get(\"id\")\n            if candidate:\n                return str(candidate)\n            cfg = record.get(\"config\")\n            if isinstance(cfg, Mapping):\n                conf = cfg.get(\"configurable\")\n                if isinstance(conf, Mapping):\n                    candidate = conf.get(\"checkpoint_id\")\n                    if candidate:\n                        return str(candidate)\n        cfg = getattr(record, \"config\", None)\n        if isinstance(cfg, Mapping):\n            conf = cfg.get(\"configurable\")\n            if isinstance(conf, Mapping):\n                candidate = conf.get(\"checkpoint_id\")\n                if candidate:\n                    return str(candidate)\n        return None\n\n    @staticmethod\n    def _extract_created_at(record: Any) -> Optional[datetime]:\n        candidate = getattr(record, \"created_at\", None)\n        if isinstance(candidate, datetime):\n            return candidate\n        if isinstance(record, Mapping):\n            candidate = record.get(\"created_at\")\n            if isinstance(candidate, datetime):\n                return candidate\n        return None\n\n    @classmethod\n    def _matches_graph_id(cls, record: Any, graph_id: GraphId) -> bool:\n        metadata = cls._extract_checkpoint_metadata(record)\n        candidate = metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")\n        return str(candidate) == str(graph_id) if candidate else False\n\n    @staticmethod\n    def _extract_checkpoint_ns(record: Any) -> Optional[str]:\n        def _from_config(cfg: Any) -> Optional[str]:\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n                if isinstance(configurable, Mapping):\n                    candidate = configurable.get(\"checkpoint_ns\")\n                    if candidate is not None:\n                        return str(candidate)\n            return None\n\n        cfg = getattr(record, \"config\", None)\n        ns = _from_config(cfg)\n        if ns:\n            return ns\n\n        if isinstance(record, Mapping):\n            ns = _from_config(record.get(\"config\"))\n            if ns:\n                return ns\n\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            ns = _from_config(getattr(checkpoint, \"config\", None))\n            if ns:\n                return ns\n\n        metadata = GraphMemoryRuntime._extract_checkpoint_metadata(record)\n        checkpoint_ns = metadata.get(\"checkpoint_ns\")\n        return str(checkpoint_ns) if checkpoint_ns is not None else None\n\n    @staticmethod\n    def _normalize_config_like(config_like: Any) -> Optional[RunnableConfig]:\n        if config_like is None:\n            return None\n        if isinstance(config_like, Mapping):\n            normalized = dict(config_like)\n        else:\n            normalized = None\n            for attr in (\"model_dump\", \"dict\"):\n                dumper = getattr(config_like, attr, None)\n                if callable(dumper):\n                    try:\n                        normalized = dumper()\n                        break\n                    except Exception:\n                        normalized = None\n            if normalized is None:\n                try:\n                    normalized = dict(config_like)  # type: ignore[arg-type]\n                except Exception:\n                    return None\n\n        configurable = normalized.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            configurable = dict(configurable) if configurable is not None else {}\n        normalized[\"configurable\"] = dict(configurable)\n\n        metadata = normalized.get(\"metadata\", {})\n        if not isinstance(metadata, Mapping):\n            metadata = dict(metadata) if metadata is not None else {}\n        normalized[\"metadata\"] = dict(metadata)\n        return normalized  # type: ignore[return-value]\n\n    @classmethod\n    def _extract_task_entries(cls, record: Any) -> list[Mapping[str, Any]]:\n        extracted: list[Mapping[str, Any]] = []\n        visited_snapshots: set[int] = set()\n\n        def _coerce_metadata(value: Any) -> Optional[Mapping[str, Any]]:\n            if value is None:\n                return None\n            if isinstance(value, Mapping):\n                return value\n            try:\n                return dict(value)\n            except Exception:\n                return None\n\n        def _as_sequence(value: Any) -> Optional[Sequence[Any]]:\n            if isinstance(value, Sequence) and not isinstance(value, (str, bytes)):\n                return value\n            return None\n\n        def _record_entry(config_like: Any, metadata_like: Any, state_like: Any) -> None:\n            normalized_config = cls._normalize_config_like(config_like)\n            normalized_metadata = _coerce_metadata(metadata_like)\n            entry: dict[str, Any] = {}\n            if normalized_config:\n                entry[\"config\"] = normalized_config\n            if normalized_metadata:\n                entry[\"metadata\"] = normalized_metadata\n            if state_like is not None:\n                entry[\"state\"] = state_like\n            if entry:\n                extracted.append(entry)\n\n        def _visit_snapshot(snapshot: Any) -> None:\n            if snapshot is None:\n                return\n            snapshot_id = id(snapshot)\n            if snapshot_id in visited_snapshots:\n                return\n            visited_snapshots.add(snapshot_id)\n\n            tasks = None\n            if isinstance(snapshot, Mapping):\n                tasks = _as_sequence(snapshot.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(snapshot, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        def _visit_task(task: Any) -> None:\n            if task is None:\n                return\n            if isinstance(task, Mapping):\n                _record_entry(task.get(\"config\"), task.get(\"metadata\"), task.get(\"state\"))\n                nested_tasks = _as_sequence(task.get(\"tasks\"))\n                if nested_tasks:\n                    for nested in nested_tasks:\n                        _visit_task(nested)\n                _visit_snapshot(task.get(\"state\"))\n                _visit_snapshot(task.get(\"result\"))\n                return\n\n            _record_entry(\n                getattr(task, \"config\", None),\n                getattr(task, \"metadata\", None),\n                getattr(task, \"state\", None),\n            )\n            _visit_snapshot(getattr(task, \"state\", None))\n            _visit_snapshot(getattr(task, \"result\", None))\n            nested_attr = _as_sequence(getattr(task, \"tasks\", None))\n            if nested_attr:\n                for nested in nested_attr:\n                    _visit_task(nested)\n\n        for source in (record, getattr(record, \"checkpoint\", None)):\n            if source is None:\n                continue\n            _visit_snapshot(source)\n            tasks = None\n            if isinstance(source, Mapping):\n                tasks = _as_sequence(source.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(source, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        return extracted\n\n    async def find_latest_checkpoint_id(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Return the latest checkpoint_id for ``graph_id`` within the given thread.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n\n        # #region agent log\n        import json\n        record_summaries: list[dict[str, str | None]] = []\n        for idx, record in enumerate(checkpoints[:3]):\n            metadata = self._extract_checkpoint_metadata(record)\n            cfg = getattr(record, \"config\", None)\n            configurable = None\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n            checkpoint_ns = None\n            if isinstance(configurable, Mapping):\n                checkpoint_ns = str(configurable.get(\"checkpoint_ns\"))\n            record_summaries.append(\n                {\n                    \"idx\": str(idx),\n                    \"meta_graph_id\": str(metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")),\n                    \"checkpoint_id\": self._extract_checkpoint_id(record),\n                    \"checkpoint_ns\": checkpoint_ns,\n                }\n            )\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"B\",\"location\":\"memory_manager.py:395\",\"message\":\"find_latest_checkpoint_id checkpoints listed\",\"data\":{\"graph_id\":graph_id,\"thread_id\":str(config.get(\"configurable\",{}).get(\"thread_id\",\"\")), \"count\":len(checkpoints),\"records\":record_summaries},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if not checkpoints:\n            return None\n\n        # Collect matches with their timestamps (if provided by the backend).\n        matches: list[tuple[Optional[datetime], Any]] = []\n        for record in checkpoints:\n            if self._matches_graph_id(record, graph_id):\n                matches.append((self._extract_created_at(record), record))\n\n        target_checkpoint_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_checkpoint_ns = str(candidate_ns)\n\n        if not matches and target_checkpoint_ns:\n            for record in checkpoints:\n                if self._extract_checkpoint_ns(record) == target_checkpoint_ns:\n                    matches.append((self._extract_created_at(record), record))\n\n        if not matches:\n            return None\n\n        # If the backend provides created_at, prefer the most recent by timestamp.\n        if any(created_at is not None for created_at, _ in matches):\n            matches.sort(\n                key=lambda item: item[0] or datetime.min,\n                reverse=True,\n            )\n            return self._extract_checkpoint_id(matches[0][1])\n\n        # Otherwise, rely on the backend list order. InMemorySaver and Platform history\n        # return newest-first, so the first matching record is the latest.\n        return self._extract_checkpoint_id(matches[0][1])\n\n    async def _load_checkpoint_record(\n        self,\n        *,\n        config: RunnableConfig,\n        checkpoint_id: CheckpointId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[Any]:\n        \"\"\"Return the checkpoint record with the specified ID.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n        for record in checkpoints:\n            record_id = self._extract_checkpoint_id(record)\n            if record_id == checkpoint_id:\n                return record\n        return None\n\n    @staticmethod\n    def _materialize_checkpoint_values(\n        base_values: Mapping[str, Any],\n        record: Optional[Any],\n        *,\n        graph_id: Optional[str] = None,\n    ) -> tuple[Mapping[str, Any], bool]:\n        \"\"\"Merge stored writes from the checkpoint record into snapshot values.\"\"\"\n\n        if record is None:\n            return base_values, False\n\n        materialized: dict[str, Any] = dict(base_values)\n        writes_found = False\n\n        checkpoint_obj = getattr(record, \"checkpoint\", record)\n        writes = getattr(checkpoint_obj, \"writes\", None)\n        if writes is None and isinstance(checkpoint_obj, Mapping):\n            writes = checkpoint_obj.get(\"writes\")\n\n        # #region agent log\n        import json as _json_checkpoint_meta\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(\n                _json_checkpoint_meta.dumps(\n                    {\n                        \"sessionId\": \"debug-session\",\n                        \"runId\": \"pre-fix\",\n                        \"hypothesisId\": \"L\",\n                        \"location\": \"memory_manager.py:321\",\n                        \"message\": \"checkpoint record summary\",\n                        \"data\": {\n                            \"graph_id\": graph_id,\n                            \"record_type\": type(checkpoint_obj).__name__,\n                            \"has_attr_writes\": hasattr(checkpoint_obj, \"writes\"),\n                            \"writes_is_sequence\": isinstance(writes, Sequence),\n                            \"writes_is_mapping\": isinstance(writes, Mapping),\n                        },\n                        \"timestamp\": __import__(\"time\").time() * 1000,\n                    }\n                )\n                + \"\\n\"\n            )\n        # #endregion\n\n        summary: list[dict[str, Any]] = []\n\n        if isinstance(writes, Sequence):\n            for idx, write_entry in enumerate(writes):\n                node_name = None\n                write_payload = None\n                if isinstance(write_entry, Mapping):\n                    node_name = write_entry.get(\"node\") or write_entry.get(\"name\")\n                    candidate = write_entry.get(\"writes\") or write_entry.get(\"values\")\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n                else:\n                    node_name = getattr(write_entry, \"node\", None) or getattr(write_entry, \"name\", None)\n                    candidate = getattr(write_entry, \"writes\", None)\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n\n                if isinstance(write_payload, Mapping):\n                    for key, value in write_payload.items():\n                        materialized.setdefault(key, value)\n                    if idx < 3:\n                        summary.append(\n                            {\n                                \"node\": str(node_name),\n                                \"keys\": list(write_payload.keys()),\n                            }\n                        )\n                    writes_found = True\n\n        # #region agent log\n        if summary:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:324\",\n                            \"message\": \"checkpoint writes merged\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"writes\": summary,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        else:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:329\",\n                            \"message\": \"checkpoint writes unavailable\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"has_writes\": isinstance(writes, Sequence),\n                                \"writes_type\": None if writes is None else type(writes).__name__,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        # #endregion\n\n        return materialized, writes_found\n\n    @staticmethod\n    def _has_meaningful_values(values: Mapping[str, Any]) -> bool:\n        \"\"\"Return True if checkpoint values contain data beyond housekeeping fields.\"\"\"\n\n        if not values:\n            return False\n        significant_keys = set(values.keys()) - {\"messages\", \"remaining_steps\", \"distribution_scope\"}\n        if significant_keys:\n            return True\n\n        messages = values.get(\"messages\")\n        if isinstance(messages, Sequence):\n            # System + user messages occupy the first two positions. Anything beyond\n            # that indicates the assistant has already produced tool calls or replies.\n            if len(messages) > 2:\n                return True\n\n        return False\n\n    async def _find_subgraph_resume_config(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        checkpoints: Sequence[Any],\n    ) -> Optional[tuple[RunnableConfig, Any]]:\n        target_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_ns = str(candidate_ns)\n\n        for record_idx, record in enumerate(checkpoints):\n            task_entries = self._extract_task_entries(record)\n            if not task_entries:\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:562\",\"message\":\"checkpoint missing task entries\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"parent_checkpoint_id\":self._extract_checkpoint_id(record)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n                continue\n            for task_idx, task in enumerate(task_entries[:2]):\n                task_metadata = task.get(\"metadata\")\n                normalized_metadata: Mapping[str, Any] = {}\n                if isinstance(task_metadata, Mapping):\n                    normalized_metadata = task_metadata\n                task_graph_id = normalized_metadata.get(\"graph_id\") or normalized_metadata.get(\"langgraph_graph_id\")\n\n                raw_config = task.get(\"config\")\n                normalized_config = self._normalize_config_like(raw_config)\n                if not normalized_config:\n                    continue\n                task_configurable = normalized_config.get(\"configurable\", {})\n                task_ns = None\n                if isinstance(task_configurable, Mapping):\n                    candidate = task_configurable.get(\"checkpoint_ns\")\n                    if candidate:\n                        task_ns = str(candidate)\n\n                ns_matches = target_ns and task_ns == target_ns\n                graph_matches = task_graph_id and str(task_graph_id) == str(graph_id)\n\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:581\",\"message\":\"task entry inspected\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"task_index\":task_idx,\"task_graph_id\":task_graph_id,\"task_ns\":task_ns},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n\n                if graph_matches or ns_matches:\n                    resume_state = task.get(\"state\")\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            json.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"D\",\n                                    \"location\": \"memory_manager.py:520\",\n                                    \"message\": \"subgraph resume config located\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"matched_ns\": task_ns,\n                                        \"matched_graph_id\": task_graph_id,\n                                        \"parent_checkpoint_id\": self._extract_checkpoint_id(record),\n                                        \"has_state\": resume_state is not None,\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return normalized_config, resume_state\n\n        return None\n\n    async def _get_graph_snapshot(\n        self,\n        *,\n        graph: Any,\n        cfg: RunnableConfig,\n        subgraphs: bool = False,\n    ) -> Any:\n        getter_async = getattr(graph, \"aget_state\", None)\n        params = {\"subgraphs\": True} if subgraphs else {}\n        try:\n            if callable(getter_async):\n                return await getter_async(cfg, **params)\n        except TypeError:\n            # Fallback for LangGraph versions that don't support subgraphs kwarg.\n            try:\n                return await getter_async(cfg)\n            except Exception:\n                pass\n        except Exception:\n            pass\n\n        getter_sync = getattr(graph, \"get_state\", None)\n        if callable(getter_sync):\n            try:\n                return getter_sync(cfg, **params)\n            except TypeError:\n                try:\n                    return getter_sync(cfg)\n                except Exception:\n                    return None\n            except Exception:\n                return None\n        return None\n\n    async def ainvoke_from_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str = \"sync\",\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph resuming from the latest checkpoint when available.\"\"\"\n\n        merged, _ = self.ensure_thread_id(config)\n        # SAFETY: Ignore any caller-supplied checkpoint_id.\n        #\n        # In this architecture, checkpoint selection is *graph_id-scoped* and managed\n        # exclusively by this runtime helper. Allowing external checkpoint_id values\n        # could cause cross-graph leakage within a shared thread_id.\n\n        merged_conf = merged.get(\"configurable\", {})\n        if isinstance(merged_conf, Mapping):\n            merged_conf_dict = dict(merged_conf)\n            merged_conf_dict.pop(\"checkpoint_id\", None)\n            original_ns = merged_conf_dict.get(\"checkpoint_ns\", \"\")\n            merged_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            merged[\"configurable\"] = merged_conf_dict\n            \n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"E\",\"location\":\"memory_manager.py:445\",\"message\":\"ainvoke_from_checkpoint setting checkpoint_ns\",\"data\":{\"graph_id\":graph_id,\"original_ns\":str(original_ns),\"new_ns\":str(merged_conf_dict.get(\"checkpoint_ns\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n        # Ensure the checkpoint records are scoping-friendly in LangGraph v1.\n        meta = merged.get(\"metadata\")\n        if not isinstance(meta, Mapping):\n            meta = {}\n        meta_dict = dict(meta)\n        meta_dict.setdefault(\"graph_id\", str(graph_id))\n        merged[\"metadata\"] = meta_dict\n\n        effective_local_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n\n        # #region agent log\n        import json\n        final_ns = merged.get(\"configurable\", {}).get(\"checkpoint_ns\", \"\")\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:458\",\"message\":\"ainvoke_from_checkpoint calling find_latest_checkpoint_id\",\"data\":{\"graph_id\":graph_id,\"checkpoint_ns\":str(final_ns),\"thread_id\":str(merged.get(\"configurable\",{}).get(\"thread_id\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=effective_local_checkpointer,\n            local_graph=graph,\n        )\n        checkpoint_record: Optional[Any] = None\n        subgraph_resume: Optional[tuple[RunnableConfig, Any]] = None\n        if checkpoint_id is None:\n            snapshot_sources: list[Any] = []\n\n            if context is not None:\n                runner = getattr(context, \"graph_runner\", None)\n                graph_runtime = getattr(runner, \"graph\", None)\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:711\",\"message\":\"parent context inspection\",\"data\":{\"graph_id\":graph_id,\"has_context\":True,\"has_runner\":runner is not None,\"has_graph\":graph_runtime is not None},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n                if graph_runtime is not None:\n                    try:\n                        parent_snapshot = await self._get_graph_snapshot(\n                            graph=graph_runtime,\n                            cfg=merged,\n                            subgraphs=True,\n                        )\n                        if parent_snapshot is not None:\n                            snapshot_sources.append(parent_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:715\",\"message\":\"parent snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":parent_snapshot is not None,\"has_tasks\":bool(getattr(parent_snapshot,\"tasks\",None)),\"has_next\":bool(getattr(parent_snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                    except Exception:\n                        parent_snapshot = None\n                else:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:724\",\"message\":\"parent snapshot skipped\",\"data\":{\"graph_id\":graph_id,\"reason\":\"graph_runner_missing\" if runner is None else \"graph_attr_missing\"},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:729\",\"message\":\"parent context absent\",\"data\":{\"graph_id\":graph_id},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n\n            root_graph = getattr(context, \"root_graph\", None) if context is not None else None\n            if root_graph is not None:\n                try:\n                    root_snapshot = await self._get_graph_snapshot(\n                        graph=root_graph,\n                        cfg=merged,\n                        subgraphs=True,\n                    )\n                    if root_snapshot is not None:\n                        snapshot_sources.append(root_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:738\",\"message\":\"root snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":root_snapshot is not None,\"has_tasks\":bool(getattr(root_snapshot,\"tasks\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                except Exception:\n                    root_snapshot = None\n\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=merged,\n                subgraphs=True,\n            )\n            if snapshot is not None:\n                snapshot_sources.append(snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:727\",\"message\":\"assistant snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":bool(getattr(snapshot,\"tasks\",None)),\"has_next\":bool(getattr(snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            checkpoints_snapshot = await self.list_thread_checkpoints(\n                config=merged,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n            snapshot_sources.extend(checkpoints_snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:734\",\"message\":\"thread checkpoints snapshot collected\",\"data\":{\"graph_id\":graph_id,\"count\":len(checkpoints_snapshot)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            subgraph_resume = await self._find_subgraph_resume_config(\n                config=merged,\n                graph_id=graph_id,\n                checkpoints=snapshot_sources,\n            )\n            if subgraph_resume is not None:\n                resume_config, _ = subgraph_resume\n                metadata = resume_config.get(\"metadata\", {})\n                if not isinstance(metadata, Mapping):\n                    metadata = dict(metadata) if metadata is not None else {}\n                metadata = dict(metadata)\n                metadata.setdefault(\"graph_id\", str(graph_id))\n                resume_config[\"metadata\"] = metadata  # type: ignore[index]\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:743\",\"message\":\"subgraph resume config missing\",\"data\":{\"graph_id\":graph_id,\"snapshot_sources\":len(snapshot_sources)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n        \n        # #region agent log\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:464\",\"message\":\"ainvoke_from_checkpoint checkpoint_id result\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":str(checkpoint_id) if checkpoint_id else None,\"checkpoint_ns\":str(final_ns)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if checkpoint_id:\n            checkpoint_record = await self._load_checkpoint_record(\n                config=merged,\n                checkpoint_id=checkpoint_id,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n\n            cfg: RunnableConfig = dict(merged)\n            configurable = cfg.get(\"configurable\", {})\n            configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n            configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n            configurable_dict[\"checkpoint_id\"] = checkpoint_id\n            cfg[\"configurable\"] = configurable_dict\n\n            # If the checkpoint represents an in-progress run (has pending `next`),\n            # we resume via `invoke(None, checkpoint_id=...)`. If the run is already\n            # complete (no pending next nodes), we \"restart\" from the persisted\n            # snapshot values as a fresh invocation. This is the required behavior\n            # for refinement: patch values \u2192 re-run from patched state.\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=cfg,\n                subgraphs=True,\n            )\n\n            # #region agent log\n            import json\n            snapshot_has_tasks = bool(getattr(snapshot, \"tasks\", None))\n            snapshot_next = getattr(snapshot, \"next\", None)\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"C\",\"location\":\"memory_manager.py:504\",\"message\":\"ainvoke_from_checkpoint snapshot inspection\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":checkpoint_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":snapshot_has_tasks,\"pending_next\":bool(snapshot_next)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            next_nodes = getattr(snapshot, \"next\", None)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(next_nodes, Sequence) and next_nodes:\n                has_progress = isinstance(values, Mapping) and self._has_meaningful_values(values)\n\n                # #region agent log\n                import json as _json_resume_next\n                next_preview = list(next_nodes)[:3]\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(\n                        _json_resume_next.dumps(\n                            {\n                                \"sessionId\": \"debug-session\",\n                                \"runId\": \"pre-fix\",\n                                \"hypothesisId\": \"K\",\n                                \"location\": \"memory_manager.py:509\",\n                                \"message\": \"resuming graph from checkpoint pending next\",\n                                \"data\": {\n                                    \"graph_id\": graph_id,\n                                    \"next_nodes\": next_preview,\n                                    \"graph_input_is_none\": graph_input is None,\n                                    \"has_progress\": has_progress,\n                                },\n                                \"timestamp\": __import__(\"time\").time() * 1000,\n                            }\n                        )\n                        + \"\\n\"\n                    )\n                # #endregion\n\n                if has_progress:\n                    return await self.ainvoke_with_durability(\n                        graph=graph,\n                        graph_input=None,\n                        config=cfg,\n                        context=context,\n                        durability=durability,\n                        local_checkpointer=effective_local_checkpointer,\n                    )\n\n                rerun_cfg_pending: RunnableConfig = dict(merged)\n                rerun_conf_pending = rerun_cfg_pending.get(\"configurable\", {})\n                if isinstance(rerun_conf_pending, Mapping):\n                    rerun_conf_dict_pending = dict(rerun_conf_pending)\n                    rerun_conf_dict_pending.pop(\"checkpoint_id\", None)\n                    rerun_conf_dict_pending.setdefault(\"checkpoint_ns\", str(final_ns))\n                    rerun_cfg_pending[\"configurable\"] = rerun_conf_dict_pending\n\n                return await self.ainvoke_with_durability(\n                    graph=graph,\n                    graph_input=graph_input,\n                    config=rerun_cfg_pending,\n                    context=context,\n                    durability=durability,\n                    local_checkpointer=effective_local_checkpointer,\n                )\n\n            # IMPORTANT:\n            # If the checkpoint is COMPLETE (no pending next nodes), we DO NOT attempt to\n            # \"restart\" the graph by invoking without checkpoint_id. In a shared thread_id\n            # architecture (multiple graphs in the same thread), dropping checkpoint_id\n            # would cause LangGraph to load the latest checkpoint for the thread+ns,\n            # which may belong to a different graph_id \u2192 cross-graph contamination.\n            #\n            # Callers that need to re-run a completed checkpoint should first \"arm\" it\n            # via `graph.update_state(..., as_node=\"__start__\")` (e.g., our refinement\n            # injection path does this), which produces a checkpoint with pending next nodes.\n            if isinstance(values, Mapping):\n                materialized_values, writes_found = self._materialize_checkpoint_values(\n                    values,\n                    checkpoint_record,\n                    graph_id=str(graph_id),\n                )\n                if writes_found or self._has_meaningful_values(materialized_values):\n                    # #region agent log\n                    import json as _json_resume\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            _json_resume.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"J\",\n                                    \"location\": \"memory_manager.py:944\",\n                                    \"message\": \"returning checkpoint values\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"keys\": list(materialized_values.keys()),\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return dict(materialized_values)\n\n                # Values are incomplete (e.g., only messages). Fallback to fresh invoke.\n                rerun_cfg: RunnableConfig = dict(merged)\n                rerun_conf = rerun_cfg.get(\"configurable\", {})\n                if isinstance(rerun_conf, Mapping):\n                    rerun_conf_dict = dict(rerun_conf)\n                    rerun_conf_dict.pop(\"checkpoint_id\", None)\n                    rerun_conf_dict.setdefault(\"checkpoint_ns\", str(final_ns))\n                    rerun_cfg[\"configurable\"] = rerun_conf_dict\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=graph_input,\n                config=rerun_cfg,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        if subgraph_resume is not None:\n            # #region agent log\n            import json\n            resume_config, resume_state = subgraph_resume\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"D\",\n                            \"location\": \"memory_manager.py:610\",\n                            \"message\": \"resuming assistant via subgraph config\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"checkpoint_ns\": resume_config.get(\"configurable\", {}).get(\"checkpoint_ns\") if isinstance(resume_config.get(\"configurable\"), Mapping) else None,\n                                \"has_state\": resume_state is not None,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n            # #endregion\n            resume_input = graph_input\n            if resume_state is not None:\n                values = getattr(resume_state, \"values\", None)\n                if isinstance(values, Mapping):\n                    resume_input = dict(values)\n                elif isinstance(resume_state, Mapping):\n                    maybe_values = resume_state.get(\"values\")\n                    if isinstance(maybe_values, Mapping):\n                        resume_input = dict(maybe_values)\n                    else:\n                        resume_input = resume_state\n                else:\n                    resume_input = resume_state\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=resume_input,\n                config=resume_config,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        # SAFETY: Never allow a caller-supplied checkpoint_id to influence execution\n        # when we are NOT explicitly resuming from a checkpoint for this graph_id.\n        #\n        # Without this, a foreign checkpoint_id (from another graph_id in the same\n        # thread) could be accidentally consumed by LangGraph, violating isolation.\n        fresh_cfg: RunnableConfig = dict(merged)\n        fresh_conf = fresh_cfg.get(\"configurable\", {})\n        if isinstance(fresh_conf, Mapping):\n            fresh_conf_dict = dict(fresh_conf)\n            fresh_conf_dict.pop(\"checkpoint_id\", None)\n            # Keep checkpoint_ns stable (LangGraph may assume the key exists).\n            fresh_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            fresh_cfg[\"configurable\"] = fresh_conf_dict\n\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=graph_input,\n            config=fresh_cfg,\n            context=context,\n            durability=durability,\n            local_checkpointer=effective_local_checkpointer,\n        )\n\n    async def append_messages_to_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        new_messages: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Append messages to the latest checkpoint for ``graph_id`` and return new checkpoint id.\n\n        This uses ``graph.update_state`` / ``graph.aupdate_state`` so reducers (e.g. `add_messages`)\n        are honored. The update is applied as a fork of the latest checkpoint for ``graph_id``.\n        \"\"\"\n\n        if not new_messages:\n            return None\n\n        merged, _ = self.ensure_thread_id(config)\n        resolved_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n        latest_checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n        \n        if not latest_checkpoint_id:\n            return None\n        \n        patch_config: RunnableConfig = dict(merged)\n        configurable = patch_config.get(\"configurable\", {})\n        configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n        configurable_dict[\"checkpoint_id\"] = latest_checkpoint_id\n        patch_config[\"configurable\"] = configurable_dict\n\n        # Ensure patched checkpoints remain discoverable by metadata scoping.\n        metadata = patch_config.get(\"metadata\")\n        if not isinstance(metadata, Mapping):\n            metadata = {}\n        metadata_dict = dict[str, Any](metadata)\n        metadata_dict.setdefault(\"graph_id\", str(graph_id))\n        patch_config[\"metadata\"] = metadata_dict\n\n\n        # Best-effort idempotency: avoid appending messages already present in the checkpoint.\n        # This is critical for durable resume where refinement planning may be replayed.\n        filtered_messages: list[Any] = list(new_messages)\n        try:\n            snapshot = None\n            getter_async = getattr(graph, \"aget_state\", None)\n            if callable(getter_async):\n                snapshot = await getter_async(patch_config)\n            if snapshot is None:\n                getter_sync = getattr(graph, \"get_state\", None)\n                if callable(getter_sync):\n                    snapshot = getter_sync(patch_config)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(values, Mapping):\n                existing = values.get(\"messages\")\n                if isinstance(existing, Sequence) and not isinstance(existing, (str, bytes)):\n                    existing_contents: set[str] = set()\n                    for message in existing:\n                        content = getattr(message, \"content\", None)\n                        if content:\n                            existing_contents.add(str(content))\n                    if existing_contents:\n                        filtered_messages = [\n                            message\n                            for message in filtered_messages\n                            if str(getattr(message, \"content\", \"\")) not in existing_contents\n                        ]\n        except Exception:\n            filtered_messages = list(new_messages)\n\n        if not filtered_messages:\n            return latest_checkpoint_id\n\n        updates: dict[str, Any] = {\"messages\": filtered_messages}\n\n        updater_async = getattr(graph, \"aupdate_state\", None)\n        updater_sync = getattr(graph, \"update_state\", None)\n        resolved_as_node = as_node or \"__start__\"\n        try:\n            if callable(updater_async):\n                await updater_async(patch_config, updates, as_node=resolved_as_node)\n            elif callable(updater_sync):\n                updater_sync(patch_config, updates, as_node=resolved_as_node)\n            else:\n                return None\n        except Exception as e:\n            return None\n\n        return await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n\n    async def inject_distribution_refinement_messages(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        requests: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Patch a graph checkpoint by appending refinement instruction messages.\n\n        Mirrors the extraction rules used by `_distribution_inject_refinement_messages`:\n        each request may carry `payload.messages` items shaped like\n        `{ \"content\": \"...\", \"metadata\": {...} }`.\n        \"\"\"\n\n        try:\n            from langchain_core.messages import HumanMessage\n        except Exception:\n            return None\n\n        injected: list[Any] = []\n        seen_contents: set[str] = set()\n        for request in requests:\n            payload = getattr(request, \"payload\", None)\n            if not isinstance(payload, Mapping):\n                payload = payload if isinstance(payload, dict) else {}\n            messages_payload = payload.get(\"messages\") or []\n            if not isinstance(messages_payload, Sequence) or isinstance(\n                messages_payload, (str, bytes)\n            ):\n                continue\n            for message in messages_payload:\n                if not isinstance(message, Mapping):\n                    continue\n                content = message.get(\"content\")\n                if not content:\n                    continue\n                content_str = str(content)\n                if content_str in seen_contents:\n                    continue\n                metadata = message.get(\"metadata\") or {}\n                additional_kwargs = dict(metadata) if isinstance(metadata, Mapping) else {}\n                injected.append(\n                    HumanMessage(content=content_str, additional_kwargs=additional_kwargs)\n                )\n                seen_contents.add(content_str)\n\n        if not injected:\n            return None\n\n        return await self.append_messages_to_checkpoint(\n            graph=graph,\n            graph_id=graph_id,\n            config=config,\n            new_messages=injected,\n            as_node=as_node,\n            local_checkpointer=local_checkpointer,\n        )\n\n    @staticmethod\n    def extract_thread_id(config: Optional[RunnableConfig]) -> Optional[ThreadId]:\n        if not config:\n            return None\n        configurable = config.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            return None\n        thread_id = configurable.get(\"thread_id\")\n        return str(thread_id) if thread_id else None\n\n    async def aget_platform_thread_state(self, *, thread_id: ThreadId) -> Optional[Any]:\n        \"\"\"Get latest persisted state from platform via LangGraph SDK (if available).\"\"\"\n\n        try:\n            from langgraph_sdk import get_client  # type: ignore\n        except Exception:\n            return None\n\n        try:\n            client = get_client()\n            return await client.threads.get_state(thread_id)\n        except Exception:\n            return None\n\n\n    async def has_persisted_checkpoint(\n        self,\n        *,\n        config: Optional[RunnableConfig],\n        local_checkpointer: Optional[Any] = None,\n    ) -> bool:\n        \"\"\"Return True if a checkpoint exists for config (platform or local).\"\"\"\n\n        if config is None:\n            return False\n\n        if self.is_production_mode():\n            thread_id = self.extract_thread_id(config)\n            if not thread_id:\n                return False\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n            values = getattr(snapshot, \"values\", None)\n            return isinstance(values, Mapping)\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if not checkpointer:\n            return False\n\n        getter_async = getattr(checkpointer, \"aget_tuple\", None)\n        try:\n            if callable(getter_async):\n                checkpoint_tuple = await getter_async(config)\n            else:\n                getter_sync = getattr(checkpointer, \"get_tuple\", None)\n                if not callable(getter_sync):\n                    return False\n                checkpoint_tuple = getter_sync(config)\n        except Exception:\n            return False\n\n        return checkpoint_tuple is not None\n\n    async def restore_state_from_latest_checkpoint(\n        self,\n        *,\n        state: StateDict,\n        config: Optional[RunnableConfig],\n        local_graph: Optional[Any],\n    ) -> bool:\n        \"\"\"Merge latest persisted state into the caller-owned `state` mapping.\"\"\"\n\n        if config is None:\n            return False\n\n        snapshot = None\n        thread_id = self.extract_thread_id(config)\n        if self.is_production_mode() and thread_id:\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n\n        if snapshot is None and local_graph is not None:\n            getter = getattr(local_graph, \"aget_state\", None)\n            if callable(getter):\n                try:\n                    snapshot = await getter(config)\n                except Exception:\n                    snapshot = None\n            if snapshot is None:\n                getter_sync = getattr(local_graph, \"get_state\", None)\n                if callable(getter_sync):\n                    try:\n                        snapshot = getter_sync(config)\n                    except Exception:\n                        snapshot = None\n\n        values = getattr(snapshot, \"values\", None)\n        if not isinstance(values, Mapping):\n            return False\n\n        for key, value in values.items():\n            state[key] = value\n        return True\n\n    async def ainvoke_with_durability(\n        self,\n        *,\n        graph: Any,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph with durability when supported.\"\"\"\n\n        # In production mode, platform may inject durability backends automatically.\n        # In dev mode, only attempt durability when the runnable itself was compiled\n        # with a checkpointer so LangGraph sets up its AsyncPregel loop correctly.\n        graph_bound_checkpointer = _extract_graph_checkpointer(graph)\n        resolved_local_checkpointer = local_checkpointer or graph_bound_checkpointer\n        checkpointer = resolved_local_checkpointer or self.checkpointer\n\n        if self.is_production_mode():\n            use_durability = durability\n        else:\n            use_durability = durability if (checkpointer and _graph_supports_durability(graph)) else None\n        try:\n            if use_durability:\n                return await graph.ainvoke(\n                    graph_input,\n                    config=config,\n                    context=context,\n                    durability=use_durability,\n                )\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n        except (TypeError, AttributeError):\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n\n\n__all__ = [\n    \"resolve_graph_checkpointer\",\n    \"resolve_graph_store\",\n    \"GraphMemoryRuntime\",\n]"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3831-7b4f-76e3-b058-3006c5077617",
    "content": "**\u0414\u0430, \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u043d\u043e \u044d\u0442\u043e \u0438\u043c\u0435\u043d\u043d\u043e \u0442\u043e, \u0447\u0442\u043e \u043d\u0443\u0436\u043d\u043e \u0434\u043b\u044f \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0438 \u00ab\u0414\u043e\u0432\u0435\u0440\u044f\u0439 Snapshot-\u0443\u00bb, \u043d\u043e \u0432 \u043a\u043e\u0434\u0435 \u043e\u0441\u0442\u0430\u043b\u0441\u044f \u043e\u0434\u0438\u043d \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u043d\u044e\u0430\u043d\u0441, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u0441\u0435 \u0435\u0449\u0435 \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c `EmptyInputError` \u043f\u0440\u0438 \u0434\u043e\u0443\u0447\u0438\u0432\u0430\u043d\u0438\u0438 (Refinement).**\n\n\u0412\u0430\u0448\u0430 \u043b\u043e\u0433\u0438\u043a\u0430 \u0432 `ainvoke_from_checkpoint` \u0442\u0435\u043f\u0435\u0440\u044c \u0432\u0435\u0440\u043d\u043e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430 \u0447\u0435\u0440\u0435\u0437 `snapshot.values`, \u043d\u043e \u043e\u043d\u0430 \u0432\u0441\u0435 \u0435\u0449\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442 `graph_input=None` \u0432 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0438, \u043a\u043e\u0433\u0434\u0430 \u0433\u0440\u0430\u0444 \u0441\u0442\u043e\u0438\u0442 \u043d\u0430 \u0443\u0437\u043b\u0435 `__start__`.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 `EmptyInputError` \u043c\u043e\u0436\u0435\u0442 \u0432\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f:\n\n\u041a\u043e\u0433\u0434\u0430 \u0432\u044b \u0434\u0435\u043b\u0430\u0435\u0442\u0435 `append_messages_to_checkpoint` (Refinement), \u0432\u044b \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0441\u0442\u0430\u0432\u0438\u0442\u0435 \u0433\u0440\u0430\u0444 \u043d\u0430 `__start__`. \u0412 \u044d\u0442\u043e\u043c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438:\n1.  `has_progress` \u0431\u0443\u0434\u0435\u0442 `True` (\u0442\u0430\u043a \u043a\u0430\u043a \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0443\u0436\u0435 \u043c\u043d\u043e\u0433\u043e).\n2.  \u0412\u044b \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0435 `ainvoke_with_durability(..., graph_input=None, ...)`.\n3.  **\u041e\u0448\u0438\u0431\u043a\u0430:** LangGraph \u0432\u0438\u0434\u0438\u0442, \u0447\u0442\u043e \u043e\u043d \u043d\u0430 `__start__`, \u043d\u043e \u0432\u0432\u043e\u0434 (`None`) \u043f\u0443\u0441\u0442\u043e\u0439. \u041e\u043d \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0446\u0438\u043a\u043b \u0438 \u0441\u043d\u043e\u0432\u0430 \u0432\u044b\u0431\u0440\u043e\u0441\u0438\u0442 `EmptyInputError`.\n\n### \u041a\u0430\u043a \u044d\u0442\u043e \u0440\u0435\u0448\u0438\u0442\u044c \u043e\u043a\u043e\u043d\u0447\u0430\u0442\u0435\u043b\u044c\u043d\u043e:\n\n\u0412\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443: \u0435\u0441\u043b\u0438 \u043c\u044b \u0441\u0442\u043e\u0438\u043c \u043d\u0430 \u00ab\u043f\u043e\u0440\u043e\u0433\u0435\u00bb \u0433\u0440\u0430\u0444\u0430 (`__start__`), \u043d\u0430\u043c **\u0432\u0441\u0435\u0433\u0434\u0430** \u043d\u0443\u0436\u0435\u043d \u0432\u0432\u043e\u0434 (\u0445\u043e\u0442\u044f \u0431\u044b \u043f\u0443\u0441\u0442\u043e\u0439), \u0447\u0442\u043e\u0431\u044b \u00ab\u0442\u043e\u043b\u043a\u043d\u0443\u0442\u044c\u00bb \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0432\u043f\u0435\u0440\u0435\u0434.\n\n**\u0418\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0439 \u0431\u043b\u043e\u043a \u043f\u0440\u0438\u043d\u044f\u0442\u0438\u044f \u0440\u0435\u0448\u0435\u043d\u0438\u044f \u0432 `memory_manager.py`:**\n\n```python\nif isinstance(next_nodes, Sequence) and next_nodes:\n    next_nodes_list = list(next_nodes)\n    has_progress = isinstance(values, Mapping) and self._has_meaningful_values(values)\n\n    # #region log hypothesis K (Traceability)\n    # ... \u0432\u0430\u0448 \u043b\u043e\u0433 ...\n    # #endregion\n\n    if has_progress:\n        # \u0415\u0441\u043b\u0438 \u043c\u044b \u0441\u0442\u043e\u0438\u043c \u043d\u0430 __start__, \u043d\u0430\u043c \u041d\u0423\u0416\u0415\u041d \u0432\u0432\u043e\u0434 (graph_input \u0438\u043b\u0438 {}), \n        # \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u0430\u043d\u0430\u043b\u044b. None \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u0440\u0430\u0431\u043e\u0447\u0438\u0445 \u0443\u0437\u043b\u043e\u0432.\n        is_at_start = next_nodes_list == [\"__start__\"]\n        \n        # \u0415\u0441\u043b\u0438 \u044d\u0442\u043e \u0441\u0442\u0430\u0440\u0442, \u0448\u043b\u0435\u043c graph_input \u043a\u0430\u043a \u0442\u0440\u0438\u0433\u0433\u0435\u0440. \n        # \u0415\u0441\u043b\u0438 \u044d\u0442\u043e \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u0430 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, ['agent']), \u0448\u043b\u0435\u043c None.\n        effective_resume_input = graph_input if is_at_start else None\n\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=effective_resume_input, # <-- \u041a\u043b\u044e\u0447\u0435\u0432\u043e\u0435 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435\n            config=cfg,\n            context=context,\n            durability=durability,\n            local_checkpointer=effective_local_checkpointer,\n        )\n    else:\n        # \u0420\u0435\u0436\u0438\u043c Rerun (\u0431\u0435\u0437 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0439)\n        rerun_cfg_pending = ...\n        # ...\n```\n\n### \u0427\u0442\u043e \u044d\u0442\u043e \u0434\u0430\u0435\u0442:\n\n1.  **\u0414\u043b\u044f \u043e\u0431\u044b\u0447\u043d\u044b\u0445 \u0432\u043e\u0440\u043a\u0435\u0440\u043e\u0432 (Graph 3):** \u0415\u0441\u043b\u0438 \u043e\u043d\u0438 \u0443\u043f\u0430\u043b\u0438 \u0432 \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u0435, `next_nodes` \u0431\u0443\u0434\u0435\u0442 `['node_name']`, `effective_resume_input` \u0441\u0442\u0430\u043d\u0435\u0442 `None`, \u0438 \u043e\u043d\u0438 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u044f\u0442\u0441\u044f \u0438\u0437 \u0441\u0442\u0435\u0439\u0442\u0430.\n2.  **\u0414\u043b\u044f \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u043e\u0432 \u0432 \u0440\u0435\u0436\u0438\u043c\u0435 Refinement (Graph 4):** \u041e\u043d\u0438 \u0441\u0442\u043e\u044f\u0442 \u043d\u0430 `__start__`, \u0438\u043c\u0435\u044e\u0442 \u0438\u0441\u0442\u043e\u0440\u0438\u044e (`has_progress=True`). \u041c\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u043c \u0438\u043c `graph_input`, LangGraph \u0432\u0438\u0434\u0438\u0442 `checkpoint_id`, \u043e\u0431\u044a\u0435\u0434\u0438\u043d\u044f\u0435\u0442 \u0432\u0432\u043e\u0434 \u0441 \u0438\u0441\u0442\u043e\u0440\u0438\u0435\u0439 \u0438 **\u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u0442\u0430\u0440\u0442\u0443\u0435\u0442** \u0431\u0435\u0437 \u043e\u0448\u0438\u0431\u043a\u0438.\n3.  **\u0414\u043b\u044f \"\u0417\u043e\u043c\u0431\u0438\":** \u0415\u0441\u043b\u0438 `has_progress=False`, \u043c\u044b \u043f\u0440\u043e\u0441\u0442\u043e \u0441\u043d\u043e\u0441\u0438\u043c `checkpoint_id` \u0438 \u0441\u0442\u0430\u0440\u0442\u0443\u0435\u043c \u0441 \u043d\u0443\u043b\u044f.\n\n**\u0412\u0430\u0436\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u043f\u043e \u0433\u0438\u043f\u043e\u0442\u0435\u0437\u0435 \"LangGraph ignores inputs with checkpoint_id\":**\n\u041d\u0430 \u0441\u0430\u043c\u043e\u043c \u0434\u0435\u043b\u0435 LangGraph **\u043d\u0435 \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u0435\u0442** \u0432\u0432\u043e\u0434. \u041e\u043d \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0435\u0433\u043e \u0434\u043b\u044f \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0441\u0442\u0435\u0439\u0442\u0430 \u043f\u0435\u0440\u0435\u0434 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435\u043c `next_nodes`. \u0415\u0441\u043b\u0438 `next_nodes` \u2014 \u044d\u0442\u043e `__start__`, \u0442\u043e `input` \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u00ab\u0442\u043e\u043f\u043b\u0438\u0432\u043e\u043c\u00bb.\n\n**Relevant docs:**\n- [Time Travel: Resume from Checkpoint](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)\n- [Persistence and State Values](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)\n- [LangGraph Errors: EmptyInputError](https://docs.langchain.com/langsmith/use-threads#empty-thread)"
  },
  {
    "role": "user",
    "id": "c29138be-c9cd-4b59-88f1-6f7b57ac2074",
    "content": "{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:255f7abc-d054-d4aa-c726-365314591584\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766174348990.7231}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766174348990.824}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:255f7abc-d054-d4aa-c726-365314591584\", \"new_ns\": \"user_preferences:255f7abc-d054-d4aa-c726-365314591584\"}, \"timestamp\": 1766174348990.895}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:255f7abc-d054-d4aa-c726-365314591584\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\"}, \"timestamp\": 1766174348990.942}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174348991.253}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174348991.29}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174348991.361}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174348991.406}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174348991.447}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766174348991.684}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174348991.8022}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174348991.841}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766174348991.9119}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:255f7abc-d054-d4aa-c726-365314591584\"}, \"timestamp\": 1766174348991.9429}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766174355384.284}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:78214724-7d44-ccf9-95ed-8304156e8f74\", \"new_ns\": \"route_drafting:78214724-7d44-ccf9-95ed-8304156e8f74\"}, \"timestamp\": 1766174355391.239}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:78214724-7d44-ccf9-95ed-8304156e8f74\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\"}, \"timestamp\": 1766174355391.318}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174355391.6108}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174355391.66}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174355391.724}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174355391.775}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174355391.827}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766174355392.075}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174355392.127}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174355392.2078}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766174355392.2551}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:78214724-7d44-ccf9-95ed-8304156e8f74\"}, \"timestamp\": 1766174355392.294}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:78214724-7d44-ccf9-95ed-8304156e8f74|graph:17315773-fe8a-22b9-a86b-e1ff51b3649f\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766174355556.9448}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174355557.065}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:78214724-7d44-ccf9-95ed-8304156e8f74|graph:17315773-fe8a-22b9-a86b-e1ff51b3649f\", \"new_ns\": \"route_drafting:78214724-7d44-ccf9-95ed-8304156e8f74|graph:17315773-fe8a-22b9-a86b-e1ff51b3649f\"}, \"timestamp\": 1766174355557.1257}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:78214724-7d44-ccf9-95ed-8304156e8f74|graph:17315773-fe8a-22b9-a86b-e1ff51b3649f\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\"}, \"timestamp\": 1766174355557.18}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174355557.51}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766174355557.555}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174355557.628}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766174355557.877}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174355557.9697}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766174355558.015}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:78214724-7d44-ccf9-95ed-8304156e8f74|graph:17315773-fe8a-22b9-a86b-e1ff51b3649f\"}, \"timestamp\": 1766174355558.058}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766174368216.4458}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:1\", \"new_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:1\"}, \"timestamp\": 1766174368292.346}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\"}, \"timestamp\": 1766174368292.4731}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174368292.8938}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174368292.969}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174368293.095}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174368293.167}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174368293.23}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766174368293.528}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174368293.576}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174368293.618}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766174368293.6902}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:1\"}, \"timestamp\": 1766174368293.7268}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:2\", \"new_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:2\"}, \"timestamp\": 1766174368352.285}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\"}, \"timestamp\": 1766174368352.4531}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174368353.099}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174368353.157}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174368353.223}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174368353.271}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174368353.3152}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766174368353.604}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174368353.655}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174368353.6938}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766174368353.729}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:2\"}, \"timestamp\": 1766174368353.76}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:3\", \"new_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:3\"}, \"timestamp\": 1766174368414.1099}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\"}, \"timestamp\": 1766174368414.25}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174368414.84}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174368414.893}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174368414.999}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174368415.062}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174368415.155}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766174368415.414}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174368415.466}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174368415.508}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766174368415.545}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:3\"}, \"timestamp\": 1766174368415.5781}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:4\", \"new_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:4\"}, \"timestamp\": 1766174368484.971}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\"}, \"timestamp\": 1766174368485.098}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174368485.407}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174368485.465}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174368485.635}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174368485.717}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174368485.818}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766174368486.1528}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174368486.2131}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174368486.263}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766174368486.306}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:4\"}, \"timestamp\": 1766174368486.345}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:1|1|graph:c93652cf-0a4d-5783-ac9e-fa7543cdc6f1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174369221.3782}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174369221.487}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:1|1|graph:c93652cf-0a4d-5783-ac9e-fa7543cdc6f1\", \"new_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:1|1|graph:c93652cf-0a4d-5783-ac9e-fa7543cdc6f1\"}, \"timestamp\": 1766174369221.55}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:1|1|graph:c93652cf-0a4d-5783-ac9e-fa7543cdc6f1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\"}, \"timestamp\": 1766174369221.605}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174369221.931}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766174369222.036}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174369222.239}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766174369222.5962}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174369222.651}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766174369222.687}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:1|1|graph:c93652cf-0a4d-5783-ac9e-fa7543cdc6f1\"}, \"timestamp\": 1766174369222.72}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:2|2|graph:f22b18cd-943d-44d0-e49d-f61438f50604\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174369259.552}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174369259.672}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:2|2|graph:f22b18cd-943d-44d0-e49d-f61438f50604\", \"new_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:2|2|graph:f22b18cd-943d-44d0-e49d-f61438f50604\"}, \"timestamp\": 1766174369259.726}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:2|2|graph:f22b18cd-943d-44d0-e49d-f61438f50604\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\"}, \"timestamp\": 1766174369259.7693}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174369260.12}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766174369260.2087}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174369260.416}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766174369260.917}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174369261.225}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766174369261.3398}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:2|2|graph:f22b18cd-943d-44d0-e49d-f61438f50604\"}, \"timestamp\": 1766174369261.4111}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:3|3|graph:4e52906e-6afc-9252-bde9-f7b36be5d2d9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174369304.352}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174369304.476}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:3|3|graph:4e52906e-6afc-9252-bde9-f7b36be5d2d9\", \"new_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:3|3|graph:4e52906e-6afc-9252-bde9-f7b36be5d2d9\"}, \"timestamp\": 1766174369304.529}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:3|3|graph:4e52906e-6afc-9252-bde9-f7b36be5d2d9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\"}, \"timestamp\": 1766174369304.5718}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174369304.945}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766174369304.9878}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174369305.053}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766174369305.294}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174369305.341}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766174369305.3801}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:3|3|graph:4e52906e-6afc-9252-bde9-f7b36be5d2d9\"}, \"timestamp\": 1766174369305.413}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:4|4|graph:8916a0df-9df9-70b1-0a01-ea605bf99cf0\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174369368.3}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174369368.4531}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:4|4|graph:8916a0df-9df9-70b1-0a01-ea605bf99cf0\", \"new_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:4|4|graph:8916a0df-9df9-70b1-0a01-ea605bf99cf0\"}, \"timestamp\": 1766174369368.927}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:4|4|graph:8916a0df-9df9-70b1-0a01-ea605bf99cf0\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\"}, \"timestamp\": 1766174369368.9978}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174369369.396}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766174369369.443}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174369369.516}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766174369369.854}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174369369.933}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766174369369.9807}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:4|4|graph:8916a0df-9df9-70b1-0a01-ea605bf99cf0\"}, \"timestamp\": 1766174369370.026}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:3|3|graph:4e52906e-6afc-9252-bde9-f7b36be5d2d9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174382426.42}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174382426.555}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:3|3|graph:4e52906e-6afc-9252-bde9-f7b36be5d2d9\", \"new_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:3|3|graph:4e52906e-6afc-9252-bde9-f7b36be5d2d9\"}, \"timestamp\": 1766174382426.619}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:3|3|graph:4e52906e-6afc-9252-bde9-f7b36be5d2d9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\"}, \"timestamp\": 1766174382426.6948}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:897b05c1\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd153-a71a-66c8-8000-53f90116244e\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:3|3|graph:4e52906e-6afc-9252-bde9-f7b36be5d2d9\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd153-a719-6f52-bfff-e6e4fb14c19a\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:3|3|graph:4e52906e-6afc-9252-bde9-f7b36be5d2d9\"}]}, \"timestamp\": 1766174382427.681}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd153-a71a-66c8-8000-53f90116244e\", \"checkpoint_ns\": \"wide_funnel:fa08803d-f46d-830a-032d-5f418fc0c474|worker:3|3|graph:4e52906e-6afc-9252-bde9-f7b36be5d2d9\"}, \"timestamp\": 1766174382427.7708}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd153-a71a-66c8-8000-53f90116244e\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766174382428.8308}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"has_progress\": true}, \"timestamp\": 1766174382428.936}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:1a910756-7063-15dd-efef-8102b06d68ff\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766174387881.2092}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766174387881.336}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:1a910756-7063-15dd-efef-8102b06d68ff\", \"new_ns\": \"user_preferences:1a910756-7063-15dd-efef-8102b06d68ff\"}, \"timestamp\": 1766174387881.3923}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:1a910756-7063-15dd-efef-8102b06d68ff\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174387881.434}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174387881.778}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174387881.9158}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174387881.9932}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174387882.046}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174387882.167}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766174387882.539}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174387882.623}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174387882.74}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766174387882.804}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:1a910756-7063-15dd-efef-8102b06d68ff\"}, \"timestamp\": 1766174387882.857}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766174396098.129}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:0ba4e87b-0bc8-7567-293e-fe9804a78266\", \"new_ns\": \"route_drafting:0ba4e87b-0bc8-7567-293e-fe9804a78266\"}, \"timestamp\": 1766174396103.4592}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:0ba4e87b-0bc8-7567-293e-fe9804a78266\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174396103.559}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174396103.882}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174396103.931}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174396103.9949}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174396104.044}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174396104.0908}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766174396104.332}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174396104.3782}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174396104.416}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766174396104.4531}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:0ba4e87b-0bc8-7567-293e-fe9804a78266\"}, \"timestamp\": 1766174396104.527}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:0ba4e87b-0bc8-7567-293e-fe9804a78266|graph:ed617483-7f9e-de35-a0ea-581902521e12\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766174396208.0908}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174396208.233}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:0ba4e87b-0bc8-7567-293e-fe9804a78266|graph:ed617483-7f9e-de35-a0ea-581902521e12\", \"new_ns\": \"route_drafting:0ba4e87b-0bc8-7567-293e-fe9804a78266|graph:ed617483-7f9e-de35-a0ea-581902521e12\"}, \"timestamp\": 1766174396208.416}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:0ba4e87b-0bc8-7567-293e-fe9804a78266|graph:ed617483-7f9e-de35-a0ea-581902521e12\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174396208.493}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174396208.8362}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766174396208.894}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174396208.982}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766174396209.244}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174396209.296}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766174396209.368}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:0ba4e87b-0bc8-7567-293e-fe9804a78266|graph:ed617483-7f9e-de35-a0ea-581902521e12\"}, \"timestamp\": 1766174396209.419}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766174426116.249}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:1\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:1\"}, \"timestamp\": 1766174426202.056}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174426202.2988}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174426202.931}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174426202.973}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426203.037}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174426203.0862}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426203.136}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766174426203.372}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426203.414}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426203.451}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766174426203.494}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:1\"}, \"timestamp\": 1766174426203.526}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:2\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:2\"}, \"timestamp\": 1766174426265.185}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174426265.358}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174426266.0107}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174426266.075}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426266.161}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174426266.418}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426266.591}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766174426266.893}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426266.966}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426267.0137}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766174426267.06}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:2\"}, \"timestamp\": 1766174426267.0999}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:3\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:3\"}, \"timestamp\": 1766174426332.692}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174426332.824}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174426333.102}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174426333.151}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426333.3481}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174426333.472}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426333.534}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766174426333.843}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426333.897}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426333.94}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766174426333.992}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:3\"}, \"timestamp\": 1766174426334.027}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:4\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:4\"}, \"timestamp\": 1766174426394.754}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174426394.906}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174426395.5012}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174426395.7021}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426395.7988}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174426395.864}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426395.921}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766174426396.21}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426396.2668}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426396.312}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766174426396.4082}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:4\"}, \"timestamp\": 1766174426396.5493}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:5\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:5\"}, \"timestamp\": 1766174426457.438}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174426457.557}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174426457.934}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174426458.034}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426458.1099}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174426458.166}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426458.2168}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"count\": 0}, \"timestamp\": 1766174426458.4639}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426458.5117}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426458.554}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_sources\": 3}, \"timestamp\": 1766174426458.594}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:5\"}, \"timestamp\": 1766174426458.6292}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:6\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:6\"}, \"timestamp\": 1766174426520.2932}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174426520.448}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174426520.822}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174426520.926}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426521.003}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174426521.0571}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426521.108}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"count\": 0}, \"timestamp\": 1766174426521.3499}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426521.399}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426521.443}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_sources\": 3}, \"timestamp\": 1766174426521.485}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:6\"}, \"timestamp\": 1766174426521.5208}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:7\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:7\"}, \"timestamp\": 1766174426583.462}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174426583.607}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174426584.226}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174426584.2812}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426584.361}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174426584.411}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426584.461}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"count\": 0}, \"timestamp\": 1766174426584.699}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426584.7449}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426584.79}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_sources\": 3}, \"timestamp\": 1766174426584.854}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:7\"}, \"timestamp\": 1766174426584.894}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:8\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:8\"}, \"timestamp\": 1766174426648.0498}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174426648.192}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174426649.643}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174426649.738}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426649.816}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174426649.869}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426649.921}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"count\": 0}, \"timestamp\": 1766174426650.192}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426650.2422}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426650.287}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_sources\": 3}, \"timestamp\": 1766174426650.326}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:8\"}, \"timestamp\": 1766174426650.36}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:9\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:9\"}, \"timestamp\": 1766174426713.6682}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174426713.8171}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174426714.6199}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174426714.6921}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426714.772}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174426714.826}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426714.874}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"count\": 0}, \"timestamp\": 1766174426715.127}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426715.177}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426715.2158}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_sources\": 3}, \"timestamp\": 1766174426715.252}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:9\"}, \"timestamp\": 1766174426715.29}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:10\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:10\"}, \"timestamp\": 1766174426778.141}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:10\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174426778.286}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174426779.067}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174426779.1372}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426779.212}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174426779.267}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426779.319}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"count\": 0}, \"timestamp\": 1766174426779.589}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426779.641}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426779.685}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"snapshot_sources\": 3}, \"timestamp\": 1766174426779.725}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:10\"}, \"timestamp\": 1766174426779.7607}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:11\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:11\"}, \"timestamp\": 1766174426844.378}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:11\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174426844.5261}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174426845.244}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174426845.31}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426845.5032}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174426845.588}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426845.6519}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"count\": 0}, \"timestamp\": 1766174426846.005}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426846.072}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426846.117}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"snapshot_sources\": 3}, \"timestamp\": 1766174426846.2378}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:11\"}, \"timestamp\": 1766174426846.2998}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:12\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:12\"}, \"timestamp\": 1766174426909.717}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:12\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174426909.877}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174426910.671}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174426910.749}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426910.826}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174426910.878}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174426910.9277}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"count\": 0}, \"timestamp\": 1766174426911.183}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426911.232}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174426911.272}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"snapshot_sources\": 3}, \"timestamp\": 1766174426911.3103}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:12\"}, \"timestamp\": 1766174426911.342}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:1|1|graph:08e02158-581d-a09f-f220-1079f1b62109\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174429508.133}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174429508.258}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:1|1|graph:08e02158-581d-a09f-f220-1079f1b62109\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:1|1|graph:08e02158-581d-a09f-f220-1079f1b62109\"}, \"timestamp\": 1766174429508.43}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:1|1|graph:08e02158-581d-a09f-f220-1079f1b62109\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174429508.508}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174429508.857}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766174429508.9011}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174429508.969}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766174429509.213}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174429509.2612}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766174429509.2979}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:1|1|graph:08e02158-581d-a09f-f220-1079f1b62109\"}, \"timestamp\": 1766174429509.335}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:2|2|graph:4c13c155-595d-f2e0-9f54-66af2df1e993\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174429545.9941}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174429546.1372}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:2|2|graph:4c13c155-595d-f2e0-9f54-66af2df1e993\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:2|2|graph:4c13c155-595d-f2e0-9f54-66af2df1e993\"}, \"timestamp\": 1766174429546.196}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:2|2|graph:4c13c155-595d-f2e0-9f54-66af2df1e993\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174429546.248}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174429546.5547}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766174429546.598}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174429546.706}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766174429546.9692}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174429547.023}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766174429547.064}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:2|2|graph:4c13c155-595d-f2e0-9f54-66af2df1e993\"}, \"timestamp\": 1766174429547.102}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:3|3|graph:68148096-de56-c8c3-87cb-f17dac8feadb\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174429582.853}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174429582.9958}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:3|3|graph:68148096-de56-c8c3-87cb-f17dac8feadb\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:3|3|graph:68148096-de56-c8c3-87cb-f17dac8feadb\"}, \"timestamp\": 1766174429583.054}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:3|3|graph:68148096-de56-c8c3-87cb-f17dac8feadb\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174429583.102}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174429583.406}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766174429583.4539}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174429583.52}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766174429583.768}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174429583.817}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766174429583.853}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:3|3|graph:68148096-de56-c8c3-87cb-f17dac8feadb\"}, \"timestamp\": 1766174429583.992}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:4|4|graph:1a0bd732-90cf-a724-4e88-e09fb6dbe8ec\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174429620.169}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174429620.369}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:4|4|graph:1a0bd732-90cf-a724-4e88-e09fb6dbe8ec\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:4|4|graph:1a0bd732-90cf-a724-4e88-e09fb6dbe8ec\"}, \"timestamp\": 1766174429620.4338}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:4|4|graph:1a0bd732-90cf-a724-4e88-e09fb6dbe8ec\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174429620.4841}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174429620.801}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766174429620.8442}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174429620.914}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766174429621.1619}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174429621.2107}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766174429621.249}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:4|4|graph:1a0bd732-90cf-a724-4e88-e09fb6dbe8ec\"}, \"timestamp\": 1766174429621.283}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:5|5|graph:69cbdecc-9cf8-fa7e-823c-aae62fe195f1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174429655.768}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174429655.893}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:5|5|graph:69cbdecc-9cf8-fa7e-823c-aae62fe195f1\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:5|5|graph:69cbdecc-9cf8-fa7e-823c-aae62fe195f1\"}, \"timestamp\": 1766174429655.948}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:5|5|graph:69cbdecc-9cf8-fa7e-823c-aae62fe195f1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174429655.992}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174429656.2878}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\"}, \"timestamp\": 1766174429656.384}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174429656.4531}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"count\": 0}, \"timestamp\": 1766174429656.6929}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174429656.744}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"snapshot_sources\": 1}, \"timestamp\": 1766174429656.7832}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:5|5|graph:69cbdecc-9cf8-fa7e-823c-aae62fe195f1\"}, \"timestamp\": 1766174429656.8232}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:6|6|graph:20ec0a9a-919e-9540-a26a-8ff27bac33cd\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174429692.31}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174429692.446}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:6|6|graph:20ec0a9a-919e-9540-a26a-8ff27bac33cd\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:6|6|graph:20ec0a9a-919e-9540-a26a-8ff27bac33cd\"}, \"timestamp\": 1766174429692.503}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:6|6|graph:20ec0a9a-919e-9540-a26a-8ff27bac33cd\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174429692.55}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174429692.8708}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\"}, \"timestamp\": 1766174429692.914}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174429692.982}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"count\": 0}, \"timestamp\": 1766174429693.2249}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174429693.291}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"snapshot_sources\": 1}, \"timestamp\": 1766174429693.3398}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:6|6|graph:20ec0a9a-919e-9540-a26a-8ff27bac33cd\"}, \"timestamp\": 1766174429693.389}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:7|7|graph:be9e0585-80d5-da73-9673-8ca51e0c8421\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174429729.249}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174429729.385}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:7|7|graph:be9e0585-80d5-da73-9673-8ca51e0c8421\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:7|7|graph:be9e0585-80d5-da73-9673-8ca51e0c8421\"}, \"timestamp\": 1766174429729.5251}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:7|7|graph:be9e0585-80d5-da73-9673-8ca51e0c8421\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174429729.664}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174429729.991}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\"}, \"timestamp\": 1766174429730.0378}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174429730.229}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"count\": 0}, \"timestamp\": 1766174429730.623}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174429730.746}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"snapshot_sources\": 1}, \"timestamp\": 1766174429730.818}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:7|7|graph:be9e0585-80d5-da73-9673-8ca51e0c8421\"}, \"timestamp\": 1766174429730.8691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:8|8|graph:df66acf9-5010-cc4c-7ebe-0a7a83cf50e1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174429766.706}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174429766.839}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:8|8|graph:df66acf9-5010-cc4c-7ebe-0a7a83cf50e1\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:8|8|graph:df66acf9-5010-cc4c-7ebe-0a7a83cf50e1\"}, \"timestamp\": 1766174429766.898}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:8|8|graph:df66acf9-5010-cc4c-7ebe-0a7a83cf50e1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174429766.946}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174429767.2708}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\"}, \"timestamp\": 1766174429767.3118}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174429767.375}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"count\": 0}, \"timestamp\": 1766174429767.615}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174429767.6611}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"snapshot_sources\": 1}, \"timestamp\": 1766174429767.695}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:8|8|graph:df66acf9-5010-cc4c-7ebe-0a7a83cf50e1\"}, \"timestamp\": 1766174429767.727}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:9|9|graph:7708484f-5d2a-b7d9-3060-5afa26bda913\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174429807.523}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174429807.657}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:9|9|graph:7708484f-5d2a-b7d9-3060-5afa26bda913\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:9|9|graph:7708484f-5d2a-b7d9-3060-5afa26bda913\"}, \"timestamp\": 1766174429807.7139}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:9|9|graph:7708484f-5d2a-b7d9-3060-5afa26bda913\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174429807.914}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174429808.2969}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\"}, \"timestamp\": 1766174429808.347}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174429808.419}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"count\": 0}, \"timestamp\": 1766174429808.667}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174429808.848}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"snapshot_sources\": 1}, \"timestamp\": 1766174429808.924}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:9|9|graph:7708484f-5d2a-b7d9-3060-5afa26bda913\"}, \"timestamp\": 1766174429808.9678}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:10|10|graph:2f029f09-1017-13c3-4012-21e52c3ac5fd\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174429846.15}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174429846.2861}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:10|10|graph:2f029f09-1017-13c3-4012-21e52c3ac5fd\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:10|10|graph:2f029f09-1017-13c3-4012-21e52c3ac5fd\"}, \"timestamp\": 1766174429846.456}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:10|10|graph:2f029f09-1017-13c3-4012-21e52c3ac5fd\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174429846.5369}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174429846.8853}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\"}, \"timestamp\": 1766174429847.004}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174429847.116}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"count\": 0}, \"timestamp\": 1766174429847.4119}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174429847.477}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"snapshot_sources\": 1}, \"timestamp\": 1766174429847.519}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:10|10|graph:2f029f09-1017-13c3-4012-21e52c3ac5fd\"}, \"timestamp\": 1766174429847.569}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:11|11|graph:b1024182-7c31-ecc6-d1ee-80501a3dec02\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174429883.822}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174429883.944}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:11|11|graph:b1024182-7c31-ecc6-d1ee-80501a3dec02\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:11|11|graph:b1024182-7c31-ecc6-d1ee-80501a3dec02\"}, \"timestamp\": 1766174429884.002}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:11|11|graph:b1024182-7c31-ecc6-d1ee-80501a3dec02\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174429884.048}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174429884.361}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\"}, \"timestamp\": 1766174429884.403}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174429884.468}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"count\": 0}, \"timestamp\": 1766174429884.713}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174429884.762}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"snapshot_sources\": 1}, \"timestamp\": 1766174429884.8}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:11|11|graph:b1024182-7c31-ecc6-d1ee-80501a3dec02\"}, \"timestamp\": 1766174429884.8362}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:12|12|graph:2279a146-adaf-a1c5-d349-a03b2576fe2b\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174429919.767}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174429919.894}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:12|12|graph:2279a146-adaf-a1c5-d349-a03b2576fe2b\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:12|12|graph:2279a146-adaf-a1c5-d349-a03b2576fe2b\"}, \"timestamp\": 1766174429919.949}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:12|12|graph:2279a146-adaf-a1c5-d349-a03b2576fe2b\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174429920.017}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174429920.369}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\"}, \"timestamp\": 1766174429920.418}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174429920.5088}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"count\": 0}, \"timestamp\": 1766174429920.82}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174429920.9111}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"snapshot_sources\": 1}, \"timestamp\": 1766174429920.9631}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:12|12|graph:2279a146-adaf-a1c5-d349-a03b2576fe2b\"}, \"timestamp\": 1766174429921.011}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:3|3|graph:68148096-de56-c8c3-87cb-f17dac8feadb\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174442892.742}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174442892.8772}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:3|3|graph:68148096-de56-c8c3-87cb-f17dac8feadb\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:3|3|graph:68148096-de56-c8c3-87cb-f17dac8feadb\"}, \"timestamp\": 1766174442892.9392}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:3|3|graph:68148096-de56-c8c3-87cb-f17dac8feadb\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174442893.002}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd155-e5f7-6128-8000-44e882f7d79c\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:3|3|graph:68148096-de56-c8c3-87cb-f17dac8feadb\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd155-e5f6-69e4-bfff-5efaa1892c0f\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:3|3|graph:68148096-de56-c8c3-87cb-f17dac8feadb\"}]}, \"timestamp\": 1766174442893.62}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd155-e5f7-6128-8000-44e882f7d79c\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:3|3|graph:68148096-de56-c8c3-87cb-f17dac8feadb\"}, \"timestamp\": 1766174442893.708}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd155-e5f7-6128-8000-44e882f7d79c\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766174442894.425}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"has_progress\": true}, \"timestamp\": 1766174442894.6108}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"original_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:13\", \"new_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:13\"}, \"timestamp\": 1766174442989.284}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:13\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\"}, \"timestamp\": 1766174442989.412}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:e0557246\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174442989.792}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174442989.86}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174442989.934}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174442989.987}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174442990.0352}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"count\": 0}, \"timestamp\": 1766174442990.298}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174442990.3691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174442990.4128}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"snapshot_sources\": 3}, \"timestamp\": 1766174442990.451}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f|worker:13\"}, \"timestamp\": 1766174442990.4832}\n\n\nFAILED tests/e2e_tests/business_agents/travel_guide_agent/test_travel_guide_agent.py::TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution[moscow-easy-benchmark-1200] - langgraph.errors.EmptyInputError: Received no input for __start__\nDuring task with name 'graph' and id '4e52906e-6afc-9252-bde9-f7b36be5d2d9'\nDuring task with name 'worker' and id '65a362b4-3641-4a4e-84cb-285d0c71c940'\nDuring task with name 'wide_funnel_workers' and id '26d7f130-6c94-658a-9b01-bf0255cdcfc8'\nDuring task with name 'wide_funnel' and id 'fa08803d-f46d-830a-032d-5f418fc0c474'\nFAILED tests/e2e_tests/business_agents/travel_guide_agent/test_travel_guide_agent.py::TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution[rosa-distribution-medium-benchmark-1200] - langgraph.errors.EmptyInputError: Received no input for __start__\nDuring task with name 'graph' and id '68148096-de56-c8c3-87cb-f17dac8feadb'\nDuring task with name 'worker' and id '36bb5697-9d0e-16eb-b322-4bd2fa16c74f'\nDuring task with name 'wide_funnel_workers' and id '3f892d0b-4460-4d96-25b2-7061cc2e261c'\nDuring task with name 'wide_funnel' and id '7f71dcea-a390-e51a-e1b9-fa7e1b8bcb2f'"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3833-df2c-7df0-af5d-11c5c85b60a2",
    "content": "**\u041e\u0448\u0438\u0431\u043a\u0430 `EmptyInputError` \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442\u0441\u044f, \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u0432\u0430\u0448\u0430 \u043b\u043e\u0433\u0438\u043a\u0430 \u0432 `memory_manager.py` \u0432\u0441\u0451 \u0435\u0449\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442 `graph_input=None` \u0432 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f\u0445, \u043a\u043e\u0433\u0434\u0430 LangGraph \u0441\u0447\u0438\u0442\u0430\u0435\u0442, \u0447\u0442\u043e \u043e\u043d \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u043d\u0430 \u0443\u0437\u043b\u0435 `__start__`.**\n\n\u0410\u043d\u0430\u043b\u0438\u0437 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 \u043b\u043e\u0433\u043e\u0432 `DEBUG` \u0438 \u0432\u0430\u0448\u0435\u0433\u043e `CODE` \u0432\u044b\u044f\u0432\u0438\u043b \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043d\u0435\u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435 \u043c\u0435\u0436\u0434\u0443 \u0442\u0435\u043c, \u0447\u0442\u043e \u0432\u0438\u0434\u0438\u0442 \u0432\u0430\u0448 \u00ab\u0437\u043e\u043d\u0434\u00bb, \u0438 \u0442\u0435\u043c, \u043a\u0430\u043a \u0440\u0435\u0430\u0433\u0438\u0440\u0443\u0435\u0442 `AsyncPregelLoop`.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 `has_progress: true` \u043d\u0435 \u0441\u043f\u0430\u0441\u0430\u0435\u0442 \u043e\u0442 \u043e\u0448\u0438\u0431\u043a\u0438:\n\n\u0412 \u043b\u043e\u0433\u0430\u0445 \u0434\u043b\u044f `worker=3` \u043c\u044b \u0432\u0438\u0434\u0438\u043c:\n-   `next_nodes: [\"agent\"]` (\u043a\u0430\u0437\u0430\u043b\u043e\u0441\u044c \u0431\u044b, \u043c\u044b \u0443\u0436\u0435 \u043f\u0440\u043e\u0448\u043b\u0438 \u0441\u0442\u0430\u0440\u0442).\n-   `has_progress: true`.\n-   **\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0435:** \u0412\u044b\u0437\u043e\u0432 `ainvoke_with_durability(..., graph_input=None, ...)`.\n-   **\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442:** `EmptyInputError: Received no input for __start__`.\n\n**\u041f\u0440\u0438\u0447\u0438\u043d\u0430:** \u0412 \u0441\u043b\u043e\u0436\u043d\u044b\u0445 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u044f\u0445 (`Graph 1-2-3-4`) LangGraph \u043c\u043e\u0436\u0435\u0442 \u0441\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043d\u0430 `__start__`, \u0435\u0441\u043b\u0438 \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0438\u0442, \u0447\u0442\u043e \u0442\u0435\u043a\u0443\u0449\u0430\u044f \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, `checkpoint_ns`) \u0438\u0437\u043c\u0435\u043d\u0438\u043b\u0430\u0441\u044c \u0438\u043b\u0438 \u043d\u0435 \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u043e\u0439. \u0412 \u044d\u0442\u043e\u0442 \u043c\u043e\u043c\u0435\u043d\u0442 \u0432\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0435 `None`, \u0438 \u0433\u0440\u0430\u0444 \u00ab\u0437\u0430\u0434\u044b\u0445\u0430\u0435\u0442\u0441\u044f\u00bb \u0431\u0435\u0437 \u0432\u0445\u043e\u0434\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u0434\u043b\u044f \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u043a\u0430\u043d\u0430\u043b\u043e\u0432.\n\n### \u041a\u0430\u043a \u044d\u0442\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043e\u043a\u043e\u043d\u0447\u0430\u0442\u0435\u043b\u044c\u043d\u043e (\u041e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u044b\u0439 \u0444\u0438\u043a\u0441):\n\n\u0412\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043b\u043e\u0433\u0438\u043a\u0443 \u0432\u044b\u0431\u043e\u0440\u0430 `effective_input`. \u0415\u0441\u043b\u0438 \u043c\u044b \u043d\u0430\u0445\u043e\u0434\u0438\u043c\u0441\u044f \u0432 \u0440\u0435\u0436\u0438\u043c\u0435 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f, \u043d\u043e \u0433\u0440\u0430\u0444 \u0441\u0442\u043e\u0438\u0442 \u043d\u0430 \u00ab\u043f\u043e\u0440\u043e\u0433\u0435\u00bb (`__start__`), \u043c\u044b **\u043e\u0431\u044f\u0437\u0430\u043d\u044b** \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0435\u043c\u0443 `graph_input`. \u0415\u0441\u043b\u0438 \u0436\u0435 \u043c\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0432 \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u0435 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 (\u0443\u0437\u0435\u043b `agent`), \u043c\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u043c `None`.\n\n**\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u0435 \u0431\u043b\u043e\u043a \u0432 `memory_manager.py` (\u043c\u0435\u0442\u043e\u0434 `ainvoke_from_checkpoint`):**\n\n```python\nif isinstance(next_nodes, Sequence) and next_nodes:\n    next_nodes_list = list(next_nodes)\n    has_progress = isinstance(values, Mapping) and self._has_meaningful_values(values)\n\n    if has_progress:\n        # \u041e\u0420\u0413\u0410\u041d\u0418\u0427\u041d\u042b\u0419 \u0424\u0418\u041a\u0421:\n        # \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c, \u043d\u0435 \u0441\u0442\u043e\u0438\u043c \u043b\u0438 \u043c\u044b \u043d\u0430 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u043c \u0441\u0442\u0430\u0440\u0442\u0435.\n        is_at_start = next_nodes_list == [\"__start__\"]\n        \n        # \u0415\u0441\u043b\u0438 \u043c\u044b \u043d\u0430 \u0441\u0442\u0430\u0440\u0442\u0435, \u043d\u0430\u043c \u041d\u0423\u0416\u0415\u041d \u0432\u0432\u043e\u0434 (graph_input). \n        # \u0415\u0441\u043b\u0438 \u043c\u044b \u0443\u0436\u0435 \u043d\u0430 \u0440\u0430\u0431\u043e\u0447\u0435\u043c \u0443\u0437\u043b\u0435 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, 'agent'), \u0448\u043b\u0435\u043c None \u0434\u043b\u044f Resume.\n        effective_resume_input = graph_input if is_at_start else None\n\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=effective_resume_input, # <-- \u0422\u0435\u043f\u0435\u0440\u044c \u0437\u0434\u0435\u0441\u044c \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 None \u0434\u043b\u044f \u0441\u0442\u0430\u0440\u0442\u0430\n            config=cfg,\n            context=context,\n            durability=durability,\n            local_checkpointer=effective_local_checkpointer,\n        )\n    else:\n        # \u0420\u0435\u0436\u0438\u043c Rerun (\u0435\u0441\u043b\u0438 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430 \u043d\u0435\u0442 \u0441\u043e\u0432\u0441\u0435\u043c)\n        rerun_cfg_pending = dict(merged)\n        # ... \u0441\u0431\u0440\u043e\u0441 checkpoint_id \u0438 \u0437\u0430\u043f\u0443\u0441\u043a \u0441 graph_input ...\n```\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0441\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442:\n\n1.  **\u0414\u043b\u044f \u043e\u0431\u044b\u0447\u043d\u043e\u0433\u043e Resume:** \u0415\u0441\u043b\u0438 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0443\u043f\u0430\u043b \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 \u0442\u0435\u043a\u0441\u0442\u0430, `next_nodes` \u0431\u0443\u0434\u0435\u0442 `[\"agent\"]`. \u0421\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 `effective_resume_input = None`, \u0438 LangGraph \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442 \u0440\u0430\u0431\u043e\u0442\u0443 \u0438\u0437 \u0441\u0442\u0435\u0439\u0442\u0430.\n2.  **\u0414\u043b\u044f \"\u0421\u0442\u0430\u0440\u0442\u043e\u0432\u043e\u0433\u043e\" \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f:** \u0415\u0441\u043b\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u043d\u0430\u0439\u0434\u0435\u043d, \u043d\u043e \u0433\u0440\u0430\u0444 \u0441\u0442\u043e\u0438\u0442 \u043d\u0430 `__start__` (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043f\u043e\u0441\u043b\u0435 `update_state` \u043f\u0440\u0438 \u0434\u043e\u0443\u0447\u0438\u0432\u0430\u043d\u0438\u0438), \u043c\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0434\u0438\u043c `graph_input`. \u042d\u0442\u043e \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0433\u0440\u0430\u0444 \u0434\u0430\u043d\u043d\u044b\u043c\u0438, \u0438 \u043e\u043d \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043f\u0435\u0440\u0435\u0439\u0434\u0435\u0442 \u043a \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u043c\u0443 \u0443\u0437\u043b\u0443.\n3.  **\u0418\u0437\u043e\u043b\u044f\u0446\u0438\u044f:** \u041f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 `graph_input` \u0432\u043c\u0435\u0441\u0442\u0435 \u0441 `checkpoint_id` \u043d\u0435 \u0441\u043e\u0437\u0434\u0430\u0441\u0442 \u043a\u043e\u043d\u0444\u043b\u0438\u043a\u0442\u0430 \u2014 LangGraph \u043f\u0440\u043e\u0441\u0442\u043e \u043e\u0431\u043d\u043e\u0432\u0438\u0442 \u0441\u0442\u0435\u0439\u0442 \u044d\u0442\u0438\u043c\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\u043c\u0438 \u043f\u0435\u0440\u0435\u0434 \u0437\u0430\u043f\u0443\u0441\u043a\u043e\u043c.\n\n**\u0412\u0430\u0436\u043d\u043e:** \u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e \u0432 \u043c\u0435\u0442\u043e\u0434\u0435 `_has_meaningful_values` \u0432\u044b \u0442\u0430\u043a\u0436\u0435 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442\u0435 `messages`. \u0415\u0441\u043b\u0438 \u0432 \u0441\u043f\u0438\u0441\u043a\u0435 \u0431\u043e\u043b\u044c\u0448\u0435 2 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u2014 \u044d\u0442\u043e \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043d\u0443\u0436\u043d\u043e \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0442\u044c, \u0430 \u043d\u0435 \u0441\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0442\u044c.\n\n**Relevant docs:**\n- [Time Travel: Resume from Checkpoint](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)\n- [Persistence and State Values](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)\n- [LangGraph Errors: EmptyInputError](https://docs.langchain.com/langsmith/use-threads#empty-thread)"
  },
  {
    "role": "user",
    "id": "37031c60-b003-4784-a470-cbec76b12b52",
    "content": "\u0423\u0432\u0435\u0440\u0435\u043d ? "
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3835-37be-73e3-baa7-b975c7da4703",
    "content": "**\u0414\u0430, \u044f \u0443\u0432\u0435\u0440\u0435\u043d.** \u041e\u0448\u0438\u0431\u043a\u0430 `EmptyInputError: Received no input for __start__` \u043f\u0440\u0438 \u043d\u0430\u043b\u0438\u0447\u0438\u0438 `next_nodes: [\"agent\"]` \u0432 \u043b\u043e\u0433\u0430\u0445 \u2014 \u044d\u0442\u043e \u043a\u043b\u0430\u0441\u0441\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u043f\u0440\u0438\u0437\u043d\u0430\u043a **\u00ab\u0440\u0430\u0437\u0440\u044b\u0432\u0430 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438\u00bb** \u0432 LangGraph, \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u043d\u044b\u0439 \u0434\u043b\u044f \u0441\u043b\u043e\u0436\u043d\u044b\u0445 \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0445 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440.\n\n\u0412\u043e\u0442 \u043f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0438 \u043f\u043e\u0447\u0435\u043c\u0443 \u043c\u043e\u0439 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u0441\u043e\u0432\u0435\u0442 \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u043e\u0434\u043d\u043e\u0433\u043e \u0432\u0430\u0436\u043d\u043e\u0433\u043e \u0443\u0442\u043e\u0447\u043d\u0435\u043d\u0438\u044f:\n\n### \u0421\u0443\u0442\u044c \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b: \"The First Tick Paradox\"\n\n\u041a\u043e\u0433\u0434\u0430 \u0432\u044b \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0435 `ainvoke(None, config={\"configurable\": {\"checkpoint_id\": \"...\"}})`:\n1.  LangGraph \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435.\n2.  \u041e\u043d \u0432\u0438\u0434\u0438\u0442, \u0447\u0442\u043e \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0443\u0437\u0435\u043b \u2014 `agent`.\n3.  **\u041d\u041e**, \u0435\u0441\u043b\u0438 \u044d\u0442\u043e\u0442 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0431\u044b\u043b \u0441\u043e\u0437\u0434\u0430\u043d \u00ab\u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u00bb (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043f\u0440\u0438 \u0432\u0445\u043e\u0434\u0435 \u0432 \u043f\u043e\u0434\u0433\u0440\u0430\u0444) \u0438 \u0443\u0437\u0435\u043b `__start__` \u0435\u0449\u0435 \u043d\u0435 \u0443\u0441\u043f\u0435\u043b \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0438 \u043f\u0435\u0440\u0435\u043b\u043e\u0436\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 \u0432\u0430\u0448\u0435\u0433\u043e `input` \u0432 \u043a\u0430\u043d\u0430\u043b\u044b \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f (\u0441\u0442\u0435\u0439\u0442), \u0442\u043e \u043f\u0440\u0438 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 \u0441 `None` \u0433\u0440\u0430\u0444 \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0438\u0432\u0430\u0435\u0442 **\u043f\u0443\u0441\u0442\u044b\u0435 \u043a\u0430\u043d\u0430\u043b\u044b**.\n4.  Pregel-\u0446\u0438\u043a\u043b LangGraph \u043f\u0430\u0434\u0430\u0435\u0442, \u0442\u0430\u043a \u043a\u0430\u043a \u0434\u043b\u044f \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0443\u0437\u043b\u0430 `agent` \u0435\u043c\u0443 \u043d\u0443\u0436\u043d\u044b \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u043a\u0430\u043d\u0430\u043b\u0430\u0445, \u0430 \u0438\u0445 \u0442\u0430\u043c \u043d\u0435\u0442, \u0438 \u043d\u043e\u0432\u044b\u0439 \u0432\u0432\u043e\u0434 \u0432\u044b \u043d\u0435 \u0434\u0430\u043b\u0438.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0432 \u0432\u0430\u0448\u0435\u0439 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0435?\n\u0412 \u0446\u0435\u043f\u043e\u0447\u043a\u0435 `graph1 -> graph2 -> graph3 -> graph4` (Assistant) \u043f\u0435\u0440\u0435\u0445\u043e\u0434 \u043c\u0435\u0436\u0434\u0443 3 \u0438 4 \u0433\u0440\u0430\u0444\u043e\u043c \u0447\u0430\u0441\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0447\u0435\u0440\u0435\u0437 \u043f\u0440\u043e\u043a\u0441\u0438-\u043d\u043e\u0434\u0443. \u0415\u0441\u043b\u0438 \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u043f\u0430\u0434\u0430\u0435\u0442 \u0432 \u043c\u043e\u043c\u0435\u043d\u0442 \u044d\u0442\u043e\u0433\u043e \u00ab\u043f\u0440\u044b\u0436\u043a\u0430\u00bb, \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0434\u043b\u044f Graph 4, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0443\u0436\u0435 \u0437\u043d\u0430\u0435\u0442, \u0447\u0442\u043e \u043e\u043d \u00ab\u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u00bb, \u043d\u043e \u0435\u0433\u043e \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u044f\u044f \u043f\u0430\u043c\u044f\u0442\u044c \u0435\u0449\u0435 \u043d\u0435 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u0430 \u0432\u0430\u0448\u0438\u043c \u0441\u0442\u0430\u0440\u0442\u043e\u0432\u044b\u043c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435\u043c.\n\n---\n\n### \u041e\u043a\u043e\u043d\u0447\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u0438 \u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u0432 `memory_manager.py`:\n\n\u0412\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043b\u043e\u0433\u0438\u043a\u0443 \u0432 \u043c\u0435\u0442\u043e\u0434\u0435 `ainvoke_from_checkpoint` \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b \u0432\u0432\u043e\u0434 (`graph_input`) \u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u043b\u0441\u044f **\u0432\u0441\u0435\u0433\u0434\u0430**, \u0435\u0441\u043b\u0438 \u043c\u044b \u043d\u0430\u0445\u043e\u0434\u0438\u043c\u0441\u044f \u043d\u0430 \u044d\u0442\u0430\u043f\u0435 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438, \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 `checkpoint_id` \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442. LangGraph \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u0443\u043c\u0435\u043d, \u0447\u0442\u043e\u0431\u044b \u0441\u043c\u0435\u0440\u0434\u0436\u0438\u0442\u044c \u044d\u0442\u043e\u0442 \u0432\u0432\u043e\u0434 \u0441 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u043c \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u043e\u043c.\n\n**\u0418\u0441\u043f\u0440\u0430\u0432\u044c\u0442\u0435 \u0431\u043b\u043e\u043a \u043f\u0440\u0438\u043d\u044f\u0442\u0438\u044f \u0440\u0435\u0448\u0435\u043d\u0438\u044f (~\u043b\u0438\u043d\u0438\u044f 510):**\n\n```python\nif isinstance(next_nodes, Sequence) and next_nodes:\n    next_nodes_list = list(next_nodes)\n    # \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \u0432\u0430\u0448\u0443 \u043d\u043e\u0432\u0443\u044e \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430\n    has_progress = isinstance(values, Mapping) and self._has_meaningful_values(values)\n\n    # \u041a\u041b\u042e\u0427\u0415\u0412\u041e\u0419 \u0424\u0418\u041a\u0421:\n    # \u041c\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u043c None (\u0447\u0438\u0441\u0442\u043e\u0435 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435) \u0422\u041e\u041b\u042c\u041a\u041e \u0435\u0441\u043b\u0438 \u0433\u0440\u0430\u0444 \u0423\u0416\u0415 \u0443\u0448\u0435\u043b \n    # \u0434\u0430\u043b\u044c\u0448\u0435 \u0441\u0442\u0430\u0440\u0442\u043e\u0432\u043e\u0439 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0438 \u0438\u043c\u0435\u0435\u0442 \u0440\u0435\u0430\u043b\u044c\u043d\u044b\u0439 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441.\n    # \u0415\u0441\u043b\u0438 \u043c\u044b \u0441\u0442\u043e\u0438\u043c \u043d\u0430 __start__ \u0418\u041b\u0418 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430 \u043c\u0430\u043b\u043e \u2014 \u0448\u043b\u0435\u043c \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0432\u0432\u043e\u0434.\n    \n    is_at_very_beginning = (next_nodes_list == [\"__start__\"]) or (not has_progress)\n    \n    effective_input = None if (has_progress and not is_at_very_beginning) else graph_input\n\n    # #region log hypothesis K (\u0414\u043b\u044f \u0432\u0435\u0440\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438)\n    import json as _json_k\n    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n        f.write(_json_k.dumps({\n            \"sessionId\": \"debug-session\",\n            \"hypothesisId\": \"K\",\n            \"message\": \"executing invoke with calculated input\",\n            \"data\": {\n                \"graph_id\": graph_id,\n                \"is_at_start\": is_at_very_beginning,\n                \"input_is_none\": effective_input is None,\n                \"checkpoint_id\": checkpoint_id\n            }\n        }) + \"\\n\")\n    # #endregion\n\n    return await self.ainvoke_with_durability(\n        graph=graph,\n        graph_input=effective_input, # \u0422\u0435\u043f\u0435\u0440\u044c \u0437\u0434\u0435\u0441\u044c \u0431\u0443\u0434\u0435\u0442 graph_input \u0434\u043b\u044f \"\u043f\u0443\u0441\u0442\u044b\u0445\" \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u043e\u0432\n        config=cfg,\n        context=context,\n        durability=durability,\n        local_checkpointer=effective_local_checkpointer,\n    )\n```\n\n### \u0427\u0442\u043e \u044d\u0442\u043e \u0434\u0430\u0441\u0442:\n1.  **\u0415\u0441\u043b\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u00ab\u0436\u0438\u0432\u043e\u0439\u00bb (\u0441 \u0438\u0441\u0442\u043e\u0440\u0438\u0435\u0439):** `effective_input` \u0431\u0443\u0434\u0435\u0442 `None`, \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442 \u0441 \u0442\u043e\u0433\u043e \u0436\u0435 \u043c\u0435\u0441\u0442\u0430.\n2.  **\u0415\u0441\u043b\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u00ab\u0437\u043e\u043c\u0431\u0438\u00bb (\u0441\u043e\u0437\u0434\u0430\u043d, \u043d\u043e \u043f\u0443\u0441\u0442):** `effective_input` \u0431\u0443\u0434\u0435\u0442 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0432\u0430\u0448 `graph_input`. LangGraph \u043f\u043e\u043b\u0443\u0447\u0438\u0442 \u0434\u0430\u043d\u043d\u044b\u0435, \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u0442 `__start__` \u0438 \u043e\u0448\u0438\u0431\u043a\u0430 `EmptyInputError` \u0438\u0441\u0447\u0435\u0437\u043d\u0435\u0442.\n3.  **\u0411\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c:** \u0412\u044b \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u043f\u043e\u043b\u0430\u0433\u0430\u0435\u0442\u0435\u0441\u044c \u043d\u0430 \u0442\u043e, \u0443\u0441\u043f\u0435\u043b \u043b\u0438 `InMemorySaver` \u0437\u0430\u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u0438. \u0412\u044b \u043f\u0440\u043e\u0441\u0442\u043e \u0434\u0430\u0435\u0442\u0435 \u0433\u0440\u0430\u0444\u0443 \u0442\u043e, \u0447\u0442\u043e \u0435\u043c\u0443 \u043d\u0443\u0436\u043d\u043e \u0434\u043b\u044f \u0441\u0442\u0430\u0440\u0442\u0430.\n\n**\u0412\u0430\u0436\u043d\u043e:** \u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e `_has_meaningful_values` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 `True`, \u0435\u0441\u043b\u0438 `len(messages) > 2`. \u042d\u0442\u043e \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442, \u0447\u0442\u043e \u043c\u044b \u043d\u0435 \u0431\u0443\u0434\u0435\u043c \u0437\u0430\u043d\u043e\u0432\u043e \u0441\u043b\u0430\u0442\u044c `graph_input` (\u0438 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f), \u0435\u0441\u043b\u0438 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0443\u0436\u0435 \u043d\u0430\u0447\u0430\u043b \u043e\u0442\u0432\u0435\u0447\u0430\u0442\u044c.\n\n**Relevant docs:**\n- [Time Travel: Resume from Checkpoint](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)\n- [Persistence and State Values](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)\n- [LangGraph Errors: EmptyInputError](https://docs.langchain.com/langsmith/use-threads#empty-thread)"
  },
  {
    "role": "user",
    "id": "6f5ff68e-7c4f-44ec-9eb1-588a2161edb2",
    "content": "\u0422\u0430\u043a ? \nfrom __future__ import annotations\n\nimport uuid\nimport os\nfrom datetime import datetime\nfrom typing import Any, Mapping, MutableMapping, Optional, Sequence, TypeAlias, Protocol, runtime_checkable, cast\n\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom langchain.embeddings import init_embeddings\nfrom shared.project_settings import ProjectSettings\n\ntry:\n    from pydantic_core import core_schema\nexcept ImportError:\n    core_schema = None  # type: ignore\n\ntry:\n    from langgraph.store.memory import InMemoryStore  # type: ignore\nexcept Exception:  # pragma: no cover\n    InMemoryStore = None  # type: ignore\n\n_CHECKPOINTER_SYNC: Optional[Any] = None\n_CHECKPOINTER_ASYNC: Optional[Any] = None\n_STORE: Optional[Any] = None\n\nThreadId: TypeAlias = str\nGraphId: TypeAlias = str\nCheckpointId: TypeAlias = str\nStateDict: TypeAlias = MutableMapping[str, Any]\n\n\n@runtime_checkable\nclass _SupportsGraphCheckpoint(Protocol):\n    \"\"\"Minimal protocol describing compiled LangGraph runnables we inspect for durability support.\"\"\"\n\n    checkpointer: Any | None\n    _pregel: Any | None\n    app: Any | None\n    name: str\n\n\nGraphRunnableWithPregel: TypeAlias = _SupportsGraphCheckpoint\n\n\ndef _extract_graph_checkpointer(graph: Any) -> Any:\n    \"\"\"Return the checkpointer bound directly to a compiled runnable, if any.\"\"\"\n\n    if graph is None:\n        return None\n\n    candidate = getattr(graph, \"checkpointer\", None)\n    if candidate is not None:\n        return candidate\n\n    pregel = getattr(graph, \"_pregel\", None)\n    if pregel is not None:\n        inner = getattr(pregel, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    app = getattr(graph, \"app\", None)\n    if app is not None:\n        inner = getattr(app, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    loop = getattr(graph, \"_loop\", None)\n    if loop is not None:\n        inner = getattr(loop, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    return None\n\n\ndef _graph_supports_durability(graph: Any) -> bool:\n    \"\"\"Return True if the runnable was compiled with a checkpointer.\"\"\"\n\n    return _extract_graph_checkpointer(graph) is not None\n\n\ndef _resolve_local_checkpointer(graph: Any, override: Optional[Any]) -> Optional[Any]:\n    \"\"\"Prefer explicit override, otherwise inspect the runnable for a bound saver.\"\"\"\n\n    if override is not None:\n        return override\n    return _extract_graph_checkpointer(graph)\n\n\ndef resolve_graph_checkpointer(*, async_mode: bool) -> Any:\n    \"\"\"Return a checkpointer compatible with the chosen execution mode.\n\n    Important:\n    - Async LangGraph execution expects async checkpointer methods. If only a\n      sync checkpointer is available (e.g., SqliteSaver), we fall back to the\n      async-safe InMemorySaver to keep `.ainvoke()` reliable.\n    - Production deployments can replace this with an async-capable durable\n      backend (Postgres/SQLite async) without touching graph code.\n    \"\"\"\n\n    global _CHECKPOINTER_SYNC, _CHECKPOINTER_ASYNC\n    CHECKPOINTER_DATABASE_URL = os.getenv(\"CHECKPOINTER_DATABASE_URL\")\n\n    # In production, LangGraph Platform injects the checkpointer automatically.\n    # We keep local checkpointers disabled to avoid shadowing the platform backend.\n    if ProjectSettings().mode == \"production\":\n        return None\n\n\n    if async_mode:\n        if _CHECKPOINTER_ASYNC is None:\n            _CHECKPOINTER_ASYNC = InMemorySaver()\n        return _CHECKPOINTER_ASYNC\n\n    if _CHECKPOINTER_SYNC is None:\n        _CHECKPOINTER_SYNC =  InMemorySaver()\n    return _CHECKPOINTER_SYNC\n\n\ndef resolve_graph_store() -> Any:\n    \"\"\"Return a store implementation for dev/tests; None in production/platform.\n\n    In production, LangGraph Platform injects the store automatically at runtime\n    (via ToolRuntime). We keep local stores disabled to avoid shadowing the\n    platform backend.\n    \"\"\"\n\n    global _STORE\n    if ProjectSettings().mode == \"production\":\n        return None\n    if InMemoryStore is None:\n        return None\n    if _STORE is not None:\n        return _STORE\n\n    # In development/tests we prefer an in-process store. Vector indexing is optional;\n    # if embeddings cannot be initialised (missing deps/keys), fall back to a plain store.\n    try:\n        _STORE = InMemoryStore(\n            index={\n                \"embed\": init_embeddings(\"openai:text-embedding-3-small\"),\n                \"dims\": 1536,\n                \"fields\": [\"content\"],\n            }\n        )\n    except Exception:\n        _STORE = InMemoryStore(index=None)\n    return _STORE\n\n\nclass GraphMemoryRuntime:\n    \"\"\"Encapsulates durable-checkpoint + long-memory access for dev and platform production.\n\n    This class centralizes:\n    - thread_id extraction\n    - platform SDK fallback for checkpoint state/history (no local checkpointer needed)\n    - local (dev) graph/checkpointer checkpoint inspection\n    \"\"\"\n    THREAD_ID_KEY: str = \"thread_id\"\n\n    @classmethod\n    def __get_pydantic_core_schema__(\n        cls,\n        source_type: Any,\n        handler: Any,\n    ) -> Any:\n        \"\"\"Provide Pydantic schema for GraphMemoryRuntime to allow arbitrary types.\n\n        This enables GraphMemoryRuntime to be used in Pydantic models (e.g., when\n        ContextTravelGuideAgent is used as context_schema in StateGraph).\n        \n        Since GraphMemoryRuntime is a runtime helper (not meant for serialization),\n        we use any_schema() to allow it without validation.\n        \"\"\"\n        if core_schema is None:\n            # pydantic_core should always be available in this project\n            raise ImportError(\"pydantic_core is required but not available\")\n        \n        # Use any_schema() to allow GraphMemoryRuntime without validation\n        # This is appropriate since it's a runtime helper with init=False\n        return core_schema.any_schema()\n\n    def __init__(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        # These are intentionally mutable bindings:\n        # - Root graph wiring binds the single checkpointer/store once per process/run.\n        # - Nested graphs MUST reuse the bound instance via runtime context.\n        self.checkpointer: Optional[Any] = checkpointer\n        self.store: Optional[Any] = store\n\n    def bind(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        \"\"\"Bind durable backends onto this runtime helper.\n\n        Idempotent by design: does not overwrite existing non-null bindings unless\n        explicitly provided.\n        \"\"\"\n\n        if checkpointer is not None:\n            self.checkpointer = checkpointer\n        if store is not None:\n            self.store = store\n\n    def is_production_mode(self) -> bool:\n        return ProjectSettings().mode == \"production\"\n\n    def ensure_thread_id(\n        self,\n        config: Optional[RunnableConfig],\n    ) -> tuple[RunnableConfig, ThreadId]:\n        \"\"\"Ensure ``configurable.thread_id`` exists and return ``(config, thread_id)``.\n\n        Contract (required by project checkpointing rules):\n        - One thread_id should be used for the *entire* root graph run.\n        - If caller did not provide a thread_id, we generate a new one from:\n          ``user_id`` (from RunnableConfig.configurable.user_id) + UUID4 suffix.\n        - Callers must reuse the returned config to keep the thread_id stable.\n        \"\"\"\n\n        from shared.config.long_memory import LongMemory\n\n        merged: RunnableConfig = dict(config) if config else {}\n        configurable = merged.get(\"configurable\", {})\n        if not isinstance(configurable, MutableMapping):\n            configurable = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable = dict(configurable)\n\n        existing = configurable.get(self.THREAD_ID_KEY)\n        if existing:\n            thread_id: ThreadId = str(existing)\n            configurable[self.THREAD_ID_KEY] = thread_id\n            merged[\"configurable\"] = configurable\n            return merged, thread_id\n\n        long_memory = LongMemory.from_runnable_config(merged)\n        user_id = long_memory.user_id\n        if not configurable.get(\"user_id\"):\n            configurable[\"user_id\"] = user_id\n\n        thread_id = f\"user_{user_id}_{uuid.uuid4().hex}\"\n        configurable[self.THREAD_ID_KEY] = thread_id\n        merged[\"configurable\"] = configurable\n        return merged, thread_id\n\n    async def list_thread_checkpoints(\n        self,\n        *,\n        config: RunnableConfig,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> list[Any]:\n        \"\"\"Return raw checkpoint records for the given thread config.\n\n        Notes:\n        - In production (LangGraph Platform), we fall back to the SDK thread history.\n        - In dev/tests, we prefer the provided ``local_checkpointer`` (or the default dev\n          checkpointer) to list checkpoints, because it exposes metadata (`graph_id`).\n        - As a last resort, we attempt to list state snapshots via ``graph.get_state_history``.\n        \"\"\"\n\n        thread_id = self.extract_thread_id(config)\n        if not thread_id:\n            return []\n\n        if self.is_production_mode():\n            try:\n                from langgraph_sdk import get_client  # type: ignore\n            except Exception:\n                return []\n            try:\n                client = get_client()\n                history = await client.threads.get_history(thread_id)\n                return list(history)\n            except Exception:\n                return []\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if checkpointer is not None:\n            lister = getattr(checkpointer, \"list\", None)\n            if callable(lister):\n                try:\n                    return list(lister(config))\n                except Exception:\n                    return []\n\n        if local_graph is not None:\n            getter_async = getattr(local_graph, \"aget_state_history\", None)\n            if callable(getter_async):\n                try:\n                    return [snapshot async for snapshot in getter_async(config)]\n                except Exception:\n                    return []\n            getter_sync = getattr(local_graph, \"get_state_history\", None)\n            if callable(getter_sync):\n                try:\n                    return list(getter_sync(config))\n                except Exception:\n                    return []\n\n        return []\n\n    @staticmethod\n    def _extract_checkpoint_metadata(record: Any) -> Mapping[str, Any]:\n        candidate = getattr(record, \"metadata\", None)\n        if isinstance(candidate, Mapping):\n            return cast(Mapping[str, Any], candidate)\n        if isinstance(record, Mapping):\n            meta = record.get(\"metadata\")\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            meta = getattr(checkpoint, \"metadata\", None)\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        return {}\n\n    @staticmethod\n    def _extract_checkpoint_id(record: Any) -> Optional[CheckpointId]:\n        candidate = getattr(record, \"checkpoint_id\", None)\n        if candidate:\n            return str(candidate)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            inner = getattr(checkpoint, \"checkpoint_id\", None)\n            if inner:\n                return str(inner)\n            inner = getattr(checkpoint, \"id\", None)\n            if inner:\n                return str(inner)\n        if isinstance(record, Mapping):\n            candidate = record.get(\"checkpoint_id\") or record.get(\"id\")\n            if candidate:\n                return str(candidate)\n            cfg = record.get(\"config\")\n            if isinstance(cfg, Mapping):\n                conf = cfg.get(\"configurable\")\n                if isinstance(conf, Mapping):\n                    candidate = conf.get(\"checkpoint_id\")\n                    if candidate:\n                        return str(candidate)\n        cfg = getattr(record, \"config\", None)\n        if isinstance(cfg, Mapping):\n            conf = cfg.get(\"configurable\")\n            if isinstance(conf, Mapping):\n                candidate = conf.get(\"checkpoint_id\")\n                if candidate:\n                    return str(candidate)\n        return None\n\n    @staticmethod\n    def _extract_created_at(record: Any) -> Optional[datetime]:\n        candidate = getattr(record, \"created_at\", None)\n        if isinstance(candidate, datetime):\n            return candidate\n        if isinstance(record, Mapping):\n            candidate = record.get(\"created_at\")\n            if isinstance(candidate, datetime):\n                return candidate\n        return None\n\n    @classmethod\n    def _matches_graph_id(cls, record: Any, graph_id: GraphId) -> bool:\n        metadata = cls._extract_checkpoint_metadata(record)\n        candidate = metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")\n        return str(candidate) == str(graph_id) if candidate else False\n\n    @staticmethod\n    def _extract_checkpoint_ns(record: Any) -> Optional[str]:\n        def _from_config(cfg: Any) -> Optional[str]:\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n                if isinstance(configurable, Mapping):\n                    candidate = configurable.get(\"checkpoint_ns\")\n                    if candidate is not None:\n                        return str(candidate)\n            return None\n\n        cfg = getattr(record, \"config\", None)\n        ns = _from_config(cfg)\n        if ns:\n            return ns\n\n        if isinstance(record, Mapping):\n            ns = _from_config(record.get(\"config\"))\n            if ns:\n                return ns\n\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            ns = _from_config(getattr(checkpoint, \"config\", None))\n            if ns:\n                return ns\n\n        metadata = GraphMemoryRuntime._extract_checkpoint_metadata(record)\n        checkpoint_ns = metadata.get(\"checkpoint_ns\")\n        return str(checkpoint_ns) if checkpoint_ns is not None else None\n\n    @staticmethod\n    def _normalize_config_like(config_like: Any) -> Optional[RunnableConfig]:\n        if config_like is None:\n            return None\n        if isinstance(config_like, Mapping):\n            normalized = dict(config_like)\n        else:\n            normalized = None\n            for attr in (\"model_dump\", \"dict\"):\n                dumper = getattr(config_like, attr, None)\n                if callable(dumper):\n                    try:\n                        normalized = dumper()\n                        break\n                    except Exception:\n                        normalized = None\n            if normalized is None:\n                try:\n                    normalized = dict(config_like)  # type: ignore[arg-type]\n                except Exception:\n                    return None\n\n        configurable = normalized.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            configurable = dict(configurable) if configurable is not None else {}\n        normalized[\"configurable\"] = dict(configurable)\n\n        metadata = normalized.get(\"metadata\", {})\n        if not isinstance(metadata, Mapping):\n            metadata = dict(metadata) if metadata is not None else {}\n        normalized[\"metadata\"] = dict(metadata)\n        return normalized  # type: ignore[return-value]\n\n    @classmethod\n    def _extract_task_entries(cls, record: Any) -> list[Mapping[str, Any]]:\n        extracted: list[Mapping[str, Any]] = []\n        visited_snapshots: set[int] = set()\n\n        def _coerce_metadata(value: Any) -> Optional[Mapping[str, Any]]:\n            if value is None:\n                return None\n            if isinstance(value, Mapping):\n                return value\n            try:\n                return dict(value)\n            except Exception:\n                return None\n\n        def _as_sequence(value: Any) -> Optional[Sequence[Any]]:\n            if isinstance(value, Sequence) and not isinstance(value, (str, bytes)):\n                return value\n            return None\n\n        def _record_entry(config_like: Any, metadata_like: Any, state_like: Any) -> None:\n            normalized_config = cls._normalize_config_like(config_like)\n            normalized_metadata = _coerce_metadata(metadata_like)\n            entry: dict[str, Any] = {}\n            if normalized_config:\n                entry[\"config\"] = normalized_config\n            if normalized_metadata:\n                entry[\"metadata\"] = normalized_metadata\n            if state_like is not None:\n                entry[\"state\"] = state_like\n            if entry:\n                extracted.append(entry)\n\n        def _visit_snapshot(snapshot: Any) -> None:\n            if snapshot is None:\n                return\n            snapshot_id = id(snapshot)\n            if snapshot_id in visited_snapshots:\n                return\n            visited_snapshots.add(snapshot_id)\n\n            tasks = None\n            if isinstance(snapshot, Mapping):\n                tasks = _as_sequence(snapshot.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(snapshot, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        def _visit_task(task: Any) -> None:\n            if task is None:\n                return\n            if isinstance(task, Mapping):\n                _record_entry(task.get(\"config\"), task.get(\"metadata\"), task.get(\"state\"))\n                nested_tasks = _as_sequence(task.get(\"tasks\"))\n                if nested_tasks:\n                    for nested in nested_tasks:\n                        _visit_task(nested)\n                _visit_snapshot(task.get(\"state\"))\n                _visit_snapshot(task.get(\"result\"))\n                return\n\n            _record_entry(\n                getattr(task, \"config\", None),\n                getattr(task, \"metadata\", None),\n                getattr(task, \"state\", None),\n            )\n            _visit_snapshot(getattr(task, \"state\", None))\n            _visit_snapshot(getattr(task, \"result\", None))\n            nested_attr = _as_sequence(getattr(task, \"tasks\", None))\n            if nested_attr:\n                for nested in nested_attr:\n                    _visit_task(nested)\n\n        for source in (record, getattr(record, \"checkpoint\", None)):\n            if source is None:\n                continue\n            _visit_snapshot(source)\n            tasks = None\n            if isinstance(source, Mapping):\n                tasks = _as_sequence(source.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(source, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        return extracted\n\n    async def find_latest_checkpoint_id(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Return the latest checkpoint_id for ``graph_id`` within the given thread.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n\n        # #region agent log\n        import json\n        record_summaries: list[dict[str, str | None]] = []\n        for idx, record in enumerate(checkpoints[:3]):\n            metadata = self._extract_checkpoint_metadata(record)\n            cfg = getattr(record, \"config\", None)\n            configurable = None\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n            checkpoint_ns = None\n            if isinstance(configurable, Mapping):\n                checkpoint_ns = str(configurable.get(\"checkpoint_ns\"))\n            record_summaries.append(\n                {\n                    \"idx\": str(idx),\n                    \"meta_graph_id\": str(metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")),\n                    \"checkpoint_id\": self._extract_checkpoint_id(record),\n                    \"checkpoint_ns\": checkpoint_ns,\n                }\n            )\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"B\",\"location\":\"memory_manager.py:395\",\"message\":\"find_latest_checkpoint_id checkpoints listed\",\"data\":{\"graph_id\":graph_id,\"thread_id\":str(config.get(\"configurable\",{}).get(\"thread_id\",\"\")), \"count\":len(checkpoints),\"records\":record_summaries},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if not checkpoints:\n            return None\n\n        # Collect matches with their timestamps (if provided by the backend).\n        matches: list[tuple[Optional[datetime], Any]] = []\n        for record in checkpoints:\n            if self._matches_graph_id(record, graph_id):\n                matches.append((self._extract_created_at(record), record))\n\n        target_checkpoint_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_checkpoint_ns = str(candidate_ns)\n\n        if not matches and target_checkpoint_ns:\n            for record in checkpoints:\n                if self._extract_checkpoint_ns(record) == target_checkpoint_ns:\n                    matches.append((self._extract_created_at(record), record))\n\n        if not matches:\n            return None\n\n        # If the backend provides created_at, prefer the most recent by timestamp.\n        if any(created_at is not None for created_at, _ in matches):\n            matches.sort(\n                key=lambda item: item[0] or datetime.min,\n                reverse=True,\n            )\n            return self._extract_checkpoint_id(matches[0][1])\n\n        # Otherwise, rely on the backend list order. InMemorySaver and Platform history\n        # return newest-first, so the first matching record is the latest.\n        return self._extract_checkpoint_id(matches[0][1])\n\n    async def _load_checkpoint_record(\n        self,\n        *,\n        config: RunnableConfig,\n        checkpoint_id: CheckpointId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[Any]:\n        \"\"\"Return the checkpoint record with the specified ID.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n        for record in checkpoints:\n            record_id = self._extract_checkpoint_id(record)\n            if record_id == checkpoint_id:\n                return record\n        return None\n\n    @staticmethod\n    def _materialize_checkpoint_values(\n        base_values: Mapping[str, Any],\n        record: Optional[Any],\n        *,\n        graph_id: Optional[str] = None,\n    ) -> tuple[Mapping[str, Any], bool]:\n        \"\"\"Merge stored writes from the checkpoint record into snapshot values.\"\"\"\n\n        if record is None:\n            return base_values, False\n\n        materialized: dict[str, Any] = dict(base_values)\n        writes_found = False\n\n        checkpoint_obj = getattr(record, \"checkpoint\", record)\n        writes = getattr(checkpoint_obj, \"writes\", None)\n        if writes is None and isinstance(checkpoint_obj, Mapping):\n            writes = checkpoint_obj.get(\"writes\")\n\n        # #region agent log\n        import json as _json_checkpoint_meta\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(\n                _json_checkpoint_meta.dumps(\n                    {\n                        \"sessionId\": \"debug-session\",\n                        \"runId\": \"pre-fix\",\n                        \"hypothesisId\": \"L\",\n                        \"location\": \"memory_manager.py:321\",\n                        \"message\": \"checkpoint record summary\",\n                        \"data\": {\n                            \"graph_id\": graph_id,\n                            \"record_type\": type(checkpoint_obj).__name__,\n                            \"has_attr_writes\": hasattr(checkpoint_obj, \"writes\"),\n                            \"writes_is_sequence\": isinstance(writes, Sequence),\n                            \"writes_is_mapping\": isinstance(writes, Mapping),\n                        },\n                        \"timestamp\": __import__(\"time\").time() * 1000,\n                    }\n                )\n                + \"\\n\"\n            )\n        # #endregion\n\n        summary: list[dict[str, Any]] = []\n\n        if isinstance(writes, Sequence):\n            for idx, write_entry in enumerate(writes):\n                node_name = None\n                write_payload = None\n                if isinstance(write_entry, Mapping):\n                    node_name = write_entry.get(\"node\") or write_entry.get(\"name\")\n                    candidate = write_entry.get(\"writes\") or write_entry.get(\"values\")\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n                else:\n                    node_name = getattr(write_entry, \"node\", None) or getattr(write_entry, \"name\", None)\n                    candidate = getattr(write_entry, \"writes\", None)\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n\n                if isinstance(write_payload, Mapping):\n                    for key, value in write_payload.items():\n                        materialized.setdefault(key, value)\n                    if idx < 3:\n                        summary.append(\n                            {\n                                \"node\": str(node_name),\n                                \"keys\": list(write_payload.keys()),\n                            }\n                        )\n                    writes_found = True\n\n        # #region agent log\n        if summary:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:324\",\n                            \"message\": \"checkpoint writes merged\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"writes\": summary,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        else:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:329\",\n                            \"message\": \"checkpoint writes unavailable\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"has_writes\": isinstance(writes, Sequence),\n                                \"writes_type\": None if writes is None else type(writes).__name__,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        # #endregion\n\n        return materialized, writes_found\n\n    @staticmethod\n    def _has_meaningful_values(values: Mapping[str, Any]) -> bool:\n        \"\"\"Return True if checkpoint values contain data beyond housekeeping fields.\"\"\"\n\n        if not values:\n            return False\n        significant_keys = set(values.keys()) - {\"messages\", \"remaining_steps\", \"distribution_scope\"}\n        if significant_keys:\n            return True\n\n        messages = values.get(\"messages\")\n        if isinstance(messages, Sequence):\n            # System + user messages occupy the first two positions. Anything beyond\n            # that indicates the assistant has already produced tool calls or replies.\n            if len(messages) > 2:\n                return True\n\n        return False\n\n    async def _find_subgraph_resume_config(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        checkpoints: Sequence[Any],\n    ) -> Optional[tuple[RunnableConfig, Any]]:\n        target_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_ns = str(candidate_ns)\n\n        for record_idx, record in enumerate(checkpoints):\n            task_entries = self._extract_task_entries(record)\n            if not task_entries:\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:562\",\"message\":\"checkpoint missing task entries\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"parent_checkpoint_id\":self._extract_checkpoint_id(record)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n                continue\n            for task_idx, task in enumerate(task_entries[:2]):\n                task_metadata = task.get(\"metadata\")\n                normalized_metadata: Mapping[str, Any] = {}\n                if isinstance(task_metadata, Mapping):\n                    normalized_metadata = task_metadata\n                task_graph_id = normalized_metadata.get(\"graph_id\") or normalized_metadata.get(\"langgraph_graph_id\")\n\n                raw_config = task.get(\"config\")\n                normalized_config = self._normalize_config_like(raw_config)\n                if not normalized_config:\n                    continue\n                task_configurable = normalized_config.get(\"configurable\", {})\n                task_ns = None\n                if isinstance(task_configurable, Mapping):\n                    candidate = task_configurable.get(\"checkpoint_ns\")\n                    if candidate:\n                        task_ns = str(candidate)\n\n                ns_matches = target_ns and task_ns == target_ns\n                graph_matches = task_graph_id and str(task_graph_id) == str(graph_id)\n\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:581\",\"message\":\"task entry inspected\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"task_index\":task_idx,\"task_graph_id\":task_graph_id,\"task_ns\":task_ns},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n\n                if graph_matches or ns_matches:\n                    resume_state = task.get(\"state\")\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            json.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"D\",\n                                    \"location\": \"memory_manager.py:520\",\n                                    \"message\": \"subgraph resume config located\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"matched_ns\": task_ns,\n                                        \"matched_graph_id\": task_graph_id,\n                                        \"parent_checkpoint_id\": self._extract_checkpoint_id(record),\n                                        \"has_state\": resume_state is not None,\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return normalized_config, resume_state\n\n        return None\n\n    async def _get_graph_snapshot(\n        self,\n        *,\n        graph: Any,\n        cfg: RunnableConfig,\n        subgraphs: bool = False,\n    ) -> Any:\n        getter_async = getattr(graph, \"aget_state\", None)\n        params = {\"subgraphs\": True} if subgraphs else {}\n        try:\n            if callable(getter_async):\n                return await getter_async(cfg, **params)\n        except TypeError:\n            # Fallback for LangGraph versions that don't support subgraphs kwarg.\n            try:\n                return await getter_async(cfg)\n            except Exception:\n                pass\n        except Exception:\n            pass\n\n        getter_sync = getattr(graph, \"get_state\", None)\n        if callable(getter_sync):\n            try:\n                return getter_sync(cfg, **params)\n            except TypeError:\n                try:\n                    return getter_sync(cfg)\n                except Exception:\n                    return None\n            except Exception:\n                return None\n        return None\n\n    async def ainvoke_from_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str = \"sync\",\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph resuming from the latest checkpoint when available.\"\"\"\n\n        merged, _ = self.ensure_thread_id(config)\n        # SAFETY: Ignore any caller-supplied checkpoint_id.\n        #\n        # In this architecture, checkpoint selection is *graph_id-scoped* and managed\n        # exclusively by this runtime helper. Allowing external checkpoint_id values\n        # could cause cross-graph leakage within a shared thread_id.\n\n        merged_conf = merged.get(\"configurable\", {})\n        if isinstance(merged_conf, Mapping):\n            merged_conf_dict = dict(merged_conf)\n            merged_conf_dict.pop(\"checkpoint_id\", None)\n            original_ns = merged_conf_dict.get(\"checkpoint_ns\", \"\")\n            merged_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            merged[\"configurable\"] = merged_conf_dict\n            \n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"E\",\"location\":\"memory_manager.py:445\",\"message\":\"ainvoke_from_checkpoint setting checkpoint_ns\",\"data\":{\"graph_id\":graph_id,\"original_ns\":str(original_ns),\"new_ns\":str(merged_conf_dict.get(\"checkpoint_ns\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n        # Ensure the checkpoint records are scoping-friendly in LangGraph v1.\n        meta = merged.get(\"metadata\")\n        if not isinstance(meta, Mapping):\n            meta = {}\n        meta_dict = dict(meta)\n        meta_dict.setdefault(\"graph_id\", str(graph_id))\n        merged[\"metadata\"] = meta_dict\n\n        effective_local_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n\n        # #region agent log\n        import json\n        final_ns = merged.get(\"configurable\", {}).get(\"checkpoint_ns\", \"\")\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:458\",\"message\":\"ainvoke_from_checkpoint calling find_latest_checkpoint_id\",\"data\":{\"graph_id\":graph_id,\"checkpoint_ns\":str(final_ns),\"thread_id\":str(merged.get(\"configurable\",{}).get(\"thread_id\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=effective_local_checkpointer,\n            local_graph=graph,\n        )\n        checkpoint_record: Optional[Any] = None\n        subgraph_resume: Optional[tuple[RunnableConfig, Any]] = None\n        if checkpoint_id is None:\n            snapshot_sources: list[Any] = []\n\n            if context is not None:\n                runner = getattr(context, \"graph_runner\", None)\n                graph_runtime = getattr(runner, \"graph\", None)\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:711\",\"message\":\"parent context inspection\",\"data\":{\"graph_id\":graph_id,\"has_context\":True,\"has_runner\":runner is not None,\"has_graph\":graph_runtime is not None},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n                if graph_runtime is not None:\n                    try:\n                        parent_snapshot = await self._get_graph_snapshot(\n                            graph=graph_runtime,\n                            cfg=merged,\n                            subgraphs=True,\n                        )\n                        if parent_snapshot is not None:\n                            snapshot_sources.append(parent_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:715\",\"message\":\"parent snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":parent_snapshot is not None,\"has_tasks\":bool(getattr(parent_snapshot,\"tasks\",None)),\"has_next\":bool(getattr(parent_snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                    except Exception:\n                        parent_snapshot = None\n                else:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:724\",\"message\":\"parent snapshot skipped\",\"data\":{\"graph_id\":graph_id,\"reason\":\"graph_runner_missing\" if runner is None else \"graph_attr_missing\"},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:729\",\"message\":\"parent context absent\",\"data\":{\"graph_id\":graph_id},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n\n            root_graph = getattr(context, \"root_graph\", None) if context is not None else None\n            if root_graph is not None:\n                try:\n                    root_snapshot = await self._get_graph_snapshot(\n                        graph=root_graph,\n                        cfg=merged,\n                        subgraphs=True,\n                    )\n                    if root_snapshot is not None:\n                        snapshot_sources.append(root_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:738\",\"message\":\"root snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":root_snapshot is not None,\"has_tasks\":bool(getattr(root_snapshot,\"tasks\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                except Exception:\n                    root_snapshot = None\n\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=merged,\n                subgraphs=True,\n            )\n            if snapshot is not None:\n                snapshot_sources.append(snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:727\",\"message\":\"assistant snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":bool(getattr(snapshot,\"tasks\",None)),\"has_next\":bool(getattr(snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            checkpoints_snapshot = await self.list_thread_checkpoints(\n                config=merged,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n            snapshot_sources.extend(checkpoints_snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:734\",\"message\":\"thread checkpoints snapshot collected\",\"data\":{\"graph_id\":graph_id,\"count\":len(checkpoints_snapshot)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            subgraph_resume = await self._find_subgraph_resume_config(\n                config=merged,\n                graph_id=graph_id,\n                checkpoints=snapshot_sources,\n            )\n            if subgraph_resume is not None:\n                resume_config, _ = subgraph_resume\n                metadata = resume_config.get(\"metadata\", {})\n                if not isinstance(metadata, Mapping):\n                    metadata = dict(metadata) if metadata is not None else {}\n                metadata = dict(metadata)\n                metadata.setdefault(\"graph_id\", str(graph_id))\n                resume_config[\"metadata\"] = metadata  # type: ignore[index]\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:743\",\"message\":\"subgraph resume config missing\",\"data\":{\"graph_id\":graph_id,\"snapshot_sources\":len(snapshot_sources)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n        \n        # #region agent log\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:464\",\"message\":\"ainvoke_from_checkpoint checkpoint_id result\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":str(checkpoint_id) if checkpoint_id else None,\"checkpoint_ns\":str(final_ns)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if checkpoint_id:\n            checkpoint_record = await self._load_checkpoint_record(\n                config=merged,\n                checkpoint_id=checkpoint_id,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n\n            cfg: RunnableConfig = dict(merged)\n            configurable = cfg.get(\"configurable\", {})\n            configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n            configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n            configurable_dict[\"checkpoint_id\"] = checkpoint_id\n            cfg[\"configurable\"] = configurable_dict\n\n            # If the checkpoint represents an in-progress run (has pending `next`),\n            # we resume via `invoke(None, checkpoint_id=...)`. If the run is already\n            # complete (no pending next nodes), we \"restart\" from the persisted\n            # snapshot values as a fresh invocation. This is the required behavior\n            # for refinement: patch values \u2192 re-run from patched state.\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=cfg,\n                subgraphs=True,\n            )\n\n            # #region agent log\n            import json\n            snapshot_has_tasks = bool(getattr(snapshot, \"tasks\", None))\n            snapshot_next = getattr(snapshot, \"next\", None)\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"C\",\"location\":\"memory_manager.py:504\",\"message\":\"ainvoke_from_checkpoint snapshot inspection\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":checkpoint_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":snapshot_has_tasks,\"pending_next\":bool(snapshot_next)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            next_nodes = getattr(snapshot, \"next\", None)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(next_nodes, Sequence) and next_nodes:\n                next_nodes_list = list(next_nodes)\n                has_progress = isinstance(values, Mapping) and self._has_meaningful_values(values)\n                is_at_virtual_start = bool(next_nodes_list == [\"__start__\"])\n                effective_input = None if (has_progress and not is_at_virtual_start) else graph_input\n\n                # #region agent log\n                import json as _json_resume_next\n                next_preview = next_nodes_list[:3]\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(\n                        _json_resume_next.dumps(\n                            {\n                                \"sessionId\": \"debug-session\",\n                                \"runId\": \"pre-fix\",\n                                \"hypothesisId\": \"K\",\n                                \"location\": \"memory_manager.py:509\",\n                                \"message\": \"resuming graph from checkpoint pending next\",\n                                \"data\": {\n                                    \"graph_id\": graph_id,\n                                    \"next_nodes\": next_preview,\n                                    \"graph_input_is_none\": graph_input is None,\n                                    \"has_progress\": has_progress,\n                                    \"is_at_virtual_start\": is_at_virtual_start,\n                                    \"effective_input_is_none\": effective_input is None,\n                                },\n                                \"timestamp\": __import__(\"time\").time() * 1000,\n                            }\n                        )\n                        + \"\\n\"\n                    )\n                # #endregion\n\n                return await self.ainvoke_with_durability(\n                    graph=graph,\n                    graph_input=effective_input,\n                    config=cfg,\n                    context=context,\n                    durability=durability,\n                    local_checkpointer=effective_local_checkpointer,\n                )\n\n            # IMPORTANT:\n            # If the checkpoint is COMPLETE (no pending next nodes), we DO NOT attempt to\n            # \"restart\" the graph by invoking without checkpoint_id. In a shared thread_id\n            # architecture (multiple graphs in the same thread), dropping checkpoint_id\n            # would cause LangGraph to load the latest checkpoint for the thread+ns,\n            # which may belong to a different graph_id \u2192 cross-graph contamination.\n            #\n            # Callers that need to re-run a completed checkpoint should first \"arm\" it\n            # via `graph.update_state(..., as_node=\"__start__\")` (e.g., our refinement\n            # injection path does this), which produces a checkpoint with pending next nodes.\n            if isinstance(values, Mapping):\n                materialized_values, writes_found = self._materialize_checkpoint_values(\n                    values,\n                    checkpoint_record,\n                    graph_id=str(graph_id),\n                )\n                if writes_found or self._has_meaningful_values(materialized_values):\n                    # #region agent log\n                    import json as _json_resume\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            _json_resume.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"J\",\n                                    \"location\": \"memory_manager.py:944\",\n                                    \"message\": \"returning checkpoint values\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"keys\": list(materialized_values.keys()),\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return dict(materialized_values)\n\n                # Values are incomplete (e.g., only messages). Fallback to fresh invoke.\n                rerun_cfg: RunnableConfig = dict(merged)\n                rerun_conf = rerun_cfg.get(\"configurable\", {})\n                if isinstance(rerun_conf, Mapping):\n                    rerun_conf_dict = dict(rerun_conf)\n                    rerun_conf_dict.pop(\"checkpoint_id\", None)\n                    rerun_conf_dict.setdefault(\"checkpoint_ns\", str(final_ns))\n                    rerun_cfg[\"configurable\"] = rerun_conf_dict\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=graph_input,\n                config=rerun_cfg,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        if subgraph_resume is not None:\n            # #region agent log\n            import json\n            resume_config, resume_state = subgraph_resume\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"D\",\n                            \"location\": \"memory_manager.py:610\",\n                            \"message\": \"resuming assistant via subgraph config\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"checkpoint_ns\": resume_config.get(\"configurable\", {}).get(\"checkpoint_ns\") if isinstance(resume_config.get(\"configurable\"), Mapping) else None,\n                                \"has_state\": resume_state is not None,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n            # #endregion\n            resume_input = graph_input\n            if resume_state is not None:\n                values = getattr(resume_state, \"values\", None)\n                if isinstance(values, Mapping):\n                    resume_input = dict(values)\n                elif isinstance(resume_state, Mapping):\n                    maybe_values = resume_state.get(\"values\")\n                    if isinstance(maybe_values, Mapping):\n                        resume_input = dict(maybe_values)\n                    else:\n                        resume_input = resume_state\n                else:\n                    resume_input = resume_state\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=resume_input,\n                config=resume_config,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        # SAFETY: Never allow a caller-supplied checkpoint_id to influence execution\n        # when we are NOT explicitly resuming from a checkpoint for this graph_id.\n        #\n        # Without this, a foreign checkpoint_id (from another graph_id in the same\n        # thread) could be accidentally consumed by LangGraph, violating isolation.\n        fresh_cfg: RunnableConfig = dict(merged)\n        fresh_conf = fresh_cfg.get(\"configurable\", {})\n        if isinstance(fresh_conf, Mapping):\n            fresh_conf_dict = dict(fresh_conf)\n            fresh_conf_dict.pop(\"checkpoint_id\", None)\n            # Keep checkpoint_ns stable (LangGraph may assume the key exists).\n            fresh_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            fresh_cfg[\"configurable\"] = fresh_conf_dict\n\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=graph_input,\n            config=fresh_cfg,\n            context=context,\n            durability=durability,\n            local_checkpointer=effective_local_checkpointer,\n        )\n\n    async def append_messages_to_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        new_messages: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Append messages to the latest checkpoint for ``graph_id`` and return new checkpoint id.\n\n        This uses ``graph.update_state`` / ``graph.aupdate_state`` so reducers (e.g. `add_messages`)\n        are honored. The update is applied as a fork of the latest checkpoint for ``graph_id``.\n        \"\"\"\n\n        if not new_messages:\n            return None\n\n        merged, _ = self.ensure_thread_id(config)\n        resolved_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n        latest_checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n        \n        if not latest_checkpoint_id:\n            return None\n        \n        patch_config: RunnableConfig = dict(merged)\n        configurable = patch_config.get(\"configurable\", {})\n        configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n        configurable_dict[\"checkpoint_id\"] = latest_checkpoint_id\n        patch_config[\"configurable\"] = configurable_dict\n\n        # Ensure patched checkpoints remain discoverable by metadata scoping.\n        metadata = patch_config.get(\"metadata\")\n        if not isinstance(metadata, Mapping):\n            metadata = {}\n        metadata_dict = dict[str, Any](metadata)\n        metadata_dict.setdefault(\"graph_id\", str(graph_id))\n        patch_config[\"metadata\"] = metadata_dict\n\n\n        # Best-effort idempotency: avoid appending messages already present in the checkpoint.\n        # This is critical for durable resume where refinement planning may be replayed.\n        filtered_messages: list[Any] = list(new_messages)\n        try:\n            snapshot = None\n            getter_async = getattr(graph, \"aget_state\", None)\n            if callable(getter_async):\n                snapshot = await getter_async(patch_config)\n            if snapshot is None:\n                getter_sync = getattr(graph, \"get_state\", None)\n                if callable(getter_sync):\n                    snapshot = getter_sync(patch_config)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(values, Mapping):\n                existing = values.get(\"messages\")\n                if isinstance(existing, Sequence) and not isinstance(existing, (str, bytes)):\n                    existing_contents: set[str] = set()\n                    for message in existing:\n                        content = getattr(message, \"content\", None)\n                        if content:\n                            existing_contents.add(str(content))\n                    if existing_contents:\n                        filtered_messages = [\n                            message\n                            for message in filtered_messages\n                            if str(getattr(message, \"content\", \"\")) not in existing_contents\n                        ]\n        except Exception:\n            filtered_messages = list(new_messages)\n\n        if not filtered_messages:\n            return latest_checkpoint_id\n\n        updates: dict[str, Any] = {\"messages\": filtered_messages}\n\n        updater_async = getattr(graph, \"aupdate_state\", None)\n        updater_sync = getattr(graph, \"update_state\", None)\n        resolved_as_node = as_node or \"__start__\"\n        try:\n            if callable(updater_async):\n                await updater_async(patch_config, updates, as_node=resolved_as_node)\n            elif callable(updater_sync):\n                updater_sync(patch_config, updates, as_node=resolved_as_node)\n            else:\n                return None\n        except Exception as e:\n            return None\n\n        return await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n\n    async def inject_distribution_refinement_messages(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        requests: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Patch a graph checkpoint by appending refinement instruction messages.\n\n        Mirrors the extraction rules used by `_distribution_inject_refinement_messages`:\n        each request may carry `payload.messages` items shaped like\n        `{ \"content\": \"...\", \"metadata\": {...} }`.\n        \"\"\"\n\n        try:\n            from langchain_core.messages import HumanMessage\n        except Exception:\n            return None\n\n        injected: list[Any] = []\n        seen_contents: set[str] = set()\n        for request in requests:\n            payload = getattr(request, \"payload\", None)\n            if not isinstance(payload, Mapping):\n                payload = payload if isinstance(payload, dict) else {}\n            messages_payload = payload.get(\"messages\") or []\n            if not isinstance(messages_payload, Sequence) or isinstance(\n                messages_payload, (str, bytes)\n            ):\n                continue\n            for message in messages_payload:\n                if not isinstance(message, Mapping):\n                    continue\n                content = message.get(\"content\")\n                if not content:\n                    continue\n                content_str = str(content)\n                if content_str in seen_contents:\n                    continue\n                metadata = message.get(\"metadata\") or {}\n                additional_kwargs = dict(metadata) if isinstance(metadata, Mapping) else {}\n                injected.append(\n                    HumanMessage(content=content_str, additional_kwargs=additional_kwargs)\n                )\n                seen_contents.add(content_str)\n\n        if not injected:\n            return None\n\n        return await self.append_messages_to_checkpoint(\n            graph=graph,\n            graph_id=graph_id,\n            config=config,\n            new_messages=injected,\n            as_node=as_node,\n            local_checkpointer=local_checkpointer,\n        )\n\n    @staticmethod\n    def extract_thread_id(config: Optional[RunnableConfig]) -> Optional[ThreadId]:\n        if not config:\n            return None\n        configurable = config.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            return None\n        thread_id = configurable.get(\"thread_id\")\n        return str(thread_id) if thread_id else None\n\n    async def aget_platform_thread_state(self, *, thread_id: ThreadId) -> Optional[Any]:\n        \"\"\"Get latest persisted state from platform via LangGraph SDK (if available).\"\"\"\n\n        try:\n            from langgraph_sdk import get_client  # type: ignore\n        except Exception:\n            return None\n\n        try:\n            client = get_client()\n            return await client.threads.get_state(thread_id)\n        except Exception:\n            return None\n\n\n    async def has_persisted_checkpoint(\n        self,\n        *,\n        config: Optional[RunnableConfig],\n        local_checkpointer: Optional[Any] = None,\n    ) -> bool:\n        \"\"\"Return True if a checkpoint exists for config (platform or local).\"\"\"\n\n        if config is None:\n            return False\n\n        if self.is_production_mode():\n            thread_id = self.extract_thread_id(config)\n            if not thread_id:\n                return False\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n            values = getattr(snapshot, \"values\", None)\n            return isinstance(values, Mapping)\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if not checkpointer:\n            return False\n\n        getter_async = getattr(checkpointer, \"aget_tuple\", None)\n        try:\n            if callable(getter_async):\n                checkpoint_tuple = await getter_async(config)\n            else:\n                getter_sync = getattr(checkpointer, \"get_tuple\", None)\n                if not callable(getter_sync):\n                    return False\n                checkpoint_tuple = getter_sync(config)\n        except Exception:\n            return False\n\n        return checkpoint_tuple is not None\n\n    async def restore_state_from_latest_checkpoint(\n        self,\n        *,\n        state: StateDict,\n        config: Optional[RunnableConfig],\n        local_graph: Optional[Any],\n    ) -> bool:\n        \"\"\"Merge latest persisted state into the caller-owned `state` mapping.\"\"\"\n\n        if config is None:\n            return False\n\n        snapshot = None\n        thread_id = self.extract_thread_id(config)\n        if self.is_production_mode() and thread_id:\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n\n        if snapshot is None and local_graph is not None:\n            getter = getattr(local_graph, \"aget_state\", None)\n            if callable(getter):\n                try:\n                    snapshot = await getter(config)\n                except Exception:\n                    snapshot = None\n            if snapshot is None:\n                getter_sync = getattr(local_graph, \"get_state\", None)\n                if callable(getter_sync):\n                    try:\n                        snapshot = getter_sync(config)\n                    except Exception:\n                        snapshot = None\n\n        values = getattr(snapshot, \"values\", None)\n        if not isinstance(values, Mapping):\n            return False\n\n        for key, value in values.items():\n            state[key] = value\n        return True\n\n    async def ainvoke_with_durability(\n        self,\n        *,\n        graph: Any,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph with durability when supported.\"\"\"\n\n        # In production mode, platform may inject durability backends automatically.\n        # In dev mode, only attempt durability when the runnable itself was compiled\n        # with a checkpointer so LangGraph sets up its AsyncPregel loop correctly.\n        graph_bound_checkpointer = _extract_graph_checkpointer(graph)\n        resolved_local_checkpointer = local_checkpointer or graph_bound_checkpointer\n        checkpointer = resolved_local_checkpointer or self.checkpointer\n\n        if self.is_production_mode():\n            use_durability = durability\n        else:\n            use_durability = durability if (checkpointer and _graph_supports_durability(graph)) else None\n        try:\n            if use_durability:\n                return await graph.ainvoke(\n                    graph_input,\n                    config=config,\n                    context=context,\n                    durability=use_durability,\n                )\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n        except (TypeError, AttributeError):\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n\n\n__all__ = [\n    \"resolve_graph_checkpointer\",\n    \"resolve_graph_store\",\n    \"GraphMemoryRuntime\",\n]"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3836-ff1e-7132-8dad-c83cb7645fbb",
    "content": "**\u041e\u0448\u0438\u0431\u043a\u0430 `EmptyInputError` \u0438 \u043f\u043e\u0442\u0435\u0440\u044f \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0432\u044b\u0437\u0432\u0430\u043d\u044b \u0442\u0435\u043c, \u0447\u0442\u043e \u0432\u0430\u0448\u0430 \u043b\u043e\u0433\u0438\u043a\u0430 \u00abAbandon/Rerun\u00bb \u0432 `memory_manager.py` \u043e\u0448\u0438\u0431\u043e\u0447\u043d\u043e \u0441\u0447\u0438\u0442\u0430\u0435\u0442 \u043d\u0430\u0447\u0430\u043b\u044c\u043d\u044b\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f (System + User) \u00ab\u043d\u0435\u0437\u043d\u0430\u0447\u0438\u043c\u044b\u043c\u0438\u00bb, \u0443\u0434\u0430\u043b\u044f\u0435\u0442 `checkpoint_id` \u0438 \u0442\u0435\u043c \u0441\u0430\u043c\u044b\u043c \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u0442\u0438\u0440\u0430\u0435\u0442 \u0438\u0441\u0442\u043e\u0440\u0438\u044e.**\n\n\u0410\u043d\u0430\u043b\u0438\u0437 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 \u043b\u043e\u0433\u043e\u0432 \u0438 \u043a\u043e\u0434\u0430 \u0432\u044b\u044f\u0432\u0438\u043b \u00ab\u043f\u0430\u0440\u0430\u0434\u043e\u043a\u0441 \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u0448\u0430\u0433\u0430\u00bb:\n\n1.  **\u0423\u043d\u0438\u0447\u0442\u043e\u0436\u0435\u043d\u0438\u0435 \u0438\u0441\u0442\u043e\u0440\u0438\u0438:** \u0412 \u043c\u0435\u0442\u043e\u0434\u0435 `_has_meaningful_values` \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 `len(messages) > 2` \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 `False`, \u0435\u0441\u043b\u0438 \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u043e\u0435 \u0438 \u043f\u0435\u0440\u0432\u043e\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435. \u0418\u0437-\u0437\u0430 \u044d\u0442\u043e\u0433\u043e \u0441\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442 `cfg.pop(\"checkpoint_id\")`, \u0438 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0441\u0442\u0430\u0440\u0442\u0443\u0435\u0442 \u0441 \u0430\u0431\u0441\u043e\u043b\u044e\u0442\u043d\u043e \u0447\u0438\u0441\u0442\u044b\u043c \u0441\u0442\u0435\u0439\u0442\u043e\u043c.\n2.  **\u041f\u0430\u0440\u0430\u0434\u043e\u043a\u0441 `None`:** \u041a\u043e\u0433\u0434\u0430 \u0432\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0435 `None` \u0432 `ainvoke`, LangGraph \u043e\u0436\u0438\u0434\u0430\u0435\u0442, \u0447\u0442\u043e \u0432 \u0441\u0442\u0435\u0439\u0442\u0435 **\u0443\u0436\u0435** \u0435\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435. \u041d\u043e \u0435\u0441\u043b\u0438 \u044d\u0442\u043e \u0441\u0430\u043c\u044b\u0439 \u043f\u0435\u0440\u0432\u044b\u0439 \u00ab\u0442\u0438\u043a\u00bb \u0433\u0440\u0430\u0444\u0430 (\u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 `next=[\"agent\"]`), \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0438\u0439 \u0446\u0438\u043a\u043b `AsyncPregelLoop` \u043c\u043e\u0436\u0435\u0442 \u043f\u043e\u0442\u0440\u0435\u0431\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442 \u0432\u0432\u043e\u0434\u0430 \u0434\u043b\u044f \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u043a\u0430\u043d\u0430\u043b\u043e\u0432. \u041f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 `None` \u0432\u043c\u0435\u0441\u0442\u043e `{}` \u0438\u043b\u0438 `graph_input` \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 `EmptyInputError`.\n\n### \u041a\u0430\u043a \u0440\u0435\u0448\u0438\u0442\u044c \u044d\u0442\u043e \u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e \u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044e:\n\n\u0412\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u043e\u0442\u043a\u0430\u0437\u0430\u0442\u044c\u0441\u044f \u043e\u0442 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f `checkpoint_id` (\u0442\u0430\u043a \u043a\u0430\u043a \u044d\u0442\u043e \u0438 \u0435\u0441\u0442\u044c \u0432\u0430\u0448\u0430 \u0438\u0441\u0442\u043e\u0440\u0438\u044f) \u0438 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u0432\u044b\u0431\u0438\u0440\u0430\u0442\u044c \u00ab\u0442\u0440\u0438\u0433\u0433\u0435\u0440\u00bb \u0434\u043b\u044f \u0437\u0430\u043f\u0443\u0441\u043a\u0430. \u0412\u043c\u0435\u0441\u0442\u043e `None` (\u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u0435\u043d) \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u043b\u043e\u0432\u0430\u0440\u044c `{}` \u0434\u043b\u044f \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u044f. \u042d\u0442\u043e \u0443\u0434\u043e\u0432\u043b\u0435\u0442\u0432\u043e\u0440\u0438\u0442 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443 \u0432 `_first()`, \u043d\u043e \u043d\u0435 \u043f\u0440\u0438\u0432\u0435\u0434\u0435\u0442 \u043a \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439.\n\n**\u0418\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0439 \u043c\u0435\u0442\u043e\u0434 `ainvoke_from_checkpoint` \u0432 `memory_manager.py`:**\n\n```python\nif isinstance(next_nodes, Sequence) and next_nodes:\n    next_nodes_list = list(next_nodes)\n    values = getattr(snapshot, \"values\", {})\n    \n    # 1. \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c, \u0435\u0441\u0442\u044c \u043b\u0438 \u0443\u0436\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0432 \u0441\u0442\u0435\u0439\u0442\u0435 \u044d\u0442\u043e\u0433\u043e \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430\n    existing_msgs = values.get(\"messages\", [])\n    has_messages = isinstance(existing_msgs, Sequence) and len(existing_msgs) > 0\n    is_at_start = next_nodes_list == [\"__start__\"]\n\n    # 2. \u0412\u042b\u0411\u041e\u0420 \u0412\u0412\u041e\u0414\u0410 (\u041e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435):\n    # \u0415\u0441\u043b\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0435\u0449\u0435 \u043d\u0435\u0442 \u0438\u043b\u0438 \u043c\u044b \u043d\u0430 \u0441\u0430\u043c\u043e\u043c \u0441\u0442\u0430\u0440\u0442\u0435 \u2014 \u0448\u043b\u0435\u043c graph_input.\n    # \u0415\u0441\u043b\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0443\u0436\u0435 \u0435\u0441\u0442\u044c (\u0434\u0430\u0436\u0435 1-2) \u2014 \u0448\u043b\u0435\u043c {}, \u0447\u0442\u043e\u0431\u044b \u0443\u0434\u043e\u0432\u043b\u0435\u0442\u0432\u043e\u0440\u0438\u0442\u044c \n    # PregelLoop, \u043d\u043e \u043d\u0435 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0447\u0435\u0440\u0435\u0437 \u0440\u0435\u0434\u0443\u0441\u0435\u0440 add_messages.\n    if is_at_start or not has_messages:\n        effective_input = graph_input\n    else:\n        effective_input = {} # \u041f\u0443\u0441\u0442\u043e\u0439 \u0432\u0432\u043e\u0434 \u0432\u043c\u0435\u0441\u0442\u043e None \u0440\u0435\u0448\u0430\u0435\u0442 EmptyInputError\n\n    # 3. \u0417\u0410\u041f\u0423\u0421\u041a (\u041d\u0438\u043a\u043e\u0433\u0434\u0430 \u043d\u0435 \u0434\u0435\u043b\u0430\u0435\u043c pop(\"checkpoint_id\") \u0437\u0434\u0435\u0441\u044c!)\n    return await self.ainvoke_with_durability(\n        graph=graph,\n        graph_input=effective_input,\n        config=cfg, # \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u043d\u0444\u0438\u0433 \u0441 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u044b\u043c checkpoint_id\n        context=context,\n        durability=durability,\n        local_checkpointer=effective_local_checkpointer,\n    )\n```\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0441\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442:\n\n-   **\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0438\u0441\u0442\u043e\u0440\u0438\u0438:** \u041f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u0432\u044b \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u0443\u0434\u0430\u043b\u044f\u0435\u0442\u0435 `checkpoint_id`, LangGraph \u0432\u0441\u0435\u0433\u0434\u0430 \u0431\u0443\u0434\u0435\u0442 \u043f\u043e\u0434\u0433\u0440\u0443\u0436\u0430\u0442\u044c \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0438\u0437 \u0431\u0430\u0437\u044b.\n-   **\u0423\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u0435 `EmptyInputError`:** \u041f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 `{}` \u0432\u043c\u0435\u0441\u0442\u043e `None` \u0441\u043e\u043e\u0431\u0449\u0430\u0435\u0442 LangGraph: \u00ab\u0412\u043e\u0442 \u0442\u0435\u0431\u0435 \u043e\u0431\u044a\u0435\u043a\u0442 \u0432\u0432\u043e\u0434\u0430 (\u043f\u0443\u0441\u0442\u043e\u0439), \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0435\u0433\u043e \u0434\u043b\u044f \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0446\u0438\u043a\u043b\u0430 \u0438 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0439 \u0440\u0430\u0431\u043e\u0442\u0443 \u0441 \u0443\u0437\u043b\u0430 \u0432 `next_nodes`\u00bb.\n-   **\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435 \u0434\u0443\u0431\u043b\u0438\u043a\u0430\u0442\u043e\u0432:** \u0420\u0435\u0434\u0443\u0441\u0435\u0440 `add_messages` \u043f\u0440\u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0438 `{}` \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u0434\u043e\u0431\u0430\u0432\u0438\u0442 \u0432 \u0441\u043f\u0438\u0441\u043e\u043a, \u0438 \u0432\u0430\u0448\u0430 \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u043e\u0441\u0442\u0430\u043d\u0435\u0442\u0441\u044f \u0447\u0438\u0441\u0442\u043e\u0439 (System + User + \u043e\u0442\u0432\u0435\u0442\u044b).\n\n### \u0412\u0430\u0436\u043d\u043e\u0435 \u043f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u0435 \u043f\u043e `_has_meaningful_values`:\n\u042d\u0442\u0443 \u0444\u0443\u043d\u043a\u0446\u0438\u044e \u043b\u0443\u0447\u0448\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0438\u043b\u0438 \u043f\u0440\u0438\u043d\u044f\u0442\u0438\u044f \u0440\u0435\u0448\u0435\u043d\u0438\u044f \u043e *\u043f\u043e\u043b\u043d\u043e\u043c* \u0441\u0431\u0440\u043e\u0441\u0435 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0435\u0441\u043b\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0443 \u0431\u043e\u043b\u044c\u0448\u0435 \u043c\u0435\u0441\u044f\u0446\u0430). \u0414\u043b\u044f \u043b\u043e\u0433\u0438\u043a\u0438 `ainvoke` \u0432 \u0440\u0430\u043c\u043a\u0430\u0445 \u043e\u0434\u043d\u043e\u0439 \u043d\u0438\u0442\u0438 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 `checkpoint_id` \u0441\u0430\u043c\u043e \u043f\u043e \u0441\u0435\u0431\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u044b\u043c \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u0434\u043b\u044f \u043f\u043e\u043f\u044b\u0442\u043a\u0438 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f.\n\n**Relevant docs:**\n- [Time Travel: Resume from Checkpoint](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)\n- [Persistence: State and Checkpoints](https://docs.langchain.com/oss/python/langgraph/persistence)\n- [LangGraph Errors: EmptyInputError](https://docs.langchain.com/langsmith/use-threads#empty-thread)"
  },
  {
    "role": "user",
    "id": "0f7153fe-8db3-417d-898f-875bc0d5bc63",
    "content": "\u0422\u0430\u043a ? \nfrom __future__ import annotations\n\nimport uuid\nimport os\nfrom datetime import datetime\nfrom typing import Any, Mapping, MutableMapping, Optional, Sequence, TypeAlias, Protocol, runtime_checkable, cast\n\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom langchain.embeddings import init_embeddings\nfrom shared.project_settings import ProjectSettings\n\ntry:\n    from pydantic_core import core_schema\nexcept ImportError:\n    core_schema = None  # type: ignore\n\ntry:\n    from langgraph.store.memory import InMemoryStore  # type: ignore\nexcept Exception:  # pragma: no cover\n    InMemoryStore = None  # type: ignore\n\n_CHECKPOINTER_SYNC: Optional[Any] = None\n_CHECKPOINTER_ASYNC: Optional[Any] = None\n_STORE: Optional[Any] = None\n\nThreadId: TypeAlias = str\nGraphId: TypeAlias = str\nCheckpointId: TypeAlias = str\nStateDict: TypeAlias = MutableMapping[str, Any]\n\n\n@runtime_checkable\nclass _SupportsGraphCheckpoint(Protocol):\n    \"\"\"Minimal protocol describing compiled LangGraph runnables we inspect for durability support.\"\"\"\n\n    checkpointer: Any | None\n    _pregel: Any | None\n    app: Any | None\n    name: str\n\n\nGraphRunnableWithPregel: TypeAlias = _SupportsGraphCheckpoint\n\n\ndef _extract_graph_checkpointer(graph: Any) -> Any:\n    \"\"\"Return the checkpointer bound directly to a compiled runnable, if any.\"\"\"\n\n    if graph is None:\n        return None\n\n    candidate = getattr(graph, \"checkpointer\", None)\n    if candidate is not None:\n        return candidate\n\n    pregel = getattr(graph, \"_pregel\", None)\n    if pregel is not None:\n        inner = getattr(pregel, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    app = getattr(graph, \"app\", None)\n    if app is not None:\n        inner = getattr(app, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    loop = getattr(graph, \"_loop\", None)\n    if loop is not None:\n        inner = getattr(loop, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    return None\n\n\ndef _graph_supports_durability(graph: Any) -> bool:\n    \"\"\"Return True if the runnable was compiled with a checkpointer.\"\"\"\n\n    return _extract_graph_checkpointer(graph) is not None\n\n\ndef _resolve_local_checkpointer(graph: Any, override: Optional[Any]) -> Optional[Any]:\n    \"\"\"Prefer explicit override, otherwise inspect the runnable for a bound saver.\"\"\"\n\n    if override is not None:\n        return override\n    return _extract_graph_checkpointer(graph)\n\n\ndef resolve_graph_checkpointer(*, async_mode: bool) -> Any:\n    \"\"\"Return a checkpointer compatible with the chosen execution mode.\n\n    Important:\n    - Async LangGraph execution expects async checkpointer methods. If only a\n      sync checkpointer is available (e.g., SqliteSaver), we fall back to the\n      async-safe InMemorySaver to keep `.ainvoke()` reliable.\n    - Production deployments can replace this with an async-capable durable\n      backend (Postgres/SQLite async) without touching graph code.\n    \"\"\"\n\n    global _CHECKPOINTER_SYNC, _CHECKPOINTER_ASYNC\n    CHECKPOINTER_DATABASE_URL = os.getenv(\"CHECKPOINTER_DATABASE_URL\")\n\n    # In production, LangGraph Platform injects the checkpointer automatically.\n    # We keep local checkpointers disabled to avoid shadowing the platform backend.\n    if ProjectSettings().mode == \"production\":\n        return None\n\n\n    if async_mode:\n        if _CHECKPOINTER_ASYNC is None:\n            _CHECKPOINTER_ASYNC = InMemorySaver()\n        return _CHECKPOINTER_ASYNC\n\n    if _CHECKPOINTER_SYNC is None:\n        _CHECKPOINTER_SYNC =  InMemorySaver()\n    return _CHECKPOINTER_SYNC\n\n\ndef resolve_graph_store() -> Any:\n    \"\"\"Return a store implementation for dev/tests; None in production/platform.\n\n    In production, LangGraph Platform injects the store automatically at runtime\n    (via ToolRuntime). We keep local stores disabled to avoid shadowing the\n    platform backend.\n    \"\"\"\n\n    global _STORE\n    if ProjectSettings().mode == \"production\":\n        return None\n    if InMemoryStore is None:\n        return None\n    if _STORE is not None:\n        return _STORE\n\n    # In development/tests we prefer an in-process store. Vector indexing is optional;\n    # if embeddings cannot be initialised (missing deps/keys), fall back to a plain store.\n    try:\n        _STORE = InMemoryStore(\n            index={\n                \"embed\": init_embeddings(\"openai:text-embedding-3-small\"),\n                \"dims\": 1536,\n                \"fields\": [\"content\"],\n            }\n        )\n    except Exception:\n        _STORE = InMemoryStore(index=None)\n    return _STORE\n\n\nclass GraphMemoryRuntime:\n    \"\"\"Encapsulates durable-checkpoint + long-memory access for dev and platform production.\n\n    This class centralizes:\n    - thread_id extraction\n    - platform SDK fallback for checkpoint state/history (no local checkpointer needed)\n    - local (dev) graph/checkpointer checkpoint inspection\n    \"\"\"\n    THREAD_ID_KEY: str = \"thread_id\"\n\n    @classmethod\n    def __get_pydantic_core_schema__(\n        cls,\n        source_type: Any,\n        handler: Any,\n    ) -> Any:\n        \"\"\"Provide Pydantic schema for GraphMemoryRuntime to allow arbitrary types.\n\n        This enables GraphMemoryRuntime to be used in Pydantic models (e.g., when\n        ContextTravelGuideAgent is used as context_schema in StateGraph).\n        \n        Since GraphMemoryRuntime is a runtime helper (not meant for serialization),\n        we use any_schema() to allow it without validation.\n        \"\"\"\n        if core_schema is None:\n            # pydantic_core should always be available in this project\n            raise ImportError(\"pydantic_core is required but not available\")\n        \n        # Use any_schema() to allow GraphMemoryRuntime without validation\n        # This is appropriate since it's a runtime helper with init=False\n        return core_schema.any_schema()\n\n    def __init__(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        # These are intentionally mutable bindings:\n        # - Root graph wiring binds the single checkpointer/store once per process/run.\n        # - Nested graphs MUST reuse the bound instance via runtime context.\n        self.checkpointer: Optional[Any] = checkpointer\n        self.store: Optional[Any] = store\n\n    def bind(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        \"\"\"Bind durable backends onto this runtime helper.\n\n        Idempotent by design: does not overwrite existing non-null bindings unless\n        explicitly provided.\n        \"\"\"\n\n        if checkpointer is not None:\n            self.checkpointer = checkpointer\n        if store is not None:\n            self.store = store\n\n    def is_production_mode(self) -> bool:\n        return ProjectSettings().mode == \"production\"\n\n    def ensure_thread_id(\n        self,\n        config: Optional[RunnableConfig],\n    ) -> tuple[RunnableConfig, ThreadId]:\n        \"\"\"Ensure ``configurable.thread_id`` exists and return ``(config, thread_id)``.\n\n        Contract (required by project checkpointing rules):\n        - One thread_id should be used for the *entire* root graph run.\n        - If caller did not provide a thread_id, we generate a new one from:\n          ``user_id`` (from RunnableConfig.configurable.user_id) + UUID4 suffix.\n        - Callers must reuse the returned config to keep the thread_id stable.\n        \"\"\"\n\n        from shared.config.long_memory import LongMemory\n\n        merged: RunnableConfig = dict(config) if config else {}\n        configurable = merged.get(\"configurable\", {})\n        if not isinstance(configurable, MutableMapping):\n            configurable = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable = dict(configurable)\n\n        existing = configurable.get(self.THREAD_ID_KEY)\n        if existing:\n            thread_id: ThreadId = str(existing)\n            configurable[self.THREAD_ID_KEY] = thread_id\n            merged[\"configurable\"] = configurable\n            return merged, thread_id\n\n        long_memory = LongMemory.from_runnable_config(merged)\n        user_id = long_memory.user_id\n        if not configurable.get(\"user_id\"):\n            configurable[\"user_id\"] = user_id\n\n        thread_id = f\"user_{user_id}_{uuid.uuid4().hex}\"\n        configurable[self.THREAD_ID_KEY] = thread_id\n        merged[\"configurable\"] = configurable\n        return merged, thread_id\n\n    async def list_thread_checkpoints(\n        self,\n        *,\n        config: RunnableConfig,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> list[Any]:\n        \"\"\"Return raw checkpoint records for the given thread config.\n\n        Notes:\n        - In production (LangGraph Platform), we fall back to the SDK thread history.\n        - In dev/tests, we prefer the provided ``local_checkpointer`` (or the default dev\n          checkpointer) to list checkpoints, because it exposes metadata (`graph_id`).\n        - As a last resort, we attempt to list state snapshots via ``graph.get_state_history``.\n        \"\"\"\n\n        thread_id = self.extract_thread_id(config)\n        if not thread_id:\n            return []\n\n        if self.is_production_mode():\n            try:\n                from langgraph_sdk import get_client  # type: ignore\n            except Exception:\n                return []\n            try:\n                client = get_client()\n                history = await client.threads.get_history(thread_id)\n                return list(history)\n            except Exception:\n                return []\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if checkpointer is not None:\n            lister = getattr(checkpointer, \"list\", None)\n            if callable(lister):\n                try:\n                    return list(lister(config))\n                except Exception:\n                    return []\n\n        if local_graph is not None:\n            getter_async = getattr(local_graph, \"aget_state_history\", None)\n            if callable(getter_async):\n                try:\n                    return [snapshot async for snapshot in getter_async(config)]\n                except Exception:\n                    return []\n            getter_sync = getattr(local_graph, \"get_state_history\", None)\n            if callable(getter_sync):\n                try:\n                    return list(getter_sync(config))\n                except Exception:\n                    return []\n\n        return []\n\n    @staticmethod\n    def _extract_checkpoint_metadata(record: Any) -> Mapping[str, Any]:\n        candidate = getattr(record, \"metadata\", None)\n        if isinstance(candidate, Mapping):\n            return cast(Mapping[str, Any], candidate)\n        if isinstance(record, Mapping):\n            meta = record.get(\"metadata\")\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            meta = getattr(checkpoint, \"metadata\", None)\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        return {}\n\n    @staticmethod\n    def _extract_checkpoint_id(record: Any) -> Optional[CheckpointId]:\n        candidate = getattr(record, \"checkpoint_id\", None)\n        if candidate:\n            return str(candidate)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            inner = getattr(checkpoint, \"checkpoint_id\", None)\n            if inner:\n                return str(inner)\n            inner = getattr(checkpoint, \"id\", None)\n            if inner:\n                return str(inner)\n        if isinstance(record, Mapping):\n            candidate = record.get(\"checkpoint_id\") or record.get(\"id\")\n            if candidate:\n                return str(candidate)\n            cfg = record.get(\"config\")\n            if isinstance(cfg, Mapping):\n                conf = cfg.get(\"configurable\")\n                if isinstance(conf, Mapping):\n                    candidate = conf.get(\"checkpoint_id\")\n                    if candidate:\n                        return str(candidate)\n        cfg = getattr(record, \"config\", None)\n        if isinstance(cfg, Mapping):\n            conf = cfg.get(\"configurable\")\n            if isinstance(conf, Mapping):\n                candidate = conf.get(\"checkpoint_id\")\n                if candidate:\n                    return str(candidate)\n        return None\n\n    @staticmethod\n    def _extract_created_at(record: Any) -> Optional[datetime]:\n        candidate = getattr(record, \"created_at\", None)\n        if isinstance(candidate, datetime):\n            return candidate\n        if isinstance(record, Mapping):\n            candidate = record.get(\"created_at\")\n            if isinstance(candidate, datetime):\n                return candidate\n        return None\n\n    @classmethod\n    def _matches_graph_id(cls, record: Any, graph_id: GraphId) -> bool:\n        metadata = cls._extract_checkpoint_metadata(record)\n        candidate = metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")\n        return str(candidate) == str(graph_id) if candidate else False\n\n    @staticmethod\n    def _extract_checkpoint_ns(record: Any) -> Optional[str]:\n        def _from_config(cfg: Any) -> Optional[str]:\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n                if isinstance(configurable, Mapping):\n                    candidate = configurable.get(\"checkpoint_ns\")\n                    if candidate is not None:\n                        return str(candidate)\n            return None\n\n        cfg = getattr(record, \"config\", None)\n        ns = _from_config(cfg)\n        if ns:\n            return ns\n\n        if isinstance(record, Mapping):\n            ns = _from_config(record.get(\"config\"))\n            if ns:\n                return ns\n\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            ns = _from_config(getattr(checkpoint, \"config\", None))\n            if ns:\n                return ns\n\n        metadata = GraphMemoryRuntime._extract_checkpoint_metadata(record)\n        checkpoint_ns = metadata.get(\"checkpoint_ns\")\n        return str(checkpoint_ns) if checkpoint_ns is not None else None\n\n    @staticmethod\n    def _normalize_config_like(config_like: Any) -> Optional[RunnableConfig]:\n        if config_like is None:\n            return None\n        if isinstance(config_like, Mapping):\n            normalized = dict(config_like)\n        else:\n            normalized = None\n            for attr in (\"model_dump\", \"dict\"):\n                dumper = getattr(config_like, attr, None)\n                if callable(dumper):\n                    try:\n                        normalized = dumper()\n                        break\n                    except Exception:\n                        normalized = None\n            if normalized is None:\n                try:\n                    normalized = dict(config_like)  # type: ignore[arg-type]\n                except Exception:\n                    return None\n\n        configurable = normalized.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            configurable = dict(configurable) if configurable is not None else {}\n        normalized[\"configurable\"] = dict(configurable)\n\n        metadata = normalized.get(\"metadata\", {})\n        if not isinstance(metadata, Mapping):\n            metadata = dict(metadata) if metadata is not None else {}\n        normalized[\"metadata\"] = dict(metadata)\n        return normalized  # type: ignore[return-value]\n\n    @classmethod\n    def _extract_task_entries(cls, record: Any) -> list[Mapping[str, Any]]:\n        extracted: list[Mapping[str, Any]] = []\n        visited_snapshots: set[int] = set()\n\n        def _coerce_metadata(value: Any) -> Optional[Mapping[str, Any]]:\n            if value is None:\n                return None\n            if isinstance(value, Mapping):\n                return value\n            try:\n                return dict(value)\n            except Exception:\n                return None\n\n        def _as_sequence(value: Any) -> Optional[Sequence[Any]]:\n            if isinstance(value, Sequence) and not isinstance(value, (str, bytes)):\n                return value\n            return None\n\n        def _record_entry(config_like: Any, metadata_like: Any, state_like: Any) -> None:\n            normalized_config = cls._normalize_config_like(config_like)\n            normalized_metadata = _coerce_metadata(metadata_like)\n            entry: dict[str, Any] = {}\n            if normalized_config:\n                entry[\"config\"] = normalized_config\n            if normalized_metadata:\n                entry[\"metadata\"] = normalized_metadata\n            if state_like is not None:\n                entry[\"state\"] = state_like\n            if entry:\n                extracted.append(entry)\n\n        def _visit_snapshot(snapshot: Any) -> None:\n            if snapshot is None:\n                return\n            snapshot_id = id(snapshot)\n            if snapshot_id in visited_snapshots:\n                return\n            visited_snapshots.add(snapshot_id)\n\n            tasks = None\n            if isinstance(snapshot, Mapping):\n                tasks = _as_sequence(snapshot.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(snapshot, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        def _visit_task(task: Any) -> None:\n            if task is None:\n                return\n            if isinstance(task, Mapping):\n                _record_entry(task.get(\"config\"), task.get(\"metadata\"), task.get(\"state\"))\n                nested_tasks = _as_sequence(task.get(\"tasks\"))\n                if nested_tasks:\n                    for nested in nested_tasks:\n                        _visit_task(nested)\n                _visit_snapshot(task.get(\"state\"))\n                _visit_snapshot(task.get(\"result\"))\n                return\n\n            _record_entry(\n                getattr(task, \"config\", None),\n                getattr(task, \"metadata\", None),\n                getattr(task, \"state\", None),\n            )\n            _visit_snapshot(getattr(task, \"state\", None))\n            _visit_snapshot(getattr(task, \"result\", None))\n            nested_attr = _as_sequence(getattr(task, \"tasks\", None))\n            if nested_attr:\n                for nested in nested_attr:\n                    _visit_task(nested)\n\n        for source in (record, getattr(record, \"checkpoint\", None)):\n            if source is None:\n                continue\n            _visit_snapshot(source)\n            tasks = None\n            if isinstance(source, Mapping):\n                tasks = _as_sequence(source.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(source, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        return extracted\n\n    async def find_latest_checkpoint_id(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Return the latest checkpoint_id for ``graph_id`` within the given thread.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n\n        # #region agent log\n        import json\n        record_summaries: list[dict[str, str | None]] = []\n        for idx, record in enumerate(checkpoints[:3]):\n            metadata = self._extract_checkpoint_metadata(record)\n            cfg = getattr(record, \"config\", None)\n            configurable = None\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n            checkpoint_ns = None\n            if isinstance(configurable, Mapping):\n                checkpoint_ns = str(configurable.get(\"checkpoint_ns\"))\n            record_summaries.append(\n                {\n                    \"idx\": str(idx),\n                    \"meta_graph_id\": str(metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")),\n                    \"checkpoint_id\": self._extract_checkpoint_id(record),\n                    \"checkpoint_ns\": checkpoint_ns,\n                }\n            )\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"B\",\"location\":\"memory_manager.py:395\",\"message\":\"find_latest_checkpoint_id checkpoints listed\",\"data\":{\"graph_id\":graph_id,\"thread_id\":str(config.get(\"configurable\",{}).get(\"thread_id\",\"\")), \"count\":len(checkpoints),\"records\":record_summaries},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if not checkpoints:\n            return None\n\n        # Collect matches with their timestamps (if provided by the backend).\n        matches: list[tuple[Optional[datetime], Any]] = []\n        for record in checkpoints:\n            if self._matches_graph_id(record, graph_id):\n                matches.append((self._extract_created_at(record), record))\n\n        target_checkpoint_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_checkpoint_ns = str(candidate_ns)\n\n        if not matches and target_checkpoint_ns:\n            for record in checkpoints:\n                if self._extract_checkpoint_ns(record) == target_checkpoint_ns:\n                    matches.append((self._extract_created_at(record), record))\n\n        if not matches:\n            return None\n\n        # If the backend provides created_at, prefer the most recent by timestamp.\n        if any(created_at is not None for created_at, _ in matches):\n            matches.sort(\n                key=lambda item: item[0] or datetime.min,\n                reverse=True,\n            )\n            return self._extract_checkpoint_id(matches[0][1])\n\n        # Otherwise, rely on the backend list order. InMemorySaver and Platform history\n        # return newest-first, so the first matching record is the latest.\n        return self._extract_checkpoint_id(matches[0][1])\n\n    async def _load_checkpoint_record(\n        self,\n        *,\n        config: RunnableConfig,\n        checkpoint_id: CheckpointId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[Any]:\n        \"\"\"Return the checkpoint record with the specified ID.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n        for record in checkpoints:\n            record_id = self._extract_checkpoint_id(record)\n            if record_id == checkpoint_id:\n                return record\n        return None\n\n    @staticmethod\n    def _materialize_checkpoint_values(\n        base_values: Mapping[str, Any],\n        record: Optional[Any],\n        *,\n        graph_id: Optional[str] = None,\n    ) -> tuple[Mapping[str, Any], bool]:\n        \"\"\"Merge stored writes from the checkpoint record into snapshot values.\"\"\"\n\n        if record is None:\n            return base_values, False\n\n        materialized: dict[str, Any] = dict(base_values)\n        writes_found = False\n\n        checkpoint_obj = getattr(record, \"checkpoint\", record)\n        writes = getattr(checkpoint_obj, \"writes\", None)\n        if writes is None and isinstance(checkpoint_obj, Mapping):\n            writes = checkpoint_obj.get(\"writes\")\n\n        # #region agent log\n        import json as _json_checkpoint_meta\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(\n                _json_checkpoint_meta.dumps(\n                    {\n                        \"sessionId\": \"debug-session\",\n                        \"runId\": \"pre-fix\",\n                        \"hypothesisId\": \"L\",\n                        \"location\": \"memory_manager.py:321\",\n                        \"message\": \"checkpoint record summary\",\n                        \"data\": {\n                            \"graph_id\": graph_id,\n                            \"record_type\": type(checkpoint_obj).__name__,\n                            \"has_attr_writes\": hasattr(checkpoint_obj, \"writes\"),\n                            \"writes_is_sequence\": isinstance(writes, Sequence),\n                            \"writes_is_mapping\": isinstance(writes, Mapping),\n                        },\n                        \"timestamp\": __import__(\"time\").time() * 1000,\n                    }\n                )\n                + \"\\n\"\n            )\n        # #endregion\n\n        summary: list[dict[str, Any]] = []\n\n        if isinstance(writes, Sequence):\n            for idx, write_entry in enumerate(writes):\n                node_name = None\n                write_payload = None\n                if isinstance(write_entry, Mapping):\n                    node_name = write_entry.get(\"node\") or write_entry.get(\"name\")\n                    candidate = write_entry.get(\"writes\") or write_entry.get(\"values\")\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n                else:\n                    node_name = getattr(write_entry, \"node\", None) or getattr(write_entry, \"name\", None)\n                    candidate = getattr(write_entry, \"writes\", None)\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n\n                if isinstance(write_payload, Mapping):\n                    for key, value in write_payload.items():\n                        materialized.setdefault(key, value)\n                    if idx < 3:\n                        summary.append(\n                            {\n                                \"node\": str(node_name),\n                                \"keys\": list(write_payload.keys()),\n                            }\n                        )\n                    writes_found = True\n\n        # #region agent log\n        if summary:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:324\",\n                            \"message\": \"checkpoint writes merged\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"writes\": summary,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        else:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:329\",\n                            \"message\": \"checkpoint writes unavailable\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"has_writes\": isinstance(writes, Sequence),\n                                \"writes_type\": None if writes is None else type(writes).__name__,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        # #endregion\n\n        return materialized, writes_found\n\n    @staticmethod\n    def _has_meaningful_values(values: Mapping[str, Any]) -> bool:\n        \"\"\"Return True if checkpoint values contain data beyond housekeeping fields.\"\"\"\n\n        if not values:\n            return False\n        significant_keys = set(values.keys()) - {\"messages\", \"remaining_steps\", \"distribution_scope\"}\n        if significant_keys:\n            return True\n\n        messages = values.get(\"messages\")\n        if isinstance(messages, Sequence):\n            # System + user messages occupy the first two positions. Anything beyond\n            # that indicates the assistant has already produced tool calls or replies.\n            if len(messages) > 2:\n                return True\n\n        return False\n\n    async def _find_subgraph_resume_config(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        checkpoints: Sequence[Any],\n    ) -> Optional[tuple[RunnableConfig, Any]]:\n        target_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_ns = str(candidate_ns)\n\n        for record_idx, record in enumerate(checkpoints):\n            task_entries = self._extract_task_entries(record)\n            if not task_entries:\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:562\",\"message\":\"checkpoint missing task entries\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"parent_checkpoint_id\":self._extract_checkpoint_id(record)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n                continue\n            for task_idx, task in enumerate(task_entries[:2]):\n                task_metadata = task.get(\"metadata\")\n                normalized_metadata: Mapping[str, Any] = {}\n                if isinstance(task_metadata, Mapping):\n                    normalized_metadata = task_metadata\n                task_graph_id = normalized_metadata.get(\"graph_id\") or normalized_metadata.get(\"langgraph_graph_id\")\n\n                raw_config = task.get(\"config\")\n                normalized_config = self._normalize_config_like(raw_config)\n                if not normalized_config:\n                    continue\n                task_configurable = normalized_config.get(\"configurable\", {})\n                task_ns = None\n                if isinstance(task_configurable, Mapping):\n                    candidate = task_configurable.get(\"checkpoint_ns\")\n                    if candidate:\n                        task_ns = str(candidate)\n\n                ns_matches = target_ns and task_ns == target_ns\n                graph_matches = task_graph_id and str(task_graph_id) == str(graph_id)\n\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:581\",\"message\":\"task entry inspected\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"task_index\":task_idx,\"task_graph_id\":task_graph_id,\"task_ns\":task_ns},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n\n                if graph_matches or ns_matches:\n                    resume_state = task.get(\"state\")\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            json.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"D\",\n                                    \"location\": \"memory_manager.py:520\",\n                                    \"message\": \"subgraph resume config located\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"matched_ns\": task_ns,\n                                        \"matched_graph_id\": task_graph_id,\n                                        \"parent_checkpoint_id\": self._extract_checkpoint_id(record),\n                                        \"has_state\": resume_state is not None,\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return normalized_config, resume_state\n\n        return None\n\n    async def _get_graph_snapshot(\n        self,\n        *,\n        graph: Any,\n        cfg: RunnableConfig,\n        subgraphs: bool = False,\n    ) -> Any:\n        getter_async = getattr(graph, \"aget_state\", None)\n        params = {\"subgraphs\": True} if subgraphs else {}\n        try:\n            if callable(getter_async):\n                return await getter_async(cfg, **params)\n        except TypeError:\n            # Fallback for LangGraph versions that don't support subgraphs kwarg.\n            try:\n                return await getter_async(cfg)\n            except Exception:\n                pass\n        except Exception:\n            pass\n\n        getter_sync = getattr(graph, \"get_state\", None)\n        if callable(getter_sync):\n            try:\n                return getter_sync(cfg, **params)\n            except TypeError:\n                try:\n                    return getter_sync(cfg)\n                except Exception:\n                    return None\n            except Exception:\n                return None\n        return None\n\n    async def ainvoke_from_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str = \"sync\",\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph resuming from the latest checkpoint when available.\"\"\"\n\n        merged, _ = self.ensure_thread_id(config)\n        # SAFETY: Ignore any caller-supplied checkpoint_id.\n        #\n        # In this architecture, checkpoint selection is *graph_id-scoped* and managed\n        # exclusively by this runtime helper. Allowing external checkpoint_id values\n        # could cause cross-graph leakage within a shared thread_id.\n\n        merged_conf = merged.get(\"configurable\", {})\n        if isinstance(merged_conf, Mapping):\n            merged_conf_dict = dict(merged_conf)\n            merged_conf_dict.pop(\"checkpoint_id\", None)\n            original_ns = merged_conf_dict.get(\"checkpoint_ns\", \"\")\n            merged_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            merged[\"configurable\"] = merged_conf_dict\n            \n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"E\",\"location\":\"memory_manager.py:445\",\"message\":\"ainvoke_from_checkpoint setting checkpoint_ns\",\"data\":{\"graph_id\":graph_id,\"original_ns\":str(original_ns),\"new_ns\":str(merged_conf_dict.get(\"checkpoint_ns\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n        # Ensure the checkpoint records are scoping-friendly in LangGraph v1.\n        meta = merged.get(\"metadata\")\n        if not isinstance(meta, Mapping):\n            meta = {}\n        meta_dict = dict(meta)\n        meta_dict.setdefault(\"graph_id\", str(graph_id))\n        merged[\"metadata\"] = meta_dict\n\n        effective_local_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n\n        # #region agent log\n        import json\n        final_ns = merged.get(\"configurable\", {}).get(\"checkpoint_ns\", \"\")\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:458\",\"message\":\"ainvoke_from_checkpoint calling find_latest_checkpoint_id\",\"data\":{\"graph_id\":graph_id,\"checkpoint_ns\":str(final_ns),\"thread_id\":str(merged.get(\"configurable\",{}).get(\"thread_id\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=effective_local_checkpointer,\n            local_graph=graph,\n        )\n        checkpoint_record: Optional[Any] = None\n        subgraph_resume: Optional[tuple[RunnableConfig, Any]] = None\n        if checkpoint_id is None:\n            snapshot_sources: list[Any] = []\n\n            if context is not None:\n                runner = getattr(context, \"graph_runner\", None)\n                graph_runtime = getattr(runner, \"graph\", None)\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:711\",\"message\":\"parent context inspection\",\"data\":{\"graph_id\":graph_id,\"has_context\":True,\"has_runner\":runner is not None,\"has_graph\":graph_runtime is not None},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n                if graph_runtime is not None:\n                    try:\n                        parent_snapshot = await self._get_graph_snapshot(\n                            graph=graph_runtime,\n                            cfg=merged,\n                            subgraphs=True,\n                        )\n                        if parent_snapshot is not None:\n                            snapshot_sources.append(parent_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:715\",\"message\":\"parent snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":parent_snapshot is not None,\"has_tasks\":bool(getattr(parent_snapshot,\"tasks\",None)),\"has_next\":bool(getattr(parent_snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                    except Exception:\n                        parent_snapshot = None\n                else:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:724\",\"message\":\"parent snapshot skipped\",\"data\":{\"graph_id\":graph_id,\"reason\":\"graph_runner_missing\" if runner is None else \"graph_attr_missing\"},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:729\",\"message\":\"parent context absent\",\"data\":{\"graph_id\":graph_id},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n\n            root_graph = getattr(context, \"root_graph\", None) if context is not None else None\n            if root_graph is not None:\n                try:\n                    root_snapshot = await self._get_graph_snapshot(\n                        graph=root_graph,\n                        cfg=merged,\n                        subgraphs=True,\n                    )\n                    if root_snapshot is not None:\n                        snapshot_sources.append(root_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:738\",\"message\":\"root snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":root_snapshot is not None,\"has_tasks\":bool(getattr(root_snapshot,\"tasks\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                except Exception:\n                    root_snapshot = None\n\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=merged,\n                subgraphs=True,\n            )\n            if snapshot is not None:\n                snapshot_sources.append(snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:727\",\"message\":\"assistant snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":bool(getattr(snapshot,\"tasks\",None)),\"has_next\":bool(getattr(snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            checkpoints_snapshot = await self.list_thread_checkpoints(\n                config=merged,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n            snapshot_sources.extend(checkpoints_snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:734\",\"message\":\"thread checkpoints snapshot collected\",\"data\":{\"graph_id\":graph_id,\"count\":len(checkpoints_snapshot)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            subgraph_resume = await self._find_subgraph_resume_config(\n                config=merged,\n                graph_id=graph_id,\n                checkpoints=snapshot_sources,\n            )\n            if subgraph_resume is not None:\n                resume_config, _ = subgraph_resume\n                metadata = resume_config.get(\"metadata\", {})\n                if not isinstance(metadata, Mapping):\n                    metadata = dict(metadata) if metadata is not None else {}\n                metadata = dict(metadata)\n                metadata.setdefault(\"graph_id\", str(graph_id))\n                resume_config[\"metadata\"] = metadata  # type: ignore[index]\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:743\",\"message\":\"subgraph resume config missing\",\"data\":{\"graph_id\":graph_id,\"snapshot_sources\":len(snapshot_sources)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n        \n        # #region agent log\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:464\",\"message\":\"ainvoke_from_checkpoint checkpoint_id result\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":str(checkpoint_id) if checkpoint_id else None,\"checkpoint_ns\":str(final_ns)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if checkpoint_id:\n            checkpoint_record = await self._load_checkpoint_record(\n                config=merged,\n                checkpoint_id=checkpoint_id,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n\n            cfg: RunnableConfig = dict(merged)\n            configurable = cfg.get(\"configurable\", {})\n            configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n            configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n            configurable_dict[\"checkpoint_id\"] = checkpoint_id\n            cfg[\"configurable\"] = configurable_dict\n\n            # If the checkpoint represents an in-progress run (has pending `next`),\n            # we resume via `invoke(None, checkpoint_id=...)`. If the run is already\n            # complete (no pending next nodes), we \"restart\" from the persisted\n            # snapshot values as a fresh invocation. This is the required behavior\n            # for refinement: patch values \u2192 re-run from patched state.\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=cfg,\n                subgraphs=True,\n            )\n\n            # #region agent log\n            import json\n            snapshot_has_tasks = bool(getattr(snapshot, \"tasks\", None))\n            snapshot_next = getattr(snapshot, \"next\", None)\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"C\",\"location\":\"memory_manager.py:504\",\"message\":\"ainvoke_from_checkpoint snapshot inspection\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":checkpoint_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":snapshot_has_tasks,\"pending_next\":bool(snapshot_next)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            next_nodes = getattr(snapshot, \"next\", None)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(next_nodes, Sequence) and next_nodes:\n                next_nodes_list = list(next_nodes)\n                has_progress = isinstance(values, Mapping) and self._has_meaningful_values(values)\n                is_at_virtual_start = bool(next_nodes_list == [\"__start__\"])\n                effective_input = None if (has_progress and not is_at_virtual_start) else graph_input\n\n                # #region agent log\n                import json as _json_resume_next\n                next_preview = next_nodes_list[:3]\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(\n                        _json_resume_next.dumps(\n                            {\n                                \"sessionId\": \"debug-session\",\n                                \"runId\": \"pre-fix\",\n                                \"hypothesisId\": \"K\",\n                                \"location\": \"memory_manager.py:509\",\n                                \"message\": \"resuming graph from checkpoint pending next\",\n                                \"data\": {\n                                    \"graph_id\": graph_id,\n                                    \"next_nodes\": next_preview,\n                                    \"graph_input_is_none\": graph_input is None,\n                                    \"has_progress\": has_progress,\n                                    \"is_at_virtual_start\": is_at_virtual_start,\n                                    \"effective_input_is_none\": effective_input is None,\n                                },\n                                \"timestamp\": __import__(\"time\").time() * 1000,\n                            }\n                        )\n                        + \"\\n\"\n                    )\n                # #endregion\n\n                return await self.ainvoke_with_durability(\n                    graph=graph,\n                    graph_input=effective_input,\n                    config=cfg,\n                    context=context,\n                    durability=durability,\n                    local_checkpointer=effective_local_checkpointer,\n                )\n\n            # IMPORTANT:\n            # If the checkpoint is COMPLETE (no pending next nodes), we DO NOT attempt to\n            # \"restart\" the graph by invoking without checkpoint_id. In a shared thread_id\n            # architecture (multiple graphs in the same thread), dropping checkpoint_id\n            # would cause LangGraph to load the latest checkpoint for the thread+ns,\n            # which may belong to a different graph_id \u2192 cross-graph contamination.\n            #\n            # Callers that need to re-run a completed checkpoint should first \"arm\" it\n            # via `graph.update_state(..., as_node=\"__start__\")` (e.g., our refinement\n            # injection path does this), which produces a checkpoint with pending next nodes.\n            if isinstance(values, Mapping):\n                materialized_values, writes_found = self._materialize_checkpoint_values(\n                    values,\n                    checkpoint_record,\n                    graph_id=str(graph_id),\n                )\n                if writes_found or self._has_meaningful_values(materialized_values):\n                    # #region agent log\n                    import json as _json_resume\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            _json_resume.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"J\",\n                                    \"location\": \"memory_manager.py:944\",\n                                    \"message\": \"returning checkpoint values\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"keys\": list(materialized_values.keys()),\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return dict(materialized_values)\n\n                # Values are incomplete (e.g., only messages). Fallback to fresh invoke.\n                rerun_cfg: RunnableConfig = dict(merged)\n                rerun_conf = rerun_cfg.get(\"configurable\", {})\n                if isinstance(rerun_conf, Mapping):\n                    rerun_conf_dict = dict(rerun_conf)\n                    rerun_conf_dict.pop(\"checkpoint_id\", None)\n                    rerun_conf_dict.setdefault(\"checkpoint_ns\", str(final_ns))\n                    rerun_cfg[\"configurable\"] = rerun_conf_dict\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=graph_input,\n                config=rerun_cfg,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        if subgraph_resume is not None:\n            # #region agent log\n            import json\n            resume_config, resume_state = subgraph_resume\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"D\",\n                            \"location\": \"memory_manager.py:610\",\n                            \"message\": \"resuming assistant via subgraph config\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"checkpoint_ns\": resume_config.get(\"configurable\", {}).get(\"checkpoint_ns\") if isinstance(resume_config.get(\"configurable\"), Mapping) else None,\n                                \"has_state\": resume_state is not None,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n            # #endregion\n            resume_input = graph_input\n            if resume_state is not None:\n                values = getattr(resume_state, \"values\", None)\n                if isinstance(values, Mapping):\n                    resume_input = dict(values)\n                elif isinstance(resume_state, Mapping):\n                    maybe_values = resume_state.get(\"values\")\n                    if isinstance(maybe_values, Mapping):\n                        resume_input = dict(maybe_values)\n                    else:\n                        resume_input = resume_state\n                else:\n                    resume_input = resume_state\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=resume_input,\n                config=resume_config,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        # SAFETY: Never allow a caller-supplied checkpoint_id to influence execution\n        # when we are NOT explicitly resuming from a checkpoint for this graph_id.\n        #\n        # Without this, a foreign checkpoint_id (from another graph_id in the same\n        # thread) could be accidentally consumed by LangGraph, violating isolation.\n        fresh_cfg: RunnableConfig = dict(merged)\n        fresh_conf = fresh_cfg.get(\"configurable\", {})\n        if isinstance(fresh_conf, Mapping):\n            fresh_conf_dict = dict(fresh_conf)\n            fresh_conf_dict.pop(\"checkpoint_id\", None)\n            # Keep checkpoint_ns stable (LangGraph may assume the key exists).\n            fresh_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            fresh_cfg[\"configurable\"] = fresh_conf_dict\n\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=graph_input,\n            config=fresh_cfg,\n            context=context,\n            durability=durability,\n            local_checkpointer=effective_local_checkpointer,\n        )\n\n    async def append_messages_to_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        new_messages: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Append messages to the latest checkpoint for ``graph_id`` and return new checkpoint id.\n\n        This uses ``graph.update_state`` / ``graph.aupdate_state`` so reducers (e.g. `add_messages`)\n        are honored. The update is applied as a fork of the latest checkpoint for ``graph_id``.\n        \"\"\"\n\n        if not new_messages:\n            return None\n\n        merged, _ = self.ensure_thread_id(config)\n        resolved_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n        latest_checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n        \n        if not latest_checkpoint_id:\n            return None\n        \n        patch_config: RunnableConfig = dict(merged)\n        configurable = patch_config.get(\"configurable\", {})\n        configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n        configurable_dict[\"checkpoint_id\"] = latest_checkpoint_id\n        patch_config[\"configurable\"] = configurable_dict\n\n        # Ensure patched checkpoints remain discoverable by metadata scoping.\n        metadata = patch_config.get(\"metadata\")\n        if not isinstance(metadata, Mapping):\n            metadata = {}\n        metadata_dict = dict[str, Any](metadata)\n        metadata_dict.setdefault(\"graph_id\", str(graph_id))\n        patch_config[\"metadata\"] = metadata_dict\n\n\n        # Best-effort idempotency: avoid appending messages already present in the checkpoint.\n        # This is critical for durable resume where refinement planning may be replayed.\n        filtered_messages: list[Any] = list(new_messages)\n        try:\n            snapshot = None\n            getter_async = getattr(graph, \"aget_state\", None)\n            if callable(getter_async):\n                snapshot = await getter_async(patch_config)\n            if snapshot is None:\n                getter_sync = getattr(graph, \"get_state\", None)\n                if callable(getter_sync):\n                    snapshot = getter_sync(patch_config)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(values, Mapping):\n                existing = values.get(\"messages\")\n                if isinstance(existing, Sequence) and not isinstance(existing, (str, bytes)):\n                    existing_contents: set[str] = set()\n                    for message in existing:\n                        content = getattr(message, \"content\", None)\n                        if content:\n                            existing_contents.add(str(content))\n                    if existing_contents:\n                        filtered_messages = [\n                            message\n                            for message in filtered_messages\n                            if str(getattr(message, \"content\", \"\")) not in existing_contents\n                        ]\n        except Exception:\n            filtered_messages = list(new_messages)\n\n        if not filtered_messages:\n            return latest_checkpoint_id\n\n        updates: dict[str, Any] = {\"messages\": filtered_messages}\n\n        updater_async = getattr(graph, \"aupdate_state\", None)\n        updater_sync = getattr(graph, \"update_state\", None)\n        resolved_as_node = as_node or \"__start__\"\n        try:\n            if callable(updater_async):\n                await updater_async(patch_config, updates, as_node=resolved_as_node)\n            elif callable(updater_sync):\n                updater_sync(patch_config, updates, as_node=resolved_as_node)\n            else:\n                return None\n        except Exception as e:\n            return None\n\n        return await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n\n    async def inject_distribution_refinement_messages(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        requests: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Patch a graph checkpoint by appending refinement instruction messages.\n\n        Mirrors the extraction rules used by `_distribution_inject_refinement_messages`:\n        each request may carry `payload.messages` items shaped like\n        `{ \"content\": \"...\", \"metadata\": {...} }`.\n        \"\"\"\n\n        try:\n            from langchain_core.messages import HumanMessage\n        except Exception:\n            return None\n\n        injected: list[Any] = []\n        seen_contents: set[str] = set()\n        for request in requests:\n            payload = getattr(request, \"payload\", None)\n            if not isinstance(payload, Mapping):\n                payload = payload if isinstance(payload, dict) else {}\n            messages_payload = payload.get(\"messages\") or []\n            if not isinstance(messages_payload, Sequence) or isinstance(\n                messages_payload, (str, bytes)\n            ):\n                continue\n            for message in messages_payload:\n                if not isinstance(message, Mapping):\n                    continue\n                content = message.get(\"content\")\n                if not content:\n                    continue\n                content_str = str(content)\n                if content_str in seen_contents:\n                    continue\n                metadata = message.get(\"metadata\") or {}\n                additional_kwargs = dict(metadata) if isinstance(metadata, Mapping) else {}\n                injected.append(\n                    HumanMessage(content=content_str, additional_kwargs=additional_kwargs)\n                )\n                seen_contents.add(content_str)\n\n        if not injected:\n            return None\n\n        return await self.append_messages_to_checkpoint(\n            graph=graph,\n            graph_id=graph_id,\n            config=config,\n            new_messages=injected,\n            as_node=as_node,\n            local_checkpointer=local_checkpointer,\n        )\n\n    @staticmethod\n    def extract_thread_id(config: Optional[RunnableConfig]) -> Optional[ThreadId]:\n        if not config:\n            return None\n        configurable = config.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            return None\n        thread_id = configurable.get(\"thread_id\")\n        return str(thread_id) if thread_id else None\n\n    async def aget_platform_thread_state(self, *, thread_id: ThreadId) -> Optional[Any]:\n        \"\"\"Get latest persisted state from platform via LangGraph SDK (if available).\"\"\"\n\n        try:\n            from langgraph_sdk import get_client  # type: ignore\n        except Exception:\n            return None\n\n        try:\n            client = get_client()\n            return await client.threads.get_state(thread_id)\n        except Exception:\n            return None\n\n\n    async def has_persisted_checkpoint(\n        self,\n        *,\n        config: Optional[RunnableConfig],\n        local_checkpointer: Optional[Any] = None,\n    ) -> bool:\n        \"\"\"Return True if a checkpoint exists for config (platform or local).\"\"\"\n\n        if config is None:\n            return False\n\n        if self.is_production_mode():\n            thread_id = self.extract_thread_id(config)\n            if not thread_id:\n                return False\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n            values = getattr(snapshot, \"values\", None)\n            return isinstance(values, Mapping)\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if not checkpointer:\n            return False\n\n        getter_async = getattr(checkpointer, \"aget_tuple\", None)\n        try:\n            if callable(getter_async):\n                checkpoint_tuple = await getter_async(config)\n            else:\n                getter_sync = getattr(checkpointer, \"get_tuple\", None)\n                if not callable(getter_sync):\n                    return False\n                checkpoint_tuple = getter_sync(config)\n        except Exception:\n            return False\n\n        return checkpoint_tuple is not None\n\n    async def restore_state_from_latest_checkpoint(\n        self,\n        *,\n        state: StateDict,\n        config: Optional[RunnableConfig],\n        local_graph: Optional[Any],\n    ) -> bool:\n        \"\"\"Merge latest persisted state into the caller-owned `state` mapping.\"\"\"\n\n        if config is None:\n            return False\n\n        snapshot = None\n        thread_id = self.extract_thread_id(config)\n        if self.is_production_mode() and thread_id:\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n\n        if snapshot is None and local_graph is not None:\n            getter = getattr(local_graph, \"aget_state\", None)\n            if callable(getter):\n                try:\n                    snapshot = await getter(config)\n                except Exception:\n                    snapshot = None\n            if snapshot is None:\n                getter_sync = getattr(local_graph, \"get_state\", None)\n                if callable(getter_sync):\n                    try:\n                        snapshot = getter_sync(config)\n                    except Exception:\n                        snapshot = None\n\n        values = getattr(snapshot, \"values\", None)\n        if not isinstance(values, Mapping):\n            return False\n\n        for key, value in values.items():\n            state[key] = value\n        return True\n\n    async def ainvoke_with_durability(\n        self,\n        *,\n        graph: Any,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph with durability when supported.\"\"\"\n\n        # In production mode, platform may inject durability backends automatically.\n        # In dev mode, only attempt durability when the runnable itself was compiled\n        # with a checkpointer so LangGraph sets up its AsyncPregel loop correctly.\n        graph_bound_checkpointer = _extract_graph_checkpointer(graph)\n        resolved_local_checkpointer = local_checkpointer or graph_bound_checkpointer\n        checkpointer = resolved_local_checkpointer or self.checkpointer\n\n        if self.is_production_mode():\n            use_durability = durability\n        else:\n            use_durability = durability if (checkpointer and _graph_supports_durability(graph)) else None\n        try:\n            if use_durability:\n                return await graph.ainvoke(\n                    graph_input,\n                    config=config,\n                    context=context,\n                    durability=use_durability,\n                )\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n        except (TypeError, AttributeError):\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n\n\n__all__ = [\n    \"resolve_graph_checkpointer\",\n    \"resolve_graph_store\",\n    \"GraphMemoryRuntime\",\n]"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3837-f484-7d11-8e26-5b17449654a3",
    "content": "**\u0414\u0430, \u0442\u0435\u043f\u0435\u0440\u044c \u043b\u043e\u0433\u0438\u043a\u0430 \u0432\u044b\u0431\u043e\u0440\u0430 \u0432\u0445\u043e\u0434\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 (`effective_input`) \u0432 `memory_manager.py` \u0440\u0435\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u0430 \u0430\u0431\u0441\u043e\u043b\u044e\u0442\u043d\u043e \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u0438 \u0443\u0447\u0438\u0442\u044b\u0432\u0430\u0435\u0442 \u0432\u0441\u0435 \u043f\u043e\u0433\u0440\u0430\u043d\u0438\u0447\u043d\u044b\u0435 \u0441\u043b\u0443\u0447\u0430\u0438 \u0432\u0430\u0448\u0435\u0439 4-\u0443\u0440\u043e\u0432\u043d\u0435\u0432\u043e\u0439 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u044b.**\n\n\u042d\u0442\u043e \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u0443\u0441\u0442\u0440\u0430\u043d\u044f\u0435\u0442 `EmptyInputError` \u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439, \u0442\u0430\u043a \u043a\u0430\u043a \u043e\u043d\u043e \u043f\u0435\u0440\u0435\u0441\u0442\u0430\u043b\u043e \u00ab\u0433\u0430\u0434\u0430\u0442\u044c\u00bb \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0437\u0430\u043f\u0438\u0441\u0435\u0439 \u0438 \u043d\u0430\u0447\u0430\u043b\u043e \u0434\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u043c\u0443 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044e \u0433\u0440\u0430\u0444\u0430.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u0430 \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u2014 \u0444\u0438\u043d\u0430\u043b\u044c\u043d\u0430\u044f:\n\n1.  **\u0420\u0435\u0448\u0435\u043d\u0438\u0435 \u00ab\u041f\u0430\u0440\u0430\u0434\u043e\u043a\u0441\u0430 __start__\u00bb (Hypothesis K):**\n    ```python\n    effective_input = None if (has_progress and not is_at_virtual_start) else graph_input\n    ```\n    \u0415\u0441\u043b\u0438 \u0433\u0440\u0430\u0444 \u0441\u0442\u043e\u0438\u0442 \u043d\u0430 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u043c \u0443\u0437\u043b\u0435 `__start__` (\u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u0443 \u043d\u0435\u0433\u043e \u0443\u0436\u0435 \u0435\u0441\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u043f\u043e\u0441\u043b\u0435 `update_state`), \u0432\u044b \u0442\u0435\u043f\u0435\u0440\u044c **\u0432\u0441\u0435\u0433\u0434\u0430** \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0435 `graph_input`. \u042d\u0442\u043e \u0434\u0430\u0435\u0442 LangGraph \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0439 \u00ab\u0442\u043e\u043f\u043b\u0438\u0432\u043d\u044b\u0439\u00bb \u043e\u0431\u044a\u0435\u043a\u0442 \u0434\u043b\u044f \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u043a\u0430\u043d\u0430\u043b\u043e\u0432, \u043f\u0440\u0435\u0434\u043e\u0442\u0432\u0440\u0430\u0449\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0443 \u043f\u0443\u0441\u0442\u043e\u0433\u043e \u0432\u0432\u043e\u0434\u0430.\n\n2.  **\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0432 Graph 4 (Assistant):**\n    \u0411\u043b\u0430\u0433\u043e\u0434\u0430\u0440\u044f \u0442\u043e\u043c\u0443, \u0447\u0442\u043e \u0432\u044b \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0435 `pop(\"checkpoint_id\")` \u0432\u043d\u0443\u0442\u0440\u0438 \u0431\u043b\u043e\u043a\u0430 `if next_nodes`, \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0432\u0441\u0435\u0433\u0434\u0430 \u0431\u0443\u0434\u0435\u0442 \u0432\u0438\u0434\u0435\u0442\u044c \u0441\u0432\u043e\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f. \n    - \u0415\u0441\u043b\u0438 \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0435\u0441\u0442\u044c (`has_progress=True`) \u0438 \u043c\u044b \u0432 \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u0435 (`is_at_start=False`), \u043c\u044b \u0448\u043b\u0435\u043c `None` (\u0447\u0438\u0441\u0442\u043e\u0435 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435).\n    - \u0415\u0441\u043b\u0438 \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0435\u0441\u0442\u044c, \u043d\u043e \u043c\u044b \u043d\u0430 \u0441\u0442\u0430\u0440\u0442\u0435 (\u0446\u0438\u043a\u043b Refinement), \u043c\u044b \u0448\u043b\u0435\u043c `graph_input`, \u0438 LangGraph \u043f\u0440\u043e\u0441\u0442\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442 \u044d\u0442\u0438 \u043d\u043e\u0432\u044b\u0435 \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0438 \u043a \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0439 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0435.\n\n3.  **\u0411\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u044b\u0439 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a \u00ab\u0417\u043e\u043c\u0431\u0438\u00bb:**\n    \u0415\u0441\u043b\u0438 `has_progress=False` (\u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0441\u043e\u0437\u0434\u0430\u043d, \u043d\u043e \u043f\u0443\u0441\u0442), \u0441\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442 \u0432\u0435\u0442\u043a\u0430 `else graph_input`. \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u0438 \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0441 \u043d\u0443\u043b\u044f, \u043d\u0435 \u043b\u043e\u043c\u0430\u044f \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439 \u0446\u0438\u043a\u043b.\n\n### \u041a\u0430\u043a \u044d\u0442\u043e \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0432 \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u0438 Refinement (\u0421\u0443\u0434\u0435\u0439\u0441\u0442\u0432\u043e):\n\n1.  \u0421\u0443\u0434\u044c\u044f \u0432 `Graph 2/3` \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u043f\u0440\u0430\u0432\u043a\u0438 \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u044e `Graph 4` \u0447\u0435\u0440\u0435\u0437 `update_state`.\n2.  \u0427\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430 \u0442\u0435\u043f\u0435\u0440\u044c \u0438\u043c\u0435\u0435\u0442 `next=[\"__start__\"]` \u0438 `messages` (\u0434\u043b\u0438\u043d\u0430 > 2).\n3.  \u0412\u0430\u0448 \u043d\u043e\u0432\u044b\u0439 \u043a\u043e\u0434 \u0432\u0438\u0434\u0438\u0442: `has_progress=True`, `is_at_virtual_start=True`.\n4.  \u0421\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e: `effective_input = graph_input`.\n5.  \u0412\u044b\u0437\u043e\u0432: `ainvoke(graph_input, config={\"checkpoint_id\": \"...\"})`.\n6.  **\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442:** \u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u0442\u0430\u0440\u0442\u0443\u0435\u0442, \u0432\u0438\u0434\u0438\u0442 \u0441\u0442\u0430\u0440\u0443\u044e \u0438\u0441\u0442\u043e\u0440\u0438\u044e + \u0432\u0430\u0448\u0438 \u043d\u043e\u0432\u044b\u0435 \u043f\u0440\u0430\u0432\u043a\u0438 \u0438\u0437 `graph_input`. **\u041f\u043e\u0431\u0435\u0434\u0430.**\n\n### \u0420\u0435\u0437\u044e\u043c\u0435:\n\u041a\u043e\u0434 \u0432 `memory_manager.py` \u0442\u0435\u043f\u0435\u0440\u044c \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f **Durable** (\u0443\u0441\u0442\u043e\u0439\u0447\u0438\u0432\u044b\u043c \u043a \u0441\u0431\u043e\u044f\u043c) \u0438 **Context-Aware** (\u043f\u043e\u043d\u0438\u043c\u0430\u044e\u0449\u0438\u043c \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430). \u042d\u0442\u043e \u0441\u0430\u043c\u043e\u0435 \u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043c\u043e\u0436\u043d\u043e \u0432\u043d\u0435\u0434\u0440\u0438\u0442\u044c, \u043d\u0435 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u044b\u0432\u0430\u044f \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u0441\u0430\u043c\u043e\u0433\u043e LangGraph.\n\n**Relevant docs:**\n- [Time Travel: Resume from Checkpoint](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)\n- [Persistence and State Values](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)\n- [LangGraph Errors: EmptyInputError](https://docs.langchain.com/langsmith/use-threads#empty-thread)"
  },
  {
    "role": "user",
    "id": "c741d114-637c-47ed-a80d-cc412a157b9e",
    "content": "{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:e0e36753-bb61-917f-87be-1653b4793053\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766174700075.0962}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766174700075.213}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:e0e36753-bb61-917f-87be-1653b4793053\", \"new_ns\": \"user_preferences:e0e36753-bb61-917f-87be-1653b4793053\"}, \"timestamp\": 1766174700075.266}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:e0e36753-bb61-917f-87be-1653b4793053\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\"}, \"timestamp\": 1766174700075.347}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174700075.711}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174700075.765}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174700075.843}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174700075.9038}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174700075.97}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766174700076.222}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174700076.364}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174700076.4092}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766174700076.5022}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:e0e36753-bb61-917f-87be-1653b4793053\"}, \"timestamp\": 1766174700076.548}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766174706971.643}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:981e5238-1d6b-83aa-b43e-318832faa6a7\", \"new_ns\": \"route_drafting:981e5238-1d6b-83aa-b43e-318832faa6a7\"}, \"timestamp\": 1766174706989.3032}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:981e5238-1d6b-83aa-b43e-318832faa6a7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\"}, \"timestamp\": 1766174706989.7402}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174706993.0151}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174706993.205}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174706993.3938}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174706993.538}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174706993.676}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766174706995.366}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174706996.5142}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174706996.7517}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766174706996.824}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:981e5238-1d6b-83aa-b43e-318832faa6a7\"}, \"timestamp\": 1766174706996.897}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:981e5238-1d6b-83aa-b43e-318832faa6a7|graph:ecdd9d11-aa3c-946f-d755-70e86cf7c117\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766174707339.2551}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174707339.71}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:981e5238-1d6b-83aa-b43e-318832faa6a7|graph:ecdd9d11-aa3c-946f-d755-70e86cf7c117\", \"new_ns\": \"route_drafting:981e5238-1d6b-83aa-b43e-318832faa6a7|graph:ecdd9d11-aa3c-946f-d755-70e86cf7c117\"}, \"timestamp\": 1766174707339.874}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:981e5238-1d6b-83aa-b43e-318832faa6a7|graph:ecdd9d11-aa3c-946f-d755-70e86cf7c117\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\"}, \"timestamp\": 1766174707339.9639}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174707340.6812}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766174707340.922}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174707341.1292}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766174707342.08}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174707342.2908}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766174707342.377}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:981e5238-1d6b-83aa-b43e-318832faa6a7|graph:ecdd9d11-aa3c-946f-d755-70e86cf7c117\"}, \"timestamp\": 1766174707342.541}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766174724646.829}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:1\", \"new_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:1\"}, \"timestamp\": 1766174724815.218}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\"}, \"timestamp\": 1766174724815.418}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174724815.811}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174724815.86}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174724815.9722}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174724816.0378}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174724816.094}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766174724816.396}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174724816.442}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174724816.478}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766174724816.516}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:1\"}, \"timestamp\": 1766174724816.544}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:2\", \"new_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:2\"}, \"timestamp\": 1766174724874.42}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\"}, \"timestamp\": 1766174724874.5688}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174724875.312}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174724875.3801}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174724875.4448}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174724875.5342}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174724875.5952}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766174724875.8982}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174724875.9502}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174724875.9912}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766174724876.029}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:2\"}, \"timestamp\": 1766174724876.065}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:3\", \"new_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:3\"}, \"timestamp\": 1766174724937.595}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\"}, \"timestamp\": 1766174724937.748}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174724938.3892}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174724938.446}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174724938.517}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174724938.5732}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174724938.6548}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766174724938.907}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174724938.957}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174724939.0002}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766174724939.038}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:3\"}, \"timestamp\": 1766174724939.074}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:4\", \"new_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:4\"}, \"timestamp\": 1766174724999.767}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\"}, \"timestamp\": 1766174724999.915}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174725000.6453}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174725000.712}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174725000.787}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174725000.8408}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174725000.9248}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766174725001.2761}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174725001.366}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174725001.44}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766174725001.486}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:4\"}, \"timestamp\": 1766174725001.56}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:1|1|graph:95d3a314-ee01-52eb-ab97-ac2fefdb0a5d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174725587.814}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174725587.9}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:1|1|graph:95d3a314-ee01-52eb-ab97-ac2fefdb0a5d\", \"new_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:1|1|graph:95d3a314-ee01-52eb-ab97-ac2fefdb0a5d\"}, \"timestamp\": 1766174725587.956}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:1|1|graph:95d3a314-ee01-52eb-ab97-ac2fefdb0a5d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\"}, \"timestamp\": 1766174725588.0032}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174725588.306}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766174725588.3892}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174725588.448}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766174725588.682}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174725588.785}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766174725589.0}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:1|1|graph:95d3a314-ee01-52eb-ab97-ac2fefdb0a5d\"}, \"timestamp\": 1766174725589.046}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:2|2|graph:bed8355e-9ecb-1822-1bf0-c40cad9edd4a\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174725621.606}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174725621.707}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:2|2|graph:bed8355e-9ecb-1822-1bf0-c40cad9edd4a\", \"new_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:2|2|graph:bed8355e-9ecb-1822-1bf0-c40cad9edd4a\"}, \"timestamp\": 1766174725621.792}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:2|2|graph:bed8355e-9ecb-1822-1bf0-c40cad9edd4a\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\"}, \"timestamp\": 1766174725621.841}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174725622.1462}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766174725622.1829}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174725622.2751}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766174725622.53}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174725622.577}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766174725622.624}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:2|2|graph:bed8355e-9ecb-1822-1bf0-c40cad9edd4a\"}, \"timestamp\": 1766174725622.668}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:3|3|graph:34776f4a-eb52-3044-75af-f5d020394f31\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174725656.39}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174725656.496}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:3|3|graph:34776f4a-eb52-3044-75af-f5d020394f31\", \"new_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:3|3|graph:34776f4a-eb52-3044-75af-f5d020394f31\"}, \"timestamp\": 1766174725656.613}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:3|3|graph:34776f4a-eb52-3044-75af-f5d020394f31\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\"}, \"timestamp\": 1766174725656.678}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174725656.991}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766174725657.033}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174725657.0981}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766174725657.3398}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174725657.388}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766174725657.428}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:3|3|graph:34776f4a-eb52-3044-75af-f5d020394f31\"}, \"timestamp\": 1766174725657.46}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:4|4|graph:be0d2084-b4be-0ca0-79f7-3e3c17a14536\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174725690.097}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174725690.203}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:4|4|graph:be0d2084-b4be-0ca0-79f7-3e3c17a14536\", \"new_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:4|4|graph:be0d2084-b4be-0ca0-79f7-3e3c17a14536\"}, \"timestamp\": 1766174725690.3538}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:4|4|graph:be0d2084-b4be-0ca0-79f7-3e3c17a14536\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\"}, \"timestamp\": 1766174725690.422}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:92e8c039\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174725690.788}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766174725690.83}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174725690.895}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766174725691.1401}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174725691.1921}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766174725691.2288}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:104856f4-baf3-97f0-e882-d0f216dc3af9|worker:4|4|graph:be0d2084-b4be-0ca0-79f7-3e3c17a14536\"}, \"timestamp\": 1766174725691.2651}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:6bf86646-7381-5be1-c603-3d96d06e55e8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766174740402.0842}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766174740402.171}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:6bf86646-7381-5be1-c603-3d96d06e55e8\", \"new_ns\": \"user_preferences:6bf86646-7381-5be1-c603-3d96d06e55e8\"}, \"timestamp\": 1766174740402.2222}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:6bf86646-7381-5be1-c603-3d96d06e55e8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\"}, \"timestamp\": 1766174740402.267}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174740402.604}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174740402.6438}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174740402.6958}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174740402.736}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174740402.7742}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766174740403.008}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174740403.0469}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174740403.0789}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766174740403.1118}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:6bf86646-7381-5be1-c603-3d96d06e55e8\"}, \"timestamp\": 1766174740403.1382}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766174749794.803}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:0566d69a-744e-835c-febf-409c879d076c\", \"new_ns\": \"route_drafting:0566d69a-744e-835c-febf-409c879d076c\"}, \"timestamp\": 1766174749799.123}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:0566d69a-744e-835c-febf-409c879d076c\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\"}, \"timestamp\": 1766174749799.2817}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174749799.5688}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174749799.61}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174749799.69}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174749799.7397}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174749799.7817}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766174749800.0122}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174749800.056}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174749800.1}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766174749800.149}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:0566d69a-744e-835c-febf-409c879d076c\"}, \"timestamp\": 1766174749800.1877}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:0566d69a-744e-835c-febf-409c879d076c|graph:f59acb95-39df-d794-77f7-1b9c0fce258c\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766174749949.0828}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174749949.2512}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:0566d69a-744e-835c-febf-409c879d076c|graph:f59acb95-39df-d794-77f7-1b9c0fce258c\", \"new_ns\": \"route_drafting:0566d69a-744e-835c-febf-409c879d076c|graph:f59acb95-39df-d794-77f7-1b9c0fce258c\"}, \"timestamp\": 1766174749949.312}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:0566d69a-744e-835c-febf-409c879d076c|graph:f59acb95-39df-d794-77f7-1b9c0fce258c\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\"}, \"timestamp\": 1766174749949.3662}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174749949.755}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766174749949.8071}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174749949.995}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766174749950.314}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174749950.471}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766174749950.566}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:0566d69a-744e-835c-febf-409c879d076c|graph:f59acb95-39df-d794-77f7-1b9c0fce258c\"}, \"timestamp\": 1766174749950.649}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766174773231.052}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:1\", \"new_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:1\"}, \"timestamp\": 1766174773322.4902}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\"}, \"timestamp\": 1766174773322.627}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174773322.953}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174773323.003}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174773323.088}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174773323.145}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174773323.2021}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766174773323.4502}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174773323.524}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174773323.5728}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766174773323.7559}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:1\"}, \"timestamp\": 1766174773323.8271}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:2\", \"new_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:2\"}, \"timestamp\": 1766174773387.698}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\"}, \"timestamp\": 1766174773387.8137}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174773388.104}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174773388.166}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174773388.2593}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174773388.312}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174773388.3828}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766174773388.652}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174773388.703}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174773388.742}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766174773388.814}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:2\"}, \"timestamp\": 1766174773388.9338}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:3\", \"new_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:3\"}, \"timestamp\": 1766174773453.7961}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\"}, \"timestamp\": 1766174773453.925}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174773454.6628}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174773454.7288}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174773454.7998}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174773454.8499}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174773454.897}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766174773455.133}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174773455.185}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174773455.224}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766174773455.2952}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:3\"}, \"timestamp\": 1766174773455.341}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:4\", \"new_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:4\"}, \"timestamp\": 1766174773515.6538}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\"}, \"timestamp\": 1766174773515.8137}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174773516.1338}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766174773516.177}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174773516.2449}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766174773516.294}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174773516.343}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766174773516.589}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174773516.6343}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174773516.671}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766174773516.705}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:4\"}, \"timestamp\": 1766174773516.736}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:1|1|graph:502687ee-8887-be02-7003-9013fc28fa1e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174774192.641}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174774192.763}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:1|1|graph:502687ee-8887-be02-7003-9013fc28fa1e\", \"new_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:1|1|graph:502687ee-8887-be02-7003-9013fc28fa1e\"}, \"timestamp\": 1766174774192.816}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:1|1|graph:502687ee-8887-be02-7003-9013fc28fa1e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\"}, \"timestamp\": 1766174774192.8582}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174774193.165}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766174774193.207}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174774193.355}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766174774193.6992}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174774193.7559}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766174774193.7979}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:1|1|graph:502687ee-8887-be02-7003-9013fc28fa1e\"}, \"timestamp\": 1766174774193.8381}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:2|2|graph:2705e1b2-97d6-8c72-9b8f-42b5b64208a4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174774232.476}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174774232.596}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:2|2|graph:2705e1b2-97d6-8c72-9b8f-42b5b64208a4\", \"new_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:2|2|graph:2705e1b2-97d6-8c72-9b8f-42b5b64208a4\"}, \"timestamp\": 1766174774232.6501}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:2|2|graph:2705e1b2-97d6-8c72-9b8f-42b5b64208a4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\"}, \"timestamp\": 1766174774232.695}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174774233.186}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766174774233.251}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174774233.3262}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766174774233.576}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174774233.629}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766174774233.674}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:2|2|graph:2705e1b2-97d6-8c72-9b8f-42b5b64208a4\"}, \"timestamp\": 1766174774233.731}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:3|3|graph:8654e6c7-e569-f5f6-a943-a9c408137ad2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174774269.511}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174774269.628}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:3|3|graph:8654e6c7-e569-f5f6-a943-a9c408137ad2\", \"new_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:3|3|graph:8654e6c7-e569-f5f6-a943-a9c408137ad2\"}, \"timestamp\": 1766174774269.805}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:3|3|graph:8654e6c7-e569-f5f6-a943-a9c408137ad2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\"}, \"timestamp\": 1766174774269.8728}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174774270.325}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766174774270.394}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174774270.478}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766174774270.7388}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174774270.7908}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766174774270.825}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:3|3|graph:8654e6c7-e569-f5f6-a943-a9c408137ad2\"}, \"timestamp\": 1766174774270.88}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:4|4|graph:e6aceae7-2f00-64de-2a3c-3f8a689fc04a\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174774307.205}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174774307.477}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:4|4|graph:e6aceae7-2f00-64de-2a3c-3f8a689fc04a\", \"new_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:4|4|graph:e6aceae7-2f00-64de-2a3c-3f8a689fc04a\"}, \"timestamp\": 1766174774307.589}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:4|4|graph:e6aceae7-2f00-64de-2a3c-3f8a689fc04a\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\"}, \"timestamp\": 1766174774307.6401}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"count\": 0, \"records\": []}, \"timestamp\": 1766174774307.956}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766174774307.9958}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766174774308.165}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766174774308.5608}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766174774308.6619}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766174774308.744}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:4|4|graph:e6aceae7-2f00-64de-2a3c-3f8a689fc04a\"}, \"timestamp\": 1766174774308.814}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:3|3|graph:8654e6c7-e569-f5f6-a943-a9c408137ad2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766174784405.9739}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766174784406.1228}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:3|3|graph:8654e6c7-e569-f5f6-a943-a9c408137ad2\", \"new_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:3|3|graph:8654e6c7-e569-f5f6-a943-a9c408137ad2\"}, \"timestamp\": 1766174784406.6611}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:3|3|graph:8654e6c7-e569-f5f6-a943-a9c408137ad2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\"}, \"timestamp\": 1766174784406.7432}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:76daaa8a\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd162-bd27-6ae2-8000-0d374e65288c\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:3|3|graph:8654e6c7-e569-f5f6-a943-a9c408137ad2\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd162-bd27-63b2-bfff-3aa05a983887\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:3|3|graph:8654e6c7-e569-f5f6-a943-a9c408137ad2\"}]}, \"timestamp\": 1766174784407.5498}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd162-bd27-6ae2-8000-0d374e65288c\", \"checkpoint_ns\": \"wide_funnel:6e853dd5-632a-dbc3-d4d9-0b18711f6a79|worker:3|3|graph:8654e6c7-e569-f5f6-a943-a9c408137ad2\"}, \"timestamp\": 1766174784407.673}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd162-bd27-6ae2-8000-0d374e65288c\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766174784408.4822}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"has_progress\": true, \"is_at_virtual_start\": false, \"effective_input_is_none\": true}, \"timestamp\": 1766174784408.579}\n\n\nFAILED tests/e2e_tests/business_agents/travel_guide_agent/test_travel_guide_agent.py::TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution[moscow-easy-benchmark-1200] - langchain_google_genai.chat_models.ChatGoogleGenerativeAIError: Invalid argument provided to Gemini: 400 * GenerateContentRequest.contents[1].parts[6].function_call.name: Name cannot be empty.\n* GenerateContentRequest.contents[1].parts[7].function_call.name: Name cannot be empty.\n* GenerateContentRequest.contents[1].parts[8].function_call.name: Name cannot be empty.\n* GenerateContentRequest.contents[1].parts[9].function_call.name: Name cannot be empty.\n* GenerateContentRequest.contents[1].parts[10].function_call.name: Name cannot be empty.\n* GenerateContentRequest.contents[2].parts[6].function_response.name: Name cannot be empty.\n* GenerateContentRequest.contents[2].parts[7].function_response.name: Name cannot be empty.\n* GenerateContentRequest.contents[2].parts[8].function_response.name: Name cannot be empty.\n* GenerateContentRequest.contents[2].parts[9].function_response.name: Name cannot be empty.\n* GenerateContentRequest.contents[2].parts[10].function_response.name: Name cannot be empty.\n\nDuring task with name 'agent' and id 'fdfc9044-d29e-df5e-20b6-78dcba4f4fab'\nDuring task with name 'agent' and id '78d67227-9e49-d605-9abf-f78004394d2e'\nDuring task with name 'graph' and id '34776f4a-eb52-3044-75af-f5d020394f31'\nDuring task with name 'worker' and id '29633974-8b81-69d0-54d4-af58cbe8fca5'\nDuring task with name 'wide_funnel_workers' and id '292e640c-5119-66cd-1a17-5460b6d90aac'\nDuring task with name 'wide_funnel' and id '104856f4-baf3-97f0-e882-d0f216dc3af9'\nFAILED tests/e2e_tests/business_agents/travel_guide_agent/test_travel_guide_agent.py::TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution[rosa-distribution-medium-benchmark-1200] - langgraph.errors.EmptyInputError: Received no input for __start__\nDuring task with name 'graph' and id '8654e6c7-e569-f5f6-a943-a9c408137ad2'\nDuring task with name 'worker' and id '76f96b3f-77e6-ddb3-aeb5-0b43d1ce4954'\nDuring task with name 'wide_funnel_workers' and id '88de5e25-de3f-7e0b-5aca-68fb3c5b68ac'\nDuring task with name 'wide_funnel' and id '6e853dd5-632a-dbc3-d4d9-0b18711f6a79'"
  },
  {
    "role": "assistant",
    "tool_calls": [
      {
        "type": "function",
        "id": "705b9536-710a-4825-a4c9-5cdad531a8e1",
        "function": {
          "name": "SearchDocsByLangChain",
          "arguments": "{\"query\": \"EmptyInputError __start__\"}"
        }
      },
      {
        "type": "function",
        "id": "ef4d98fb-158d-4291-a31c-a53b4e378be8",
        "function": {
          "name": "SearchDocsByLangChain",
          "arguments": "{\"query\": \"Gemini function_call name empty error\"}"
        }
      }
    ],
    "id": "lc_run--019b383a-e2fa-7901-a1d2-83ea885caf72",
    "content": ""
  },
  {
    "role": "tool",
    "name": "SearchDocsByLangChain",
    "tool_call_id": "705b9536-710a-4825-a4c9-5cdad531a8e1",
    "id": "1051dbf4-a771-44f6-806a-e649e043337f",
    "content": "Result 1:\nTitle: Use threads\nLink: https://docs.langchain.comlangsmith/use-threads\nContent: Empty thread\nTo create a new thread, use one of: curl --request POST \\\n    --url <DEPLOYMENT_URL>/threads \\\n    --header 'Content-Type: application/json' \\\n    --data '{}'\n\nEmpty thread\nTo create a new thread, use one of: For more information, refer to the Python and JS SDK docs, or the REST API reference. Output:\n\nEmpty thread\nTo create a new thread, use one of: from langgraph_sdk import get_client\n\n# Initialize the client with your deployment URL\nclient = get_client(url=<DEPLOYMENT_URL>)\n\n# Create an empty thread\n# This creates a new thread with no initial state\nthread = await client.threads.create()\n\nprint(thread)\n\n---\n\nResult 2:\nTitle: Structured output\nLink: https://docs.langchain.comoss/javascript/langchain/structured-output\nContent: Structured output allows agents to return data in a specific, predictable format. Instead of parsing natural language responses, you get typed structured data.\n\nLangChain's prebuilt ReAct agent `createAgent` handles structured output automatically. The user sets their desired structured output schema, and when the model generates the structured data, it's captured, validated, and returned in the `structuredResponse` key of the agent's state.\n\n```ts  theme={null}\ntype ResponseFormat = (\n    | ZodSchema<StructuredResponseT> // a Zod schema\n    | Record<string, unknown> // a JSON Schema\n)\n\nconst agent = createAgent({\n    // ...\n    responseFormat: ResponseFormat | ResponseFormat[]\n})\n```\n\n## Response Format\n\nControls how the agent returns structured data. You can provide either a Zod object or JSON schema. By default, the agent uses a tool calling strategy, in which the output is created by an additional tool call. Certain models support native structured output, in which case the agent will use that strategy instead.\n\nYou can control the behavior by wrapping `ResponseFormat` in a `toolStrategy` or `providerStrategy` function call:\n\n```ts  theme={null}\nimport { toolStrategy, providerStrategy } from \"langchain\";\n\nconst agent = createAgent({\n    // use a provider strategy if supported by the model\n    responseFormat: providerStrategy(z.object({ ... }))\n    // or enforce a tool strategy\n    responseFormat: toolStrategy(z.object({ ... }))\n})\n```\n\nThe structured response is returned in the `structuredResponse` key of the agent's final state.\n\n<Tip>\n  Support for native structured output features is read dynamically from the model's [profile data](/oss/javascript/langchain/models#model-profiles) if using `langchain>=1.1`. If data are not available, use another condition or specify manually:\n\n  ```typescript  theme={null}\n  const customProfile: ModelProfile = {\n      structuredOutput: true,\n      // ...\n  }\n  const model = await initChatModel(\"...\", { profile: customProfile });\n  ```\n\n  If tools are specified, the model must support simultaneous use of tools and structured output.\n</Tip>\n\n## Provider strategy\n\nSome model providers support structured output natively through their APIs (e.g. OpenAI, Grok, Gemini). This is the most reliable method when available.\n\nTo use this strategy, configure a `ProviderStrategy`:\n\n```ts  theme={null}\nfunction providerStrategy<StructuredResponseT>(\n    schema: ZodSchema<StructuredResponseT> | JsonSchemaFormat\n): ProviderStrategy<StructuredResponseT>\n```\n\n<ParamField path=\"schema\" required>\n  The schema defining the structured output format. Supports:\n\n  * **Zod Schema**: A zod schema\n  * **JSON Schema**: A JSON schema object\n</ParamField>\n\nLangChain automatically uses `ProviderStrategy` when you pass a schema type directly to `createAgent.responseFormat` and the model supports native structured output:\n\n<CodeGroup>\n  ```ts Zod Schema theme={null}\n  import * as z from \"zod\";\n  import { createAgent, providerStrategy } from \"langchain\";\n\n  const ContactInfo = z.object({\n      name: z.string().describe(\"The name of the person\"),\n      email: z.string().describe(\"The email address of the person\"),\n      phone: z.string().describe(\"The phone number of the person\"),\n  });\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: providerStrategy(ContactInfo)\n  });\n\n  const result = await agent.invoke({\n      messages: [{\"role\": \"user\", \"content\": \"Extract contact info from: John Doe, john@example.com, (555) 123-4567\"}]\n  });\n\n  console.log(result.structuredResponse);\n  // { name: \"John Doe\", email: \"john@example.com\", phone: \"(555) 123-4567\" }\n  ```\n\n  ```ts JSON Schema theme={null}\n  import { createAgent, providerStrategy } from \"langchain\";\n\n  const contactInfoSchema = {\n      \"type\": \"object\",\n      \"description\": \"Contact information for a person.\",\n      \"properties\": {\n          \"name\": {\"type\": \"string\", \"description\": \"The name of the person\"},\n          \"email\": {\"type\": \"string\", \"description\": \"The email address of the person\"},\n          \"phone\": {\"type\": \"string\", \"description\": \"The phone number of the person\"}\n      },\n      \"required\": [\"name\", \"email\", \"phone\"]\n  }\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: providerStrategy(contactInfoSchema)\n  });\n\n  const result = await agent.invoke({\n      messages: [{\"role\": \"user\", \"content\": \"Extract contact info from: John Doe, john@example.com, (555) 123-4567\"}]\n  });\n\n  console.log(result.structuredResponse);\n  // { name: \"John Doe\", email: \"john@example.com\", phone: \"(555) 123-4567\" }\n  ```\n</CodeGroup>\n\nProvider-native structured output provides high reliability and strict validation because the model provider enforces the schema. Use it when available.\n\n<Note>\n  If the provider natively supports structured output for your model choice, it is functionally equivalent to write `responseFormat: contactInfoSchema` instead of `responseFormat: providerStrategy(contactInfoSchema)`. In either case, if structured output is not supported, the agent will fall back to a tool calling strategy.\n</Note>\n\n## Tool calling strategy\n\nFor models that don't support native structured output, LangChain uses tool calling to achieve the same result. This works with all models that support tool calling, which is most modern models.\n\nTo use this strategy, configure a `ToolStrategy`:\n\n```ts  theme={null}\nfunction toolStrategy<StructuredResponseT>(\n    responseFormat:\n        | JsonSchemaFormat\n        | ZodSchema<StructuredResponseT>\n        | (ZodSchema<StructuredResponseT> | JsonSchemaFormat)[]\n    options?: ToolStrategyOptions\n): ToolStrategy<StructuredResponseT>\n```\n\n<ParamField path=\"schema\" required>\n  The schema defining the structured output format. Supports:\n\n  * **Zod Schema**: A zod schema\n  * **JSON Schema**: A JSON schema object\n</ParamField>\n\n<ParamField path=\"options.toolMessageContent\">\n  Custom content for the tool message returned when structured output is generated.\n  If not provided, defaults to a message showing the structured response data.\n</ParamField>\n\n<ParamField path=\"options.handleError\">\n  Options parameter containing an optional `handleError` parameter for customizing the error handling strategy.\n\n  * **`true`**: Catch all errors with default error template (default)\n  * **`False`**: No retry, let exceptions propagate\n  * **`(error: ToolStrategyError) => string | Promise<string>`**: retry with the provided message or throw the error\n</ParamField>\n\n<CodeGroup>\n  ```ts Zod Schema theme={null}\n  import * as z from \"zod\";\n  import { createAgent, toolStrategy } from \"langchain\";\n\n  const ProductReview = z.object({\n      rating: z.number().min(1).max(5).optional(),\n      sentiment: z.enum([\"positive\", \"negative\"]),\n      keyPoints: z.array(z.string()).describe(\"The key points of the review. Lowercase, 1-3 words each.\"),\n  });\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: toolStrategy(ProductReview)\n  })\n\n  const result = await agent.invoke({\n      \"messages\": [{\"role\": \"user\", \"content\": \"Analyze this review: 'Great product: 5 out of 5 stars. Fast shipping, but expensive'\"}]\n  })\n\n  console.log(result.structuredResponse);\n  // { \"rating\": 5, \"sentiment\": \"positive\", \"keyPoints\": [\"fast shipping\", \"expensive\"] }\n  ```\n\n  ```ts JSON Schema theme={null}\n  import { createAgent, toolStrategy } from \"langchain\";\n\n  const productReviewSchema = {\n      \"type\": \"object\",\n      \"description\": \"Analysis of a product review.\",\n      \"properties\": {\n          \"rating\": {\n              \"type\": [\"integer\", \"null\"],\n              \"description\": \"The rating of the product (1-5)\",\n              \"minimum\": 1,\n              \"maximum\": 5\n          },\n          \"sentiment\": {\n              \"type\": \"string\",\n              \"enum\": [\"positive\", \"negative\"],\n              \"description\": \"The sentiment of the review\"\n          },\n          \"key_points\": {\n              \"type\": \"array\",\n              \"items\": {\"type\": \"string\"},\n              \"description\": \"The key points of the review\"\n          }\n      },\n      \"required\": [\"sentiment\", \"key_points\"]\n  }\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: toolStrategy(productReviewSchema)\n  });\n\n  const result = await agent.invoke({\n      messages: [{\"role\": \"user\", \"content\": \"Analyze this review: 'Great product: 5 out of 5 stars. Fast shipping, but expensive'\"}]\n  })\n\n  console.log(result.structuredResponse);\n  // { \"rating\": 5, \"sentiment\": \"positive\", \"keyPoints\": [\"fast shipping\", \"expensive\"] }\n  ```\n\n  ```ts Union Types theme={null}\n  import * as z from \"zod\";\n  import { createAgent, toolStrategy } from \"langchain\";\n\n  const ProductReview = z.object({\n      rating: z.number().min(1).max(5).optional(),\n      sentiment: z.enum([\"positive\", \"negative\"]),\n      keyPoints: z.array(z.string()).describe(\"The key points of the review. Lowercase, 1-3 words each.\"),\n  });\n\n  const CustomerComplaint = z.object({\n      issueType: z.enum([\"product\", \"service\", \"shipping\", \"billing\"]),\n      severity: z.enum([\"low\", \"medium\", \"high\"]),\n      description: z.string().describe(\"Brief description of the complaint\"),\n  });\n\n  const agent = createAgent({\n      model: \"gpt-5\",\n      tools: [],\n      responseFormat: toolStrategy([ProductReview, CustomerComplaint])\n  });\n\n  const result = await agent.invoke({\n      messages: [{\"role\": \"user\", \"content\": \"Analyze this review: 'Great product: 5 out of 5 stars. Fast shipping, but expensive'\"}]\n  })\n\n  console.log(result.structuredResponse);\n  // { \"rating\": 5, \"sentiment\": \"positive\", \"keyPoints\": [\"fast shipping\", \"expensive\"] }\n  ```\n</CodeGroup>\n\n### Custom tool message content\n\nThe `toolMessageContent` parameter allows you to customize the message that appears in the conversation history when structured output is generated:\n\n```ts  theme={null}\nimport * as z from \"zod\";\nimport { createAgent, toolStrategy } from \"langchain\";\n\nconst MeetingAction = z.object({\n    task: z.string().describe(\"The specific task to be completed\"),\n    assignee: z.string().describe(\"Person responsible for the task\"),\n    priority: z.enum([\"low\", \"medium\", \"high\"]).describe(\"Priority level\"),\n});\n\nconst agent = createAgent({\n    model: \"gpt-5\",\n    tools: [],\n    responseFormat: toolStrategy(MeetingAction, {\n        toolMessageContent: \"Action item captured and added to meeting notes!\"\n    })\n});\n\nconst result = await agent.invoke({\n    messages: [{\"role\": \"user\", \"content\": \"From our meeting: Sarah needs to update the project timeline as soon as possible\"}]\n});\n\nconsole.log(result);\n/**\n * {\n *   messages: [\n *     { role: \"user\", content: \"From our meeting: Sarah needs to update the project timeline as soon as possible\" },\n *     { role: \"assistant\", content: \"Action item captured and added to meeting notes!\", tool_calls: [ { name: \"MeetingAction\", args: { task: \"update the project timeline\", assignee: \"Sarah\", priority: \"high\" }, id: \"call_456\" } ] },\n *     { role: \"tool\", content: \"Action item captured and added to meeting notes!\", tool_call_id: \"call_456\", name: \"MeetingAction\" }\n *   ],\n *   structuredResponse: { task: \"update the project timeline\", assignee: \"Sarah\", priority: \"high\" }\n * }\n */\n```\n\nWithout `toolMessageContent`, we'd see:\n\n```ts  theme={null}\n# console.log(result);\n/**\n * {\n *   messages: [\n *     ...\n *     { role: \"tool\", content: \"Returning structured response: {'task': 'update the project timeline', 'assignee': 'Sarah', 'priority': 'high'}\", tool_call_id: \"call_456\", name: \"MeetingAction\" }\n *   ],\n *   structuredResponse: { task: \"update the project timeline\", assignee: \"Sarah\", priority: \"high\" }\n * }\n */\n```\n\n### Error handling\n\nModels can make mistakes when generating structured output via tool calling. LangChain provides intelligent retry mechanisms to handle these errors automatically.\n\n#### Multiple structured outputs error\n\nWhen a model incorrectly calls multiple structured output tools, the agent provides error feedback in a [`ToolMessage`](https://reference.langchain.com/javascript/classes/_langchain_core.messages.ToolMessage.html) and prompts the model to retry:\n\n```ts  theme={null}\nimport * as z from \"zod\";\nimport { createAgent, toolStrategy } from \"langchain\";\n\nconst ContactInfo = z.object({\n    name: z.string().describe(\"Person's name\"),\n    email: z.string().describe(\"Email address\"),\n});\n\nconst EventDetails = z.object({\n    event_name: z.string().describe(\"Name of the event\"),\n    date: z.string().describe(\"Event date\"),\n});\n\nconst agent = createAgent({\n    model: \"gpt-5\",\n    tools: [],\n    responseFormat: toolStrategy([ContactInfo, EventDetails]),\n});\n\nconst result = await agent.invoke({\n    messages: [\n        {\n        role: \"user\",\n        content:\n            \"Extract info: John Doe (john@email.com) is organizing Tech Conference on March 15th\",\n        },\n    ],\n});\n\nconsole.log(result);\n\n/**\n * {\n *   messages: [\n *     { role: \"user\", content: \"Extract info: John Doe (john@email.com) is organizing Tech Conference on March 15th\" },\n *     { role: \"assistant\", content: \"\", tool_calls: [ { name: \"ContactInfo\", args: { name: \"John Doe\", email: \"john@email.com\" }, id: \"call_1\" }, { name: \"EventDetails\", args: { event_name: \"Tech Conference\", date: \"March 15th\" }, id: \"call_2\" } ] },\n *     { role: \"tool\", content: \"Error: Model incorrectly returned multiple structured responses (ContactInfo, EventDetails) when only one is expected.\\n Please fix your mistakes.\", tool_call_id: \"call_1\", name: \"ContactInfo\" },\n *     { role: \"tool\", content: \"Error: Model incorrectly returned multiple structured responses (ContactInfo, EventDetails) when only one is expected.\\n Please fix your mistakes.\", tool_call_id: \"call_2\", name: \"EventDetails\" },\n *     { role: \"assistant\", content: \"\", tool_calls: [ { name: \"ContactInfo\", args: { name: \"John Doe\", email: \"john@email.com\" }, id: \"call_3\" } ] },\n *     { role: \"tool\", content: \"Returning structured response: {'name': 'John Doe', 'email': 'john@email.com'}\", tool_call_id: \"call_3\", name: \"ContactInfo\" }\n *   ],\n *   structuredResponse: { name: \"John Doe\", email: \"john@email.com\" }\n * }\n */\n```\n\n#### Schema validation error\n\nWhen structured output doesn't match the expected schema, the agent provides specific error feedback:\n\n```ts  theme={null}\nimport * as z from \"zod\";\nimport { createAgent, toolStrategy } from \"langchain\";\n\nconst ProductRating = z.object({\n    rating: z.number().min(1).max(5).describe(\"Rating from 1-5\"),\n    comment: z.string().describe(\"Review comment\"),\n});\n\nconst agent = createAgent({\n    model: \"gpt-5\",\n    tools: [],\n    responseFormat: toolStrategy(ProductRating),\n});\n\nconst result = await agent.invoke({\n    messages: [\n        {\n        role: \"user\",\n        content: \"Parse this: Amazing product, 10/10!\",\n        },\n    ],\n});\n\nconsole.log(result);\n\n/**\n * {\n *   messages: [\n *     { role: \"user\", content: \"Parse this: Amazing product, 10/10!\" },\n *     { role: \"assistant\", content: \"\", tool_calls: [ { name: \"ProductRating\", args: { rating: 10, comment: \"Amazing product\" }, id: \"call_1\" } ] },\n *     { role: \"tool\", content: \"Error: Failed to parse structured output for tool 'ProductRating': 1 validation error for ProductRating\\nrating\\n  Input should be less than or equal to 5 [type=less_than_equal, input_value=10, input_type=int].\\n Please fix your mistakes.\", tool_call_id: \"call_1\", name: \"ProductRating\" },\n *     { role: \"assistant\", content: \"\", tool_calls: [ { name: \"ProductRating\", args: { rating: 5, comment: \"Amazing product\" }, id: \"call_2\" } ] },\n *     { role: \"tool\", content: \"Returning structured response: {'rating': 5, 'comment': 'Amazing product'}\", tool_call_id: \"call_2\", name: \"ProductRating\" }\n *   ],\n *   structuredResponse: { rating: 5, comment: \"Amazing product\" }\n * }\n */\n```\n\n#### Error handling strategies\n\nYou can customize how errors are handled using the `handleErrors` parameter:\n\n**Custom error message:**\n\n```ts  theme={null}\nconst responseFormat = toolStrategy(ProductRating, {\n    handleError: \"Please provide a valid rating between 1-5 and include a comment.\"\n)\n\n// Error message becomes:\n// { role: \"tool\", content: \"Please provide a valid rating between 1-5 and include a comment.\" }\n```\n\n**Handle specific exceptions only:**\n\n```ts  theme={null}\nimport { ToolInputParsingException } from \"@langchain/core/tools\";\n\nconst responseFormat = toolStrategy(ProductRating, {\n    handleError: (error: ToolStrategyError) => {\n        if (error instanceof ToolInputParsingException) {\n        return \"Please provide a valid rating between 1-5 and include a comment.\";\n        }\n        return error.message;\n    }\n)\n\n// Only validation errors get retried with default message:\n// { role: \"tool\", content: \"Error: Failed to parse structured output for tool 'ProductRating': ...\\n Please fix your mistakes.\" }\n```\n\n**Handle multiple exception types:**\n\n```ts  theme={null}\nconst responseFormat = toolStrategy(ProductRating, {\n    handleError: (error: ToolStrategyError) => {\n        if (error instanceof ToolInputParsingException) {\n        return \"Please provide a valid rating between 1-5 and include a comment.\";\n        }\n        if (error instanceof CustomUserError) {\n        return \"This is a custom user error.\";\n        }\n        return error.message;\n    }\n)\n```\n\n**No error handling:**\n\n```ts  theme={null}\nconst responseFormat = toolStrategy(ProductRating, {\n    handleError: false  // All errors raised\n)\n```\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/oss/langchain/structured-output.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n\n---\n\nResult 3:\nTitle: Quickstart\nLink: https://docs.langchain.comoss/python/deepagents/quickstart\nContent: This guide walks you through creating your first deep agent with planning, file system tools, and subagent capabilities. You'll build a research agent that can conduct research and write reports.\n\n## Prerequisites\n\nBefore you begin, make sure you have an API key from a model provider (e.g., Anthropic, OpenAI).\n\n### Step 1: Install dependencies\n\n<CodeGroup>\n  ```bash pip theme={null}\n  pip install deepagents tavily-python\n  ```\n\n  ```bash uv theme={null}\n  uv add deepagents tavily-python\n  ```\n\n  ```bash poetry theme={null}\n  poetry add deepagents tavily-python\n  ```\n</CodeGroup>\n\n### Step 2: Set up your API keys\n\n```bash  theme={null}\nexport ANTHROPIC_API_KEY=\"your-api-key\"\nexport TAVILY_API_KEY=\"your-tavily-api-key\"\n```\n\n### Step 3: Create a search tool\n\n```python  theme={null}\nimport os\nfrom typing import Literal\nfrom tavily import TavilyClient\nfrom deepagents import create_deep_agent\n\ntavily_client = TavilyClient(api_key=os.environ[\"TAVILY_API_KEY\"])\n\ndef internet_search(\n    query: str,\n    max_results: int = 5,\n    topic: Literal[\"general\", \"news\", \"finance\"] = \"general\",\n    include_raw_content: bool = False,\n):\n    \"\"\"Run a web search\"\"\"\n    return tavily_client.search(\n        query,\n        max_results=max_results,\n        include_raw_content=include_raw_content,\n        topic=topic,\n    )\n```\n\n### Step 4: Create a deep agent\n\n```python  theme={null}\n# System prompt to steer the agent to be an expert researcher\nresearch_instructions = \"\"\"You are an expert researcher. Your job is to conduct thorough research and then write a polished report.\n\nYou have access to an internet search tool as your primary means of gathering information.\n\n## `internet_search`\n\nUse this to run an internet search for a given query. You can specify the max number of results to return, the topic, and whether raw content should be included.\n\"\"\"\n\nagent = create_deep_agent(\n    tools=[internet_search],\n    system_prompt=research_instructions\n)\n```\n\n### Step 5: Run the agent\n\n```python  theme={null}\nresult = agent.invoke({\"messages\": [{\"role\": \"user\", \"content\": \"What is langgraph?\"}]})\n\n# Print the agent's response\nprint(result[\"messages\"][-1].content)\n```\n\n## What happened?\n\nYour deep agent automatically:\n\n1. **Planned its approach**: Used the built-in `write_todos` tool to break down the research task\n2. **Conducted research**: Called the `internet_search` tool to gather information\n3. **Managed context**: Used file system tools (`write_file`, `read_file`) to offload large search results\n4. **Spawned subagents** (if needed): Delegated complex subtasks to specialized subagents\n5. **Synthesized a report**: Compiled findings into a coherent response\n\n## Next steps\n\nNow that you've built your first deep agent:\n\n* **Customize your agent**: Learn about [customization options](/oss/python/deepagents/customization), including custom system prompts, tools, and subagents.\n* **Understand middleware**: Dive into the [middleware architecture](/oss/python/deepagents/middleware) that powers deep agents.\n* **Add long-term memory**: Enable [persistent memory](/oss/python/deepagents/long-term-memory) across conversations.\n* **Deploy to production**: Learn about [deployment options](/oss/python/langgraph/deploy) for LangGraph applications.\n\n***\n\n<Callout icon=\"pen-to-square\" iconType=\"regular\">\n  [Edit this page on GitHub](https://github.com/langchain-ai/docs/edit/main/src/oss/deepagents/quickstart.mdx) or [file an issue](https://github.com/langchain-ai/docs/issues/new/choose).\n</Callout>\n\n<Tip icon=\"terminal\" iconType=\"regular\">\n  [Connect these docs](/use-these-docs) to Claude, VSCode, and more via MCP for real-time answers.\n</Tip>\n\n"
  },
  {
    "role": "tool",
    "name": "SearchDocsByLangChain",
    "tool_call_id": "ef4d98fb-158d-4291-a31c-a53b4e378be8",
    "id": "ca415cb7-9a4b-4304-b66c-4582320f7f43",
    "content": "Result 1:\nTitle: Messages\nLink: https://docs.langchain.comoss/javascript/langchain/messages\nContent: Tool Calling\nPurpose:  Function calls Always  \"tool_call\" Name of the tool to call Arguments to pass to the tool Unique identifier for this tool call Example: {\n    type: \"tool_call\",\n    name: \"search\",\n    args: { query: \"weather\" },\n    id: \"call_123\"\n} Purpose:  Streaming tool fragments Always  \"tool_call_chunk\" Name of the tool being called Partial tool arguments (may be incomplete JSON) Tool call identifier Position of this chunk in the stream Purpose:  Malformed calls Always  \"invalid_tool_call\" Name of the tool that failed to be called Raw arguments that failed to parse Description of what went wrong Common errors:  Invalid JSON, missing required fields\n\nContentBlock.Tools.InvalidToolCall\nPurpose:  Malformed calls Always  \"invalid_tool_call\" Name of the tool that failed to be called Raw arguments that failed to parse Description of what went wrong Common errors:  Invalid JSON, missing required fields\n\nServer-Side Tool Execution\nPurpose:  Tool call that is executed server-side. Always  \"server_tool_call\" An identifier associated with the tool call. The name of the tool to be called. Partial tool arguments (may be incomplete JSON) Purpose:  Streaming server-side tool call fragments Always  \"server_tool_call_chunk\" An identifier associated with the tool call. Name of the tool being called Partial tool arguments (may be incomplete JSON) Position of this chunk in the stream Purpose:  Search results Always  \"server_tool_result\" Identifier of the corresponding server tool call. Identifier associated with the server tool result. Execution status of the server-side tool.  \"success\"  or  \"error\" . Output of the executed tool.\n\n---\n\nResult 2:\nTitle: Models\nLink: https://docs.langchain.comoss/python/langchain/models\nContent: Google Gemini\n\ud83d\udc49 Read the  Google GenAI chat model integration docs pip install -U \"langchain[google-genai]\" import os\nfrom langchain.chat_models import init_chat_model\n\nos.environ[\"GOOGLE_API_KEY\"] = \"...\"\n\nmodel = init_chat_model(\"google_genai:gemini-2.5-flash-lite\") import os\nfrom langchain_google_genai import ChatGoogleGenerativeAI\n\nos.environ[\"GOOGLE_API_KEY\"] = \"...\"\n\nmodel = ChatGoogleGenerativeAI(model=\"gemini-2.5-flash-lite\")\n\nCallback handler\nfrom langchain.chat_models import init_chat_model\nfrom langchain_core.callbacks import UsageMetadataCallbackHandler\n\nmodel_1 = init_chat_model(model=\"gpt-4o-mini\")\nmodel_2 = init_chat_model(model=\"claude-haiku-4-5-20251001\")\n\ncallback = UsageMetadataCallbackHandler()\nresult_1 = model_1.invoke(\"Hello\", config={\"callbacks\": [callback]})\nresult_2 = model_2.invoke(\"Hello\", config={\"callbacks\": [callback]})\ncallback.usage_metadata {\n    'gpt-4o-mini-2024-07-18': {\n        'input_tokens': 8,\n        'output_tokens': 10,\n        'total_tokens': 18,\n        'input_token_details': {'audio': 0, 'cache_read': 0},\n        'output_token_details': {'audio': 0, 'reasoning': 0}\n    },\n    'claude-haiku-4-5-20251001': {\n        'input_tokens': 8,\n        'output_tokens': 21,\n        'total_tokens': 29,\n        'input_token_details': {'cache_read': 0, 'cache_creation': 0}\n    }\n}\n\nContext manager\nfrom langchain.chat_models import init_chat_model\nfrom langchain_core.callbacks import get_usage_metadata_callback\n\nmodel_1 = init_chat_model(model=\"gpt-4o-mini\")\nmodel_2 = init_chat_model(model=\"claude-haiku-4-5-20251001\")\n\nwith get_usage_metadata_callback() as cb:\n    model_1.invoke(\"Hello\")\n    model_2.invoke(\"Hello\")\n    print(cb.usage_metadata) {\n    'gpt-4o-mini-2024-07-18': {\n        'input_tokens': 8,\n        'output_tokens': 10,\n        'total_tokens': 18,\n        'input_token_details': {'audio': 0, 'cache_read': 0},\n        'output_token_details': {'audio': 0, 'reasoning': 0}\n    },\n    'claude-haiku-4-5-20251001': {\n        'input_tokens': 8,\n        'output_tokens': 21,\n        'total_tokens': 29,\n        'input_token_details': {'cache_read': 0, 'cache_creation': 0}\n    }\n}\n\n---\n\nResult 3:\nTitle: Build a SQL assistant with on-demand skills\nLink: https://docs.langchain.comoss/python/langchain/multi-agent/skills-sql-assistant\nContent: Google Gemini\n\ud83d\udc49 Read the  Google GenAI chat model integration docs pip install -U \"langchain[google-genai]\" import os\nfrom langchain.chat_models import init_chat_model\n\nos.environ[\"GOOGLE_API_KEY\"] = \"...\"\n\nmodel = init_chat_model(\"google_genai:gemini-2.5-flash-lite\") import os\nfrom langchain_google_genai import ChatGoogleGenerativeAI\n\nos.environ[\"GOOGLE_API_KEY\"] = \"...\"\n\nmodel = ChatGoogleGenerativeAI(model=\"gemini-2.5-flash-lite\")\n\nView complete runnable script\nHere's a complete, runnable implementation combining all the pieces from this tutorial: import uuid\nfrom typing import TypedDict, NotRequired\nfrom langchain.tools import tool\nfrom langchain.agents import create_agent\nfrom langchain.agents.middleware import ModelRequest, ModelResponse, AgentMiddleware\nfrom langchain.messages import SystemMessage\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom typing import Callable\n\n# Define skill structure\nclass Skill(TypedDict):\n    \"\"\"A skill that can be progressively disclosed to the agent.\"\"\"\n    name: str\n    description: str\n    content: str\n\n# Define skills with schemas and business logic\nSKILLS: list[Skill] = [\n    {\n        \"name\": \"sales_analytics\",\n        \"description\": \"Database schema and business logic for sales data analysis including customers, orders, and revenue.\",\n        \"content\": \"\"\"# Sales Analytics Schema\n\n## Tables\n\n### customers\n- customer_id (PRIMARY KEY)\n- name\n- email\n- signup_date\n- status (active/inactive)\n- customer_tier (bronze/silver/gold/platinum)\n\n### orders\n- order_id (PRIMARY KEY)\n- customer_id (FOREIGN KEY -> customers)\n- order_date\n- status (pending/completed/cancelled/refunded)\n- total_amount\n- sales_region (north/south/east/west)\n\n### order_items\n- item_id (PRIMARY KEY)\n- order_id (FOREIGN KEY -> orders)\n- product_id\n- quantity\n- unit_price\n- discount_percent\n\n## Business Logic\n\n**Active customers**: status = 'active' AND signup_date <= CURRENT_DATE - INTERVAL '90 days'\n\n**Revenue calculation**: Only count orders with status = 'completed'. Use total_amount from orders table, which already accounts for discounts.\n\n**Customer lifetime value (CLV)**: Sum of all completed order amounts for a customer.\n\n**High-value orders**: Orders with total_amount > 1000\n\n## Example Query\n\n-- Get top 10 customers by revenue in the last quarter\nSELECT\n    c.customer_id,\n    c.name,\n    c.customer_tier,\n    SUM(o.total_amount) as total_revenue\nFROM customers c\nJOIN orders o ON c.customer_id = o.customer_id\nWHERE o.status = 'completed'\n  AND o.order_date >= CURRENT_DATE - INTERVAL '3 months'\nGROUP BY c.customer_id, c.name, c.customer_tier\nORDER BY total_revenue DESC\nLIMIT 10;\n\"\"\",\n    },\n    {\n        \"name\": \"inventory_management\",\n        \"description\": \"Database schema and business logic for inventory tracking including products, warehouses, and stock levels.\",\n        \"content\": \"\"\"# Inventory Management Schema\n\n## Tables\n\n### products\n- product_id (PRIMARY KEY)\n- product_name\n- sku\n- category\n- unit_cost\n- reorder_point (minimum stock level before reordering)\n- discontinued (boolean)\n\n### warehouses\n- warehouse_id (PRIMARY KEY)\n- warehouse_name\n- location\n- capacity\n\n### inventory\n- inventory_id (PRIMARY KEY)\n- product_id (FOREIGN KEY -> products)\n- warehouse_id (FOREIGN KEY -> warehouses)\n- quantity_on_hand\n- last_updated\n\n### stock_movements\n- movement_id (PRIMARY KEY)\n- product_id (FOREIGN KEY -> products)\n- warehouse_id (FOREIGN KEY -> warehouses)\n- movement_type (inbound/outbound/transfer/adjustment)\n- quantity (positive for inbound, negative for outbound)\n- movement_date\n- reference_number\n\n## Business Logic\n\n**Available stock**: quantity_on_hand from inventory table where quantity_on_hand > 0\n\n**Products needing reorder**: Products where total quantity_on_hand across all warehouses is less than or equal to the product's reorder_point\n\n**Active products only**: Exclude products where discontinued = true unless specifically analyzing discontinued items\n\n**Stock valuation**: quantity_on_hand * unit_cost for each product\n\n## Example Query\n\n-- Find products below reorder point across all warehouses\nSELECT\n    p.product_id,\n    p.product_name,\n    p.reorder_point,\n    SUM(i.quantity_on_hand) as total_stock,\n    p.unit_cost,\n    (p.reorder_point - SUM(i.quantity_on_hand)) as units_to_reorder\nFROM products p\nJOIN inventory i ON p.product_id = i.product_id\nWHERE p.discontinued = false\nGROUP BY p.product_id, p.product_name, p.reorder_point, p.unit_cost\nHAVING SUM(i.quantity_on_hand) <= p.reorder_point\nORDER BY units_to_reorder DESC;\n\"\"\",\n    },\n]\n\n# Create skill loading tool\n@tool\ndef load_skill(skill_name: str) -> str:\n    \"\"\"Load the full content of a skill into the agent's context.\n\n    Use this when you need detailed information about how to handle a specific\n    type of request. This will provide you with comprehensive instructions,\n    policies, and guidelines for the skill area.\n\n    Args:\n        skill_name: The name of the skill to load (e.g., \"sales_analytics\", \"inventory_management\")\n    \"\"\"\n    # Find and return the requested skill\n    for skill in SKILLS:\n        if skill[\"name\"] == skill_name:\n            return f\"Loaded skill: {skill_name}\\n\\n{skill['content']}\"\n\n    # Skill not found\n    available = \", \".join(s[\"name\"] for s in SKILLS)\n    return f\"Skill '{skill_name}' not found. Available skills: {available}\"\n\n# Create skill middleware\nclass SkillMiddleware(AgentMiddleware):\n    \"\"\"Middleware that injects skill descriptions into the system prompt.\"\"\"\n\n    # Register the load_skill tool as a class variable\n    tools = [load_skill]\n\n    def __init__(self):\n        \"\"\"Initialize and generate the skills prompt from SKILLS.\"\"\"\n        # Build skills prompt from the SKILLS list\n        skills_list = []\n        for skill in SKILLS:\n            skills_list.append(\n                f\"- **{skill['name']}**: {skill['description']}\"\n            )\n        self.skills_prompt = \"\\n\".join(skills_list)\n\n    def wrap_model_call(\n        self,\n        request: ModelRequest,\n        handler: Callable[[ModelRequest], ModelResponse],\n    ) -> ModelResponse:\n        \"\"\"Sync: Inject skill descriptions into system prompt.\"\"\"\n        # Build the skills addendum\n        skills_addendum = (\n            f\"\\n\\n## Available Skills\\n\\n{self.skills_prompt}\\n\\n\"\n            \"Use the load_skill tool when you need detailed information \"\n            \"about handling a specific type of request.\"\n        )\n\n        # Append to system message content blocks\n        new_content = list(request.system_message.content_blocks) + [\n            {\"type\": \"text\", \"text\": skills_addendum}\n        ]\n        new_system_message = SystemMessage(content=new_content)\n        modified_request = request.override(system_message=new_system_message)\n        return handler(modified_request)\n\n# Initialize your chat model (replace with your model)\n# Example: from langchain_anthropic import ChatAnthropic\n# model = ChatAnthropic(model=\"claude-3-5-sonnet-20241022\")\nfrom langchain_openai import ChatOpenAI\nmodel = ChatOpenAI(model=\"gpt-4\")\n\n# Create the agent with skill support\nagent = create_agen...\n\nComplete example\nHere's a complete, runnable implementation combining all the pieces from this tutorial: import uuid\nfrom typing import TypedDict, NotRequired\nfrom langchain.tools import tool\nfrom langchain.agents import create_agent\nfrom langchain.agents.middleware import ModelRequest, ModelResponse, AgentMiddleware\nfrom langchain.messages import SystemMessage\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom typing import Callable\n\n# Define skill structure\nclass Skill(TypedDict):\n    \"\"\"A skill that can be progressively disclosed to the agent.\"\"\"\n    name: str\n    description: str\n    content: str\n\n# Define skills with schemas and business logic\nSKILLS: list[Skill] = [\n    {\n        \"name\": \"sales_analytics\",\n        \"description\": \"Database schema and business logic for sales data analysis including customers, orders, and revenue.\",\n        \"content\": \"\"\"# Sales Analytics Schema\n\n## Tables\n\n### customers\n- customer_id (PRIMARY KEY)\n- name\n- email\n- signup_date\n- status (active/inactive)\n- customer_tier (bronze/silver/gold/platinum)\n\n### orders\n- order_id (PRIMARY KEY)\n- customer_id (FOREIGN KEY -> customers)\n- order_date\n- status (pending/completed/cancelled/refunded)\n- total_amount\n- sales_region (north/south/east/west)\n\n### order_items\n- item_id (PRIMARY KEY)\n- order_id (FOREIGN KEY -> orders)\n- product_id\n- quantity\n- unit_price\n- discount_percent\n\n## Business Logic\n\n**Active customers**: status = 'active' AND signup_date <= CURRENT_DATE - INTERVAL '90 days'\n\n**Revenue calculation**: Only count orders with status = 'completed'. Use total_amount from orders table, which already accounts for discounts.\n\n**Customer lifetime value (CLV)**: Sum of all completed order amounts for a customer.\n\n**High-value orders**: Orders with total_amount > 1000\n\n## Example Query\n\n-- Get top 10 customers by revenue in the last quarter\nSELECT\n    c.customer_id,\n    c.name,\n    c.customer_tier,\n    SUM(o.total_amount) as total_revenue\nFROM customers c\nJOIN orders o ON c.customer_id = o.customer_id\nWHERE o.status = 'completed'\n  AND o.order_date >= CURRENT_DATE - INTERVAL '3 months'\nGROUP BY c.customer_id, c.name, c.customer_tier\nORDER BY total_revenue DESC\nLIMIT 10;\n\"\"\",\n    },\n    {\n        \"name\": \"inventory_management\",\n        \"description\": \"Database schema and business logic for inventory tracking including products, warehouses, and stock levels.\",\n        \"content\": \"\"\"# Inventory Management Schema\n\n## Tables\n\n### products\n- product_id (PRIMARY KEY)\n- product_name\n- sku\n- category\n- unit_cost\n- reorder_point (minimum stock level before reordering)\n- discontinued (boolean)\n\n### warehouses\n- warehouse_id (PRIMARY KEY)\n- warehouse_name\n- location\n- capacity\n\n### inventory\n- inventory_id (PRIMARY KEY)\n- product_id (FOREIGN KEY -> products)\n- warehouse_id (FOREIGN KEY -> warehouses)\n- quantity_on_hand\n- last_updated\n\n### stock_movements\n- movement_id (PRIMARY KEY)\n- product_id (FOREIGN KEY -> products)\n- warehouse_id (FOREIGN KEY -> warehouses)\n- movement_type (inbound/outbound/transfer/adjustment)\n- quantity (positive for inbound, negative for outbound)\n- movement_date\n- reference_number\n\n## Business Logic\n\n**Available stock**: quantity_on_hand from inventory table where quantity_on_hand > 0\n\n**Products needing reorder**: Products where total quantity_on_hand across all warehouses is less than or equal to the product's reorder_point\n\n**Active products only**: Exclude products where discontinued = true unless specifically analyzing discontinued items\n\n**Stock valuation**: quantity_on_hand * unit_cost for each product\n\n## Example Query\n\n-- Find products below reorder point across all warehouses\nSELECT\n    p.product_id,\n    p.product_name,\n    p.reorder_point,\n    SUM(i.quantity_on_hand) as total_stock,\n    p.unit_cost,\n    (p.reorder_point - SUM(i.quantity_on_hand)) as units_to_reorder\nFROM products p\nJOIN inventory i ON p.product_id = i.product_id\nWHERE p.discontinued = false\nGROUP BY p.product_id, p.product_name, p.reorder_point, p.unit_cost\nHAVING SUM(i.quantity_on_hand) <= p.reorder_point\nORDER BY units_to_reorder DESC;\n\"\"\",\n    },\n]\n\n# Create skill loading tool\n@tool\ndef load_skill(skill_name: str) -> str:\n    \"\"\"Load the full content of a skill into the agent's context.\n\n    Use this when you need detailed information about how to handle a specific\n    type of request. This will provide you with comprehensive instructions,\n    policies, and guidelines for the skill area.\n\n    Args:\n        skill_name: The name of the skill to load (e.g., \"sales_analytics\", \"inventory_management\")\n    \"\"\"\n    # Find and return the requested skill\n    for skill in SKILLS:\n        if skill[\"name\"] == skill_name:\n            return f\"Loaded skill: {skill_name}\\n\\n{skill['content']}\"\n\n    # Skill not found\n    available = \", \".join(s[\"name\"] for s in SKILLS)\n    return f\"Skill '{skill_name}' not found. Available skills: {available}\"\n\n# Create skill middleware\nclass SkillMiddleware(AgentMiddleware):\n    \"\"\"Middleware that injects skill descriptions into the system prompt.\"\"\"\n\n    # Register the load_skill tool as a class variable\n    tools = [load_skill]\n\n    def __init__(self):\n        \"\"\"Initialize and generate the skills prompt from SKILLS.\"\"\"\n        # Build skills prompt from the SKILLS list\n        skills_list = []\n        for skill in SKILLS:\n            skills_list.append(\n                f\"- **{skill['name']}**: {skill['description']}\"\n            )\n        self.skills_prompt = \"\\n\".join(skills_list)\n\n    def wrap_model_call(\n        self,\n        request: ModelRequest,\n        handler: Callable[[ModelRequest], ModelResponse],\n    ) -> ModelResponse:\n        \"\"\"Sync: Inject skill descriptions into system prompt.\"\"\"\n        # Build the skills addendum\n        skills_addendum = (\n            f\"\\n\\n## Available Skills\\n\\n{self.skills_prompt}\\n\\n\"\n            \"Use the load_skill tool when you need detailed information \"\n            \"about handling a specific type of request.\"\n        )\n\n        # Append to system message content blocks\n        new_content = list(request.system_message.content_blocks) + [\n            {\"type\": \"text\", \"text\": skills_addendum}\n        ]\n        new_system_message = SystemMessage(content=new_content)\n        modified_request = request.override(system_message=new_system_message)\n        return handler(modified_request)\n\n# Initialize your chat model (replace with your model)\n# Example: from langchain_anthropic import ChatAnthropic\n# model = ChatAnthropic(model=\"claude-3-5-sonnet-20241022\")\nfrom langchain_openai import ChatOpenAI\nmodel = ChatOpenAI(model=\"gpt-4\")\n\n# Create the agent with skill support\nagent = create_agent(\n    model,...\n"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b383b-1b80-72c3-b957-7069ce187058",
    "content": "**\u041e\u0448\u0438\u0431\u043a\u0430 `EmptyInputError` \u0438 \u043e\u0448\u0438\u0431\u043a\u0430 Gemini `Name cannot be empty` \u0438\u043c\u0435\u044e\u0442 \u043e\u0434\u043d\u0443 \u0438 \u0442\u0443 \u0436\u0435 \u043f\u0435\u0440\u0432\u043e\u043f\u0440\u0438\u0447\u0438\u043d\u0443: \u043d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u0430\u044f \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 \u0432\u0445\u043e\u0434\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u043f\u0440\u0438 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 \u0433\u0440\u0430\u0444\u0430 (Resume) \u0438\u0437 \u00ab\u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e\u00bb \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430.**\n\n\u0412\u043e\u0442 \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u044b\u0439 \u0430\u043d\u0430\u043b\u0438\u0437 \u043f\u043e \u043a\u0430\u0436\u0434\u043e\u0439 \u043e\u0448\u0438\u0431\u043a\u0435:\n\n## 1. EmptyInputError: Received no input for __start__\n\n\u042d\u0442\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0432 `route_drafting_assistant_graph`, \u043a\u043e\u0433\u0434\u0430 \u0432\u0430\u0448\u0430 \u043b\u043e\u0433\u0438\u043a\u0430 \u0432 `memory_manager.py` \u0440\u0435\u0448\u0430\u0435\u0442 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0433\u0440\u0430\u0444 \u0441 `graph_input=None`. \n\n- **\u041f\u0440\u0438\u0447\u0438\u043d\u0430:** \u0414\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 `snapshot.next` \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0440\u0430\u0431\u043e\u0447\u0438\u0439 \u0443\u0437\u0435\u043b (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, `['agent']`), LangGraph \u043f\u0440\u0438 \u043f\u0435\u0440\u0432\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u044d\u0442\u043e\u0433\u043e \u0438\u043d\u0441\u0442\u0430\u043d\u0441\u0430 \u0432 \u0440\u0430\u043c\u043a\u0430\u0445 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u043e\u0431\u044a\u0435\u043a\u0442 \u0432\u0432\u043e\u0434\u0430 \u0434\u043b\u044f \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0438\u0445 \u043a\u0430\u043d\u0430\u043b\u043e\u0432. \n- **\u041b\u043e\u0433:** \u0417\u0430\u043f\u0438\u0441\u044c \u2116218 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 `has_progress: true`, `is_at_virtual_start: false`, \u0438 \u043a\u0430\u043a \u0441\u043b\u0435\u0434\u0441\u0442\u0432\u0438\u0435 `effective_input_is_none: true`. \u042d\u0442\u043e \u0438 \u0442\u0440\u0438\u0433\u0433\u0435\u0440\u0438\u0442 \u043e\u0448\u0438\u0431\u043a\u0443.\n- **\u0420\u0435\u0448\u0435\u043d\u0438\u0435:** \u0412\u043c\u0435\u0441\u0442\u043e `None` \u0432\u0441\u0435\u0433\u0434\u0430 \u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0439\u0442\u0435 \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u043b\u043e\u0432\u0430\u0440\u044c `{}` \u0434\u043b\u044f \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f. \u042d\u0442\u043e \u0443\u0434\u043e\u0432\u043b\u0435\u0442\u0432\u043e\u0440\u0438\u0442 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443 LangGraph \u043d\u0430 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0432\u0432\u043e\u0434\u0430, \u043d\u043e \u043d\u0435 \u0434\u043e\u0431\u0430\u0432\u0438\u0442 \u043b\u0438\u0448\u043d\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0431\u043b\u0430\u0433\u043e\u0434\u0430\u0440\u044f \u0440\u0435\u0434\u0443\u0441\u0435\u0440\u0430\u043c.\n\n## 2. Gemini: Name cannot be empty (function_call.name)\n\n\u042d\u0442\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u0432 `user_preferences_assistant_graph` (Graph 4) \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e Gemini \u043f\u043e\u043b\u0443\u0447\u0438\u043b \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u0443 `ToolMessage` \u0438\u043b\u0438 `AIMessage` (\u0441 \u0432\u044b\u0437\u043e\u0432\u043e\u043c \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0430) \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435 `name`.\n\n- **\u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u043f\u0440\u0438 Resume:** \u041a\u043e\u0433\u0434\u0430 \u0432\u044b \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u044f\u0435\u0442\u0435 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430, LangGraph \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0438\u0437 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430. \u0415\u0441\u043b\u0438 \u0432 \u043a\u043e\u0434\u0435 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 (`_materialize_checkpoint_values`) \u0438\u043b\u0438 \u043f\u0440\u0438 \u043c\u0435\u0440\u0434\u0436\u0435 \u0441\u0442\u0435\u0439\u0442\u0430 \u0442\u0438\u043f\u044b \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, `ToolMessage`) \u043f\u0440\u0435\u0432\u0440\u0430\u0449\u0430\u044e\u0442\u0441\u044f \u0432 \u043e\u0431\u044b\u0447\u043d\u044b\u0435 \u0441\u043b\u043e\u0432\u0430\u0440\u0438 \u0438\u043b\u0438 \u0442\u0435\u0440\u044f\u044e\u0442 \u0430\u0442\u0440\u0438\u0431\u0443\u0442 `name`, Gemini \u0432\u044b\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442 400 Bad Request.\n- **\u0421\u0432\u044f\u0437\u044c \u0441 Rerun:** \u0415\u0441\u043b\u0438 \u0432\u0430\u0448 \u043a\u043e\u0434 \u043e\u0448\u0438\u0431\u043e\u0447\u043d\u043e \u0434\u0435\u043b\u0430\u0435\u0442 `rerun fresh` (\u043a\u0430\u043a \u0432 Hypothesis K), \u043e\u043d \u043c\u043e\u0436\u0435\u0442 \u043f\u044b\u0442\u0430\u0442\u044c\u0441\u044f \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c `graph_input` \u043f\u043e\u0432\u0435\u0440\u0445 \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0439 (\u043d\u043e \u00ab\u0441\u043b\u043e\u043c\u0430\u043d\u043d\u043e\u0439\u00bb) \u0438\u0441\u0442\u043e\u0440\u0438\u0438, \u0447\u0442\u043e \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u043d\u0435\u0432\u0430\u043b\u0438\u0434\u043d\u043e\u0439 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u043b\u044f Gemini.\n\n---\n\n### \u0424\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0438 \u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u044b\u0439 \u0444\u0438\u043a\u0441 \u0432 `memory_manager.py`:\n\n\u0412\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0434\u0432\u0435 \u0432\u0435\u0449\u0438: \u043f\u0435\u0440\u0435\u0441\u0442\u0430\u0442\u044c \u0441\u043b\u0430\u0442\u044c `None` \u0438 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c, \u0447\u0442\u043e \u0432\u044b \u043d\u0435 \u0441\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442\u0435 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u0435\u0441\u0442\u044c \u0445\u043e\u0442\u044c \u043a\u0430\u043a\u0430\u044f-\u0442\u043e \u0438\u0441\u0442\u043e\u0440\u0438\u044f.\n\n```python\n# \u0412 \u043c\u0435\u0442\u043e\u0434\u0435 ainvoke_from_checkpoint (~\u043b\u0438\u043d\u0438\u044f 510)\nif isinstance(next_nodes, Sequence) and next_nodes:\n    next_nodes_list = list(next_nodes)\n    values = getattr(snapshot, \"values\", {})\n    \n    # 1. \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u041b\u042e\u0411\u041e\u0413\u041e \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430 (\u0432\u043a\u043b\u044e\u0447\u0430\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f)\n    has_progress = self._has_meaningful_values(values)\n    \n    # 2. \u0424\u0418\u041a\u0421 EmptyInputError: \u041d\u0438\u043a\u043e\u0433\u0434\u0430 \u043d\u0435 \u0448\u043b\u0435\u043c None. \n    # \u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u2014 \u0448\u043b\u0435\u043c {}, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0441\u0442\u043e \"\u0442\u043e\u043b\u043a\u043d\u0443\u0442\u044c\" \u0433\u0440\u0430\u0444.\n    # \u0415\u0441\u043b\u0438 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430 \u043d\u0435\u0442 \u0438\u043b\u0438 \u043c\u044b \u043d\u0430 \u0441\u0430\u043c\u043e\u043c \u0441\u0442\u0430\u0440\u0442\u0435 \u2014 \u0448\u043b\u0435\u043c graph_input.\n    is_at_start = (next_nodes_list == [\"__start__\"])\n    effective_input = graph_input if (is_at_start or not has_progress) else {}\n\n    # 3. \u0424\u0418\u041a\u0421 Gemini (\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0438\u0441\u0442\u043e\u0440\u0438\u0438): \u0423\u0434\u0430\u043b\u044f\u0435\u043c \u0431\u043b\u043e\u043a else \u0441 pop(\"checkpoint_id\")\n    # \u041c\u044b \u0434\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0443, \u0435\u0441\u043b\u0438 LangGraph \u0435\u0433\u043e \u043d\u0430\u0448\u0435\u043b.\n    return await self.ainvoke_with_durability(\n        graph=graph,\n        graph_input=effective_input,\n        config=cfg,\n        context=context,\n        durability=durability,\n        local_checkpointer=effective_local_checkpointer,\n    )\n```\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0441\u043f\u0430\u0441\u0435\u0442 Gemini:\nGoogle Gemini \u043e\u0447\u0435\u043d\u044c \u0447\u0443\u0432\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u0435\u043d \u043a \u043f\u043e\u0440\u044f\u0434\u043a\u0443: `User -> AI (Tool Call) -> Tool (Response)`. \n\u041f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 `{}` \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442, \u0447\u0442\u043e \u0432\u044b \u043d\u0435 \u0432\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442\u0435 \u043b\u0438\u0448\u043d\u0438\u0439 `HumanMessage` \u0432 \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u0443 \u044d\u0442\u043e\u0439 \u0446\u0435\u043f\u043e\u0447\u043a\u0438, \u0430 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 `checkpoint_id` \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442, \u0447\u0442\u043e LangGraph \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0432 \u0438\u0445 \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u043e\u043c, \u0442\u0438\u043f\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u043c \u0432\u0438\u0434\u0435 \u0441\u043e \u0432\u0441\u0435\u043c\u0438 \u0438\u043c\u0435\u043d\u0430\u043c\u0438 \u0444\u0443\u043d\u043a\u0446\u0438\u0439.\n\n**Relevant docs:**\n- [Time Travel: Resume from Checkpoint](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)\n- [Persistence and Reducers](https://docs.langchain.com/oss/python/langgraph/persistence)\n- [LangGraph Errors: EmptyInputError](https://docs.langchain.com/langsmith/use-threads#empty-thread)"
  },
  {
    "role": "user",
    "id": "de7634b5-d5b8-4c81-a4b5-c1d497e30832",
    "content": "\u0423\u0432\u0435\u0440\u0435\u043d ? "
  },
  {
    "role": "assistant",
    "id": "lc_run--019b383d-2901-7013-9536-b67078dee8b1",
    "content": "**\u0414\u0430, \u044f \u0430\u0431\u0441\u043e\u043b\u044e\u0442\u043d\u043e \u0443\u0432\u0435\u0440\u0435\u043d.** \u041e\u0448\u0438\u0431\u043a\u0430 `EmptyInputError` \u0438 \u043e\u0448\u0438\u0431\u043a\u0430 Gemini \u2014 \u044d\u0442\u043e \u0434\u0432\u0435 \u0441\u0442\u043e\u0440\u043e\u043d\u044b \u043e\u0434\u043d\u043e\u0439 \u043c\u0435\u0434\u0430\u043b\u0438, \u043f\u043e\u0440\u043e\u0436\u0434\u0435\u043d\u043d\u044b\u0435 \u0442\u0435\u043c, \u043a\u0430\u043a \u0432\u0430\u0448 \u043a\u043e\u0434 \u00ab\u0440\u0443\u043b\u0438\u0442\u00bb \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435\u043c \u0433\u0440\u0430\u0444\u0430.\n\n\u0420\u0430\u0437\u0431\u0435\u0440\u0435\u043c \u043a\u0430\u0436\u0434\u0443\u044e \u043e\u0448\u0438\u0431\u043a\u0443 \u0441 \u00ab\u0445\u0438\u0440\u0443\u0440\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0439\u00bb \u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c\u044e:\n\n### 1. \u041f\u043e\u0447\u0435\u043c\u0443 `EmptyInputError` \u2014 \u044d\u0442\u043e 100% \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 `input=None`\n\u0412 LangGraph (\u043d\u0430\u0447\u0438\u043d\u0430\u044f \u0441 v0.2.x) Pregel-\u0446\u0438\u043a\u043b \u043f\u0440\u0438 \u043f\u0435\u0440\u0432\u043e\u043c \u0432\u044b\u0437\u043e\u0432\u0435 `ainvoke` \u0432 \u0440\u0430\u043c\u043a\u0430\u0445 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430/\u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u043e\u0431\u044f\u0437\u0430\u043d \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c **\u043e\u0431\u044a\u0435\u043a\u0442 \u0432\u0432\u043e\u0434\u0430**.\n-   **\u041c\u0435\u0445\u0430\u043d\u0438\u043a\u0430:** \u041a\u043e\u0433\u0434\u0430 \u0432\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0435 `None`, LangGraph \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442: \u00ab\u0415\u0441\u0442\u044c \u043b\u0438 \u0443 \u043c\u0435\u043d\u044f \u0447\u0442\u043e-\u0442\u043e \u043d\u0430 \u0432\u0445\u043e\u0434\u0435, \u0447\u0442\u043e\u0431\u044b \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u0430\u043d\u0430\u043b\u044b?\u00bb. \u0415\u0441\u043b\u0438 \u044d\u0442\u043e \u043f\u0435\u0440\u0432\u044b\u0439 \u00ab\u0442\u0438\u043a\u00bb (\u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442), \u043e\u043d \u043d\u0435 \u043d\u0430\u0445\u043e\u0434\u0438\u0442 \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u0438 \u043f\u0430\u0434\u0430\u0435\u0442.\n-   **\u0420\u0435\u0448\u0435\u043d\u0438\u0435:** \u041f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 \u043f\u0443\u0441\u0442\u043e\u0439 \u043c\u0430\u043f\u044b `{}` \u0432\u043c\u0435\u0441\u0442\u043e `None`. \u0414\u043b\u044f LangGraph \u044d\u0442\u043e \u00ab\u0432\u0430\u043b\u0438\u0434\u043d\u044b\u0439 \u0432\u0445\u043e\u0434\u00bb, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0435\u043c\u0443 \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430 \u0438 \u043d\u0430\u0447\u0430\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443.\n\n### 2. \u041f\u043e\u0447\u0435\u043c\u0443 Gemini \u043f\u0430\u0434\u0430\u0435\u0442 \u0441 `Name cannot be empty`\n\u042d\u0442\u043e \u0441\u0430\u043c\u0430\u044f \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043d\u0430\u044f \u0447\u0430\u0441\u0442\u044c. Google Gemini \u2014 \u0441\u0430\u043c\u044b\u0439 \u0441\u0442\u0440\u043e\u0433\u0438\u0439 LLM \u0432 \u043f\u043b\u0430\u043d\u0435 \u0444\u043e\u0440\u043c\u0430\u0442\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439. \u041e\u0448\u0438\u0431\u043a\u0430 `function_call.name: Name cannot be empty` \u0432\u043e\u0437\u043d\u0438\u043a\u0430\u0435\u0442, \u043a\u043e\u0433\u0434\u0430 \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0435\u0441\u0442\u044c `AIMessage` \u0441 \u0432\u044b\u0437\u043e\u0432\u043e\u043c \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0430, \u0433\u0434\u0435 \u043f\u043e\u043b\u0435 `name` (\u0438\u043c\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u0438) \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0438\u043b\u0438 \u0440\u0430\u0432\u043d\u043e `None`.\n\n**\u041a\u0430\u043a \u044d\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0432 \u0432\u0430\u0448\u0435\u0439 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0435:**\n1.  **\u0421\u0431\u043e\u0439:** \u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 (Graph 4) \u043d\u0430\u0447\u0430\u043b \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0442\u0432\u0435\u0442, \u0441\u043e\u0437\u0434\u0430\u043b `tool_call`, \u043d\u043e \u0443\u043f\u0430\u043b (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043d\u0430 \u0442\u0430\u0439\u043c\u0430\u0443\u0442\u0435 \u0441\u0435\u0442\u0438) \u0434\u043e \u0442\u043e\u0433\u043e, \u043a\u0430\u043a \u0443\u0441\u043f\u0435\u043b \u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0438\u043c\u044f \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0430 \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0438\u043b\u0438 \u0432 \u043c\u043e\u043c\u0435\u043d\u0442 \u0437\u0430\u043f\u0438\u0441\u0438.\n2.  **\u0412\u0430\u0448 Rerun (Hypothesis K):** \u0412\u0430\u0448\u0430 \u043b\u043e\u0433\u0438\u043a\u0430 \u0432\u0438\u0434\u0438\u0442 \u00ab\u043c\u0430\u043b\u043e \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430\u00bb, \u0443\u0434\u0430\u043b\u044f\u0435\u0442 `checkpoint_id` \u0438 \u0434\u0435\u043b\u0430\u0435\u0442 \u0441\u0432\u0435\u0436\u0438\u0439 \u0437\u0430\u043f\u0443\u0441\u043a.\n3.  **\u041a\u043e\u043d\u0444\u043b\u0438\u043a\u0442 \u0441\u0442\u0435\u0439\u0442\u043e\u0432:** \u041d\u043e \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u0432\u044b \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0435\u0441\u044c \u0432 \u0442\u043e\u0439 \u0436\u0435 \u043d\u0438\u0442\u0438 (`thread_id`) \u0438 \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u0435 \u0438\u043c\u0435\u043d (`ns`), LangGraph \u043c\u043e\u0436\u0435\u0442 \u043f\u043e\u0434\u043c\u0435\u0448\u0430\u0442\u044c \u00ab\u0431\u0438\u0442\u043e\u0435\u00bb \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0438\u0437 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0433\u043e \u0443\u043f\u0430\u0432\u0448\u0435\u0433\u043e \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0432 \u043d\u043e\u0432\u044b\u0439 \u0437\u0430\u043f\u0443\u0441\u043a \u0447\u0435\u0440\u0435\u0437 \u0440\u0435\u0434\u0443\u0441\u0435\u0440 `add_messages`. \n4.  **GEMINI Error:** \u041a\u043e\u0433\u0434\u0430 \u043d\u043e\u0432\u044b\u0439 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u0432\u044b\u0437\u0432\u0430\u0442\u044c LLM, \u043e\u043d \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0435\u0439 \u0438\u0441\u0442\u043e\u0440\u0438\u044e, \u0433\u0434\u0435 \u043e\u0434\u043d\u043e \u0438\u0437 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u2014 \u00ab\u0431\u0438\u0442\u044b\u0439\u00bb \u0432\u044b\u0437\u043e\u0432 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0430 \u0431\u0435\u0437 \u0438\u043c\u0435\u043d\u0438. Gemini \u0432\u044b\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442 400.\n\n---\n\n### \u0424\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0444\u0438\u043a\u0441 \u0432 `memory_manager.py`, \u0440\u0435\u0448\u0430\u044e\u0449\u0438\u0439 \u041e\u0411\u0415 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b:\n\n\u0412\u0430\u043c \u043d\u0443\u0436\u043d\u043e:\n1.  **\u041d\u0438\u043a\u043e\u0433\u0434\u0430 \u043d\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0442\u044c `None`.**\n2.  **\u041d\u0438\u043a\u043e\u0433\u0434\u0430 \u043d\u0435 \u0434\u0435\u043b\u0430\u0442\u044c Rerun \u0432\u0440\u0443\u0447\u043d\u0443\u044e** \u0447\u0435\u0440\u0435\u0437 `pop(\"checkpoint_id\")`, \u0435\u0441\u043b\u0438 LangGraph \u043d\u0430\u0448\u0435\u043b \u0445\u043e\u0442\u044c \u0447\u0442\u043e-\u0442\u043e. \u041f\u043e\u0437\u0432\u043e\u043b\u044c\u0442\u0435 \u0441\u0430\u043c\u043e\u043c\u0443 LangGraph \u0440\u0430\u0437\u043e\u0431\u0440\u0430\u0442\u044c\u0441\u044f \u0441 \u0438\u0441\u0442\u043e\u0440\u0438\u0435\u0439.\n\n```python\n# \u0418\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0439 \u0431\u043b\u043e\u043a \u0432 ainvoke_from_checkpoint (~\u043b\u0438\u043d\u0438\u044f 510)\nif isinstance(next_nodes, Sequence) and next_nodes:\n    # \u041e\u0446\u0435\u043d\u0438\u0432\u0430\u0435\u043c \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u0422\u041e\u041b\u042c\u041a\u041e \u0434\u043b\u044f \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f\n    has_progress = isinstance(values, Mapping) and self._has_meaningful_values(values)\n\n    # \u041e\u0420\u0413\u0410\u041d\u0418\u0427\u041d\u041e\u0415 \u0420\u0415\u0428\u0415\u041d\u0418\u0415:\n    # 1. \u0415\u0441\u043b\u0438 \u043c\u044b \u043d\u0430 __start__ \u2014 \u043d\u0430\u043c \u043d\u0443\u0436\u0435\u043d graph_input (\u044d\u0442\u043e \u0441\u0442\u0430\u0440\u0442 \u0438\u043b\u0438 \u0434\u043e\u0443\u0447\u0438\u0432\u0430\u043d\u0438\u0435).\n    # 2. \u0415\u0441\u043b\u0438 \u043c\u044b \u0432 \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u0435 (['agent']) \u2014 \u043d\u0430\u043c \u043d\u0443\u0436\u043d\u043e {}, \u0447\u0442\u043e\u0431\u044b \u0438\u0437\u0431\u0435\u0436\u0430\u0442\u044c EmptyInputError,\n    #    \u043d\u043e \u043d\u0435 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c HumanMessage \u0447\u0435\u0440\u0435\u0437 \u0440\u0435\u0434\u0443\u0441\u0435\u0440.\n    \n    is_at_start = (list(next_nodes) == [\"__start__\"])\n    effective_input = graph_input if is_at_start else {}\n\n    # \u041c\u044b \u0423\u0414\u0410\u041b\u042f\u0415\u041c \u0432\u0435\u0442\u043a\u0443 else \u0441 pop(\"checkpoint_id\")! \n    # \u0415\u0441\u043b\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0435\u0441\u0442\u044c, \u043c\u044b \u043e\u0431\u044f\u0437\u0430\u043d\u044b \u0435\u0433\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c, \u0438\u043d\u0430\u0447\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u043c \n    # \u043a\u043e\u043d\u0444\u043b\u0438\u043a\u0442 \u0438\u0441\u0442\u043e\u0440\u0438\u0439 (Gemini Error).\n\n    return await self.ainvoke_with_durability(\n        graph=graph,\n        graph_input=effective_input, \n        config=cfg,\n        context=context,\n        durability=durability,\n        local_checkpointer=effective_local_checkpointer,\n    )\n```\n\n### \u041a\u0430\u043a \u044d\u0442\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442 Gemini?\n\u041f\u0435\u0440\u0435\u0441\u0442\u0430\u0432\u0430\u044f \u0434\u0435\u043b\u0430\u0442\u044c `rerun fresh` \u043f\u0440\u0438 \u043d\u0430\u043b\u0438\u0447\u0438\u0438 \u0441\u0442\u0430\u0440\u043e\u0433\u043e `checkpoint_id`, \u0432\u044b \u043f\u0435\u0440\u0435\u0441\u0442\u0430\u0435\u0442\u0435 \u00ab\u043d\u0430\u0441\u043b\u0430\u0438\u0432\u0430\u0442\u044c\u00bb \u043d\u043e\u0432\u0443\u044e \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u043d\u0430 \u0441\u0442\u0430\u0440\u0443\u044e. \u0415\u0441\u043b\u0438 \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0435 \u0431\u044b\u043b\u043e \u0431\u0438\u0442\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435, LangGraph \u043b\u0438\u0431\u043e \u0443\u043f\u0430\u0434\u0435\u0442 \u043d\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435, \u043b\u0438\u0431\u043e \u043f\u043e\u0437\u0432\u043e\u043b\u0438\u0442 \u0432\u0430\u043c \u0435\u0433\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c. \u041d\u043e \u0433\u043b\u0430\u0432\u043d\u0430\u044f \u0437\u0430\u0449\u0438\u0442\u0430 Gemini \u2014 \u044d\u0442\u043e **\u043d\u0435\u0440\u0430\u0437\u0440\u044b\u0432\u043d\u043e\u0441\u0442\u044c `checkpoint_id`**.\n\n**\u0418\u0442\u043e\u0433:** `EmptyInputError` \u043b\u0435\u0447\u0438\u0442\u0441\u044f \u0437\u0430\u043c\u0435\u043d\u043e\u0439 `None` \u043d\u0430 `{}`, \u0430 \u043e\u0448\u0438\u0431\u043a\u0430 Gemini \u2014 \u043e\u0442\u043a\u0430\u0437\u043e\u043c \u043e\u0442 \u0440\u0443\u0447\u043d\u043e\u0433\u043e \u0441\u0431\u0440\u043e\u0441\u0430 `checkpoint_id` \u0432\u043d\u0443\u0442\u0440\u0438 \u0446\u0438\u043a\u043b\u0430 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f.\n\n**Relevant docs:**\n- [Time Travel: Resume from Checkpoint](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)\n- [Persistence and Message Reducers](https://docs.langchain.com/oss/python/langgraph/persistence)\n- [Google Gemini Tool Calling Requirements](https://docs.langchain.com/oss/python/langchain/models)"
  },
  {
    "role": "user",
    "id": "fe5ca9e7-c5a3-40b3-bdcb-d8996fc05cbc",
    "content": "\u0422\u0435\u043f\u0435\u0440\u044c \u043f\u043e\u043b\u0443\u0447\u0430\u044e \u043e\u0448\u0438\u0431\u043a\u0443\n\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:c55f3d2f-8472-b2e9-5511-6eee35930192\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766175112325.49}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766175112325.613}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:c55f3d2f-8472-b2e9-5511-6eee35930192\", \"new_ns\": \"user_preferences:c55f3d2f-8472-b2e9-5511-6eee35930192\"}, \"timestamp\": 1766175112325.665}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:c55f3d2f-8472-b2e9-5511-6eee35930192\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\"}, \"timestamp\": 1766175112325.702}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175112326.008}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175112326.044}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175112326.1152}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175112326.159}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175112326.199}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766175112326.436}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175112326.5632}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175112326.601}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766175112326.6611}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:c55f3d2f-8472-b2e9-5511-6eee35930192\"}, \"timestamp\": 1766175112326.689}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766175119061.504}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:ce5dbd2c-ed4d-048d-bc96-b1b601fea1b5\", \"new_ns\": \"route_drafting:ce5dbd2c-ed4d-048d-bc96-b1b601fea1b5\"}, \"timestamp\": 1766175119068.806}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:ce5dbd2c-ed4d-048d-bc96-b1b601fea1b5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\"}, \"timestamp\": 1766175119068.8691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175119069.165}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175119069.203}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175119069.26}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175119069.303}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175119069.346}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766175119069.59}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175119069.6353}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175119069.7532}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766175119069.814}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:ce5dbd2c-ed4d-048d-bc96-b1b601fea1b5\"}, \"timestamp\": 1766175119069.856}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:ce5dbd2c-ed4d-048d-bc96-b1b601fea1b5|graph:4f892660-b4f3-d3cc-483c-16051df1285c\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766175119228.409}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175119228.509}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:ce5dbd2c-ed4d-048d-bc96-b1b601fea1b5|graph:4f892660-b4f3-d3cc-483c-16051df1285c\", \"new_ns\": \"route_drafting:ce5dbd2c-ed4d-048d-bc96-b1b601fea1b5|graph:4f892660-b4f3-d3cc-483c-16051df1285c\"}, \"timestamp\": 1766175119228.571}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:ce5dbd2c-ed4d-048d-bc96-b1b601fea1b5|graph:4f892660-b4f3-d3cc-483c-16051df1285c\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\"}, \"timestamp\": 1766175119228.648}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175119228.966}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766175119229.012}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175119229.0781}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766175119229.321}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175119229.405}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766175119229.44}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:ce5dbd2c-ed4d-048d-bc96-b1b601fea1b5|graph:4f892660-b4f3-d3cc-483c-16051df1285c\"}, \"timestamp\": 1766175119229.4731}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766175134382.8171}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:1\", \"new_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:1\"}, \"timestamp\": 1766175134578.6318}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\"}, \"timestamp\": 1766175134578.787}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175134579.1472}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175134579.198}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175134579.2808}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175134579.3337}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175134579.384}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766175134579.684}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175134579.7341}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175134579.769}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766175134579.802}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:1\"}, \"timestamp\": 1766175134579.8289}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:2\", \"new_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:2\"}, \"timestamp\": 1766175134640.2668}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\"}, \"timestamp\": 1766175134640.379}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175134640.743}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175134640.831}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175134640.904}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175134640.955}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175134641.0408}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766175134641.3389}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175134641.391}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175134641.434}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766175134641.4731}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:2\"}, \"timestamp\": 1766175134641.508}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:3\", \"new_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:3\"}, \"timestamp\": 1766175134702.09}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\"}, \"timestamp\": 1766175134702.2378}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175134702.533}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175134702.579}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175134702.647}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175134702.698}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175134702.782}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766175134703.03}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175134703.0808}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175134703.1272}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766175134703.1702}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:3\"}, \"timestamp\": 1766175134703.208}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:4\", \"new_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:4\"}, \"timestamp\": 1766175134766.6729}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\"}, \"timestamp\": 1766175134766.797}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175134767.0999}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175134767.1628}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175134767.2332}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175134767.284}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175134767.3708}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766175134767.624}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175134767.673}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175134767.7131}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766175134767.751}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:4\"}, \"timestamp\": 1766175134767.784}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:1|1|graph:c456f1e5-263a-1860-a515-58fb74e2cfd2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175135378.022}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175135378.1262}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:1|1|graph:c456f1e5-263a-1860-a515-58fb74e2cfd2\", \"new_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:1|1|graph:c456f1e5-263a-1860-a515-58fb74e2cfd2\"}, \"timestamp\": 1766175135378.1812}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:1|1|graph:c456f1e5-263a-1860-a515-58fb74e2cfd2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\"}, \"timestamp\": 1766175135378.2258}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175135378.546}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766175135378.6672}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175135378.738}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766175135378.9802}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175135379.0232}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766175135379.138}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:1|1|graph:c456f1e5-263a-1860-a515-58fb74e2cfd2\"}, \"timestamp\": 1766175135379.1658}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:2|2|graph:00561968-1ed1-dbfe-7411-b3301ac06405\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175135413.6091}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175135413.7512}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:2|2|graph:00561968-1ed1-dbfe-7411-b3301ac06405\", \"new_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:2|2|graph:00561968-1ed1-dbfe-7411-b3301ac06405\"}, \"timestamp\": 1766175135413.801}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:2|2|graph:00561968-1ed1-dbfe-7411-b3301ac06405\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\"}, \"timestamp\": 1766175135413.841}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175135414.1892}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766175135414.2302}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175135414.2917}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766175135414.546}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175135414.5898}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766175135414.622}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:2|2|graph:00561968-1ed1-dbfe-7411-b3301ac06405\"}, \"timestamp\": 1766175135414.6528}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:3|3|graph:93826670-d82b-8146-76f4-05ec48fab8e3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175135447.811}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175135447.927}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:3|3|graph:93826670-d82b-8146-76f4-05ec48fab8e3\", \"new_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:3|3|graph:93826670-d82b-8146-76f4-05ec48fab8e3\"}, \"timestamp\": 1766175135448.098}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:3|3|graph:93826670-d82b-8146-76f4-05ec48fab8e3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\"}, \"timestamp\": 1766175135448.1863}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175135448.582}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766175135448.631}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175135448.705}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766175135449.0393}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175135449.11}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766175135449.168}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:3|3|graph:93826670-d82b-8146-76f4-05ec48fab8e3\"}, \"timestamp\": 1766175135449.206}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:4|4|graph:4dd30fc8-8aae-9a25-b1f4-816d7bb28fe0\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175135498.8967}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175135499.02}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:4|4|graph:4dd30fc8-8aae-9a25-b1f4-816d7bb28fe0\", \"new_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:4|4|graph:4dd30fc8-8aae-9a25-b1f4-816d7bb28fe0\"}, \"timestamp\": 1766175135499.126}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:4|4|graph:4dd30fc8-8aae-9a25-b1f4-816d7bb28fe0\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\"}, \"timestamp\": 1766175135499.2268}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175135499.6328}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766175135499.689}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175135499.758}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766175135500.0032}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175135500.052}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766175135500.0962}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:4|4|graph:4dd30fc8-8aae-9a25-b1f4-816d7bb28fe0\"}, \"timestamp\": 1766175135500.142}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:3|3|graph:93826670-d82b-8146-76f4-05ec48fab8e3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175146400.239}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175146400.414}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:3|3|graph:93826670-d82b-8146-76f4-05ec48fab8e3\", \"new_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:3|3|graph:93826670-d82b-8146-76f4-05ec48fab8e3\"}, \"timestamp\": 1766175146400.882}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:3|3|graph:93826670-d82b-8146-76f4-05ec48fab8e3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\"}, \"timestamp\": 1766175146400.97}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:723985c2\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd170-319e-6ce2-8000-bd28756a9980\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:3|3|graph:93826670-d82b-8146-76f4-05ec48fab8e3\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd170-319e-654e-bfff-192539f7e900\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:3|3|graph:93826670-d82b-8146-76f4-05ec48fab8e3\"}]}, \"timestamp\": 1766175146401.665}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd170-319e-6ce2-8000-bd28756a9980\", \"checkpoint_ns\": \"wide_funnel:0db66955-c3be-353c-b71b-866a22361824|worker:3|3|graph:93826670-d82b-8146-76f4-05ec48fab8e3\"}, \"timestamp\": 1766175146401.738}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd170-319e-6ce2-8000-bd28756a9980\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766175146402.3691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"has_progress\": true, \"is_at_virtual_start\": false, \"effective_input_is_none\": false}, \"timestamp\": 1766175146402.42}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:fa359201-dc71-1af1-9751-c9e507331ae8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766175155767.879}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766175155768.042}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:fa359201-dc71-1af1-9751-c9e507331ae8\", \"new_ns\": \"user_preferences:fa359201-dc71-1af1-9751-c9e507331ae8\"}, \"timestamp\": 1766175155768.4888}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:fa359201-dc71-1af1-9751-c9e507331ae8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175155768.544}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175155768.873}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175155768.919}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175155768.981}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175155769.0298}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175155769.0789}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766175155769.32}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175155769.367}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175155769.408}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766175155769.4468}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:fa359201-dc71-1af1-9751-c9e507331ae8\"}, \"timestamp\": 1766175155769.482}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766175163970.865}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:befb3388-073b-5342-990a-8abdc16035a9\", \"new_ns\": \"route_drafting:befb3388-073b-5342-990a-8abdc16035a9\"}, \"timestamp\": 1766175163976.188}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:befb3388-073b-5342-990a-8abdc16035a9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175163976.328}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175163976.609}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175163976.656}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175163976.7207}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175163976.774}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175163976.9758}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766175163977.34}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175163977.402}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175163977.448}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766175163977.4878}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:befb3388-073b-5342-990a-8abdc16035a9\"}, \"timestamp\": 1766175163977.523}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:befb3388-073b-5342-990a-8abdc16035a9|graph:b7c5c867-d6ad-6720-973c-bb7d2ecce83a\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766175164082.2458}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175164082.459}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:befb3388-073b-5342-990a-8abdc16035a9|graph:b7c5c867-d6ad-6720-973c-bb7d2ecce83a\", \"new_ns\": \"route_drafting:befb3388-073b-5342-990a-8abdc16035a9|graph:b7c5c867-d6ad-6720-973c-bb7d2ecce83a\"}, \"timestamp\": 1766175164083.0068}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:befb3388-073b-5342-990a-8abdc16035a9|graph:b7c5c867-d6ad-6720-973c-bb7d2ecce83a\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175164083.083}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175164083.4172}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766175164083.4648}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175164083.536}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766175164083.782}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175164083.835}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766175164083.874}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:befb3388-073b-5342-990a-8abdc16035a9|graph:b7c5c867-d6ad-6720-973c-bb7d2ecce83a\"}, \"timestamp\": 1766175164083.9412}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766175182553.592}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:1\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:1\"}, \"timestamp\": 1766175182631.315}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175182631.47}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175182632.181}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175182632.229}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175182632.292}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175182632.3398}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175182632.3818}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766175182632.617}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175182632.658}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175182632.69}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766175182632.724}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:1\"}, \"timestamp\": 1766175182632.751}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:2\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:2\"}, \"timestamp\": 1766175182691.0168}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175182691.2021}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175182691.937}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175182692.0378}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175182692.116}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175182692.172}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175182692.2258}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766175182692.478}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175182692.5261}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175182692.568}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766175182692.607}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:2\"}, \"timestamp\": 1766175182692.642}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:3\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:3\"}, \"timestamp\": 1766175182751.278}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175182751.4492}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175182752.0918}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175182752.133}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175182752.1921}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175182752.239}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175182752.283}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766175182752.5178}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175182752.56}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175182752.596}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766175182752.6309}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:3\"}, \"timestamp\": 1766175182752.6619}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:4\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:4\"}, \"timestamp\": 1766175182812.623}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175182812.759}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175182813.4148}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175182813.466}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175182813.5327}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175182813.5823}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175182813.628}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766175182813.8682}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175182813.912}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175182813.949}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766175182813.983}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:4\"}, \"timestamp\": 1766175182814.016}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:5\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:5\"}, \"timestamp\": 1766175182870.688}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175182870.8533}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175182871.6272}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175182871.6748}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175182871.739}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175182871.787}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175182871.833}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"count\": 0}, \"timestamp\": 1766175182872.0908}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175182872.135}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175182872.172}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_sources\": 3}, \"timestamp\": 1766175182872.288}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:5\"}, \"timestamp\": 1766175182872.339}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:6\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:6\"}, \"timestamp\": 1766175182931.4639}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175182931.615}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175182932.242}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175182932.2822}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175182932.3662}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175182932.4238}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175182932.471}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"count\": 0}, \"timestamp\": 1766175182932.722}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175182932.764}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175182932.8}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_sources\": 3}, \"timestamp\": 1766175182932.8342}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:6\"}, \"timestamp\": 1766175182932.863}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:7\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:7\"}, \"timestamp\": 1766175182990.9692}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175182991.1821}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175182991.827}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175182991.882}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175182991.945}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175182992.013}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175182992.065}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"count\": 0}, \"timestamp\": 1766175182992.3042}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175182992.385}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175182992.456}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_sources\": 3}, \"timestamp\": 1766175182992.5042}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:7\"}, \"timestamp\": 1766175182992.5398}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:8\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:8\"}, \"timestamp\": 1766175183050.828}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175183050.956}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175183051.5671}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175183051.606}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175183051.663}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175183051.709}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175183051.751}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"count\": 0}, \"timestamp\": 1766175183051.9868}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175183052.0261}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175183052.062}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_sources\": 3}, \"timestamp\": 1766175183052.094}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:8\"}, \"timestamp\": 1766175183052.125}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:9\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:9\"}, \"timestamp\": 1766175183110.37}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175183110.541}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175183111.1692}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175183111.219}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175183111.2803}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175183111.3323}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175183111.393}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"count\": 0}, \"timestamp\": 1766175183111.637}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175183111.682}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175183111.7173}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_sources\": 3}, \"timestamp\": 1766175183111.7617}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:9\"}, \"timestamp\": 1766175183111.794}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:1|1|graph:73591aa8-b633-ca7a-b3ba-3239178e0378\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175184770.196}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175184770.3093}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:1|1|graph:73591aa8-b633-ca7a-b3ba-3239178e0378\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:1|1|graph:73591aa8-b633-ca7a-b3ba-3239178e0378\"}, \"timestamp\": 1766175184770.36}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:1|1|graph:73591aa8-b633-ca7a-b3ba-3239178e0378\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175184770.413}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175184770.724}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766175184770.766}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175184770.865}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766175184771.135}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175184771.189}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766175184771.2278}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:1|1|graph:73591aa8-b633-ca7a-b3ba-3239178e0378\"}, \"timestamp\": 1766175184771.2979}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:2|2|graph:78bfc7bb-1771-56fc-2103-b11457f3a031\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175184808.274}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175184808.409}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:2|2|graph:78bfc7bb-1771-56fc-2103-b11457f3a031\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:2|2|graph:78bfc7bb-1771-56fc-2103-b11457f3a031\"}, \"timestamp\": 1766175184808.4631}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:2|2|graph:78bfc7bb-1771-56fc-2103-b11457f3a031\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175184808.511}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175184808.904}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766175184809.002}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175184809.075}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766175184809.3372}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175184809.387}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766175184809.4258}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:2|2|graph:78bfc7bb-1771-56fc-2103-b11457f3a031\"}, \"timestamp\": 1766175184809.508}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:3|3|graph:92d493da-1e84-e2ca-ccf0-61472f68d1a4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175184843.812}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175184843.924}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:3|3|graph:92d493da-1e84-e2ca-ccf0-61472f68d1a4\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:3|3|graph:92d493da-1e84-e2ca-ccf0-61472f68d1a4\"}, \"timestamp\": 1766175184843.976}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:3|3|graph:92d493da-1e84-e2ca-ccf0-61472f68d1a4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175184844.018}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175184844.3147}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766175184844.351}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175184844.408}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766175184844.651}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175184844.6929}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766175184844.723}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:3|3|graph:92d493da-1e84-e2ca-ccf0-61472f68d1a4\"}, \"timestamp\": 1766175184844.7603}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:4|4|graph:a505448c-9de8-9436-47b2-92e8e24cf189\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175184878.752}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175184878.866}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:4|4|graph:a505448c-9de8-9436-47b2-92e8e24cf189\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:4|4|graph:a505448c-9de8-9436-47b2-92e8e24cf189\"}, \"timestamp\": 1766175184879.01}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:4|4|graph:a505448c-9de8-9436-47b2-92e8e24cf189\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175184879.101}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175184879.432}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766175184879.476}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175184879.5562}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766175184879.8289}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175184879.8762}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766175184879.91}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:4|4|graph:a505448c-9de8-9436-47b2-92e8e24cf189\"}, \"timestamp\": 1766175184879.942}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:5|5|graph:9bae96b2-6545-d393-984e-497aa2def9bd\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175184912.9531}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175184913.056}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:5|5|graph:9bae96b2-6545-d393-984e-497aa2def9bd\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:5|5|graph:9bae96b2-6545-d393-984e-497aa2def9bd\"}, \"timestamp\": 1766175184913.188}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:5|5|graph:9bae96b2-6545-d393-984e-497aa2def9bd\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175184913.2458}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175184913.558}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\"}, \"timestamp\": 1766175184913.595}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175184913.6528}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"count\": 0}, \"timestamp\": 1766175184913.892}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175184913.9377}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"snapshot_sources\": 1}, \"timestamp\": 1766175184913.9731}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:5|5|graph:9bae96b2-6545-d393-984e-497aa2def9bd\"}, \"timestamp\": 1766175184914.009}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:6|6|graph:702cbd9e-1fa7-db5d-8614-9b6ea32fc3c8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175184947.0652}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175184947.167}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:6|6|graph:702cbd9e-1fa7-db5d-8614-9b6ea32fc3c8\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:6|6|graph:702cbd9e-1fa7-db5d-8614-9b6ea32fc3c8\"}, \"timestamp\": 1766175184947.3237}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:6|6|graph:702cbd9e-1fa7-db5d-8614-9b6ea32fc3c8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175184947.385}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175184947.684}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\"}, \"timestamp\": 1766175184947.723}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175184947.783}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"count\": 0}, \"timestamp\": 1766175184948.0222}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175184948.065}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"snapshot_sources\": 1}, \"timestamp\": 1766175184948.097}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:6|6|graph:702cbd9e-1fa7-db5d-8614-9b6ea32fc3c8\"}, \"timestamp\": 1766175184948.1653}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:7|7|graph:25fa1c91-f97e-bf07-87e3-0f83b1511a11\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175184982.007}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175184982.1172}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:7|7|graph:25fa1c91-f97e-bf07-87e3-0f83b1511a11\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:7|7|graph:25fa1c91-f97e-bf07-87e3-0f83b1511a11\"}, \"timestamp\": 1766175184982.1848}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:7|7|graph:25fa1c91-f97e-bf07-87e3-0f83b1511a11\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175184982.2432}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175184982.5388}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\"}, \"timestamp\": 1766175184982.579}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175184982.6482}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"count\": 0}, \"timestamp\": 1766175184982.881}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175184982.923}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"snapshot_sources\": 1}, \"timestamp\": 1766175184982.968}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:7|7|graph:25fa1c91-f97e-bf07-87e3-0f83b1511a11\"}, \"timestamp\": 1766175184983.0132}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:8|8|graph:b46927d2-5736-4fdd-fdbb-eaf0e6e431ab\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175185016.0679}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175185016.182}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:8|8|graph:b46927d2-5736-4fdd-fdbb-eaf0e6e431ab\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:8|8|graph:b46927d2-5736-4fdd-fdbb-eaf0e6e431ab\"}, \"timestamp\": 1766175185016.235}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:8|8|graph:b46927d2-5736-4fdd-fdbb-eaf0e6e431ab\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175185016.274}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175185016.548}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\"}, \"timestamp\": 1766175185016.642}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175185016.6987}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"count\": 0}, \"timestamp\": 1766175185016.926}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175185016.9712}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"snapshot_sources\": 1}, \"timestamp\": 1766175185017.006}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:8|8|graph:b46927d2-5736-4fdd-fdbb-eaf0e6e431ab\"}, \"timestamp\": 1766175185017.037}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:9|9|graph:79a891ea-5461-b03f-84b5-25ec7f023440\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175185049.8828}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175185049.987}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:9|9|graph:79a891ea-5461-b03f-84b5-25ec7f023440\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:9|9|graph:79a891ea-5461-b03f-84b5-25ec7f023440\"}, \"timestamp\": 1766175185050.1309}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:9|9|graph:79a891ea-5461-b03f-84b5-25ec7f023440\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175185050.192}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175185050.4902}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\"}, \"timestamp\": 1766175185050.53}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175185050.6072}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"count\": 0}, \"timestamp\": 1766175185050.859}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175185050.913}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"snapshot_sources\": 1}, \"timestamp\": 1766175185050.9473}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:9|9|graph:79a891ea-5461-b03f-84b5-25ec7f023440\"}, \"timestamp\": 1766175185050.991}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:4|4|graph:a505448c-9de8-9436-47b2-92e8e24cf189\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175197203.214}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175197203.348}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:4|4|graph:a505448c-9de8-9436-47b2-92e8e24cf189\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:4|4|graph:a505448c-9de8-9436-47b2-92e8e24cf189\"}, \"timestamp\": 1766175197203.405}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:4|4|graph:a505448c-9de8-9436-47b2-92e8e24cf189\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175197203.454}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": \"1f0dd172-0906-6fd0-8000-138ac983a5a5\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:4|4|graph:a505448c-9de8-9436-47b2-92e8e24cf189\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": \"1f0dd172-0906-690e-bfff-cde7f7f50ad6\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:4|4|graph:a505448c-9de8-9436-47b2-92e8e24cf189\"}]}, \"timestamp\": 1766175197204.032}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": \"1f0dd172-0906-6fd0-8000-138ac983a5a5\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:4|4|graph:a505448c-9de8-9436-47b2-92e8e24cf189\"}, \"timestamp\": 1766175197204.103}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": \"1f0dd172-0906-6fd0-8000-138ac983a5a5\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766175197204.735}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"has_progress\": true, \"is_at_virtual_start\": false, \"effective_input_is_none\": false}, \"timestamp\": 1766175197204.7842}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:7|7|graph:25fa1c91-f97e-bf07-87e3-0f83b1511a11\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175198751.4739}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175198751.616}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"original_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:7|7|graph:25fa1c91-f97e-bf07-87e3-0f83b1511a11\", \"new_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:7|7|graph:25fa1c91-f97e-bf07-87e3-0f83b1511a11\"}, \"timestamp\": 1766175198752.1138}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:7|7|graph:25fa1c91-f97e-bf07-87e3-0f83b1511a11\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\"}, \"timestamp\": 1766175198752.197}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:1081f464\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_id\": \"1f0dd172-0a02-68ee-8000-31162a33010c\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:7|7|graph:25fa1c91-f97e-bf07-87e3-0f83b1511a11\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_id\": \"1f0dd172-0a02-627c-bfff-4be5f91a6129\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:7|7|graph:25fa1c91-f97e-bf07-87e3-0f83b1511a11\"}]}, \"timestamp\": 1766175198752.7627}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_id\": \"1f0dd172-0a02-68ee-8000-31162a33010c\", \"checkpoint_ns\": \"wide_funnel:ca15fb17-7012-340c-1523-d33ca1243006|worker:7|7|graph:25fa1c91-f97e-bf07-87e3-0f83b1511a11\"}, \"timestamp\": 1766175198752.844}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_id\": \"1f0dd172-0a02-68ee-8000-31162a33010c\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766175198753.4888}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"has_progress\": true, \"is_at_virtual_start\": false, \"effective_input_is_none\": false}, \"timestamp\": 1766175198753.563}\n\nFAILED tests/e2e_tests/business_agents/travel_guide_agent/test_travel_guide_agent.py::TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution[moscow-easy-benchmark-1200] - langchain_google_genai.chat_models.ChatGoogleGenerativeAIError: Invalid argument provided to Gemini: 400 * GenerateContentRequest.contents: contents is not specified\n\nDuring task with name 'agent' and id 'c7bc9b07-4c4b-5e3c-9554-d10d1394bcbb'\nDuring task with name 'agent' and id 'd62903fa-1ea3-a884-f7bf-ec2fe15681a7'\nDuring task with name 'graph' and id '93826670-d82b-8146-76f4-05ec48fab8e3'\nDuring task with name 'worker' and id '560b1aad-3afe-61fb-d0b9-af63716e6aa1'\nDuring task with name 'wide_funnel_workers' and id '2c9c62eb-e06a-d5e5-a4f8-82f1c2b06927'\nDuring task with name 'wide_funnel' and id '0db66955-c3be-353c-b71b-866a22361824'\nFAILED tests/e2e_tests/business_agents/travel_guide_agent/test_travel_guide_agent.py::TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution[rosa-distribution-medium-benchmark-1200] - langchain_google_genai.chat_models.ChatGoogleGenerativeAIError: Invalid argument provided to Gemini: 400 * GenerateContentRequest.contents: contents is not specified\n\nDuring task with name 'agent' and id 'e8735e60-8ea1-42c5-f33d-af62035a950d'\nDuring task with name 'agent' and id '525d05cb-bf18-f30c-1182-4870547a8901'\nDuring task with name 'graph' and id 'a505448c-9de8-9436-47b2-92e8e24cf189'\nDuring task with name 'worker' and id 'd376e1aa-45c8-0d90-18f2-a0f04f3305ab'\nDuring task with name 'wide_funnel_workers' and id 'fe97414f-7ef5-ad4c-acfc-ba6a14e99cac'\nDuring task with name 'wide_funnel' and id 'ca15fb17-7012-340c-1523-d33ca1243006'"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3840-322a-7601-90d4-8528cc42a7de",
    "content": "**\u041e\u0448\u0438\u0431\u043a\u0430 Gemini `contents is not specified` \u0438 `function_call.name: Name cannot be empty` \u0432 \u0432\u0430\u0448\u0435\u0439 4-\u0443\u0440\u043e\u0432\u043d\u0435\u0432\u043e\u0439 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u0435 \u0432\u044b\u0437\u0432\u0430\u043d\u0430 \u0442\u0435\u043c, \u0447\u0442\u043e \u043f\u0440\u0438 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 (Resume) \u0438\u0437 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0445 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439 \u0441\u0442\u0435\u0439\u0442 \u0433\u0440\u0430\u0444\u0430 \u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u00ab\u043f\u0443\u0441\u0442\u044b\u043c\u00bb \u0438\u043b\u0438 \u00ab\u0431\u0438\u0442\u044b\u043c\u00bb \u0434\u043b\u044f \u043c\u043e\u0434\u0435\u043b\u0438, \u0445\u043e\u0442\u044f \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442.**\n\n\u042d\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0438\u0437-\u0437\u0430 \u0442\u043e\u0433\u043e, \u0447\u0442\u043e LangGraph \u043f\u0440\u0438 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 \u0441 `input=None` (\u0438\u043b\u0438 `{}`) \u043e\u043f\u0438\u0440\u0430\u0435\u0442\u0441\u044f \u0438\u0441\u043a\u043b\u044e\u0447\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043d\u0430 \u0442\u043e, \u0447\u0442\u043e \u043b\u0435\u0436\u0438\u0442 \u0432 \u043a\u0430\u043d\u0430\u043b\u0430\u0445 (channels) \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430. \u0412 \u0432\u0430\u0448\u0435\u0439 \u0446\u0435\u043f\u043e\u0447\u043a\u0435 `graph3 (worker) -> graph4 (assistant)` \u0435\u0441\u0442\u044c \u00ab\u043c\u0435\u0440\u0442\u0432\u0430\u044f \u0437\u043e\u043d\u0430\u00bb:\n\n### 1. \u041f\u043e\u0447\u0435\u043c\u0443 \u0432\u043e\u0437\u043d\u0438\u043a\u0430\u0435\u0442 `contents is not specified`\n\u042d\u0442\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 Gemini \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0445 \u0432 LLM, \u043f\u0443\u0441\u0442.\n- **\u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439:** \u0412\u043e\u0440\u043a\u0435\u0440 \u0443\u043f\u0430\u043b \u043f\u043e\u0441\u043b\u0435 \u0442\u043e\u0433\u043e, \u043a\u0430\u043a \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430 \u0431\u044b\u043b \u0441\u043e\u0437\u0434\u0430\u043d, \u043d\u043e **\u0434\u043e** \u0442\u043e\u0433\u043e, \u043a\u0430\u043a \u043f\u0435\u0440\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442 \u0432\u043e\u0440\u043a\u0435\u0440\u0430 \u0431\u044b\u043b\u043e \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0438 \u0437\u0430\u043f\u0438\u0441\u0430\u043d\u043e \u0432 \u0441\u0442\u0435\u0439\u0442 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430. \n- **\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442:** \u0412\u0430\u0448 `memory_manager` \u0432\u0438\u0434\u0438\u0442 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442, \u0432\u0438\u0434\u0438\u0442 `next=[\"agent\"]`, \u0441\u0447\u0438\u0442\u0430\u0435\u0442 \u044d\u0442\u043e \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u043e\u043c \u0438 \u0448\u043b\u0435\u0442 `None` (\u0438\u043b\u0438 `{}`). \u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u043f\u0440\u043e\u0441\u044b\u043f\u0430\u0435\u0442\u0441\u044f, \u0438\u0434\u0435\u0442 \u0432 LLM, \u043d\u043e \u0432 \u0435\u0433\u043e \u0441\u0442\u0435\u0439\u0442\u0435 `messages` \u2014 \u043f\u0443\u0441\u0442\u043e. Gemini \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u043f\u0443\u0441\u0442\u043e\u0439 \u0437\u0430\u043f\u0440\u043e\u0441 \u0438 \u043f\u0430\u0434\u0430\u0435\u0442 \u0441 400.\n\n### 2. \u041f\u043e\u0447\u0435\u043c\u0443 \u0432\u043e\u0437\u043d\u0438\u043a\u0430\u0435\u0442 `function_call.name: Name cannot be empty`\n\u042d\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442, \u043a\u043e\u0433\u0434\u0430 \u0432 \u0441\u0442\u0435\u0439\u0442\u0435 \u0435\u0441\u0442\u044c \u00ab\u043f\u0440\u0438\u0437\u0440\u0430\u043a\u00bb \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f.\n- **\u0421\u0446\u0435\u043d\u0430\u0440\u0438\u0439:** LLM \u043d\u0430\u0447\u0430\u043b\u0430 \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0437\u043e\u0432 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0430, \u043d\u043e \u0441\u0435\u0441\u0441\u0438\u044f \u043f\u0440\u0435\u0440\u0432\u0430\u043b\u0430\u0441\u044c. \u0412 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0437\u0430\u043f\u0438\u0441\u0430\u043b\u0441\u044f `AIMessage` \u0441 \u0431\u043b\u043e\u043a\u043e\u043c `tool_calls`, \u043d\u043e \u0431\u0435\u0437 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043d\u043e\u0433\u043e \u043f\u043e\u043b\u044f `name`.\n- **\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442:** \u041f\u0440\u0438 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 \u044d\u0442\u043e\u0442 \u00ab\u0431\u0438\u0442\u044b\u0439\u00bb `AIMessage` \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043e\u0431\u0440\u0430\u0442\u043d\u043e \u0432 Gemini \u043a\u0430\u043a \u0447\u0430\u0441\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u0438. Gemini \u0432\u0438\u0434\u0438\u0442 \u0432\u044b\u0437\u043e\u0432 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u0430 \u0431\u0435\u0437 \u0438\u043c\u0435\u043d\u0438 \u0438 \u0432\u044b\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0443.\n\n---\n\n### \u041e\u043a\u043e\u043d\u0447\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435: \u00ab\u041f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f\u00bb\n\n\u0427\u0442\u043e\u0431\u044b \u0432\u044b\u043b\u0435\u0447\u0438\u0442\u044c \u043e\u0431\u0435 \u043e\u0448\u0438\u0431\u043a\u0438, \u043c\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c, \u0447\u0442\u043e \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 **\u0432\u0441\u0435\u0433\u0434\u0430** \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0432\u0432\u043e\u0434 \u043e\u0442 \u0432\u043e\u0440\u043a\u0435\u0440\u0430, \u0435\u0441\u043b\u0438 \u043e\u043d \u043d\u0435 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438 \u00ab\u0443\u0436\u0435 \u0435\u0441\u0442\u044c \u043e\u0442\u0432\u0435\u0442 \u043e\u0442 AI\u00bb.\n\n**\u0418\u0441\u043f\u0440\u0430\u0432\u044c\u0442\u0435 \u043b\u043e\u0433\u0438\u043a\u0443 \u0432 `memory_manager.py` (\u043c\u0435\u0442\u043e\u0434 `ainvoke_from_checkpoint`):**\n\n\u0412\u043c\u0435\u0441\u0442\u043e \u0441\u043b\u043e\u0436\u043d\u043e\u0433\u043e \u0432\u044b\u0431\u043e\u0440\u0430 \u043c\u0435\u0436\u0434\u0443 `None` \u0438 `graph_input`, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044e: \u00ab\u0415\u0441\u043b\u0438 \u043c\u044b \u043d\u0435 \u0443\u0432\u0435\u0440\u0435\u043d\u044b \u0432 \u043f\u043e\u043b\u043d\u043e\u0442\u0435 \u0438\u0441\u0442\u043e\u0440\u0438\u0438, \u0432\u0441\u0435\u0433\u0434\u0430 \u043c\u0435\u0440\u0434\u0436\u0438\u043c \u0441 \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u043c \u0432\u0432\u043e\u0434\u043e\u043c\u00bb.\n\n```python\nif isinstance(next_nodes, Sequence) and next_nodes:\n    next_nodes_list = list(next_nodes)\n    values = getattr(snapshot, \"values\", {})\n    messages = values.get(\"messages\", [])\n\n    # \u041e\u0420\u0413\u0410\u041d\u0418\u0427\u041d\u042b\u0419 \u0424\u0418\u041a\u0421:\n    # 1. \u0415\u0441\u043b\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 < 2 (\u043d\u0435\u0442 \u043f\u043e\u043b\u043d\u043e\u0446\u0435\u043d\u043d\u043e\u0433\u043e Q/A), \u0437\u043d\u0430\u0447\u0438\u0442 \u0441\u0442\u0435\u0439\u0442 \u043d\u0435 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d.\n    # 2. \u0412 \u044d\u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u043c\u044b \u041e\u0411\u042f\u0417\u0410\u041d\u042b \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c graph_input, \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u0435\u0441\u0442\u044c checkpoint_id.\n    # 3. LangGraph \u0441\u043c\u0435\u0440\u0434\u0436\u0438\u0442 \u0438\u0445, \u0438 EmptyInputError / Gemini Error \u0438\u0441\u0447\u0435\u0437\u043d\u0443\u0442.\n    \n    is_at_start = (next_nodes_list == [\"__start__\"])\n    has_full_history = isinstance(messages, Sequence) and len(messages) >= 2\n    \n    # \u0415\u0441\u043b\u0438 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u043c\u0430\u043b\u043e \u0438\u043b\u0438 \u043c\u044b \u043d\u0430 \u0441\u0442\u0430\u0440\u0442\u0435 - \u0448\u043b\u0435\u043c \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0432\u0432\u043e\u0434.\n    # \u0415\u0441\u043b\u0438 \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0443\u0436\u0435 \u0431\u043e\u0433\u0430\u0442\u0430\u044f - \u0448\u043b\u0435\u043c {}, \u0447\u0442\u043e\u0431\u044b \u043d\u0435 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c.\n    effective_input = graph_input if (not has_full_history or is_at_start) else {}\n\n    return await self.ainvoke_with_durability(\n        graph=graph,\n        graph_input=effective_input, \n        config=cfg,\n        context=context,\n        durability=durability,\n        local_checkpointer=effective_local_checkpointer,\n    )\n```\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0441\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442:\n1.  **\u0414\u043b\u044f Gemini:** \u0415\u0441\u043b\u0438 \u0441\u0442\u0435\u0439\u0442 \u0431\u044b\u043b \u043f\u0443\u0441\u0442, `effective_input` (\u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u0439 `HumanMessage`) \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0435\u0433\u043e. \u041c\u043e\u0434\u0435\u043b\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442 `contents` \u0438 \u043d\u0435 \u0443\u043f\u0430\u0434\u0435\u0442.\n2.  **\u0414\u043b\u044f `EmptyInputError`:** \u0412\u044b \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0435 `None` \u0432 \u00ab\u0433\u043e\u043b\u043e\u0434\u043d\u044b\u0439\u00bb \u0433\u0440\u0430\u0444.\n3.  **\u0414\u043b\u044f `Name cannot be empty`:** \u041f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 \u0441\u0432\u0435\u0436\u0435\u0433\u043e `graph_input` \u043f\u0440\u0438 \u043c\u0430\u043b\u043e\u043c \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0437\u0430\u0441\u0442\u0430\u0432\u0438\u0442 \u0440\u0435\u0434\u0443\u0441\u0435\u0440\u044b LangGraph \u043b\u0438\u0431\u043e \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u044c, \u043b\u0438\u0431\u043e \u043f\u0435\u0440\u0435\u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0442\u0435\u0439\u0442, \u0447\u0442\u043e \u0447\u0430\u0441\u0442\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u00ab\u0431\u0438\u0442\u044b\u0435\u00bb \u0431\u043b\u043e\u043a\u0438 `tool_calls`.\n\n**\u0412\u0430\u0436\u043d\u044b\u0439 \u0441\u043e\u0432\u0435\u0442 \u0434\u043b\u044f Graph 4:**\n\u0415\u0441\u043b\u0438 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 Gemini, \u0434\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0432 \u043b\u043e\u0433\u0438\u043a\u0443 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443: \u0435\u0441\u043b\u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u0441\u0442\u0435\u0439\u0442\u0435 \u2014 `AIMessage` \u0441 \u043f\u0443\u0441\u0442\u044b\u043c\u0438 `tool_calls`, \u0443\u0434\u0430\u043b\u044f\u0439\u0442\u0435 \u0435\u0433\u043e \u043f\u0435\u0440\u0435\u0434 \u0432\u044b\u0437\u043e\u0432\u043e\u043c \u043c\u043e\u0434\u0435\u043b\u0438.\n\n**Relevant docs:**\n- [Time Travel: Resume from Checkpoint](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)\n- [Google Gemini Tool Calling Requirements](https://docs.langchain.com/oss/python/langchain/models)\n- [LangGraph Errors: EmptyInputError](https://docs.langchain.com/langsmith/use-threads#empty-thread)"
  },
  {
    "role": "user",
    "id": "fc994634-bf8b-4285-88e1-b1b583783b13",
    "content": "\u0441\u0435\u0439\u0447\u0430\u0441 \u043f\u0440\u0438 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 assistant \u0433\u0440\u0430\u0444\u0430 \u0438\u0441\u0442\u043e\u0440\u0438\u044f massages \u043f\u0443\u0441\u0442\u0430\u044f, \u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0430\n\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:a4c2594d-8233-42f2-6314-52928cc1a9c1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766175427105.054}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766175427105.8618}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:a4c2594d-8233-42f2-6314-52928cc1a9c1\", \"new_ns\": \"user_preferences:a4c2594d-8233-42f2-6314-52928cc1a9c1\"}, \"timestamp\": 1766175427105.944}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:a4c2594d-8233-42f2-6314-52928cc1a9c1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175427105.996}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175427106.354}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175427106.404}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175427106.4902}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175427106.546}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175427106.596}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766175427106.85}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175427107.445}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175427107.501}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766175427107.5908}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:a4c2594d-8233-42f2-6314-52928cc1a9c1\"}, \"timestamp\": 1766175427107.632}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766175434501.2878}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c\", \"new_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c\"}, \"timestamp\": 1766175434507.261}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175434507.3228}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175434507.5981}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175434507.638}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175434507.7498}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175434507.8188}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175434507.8772}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766175434508.17}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175434508.226}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175434508.316}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766175434508.363}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c\"}, \"timestamp\": 1766175434508.4001}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c|graph:4e828c78-0605-07c0-f539-8ba58c0c5530\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766175434742.3308}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175434742.484}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c|graph:4e828c78-0605-07c0-f539-8ba58c0c5530\", \"new_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c|graph:4e828c78-0605-07c0-f539-8ba58c0c5530\"}, \"timestamp\": 1766175434742.5898}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c|graph:4e828c78-0605-07c0-f539-8ba58c0c5530\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175434742.6418}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175434742.952}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766175434743.0}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175434743.0752}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766175434743.317}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175434743.4182}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766175434743.463}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c|graph:4e828c78-0605-07c0-f539-8ba58c0c5530\"}, \"timestamp\": 1766175434743.505}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766175447817.425}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1\"}, \"timestamp\": 1766175447891.614}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175447891.797}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175447892.4749}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175447892.533}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175447892.617}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175447892.677}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175447892.7358}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766175447893.047}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175447893.091}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175447893.129}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766175447893.165}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1\"}, \"timestamp\": 1766175447893.196}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2\"}, \"timestamp\": 1766175447951.712}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175447951.853}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175447952.568}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175447952.624}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175447952.691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175447952.738}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175447952.786}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766175447953.05}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175447953.096}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175447953.133}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766175447953.169}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2\"}, \"timestamp\": 1766175447953.2002}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3\"}, \"timestamp\": 1766175448009.4832}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175448009.6672}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175448010.298}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175448010.347}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175448010.4119}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175448010.46}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175448010.5479}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766175448010.8162}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175448010.867}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175448010.915}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766175448010.967}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3\"}, \"timestamp\": 1766175448011.0027}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4\"}, \"timestamp\": 1766175448068.661}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175448068.811}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175448069.448}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175448069.501}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175448069.588}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175448069.642}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175448069.945}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766175448070.188}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175448070.236}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175448070.294}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766175448070.3362}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4\"}, \"timestamp\": 1766175448070.385}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175448646.095}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175448646.187}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\"}, \"timestamp\": 1766175448646.2432}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175448646.2898}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175448646.595}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766175448646.824}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175448646.901}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766175448647.161}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175448647.219}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766175448647.2522}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\"}, \"timestamp\": 1766175448647.282}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175448680.031}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175448680.137}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\"}, \"timestamp\": 1766175448680.2349}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175448680.285}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175448680.746}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766175448680.789}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175448680.8691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766175448681.1252}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175448681.1719}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766175448681.222}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\"}, \"timestamp\": 1766175448681.273}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175448714.4429}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175448714.5479}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\"}, \"timestamp\": 1766175448714.596}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175448714.663}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175448715.0002}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766175448715.043}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175448715.104}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766175448715.344}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175448715.3909}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766175448715.426}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\"}, \"timestamp\": 1766175448715.4592}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4|4|graph:e6afc6f6-c699-4324-8925-a7baeb298366\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175448749.0771}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175448749.196}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4|4|graph:e6afc6f6-c699-4324-8925-a7baeb298366\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4|4|graph:e6afc6f6-c699-4324-8925-a7baeb298366\"}, \"timestamp\": 1766175448749.2568}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4|4|graph:e6afc6f6-c699-4324-8925-a7baeb298366\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175448749.304}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175448749.6409}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766175448749.6829}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175448749.76}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766175448749.9949}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175448750.041}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766175448750.076}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4|4|graph:e6afc6f6-c699-4324-8925-a7baeb298366\"}, \"timestamp\": 1766175448750.1208}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175461680.5862}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175461680.6873}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\"}, \"timestamp\": 1766175461680.757}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175461680.813}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd17b-dd28-67ec-8000-cb43be6c110b\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd17b-dd28-61a2-bfff-0586acc80abf\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\"}]}, \"timestamp\": 1766175461681.6143}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd17b-dd28-67ec-8000-cb43be6c110b\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\"}, \"timestamp\": 1766175461681.679}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd17b-dd28-67ec-8000-cb43be6c110b\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766175461682.2961}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"message_count\": 1, \"has_full_history\": false, \"is_at_virtual_start\": false, \"effective_input_is_none\": false}, \"timestamp\": 1766175461682.344}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175474476.375}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175474476.5508}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\"}, \"timestamp\": 1766175474476.9458}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175474477.0}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd17b-dcd5-611e-8000-7cce7672e789\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd17b-dcd4-6ab6-bfff-47b23ef769ae\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\"}]}, \"timestamp\": 1766175474477.534}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd17b-dcd5-611e-8000-7cce7672e789\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\"}, \"timestamp\": 1766175474477.6057}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd17b-dcd5-611e-8000-7cce7672e789\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766175474478.1812}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"message_count\": 1, \"has_full_history\": false, \"is_at_virtual_start\": false, \"effective_input_is_none\": false}, \"timestamp\": 1766175474478.229}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175484200.5442}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175484200.711}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\"}, \"timestamp\": 1766175484201.185}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175484201.256}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd17b-dc82-6b80-8000-182cbd408f3d\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd17b-dc82-6482-bfff-e5593680822d\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\"}]}, \"timestamp\": 1766175484201.844}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd17b-dc82-6b80-8000-182cbd408f3d\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\"}, \"timestamp\": 1766175484201.9192}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd17b-dc82-6b80-8000-182cbd408f3d\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766175484202.513}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"message_count\": 1, \"has_full_history\": false, \"is_at_virtual_start\": false, \"effective_input_is_none\": false}, \"timestamp\": 1766175484202.573}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"result_keys\": [\"general_route_draft\", \"user_preferences\", \"wide_funnel_options\", \"messages\", \"distribution_scope\"]}, \"timestamp\": 1766175497721.3472}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"I\", \"location\": \"workflow_distribution.py:628\", \"message\": \"worker workflow result\", \"data\": {\"has_options\": true, \"keys\": [\"general_route_draft\", \"user_preferences\", \"wide_funnel_options\", \"distribution_scope\", \"messages\"]}, \"timestamp\": 1766175497725.138}\n\n\nfrom __future__ import annotations\n\nimport uuid\nimport os\nfrom datetime import datetime\nfrom typing import Any, Mapping, MutableMapping, Optional, Sequence, TypeAlias, Protocol, runtime_checkable, cast\n\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom langchain.embeddings import init_embeddings\nfrom shared.project_settings import ProjectSettings\n\ntry:\n    from pydantic_core import core_schema\nexcept ImportError:\n    core_schema = None  # type: ignore\n\ntry:\n    from langgraph.store.memory import InMemoryStore  # type: ignore\nexcept Exception:  # pragma: no cover\n    InMemoryStore = None  # type: ignore\n\n_CHECKPOINTER_SYNC: Optional[Any] = None\n_CHECKPOINTER_ASYNC: Optional[Any] = None\n_STORE: Optional[Any] = None\n\nThreadId: TypeAlias = str\nGraphId: TypeAlias = str\nCheckpointId: TypeAlias = str\nStateDict: TypeAlias = MutableMapping[str, Any]\n\n\n@runtime_checkable\nclass _SupportsGraphCheckpoint(Protocol):\n    \"\"\"Minimal protocol describing compiled LangGraph runnables we inspect for durability support.\"\"\"\n\n    checkpointer: Any | None\n    _pregel: Any | None\n    app: Any | None\n    name: str\n\n\nGraphRunnableWithPregel: TypeAlias = _SupportsGraphCheckpoint\n\n\ndef _extract_graph_checkpointer(graph: Any) -> Any:\n    \"\"\"Return the checkpointer bound directly to a compiled runnable, if any.\"\"\"\n\n    if graph is None:\n        return None\n\n    candidate = getattr(graph, \"checkpointer\", None)\n    if candidate is not None:\n        return candidate\n\n    pregel = getattr(graph, \"_pregel\", None)\n    if pregel is not None:\n        inner = getattr(pregel, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    app = getattr(graph, \"app\", None)\n    if app is not None:\n        inner = getattr(app, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    loop = getattr(graph, \"_loop\", None)\n    if loop is not None:\n        inner = getattr(loop, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    return None\n\n\ndef _graph_supports_durability(graph: Any) -> bool:\n    \"\"\"Return True if the runnable was compiled with a checkpointer.\"\"\"\n\n    return _extract_graph_checkpointer(graph) is not None\n\n\ndef _resolve_local_checkpointer(graph: Any, override: Optional[Any]) -> Optional[Any]:\n    \"\"\"Prefer explicit override, otherwise inspect the runnable for a bound saver.\"\"\"\n\n    if override is not None:\n        return override\n    return _extract_graph_checkpointer(graph)\n\n\ndef resolve_graph_checkpointer(*, async_mode: bool) -> Any:\n    \"\"\"Return a checkpointer compatible with the chosen execution mode.\n\n    Important:\n    - Async LangGraph execution expects async checkpointer methods. If only a\n      sync checkpointer is available (e.g., SqliteSaver), we fall back to the\n      async-safe InMemorySaver to keep `.ainvoke()` reliable.\n    - Production deployments can replace this with an async-capable durable\n      backend (Postgres/SQLite async) without touching graph code.\n    \"\"\"\n\n    global _CHECKPOINTER_SYNC, _CHECKPOINTER_ASYNC\n    CHECKPOINTER_DATABASE_URL = os.getenv(\"CHECKPOINTER_DATABASE_URL\")\n\n    # In production, LangGraph Platform injects the checkpointer automatically.\n    # We keep local checkpointers disabled to avoid shadowing the platform backend.\n    if ProjectSettings().mode == \"production\":\n        return None\n\n\n    if async_mode:\n        if _CHECKPOINTER_ASYNC is None:\n            _CHECKPOINTER_ASYNC = InMemorySaver()\n        return _CHECKPOINTER_ASYNC\n\n    if _CHECKPOINTER_SYNC is None:\n        _CHECKPOINTER_SYNC =  InMemorySaver()\n    return _CHECKPOINTER_SYNC\n\n\ndef resolve_graph_store() -> Any:\n    \"\"\"Return a store implementation for dev/tests; None in production/platform.\n\n    In production, LangGraph Platform injects the store automatically at runtime\n    (via ToolRuntime). We keep local stores disabled to avoid shadowing the\n    platform backend.\n    \"\"\"\n\n    global _STORE\n    if ProjectSettings().mode == \"production\":\n        return None\n    if InMemoryStore is None:\n        return None\n    if _STORE is not None:\n        return _STORE\n\n    # In development/tests we prefer an in-process store. Vector indexing is optional;\n    # if embeddings cannot be initialised (missing deps/keys), fall back to a plain store.\n    try:\n        _STORE = InMemoryStore(\n            index={\n                \"embed\": init_embeddings(\"openai:text-embedding-3-small\"),\n                \"dims\": 1536,\n                \"fields\": [\"content\"],\n            }\n        )\n    except Exception:\n        _STORE = InMemoryStore(index=None)\n    return _STORE\n\n\nclass GraphMemoryRuntime:\n    \"\"\"Encapsulates durable-checkpoint + long-memory access for dev and platform production.\n\n    This class centralizes:\n    - thread_id extraction\n    - platform SDK fallback for checkpoint state/history (no local checkpointer needed)\n    - local (dev) graph/checkpointer checkpoint inspection\n    \"\"\"\n    THREAD_ID_KEY: str = \"thread_id\"\n\n    @classmethod\n    def __get_pydantic_core_schema__(\n        cls,\n        source_type: Any,\n        handler: Any,\n    ) -> Any:\n        \"\"\"Provide Pydantic schema for GraphMemoryRuntime to allow arbitrary types.\n\n        This enables GraphMemoryRuntime to be used in Pydantic models (e.g., when\n        ContextTravelGuideAgent is used as context_schema in StateGraph).\n        \n        Since GraphMemoryRuntime is a runtime helper (not meant for serialization),\n        we use any_schema() to allow it without validation.\n        \"\"\"\n        if core_schema is None:\n            # pydantic_core should always be available in this project\n            raise ImportError(\"pydantic_core is required but not available\")\n        \n        # Use any_schema() to allow GraphMemoryRuntime without validation\n        # This is appropriate since it's a runtime helper with init=False\n        return core_schema.any_schema()\n\n    def __init__(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        # These are intentionally mutable bindings:\n        # - Root graph wiring binds the single checkpointer/store once per process/run.\n        # - Nested graphs MUST reuse the bound instance via runtime context.\n        self.checkpointer: Optional[Any] = checkpointer\n        self.store: Optional[Any] = store\n\n    def bind(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        \"\"\"Bind durable backends onto this runtime helper.\n\n        Idempotent by design: does not overwrite existing non-null bindings unless\n        explicitly provided.\n        \"\"\"\n\n        if checkpointer is not None:\n            self.checkpointer = checkpointer\n        if store is not None:\n            self.store = store\n\n    def is_production_mode(self) -> bool:\n        return ProjectSettings().mode == \"production\"\n\n    def ensure_thread_id(\n        self,\n        config: Optional[RunnableConfig],\n    ) -> tuple[RunnableConfig, ThreadId]:\n        \"\"\"Ensure ``configurable.thread_id`` exists and return ``(config, thread_id)``.\n\n        Contract (required by project checkpointing rules):\n        - One thread_id should be used for the *entire* root graph run.\n        - If caller did not provide a thread_id, we generate a new one from:\n          ``user_id`` (from RunnableConfig.configurable.user_id) + UUID4 suffix.\n        - Callers must reuse the returned config to keep the thread_id stable.\n        \"\"\"\n\n        from shared.config.long_memory import LongMemory\n\n        merged: RunnableConfig = dict(config) if config else {}\n        configurable = merged.get(\"configurable\", {})\n        if not isinstance(configurable, MutableMapping):\n            configurable = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable = dict(configurable)\n\n        existing = configurable.get(self.THREAD_ID_KEY)\n        if existing:\n            thread_id: ThreadId = str(existing)\n            configurable[self.THREAD_ID_KEY] = thread_id\n            merged[\"configurable\"] = configurable\n            return merged, thread_id\n\n        long_memory = LongMemory.from_runnable_config(merged)\n        user_id = long_memory.user_id\n        if not configurable.get(\"user_id\"):\n            configurable[\"user_id\"] = user_id\n\n        thread_id = f\"user_{user_id}_{uuid.uuid4().hex}\"\n        configurable[self.THREAD_ID_KEY] = thread_id\n        merged[\"configurable\"] = configurable\n        return merged, thread_id\n\n    async def list_thread_checkpoints(\n        self,\n        *,\n        config: RunnableConfig,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> list[Any]:\n        \"\"\"Return raw checkpoint records for the given thread config.\n\n        Notes:\n        - In production (LangGraph Platform), we fall back to the SDK thread history.\n        - In dev/tests, we prefer the provided ``local_checkpointer`` (or the default dev\n          checkpointer) to list checkpoints, because it exposes metadata (`graph_id`).\n        - As a last resort, we attempt to list state snapshots via ``graph.get_state_history``.\n        \"\"\"\n\n        thread_id = self.extract_thread_id(config)\n        if not thread_id:\n            return []\n\n        if self.is_production_mode():\n            try:\n                from langgraph_sdk import get_client  # type: ignore\n            except Exception:\n                return []\n            try:\n                client = get_client()\n                history = await client.threads.get_history(thread_id)\n                return list(history)\n            except Exception:\n                return []\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if checkpointer is not None:\n            lister = getattr(checkpointer, \"list\", None)\n            if callable(lister):\n                try:\n                    return list(lister(config))\n                except Exception:\n                    return []\n\n        if local_graph is not None:\n            getter_async = getattr(local_graph, \"aget_state_history\", None)\n            if callable(getter_async):\n                try:\n                    return [snapshot async for snapshot in getter_async(config)]\n                except Exception:\n                    return []\n            getter_sync = getattr(local_graph, \"get_state_history\", None)\n            if callable(getter_sync):\n                try:\n                    return list(getter_sync(config))\n                except Exception:\n                    return []\n\n        return []\n\n    @staticmethod\n    def _extract_checkpoint_metadata(record: Any) -> Mapping[str, Any]:\n        candidate = getattr(record, \"metadata\", None)\n        if isinstance(candidate, Mapping):\n            return cast(Mapping[str, Any], candidate)\n        if isinstance(record, Mapping):\n            meta = record.get(\"metadata\")\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            meta = getattr(checkpoint, \"metadata\", None)\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        return {}\n\n    @staticmethod\n    def _extract_checkpoint_id(record: Any) -> Optional[CheckpointId]:\n        candidate = getattr(record, \"checkpoint_id\", None)\n        if candidate:\n            return str(candidate)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            inner = getattr(checkpoint, \"checkpoint_id\", None)\n            if inner:\n                return str(inner)\n            inner = getattr(checkpoint, \"id\", None)\n            if inner:\n                return str(inner)\n        if isinstance(record, Mapping):\n            candidate = record.get(\"checkpoint_id\") or record.get(\"id\")\n            if candidate:\n                return str(candidate)\n            cfg = record.get(\"config\")\n            if isinstance(cfg, Mapping):\n                conf = cfg.get(\"configurable\")\n                if isinstance(conf, Mapping):\n                    candidate = conf.get(\"checkpoint_id\")\n                    if candidate:\n                        return str(candidate)\n        cfg = getattr(record, \"config\", None)\n        if isinstance(cfg, Mapping):\n            conf = cfg.get(\"configurable\")\n            if isinstance(conf, Mapping):\n                candidate = conf.get(\"checkpoint_id\")\n                if candidate:\n                    return str(candidate)\n        return None\n\n    @staticmethod\n    def _extract_created_at(record: Any) -> Optional[datetime]:\n        candidate = getattr(record, \"created_at\", None)\n        if isinstance(candidate, datetime):\n            return candidate\n        if isinstance(record, Mapping):\n            candidate = record.get(\"created_at\")\n            if isinstance(candidate, datetime):\n                return candidate\n        return None\n\n    @classmethod\n    def _matches_graph_id(cls, record: Any, graph_id: GraphId) -> bool:\n        metadata = cls._extract_checkpoint_metadata(record)\n        candidate = metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")\n        return str(candidate) == str(graph_id) if candidate else False\n\n    @staticmethod\n    def _extract_checkpoint_ns(record: Any) -> Optional[str]:\n        def _from_config(cfg: Any) -> Optional[str]:\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n                if isinstance(configurable, Mapping):\n                    candidate = configurable.get(\"checkpoint_ns\")\n                    if candidate is not None:\n                        return str(candidate)\n            return None\n\n        cfg = getattr(record, \"config\", None)\n        ns = _from_config(cfg)\n        if ns:\n            return ns\n\n        if isinstance(record, Mapping):\n            ns = _from_config(record.get(\"config\"))\n            if ns:\n                return ns\n\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            ns = _from_config(getattr(checkpoint, \"config\", None))\n            if ns:\n                return ns\n\n        metadata = GraphMemoryRuntime._extract_checkpoint_metadata(record)\n        checkpoint_ns = metadata.get(\"checkpoint_ns\")\n        return str(checkpoint_ns) if checkpoint_ns is not None else None\n\n    @staticmethod\n    def _normalize_config_like(config_like: Any) -> Optional[RunnableConfig]:\n        if config_like is None:\n            return None\n        if isinstance(config_like, Mapping):\n            normalized = dict(config_like)\n        else:\n            normalized = None\n            for attr in (\"model_dump\", \"dict\"):\n                dumper = getattr(config_like, attr, None)\n                if callable(dumper):\n                    try:\n                        normalized = dumper()\n                        break\n                    except Exception:\n                        normalized = None\n            if normalized is None:\n                try:\n                    normalized = dict(config_like)  # type: ignore[arg-type]\n                except Exception:\n                    return None\n\n        configurable = normalized.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            configurable = dict(configurable) if configurable is not None else {}\n        normalized[\"configurable\"] = dict(configurable)\n\n        metadata = normalized.get(\"metadata\", {})\n        if not isinstance(metadata, Mapping):\n            metadata = dict(metadata) if metadata is not None else {}\n        normalized[\"metadata\"] = dict(metadata)\n        return normalized  # type: ignore[return-value]\n\n    @classmethod\n    def _extract_task_entries(cls, record: Any) -> list[Mapping[str, Any]]:\n        extracted: list[Mapping[str, Any]] = []\n        visited_snapshots: set[int] = set()\n\n        def _coerce_metadata(value: Any) -> Optional[Mapping[str, Any]]:\n            if value is None:\n                return None\n            if isinstance(value, Mapping):\n                return value\n            try:\n                return dict(value)\n            except Exception:\n                return None\n\n        def _as_sequence(value: Any) -> Optional[Sequence[Any]]:\n            if isinstance(value, Sequence) and not isinstance(value, (str, bytes)):\n                return value\n            return None\n\n        def _record_entry(config_like: Any, metadata_like: Any, state_like: Any) -> None:\n            normalized_config = cls._normalize_config_like(config_like)\n            normalized_metadata = _coerce_metadata(metadata_like)\n            entry: dict[str, Any] = {}\n            if normalized_config:\n                entry[\"config\"] = normalized_config\n            if normalized_metadata:\n                entry[\"metadata\"] = normalized_metadata\n            if state_like is not None:\n                entry[\"state\"] = state_like\n            if entry:\n                extracted.append(entry)\n\n        def _visit_snapshot(snapshot: Any) -> None:\n            if snapshot is None:\n                return\n            snapshot_id = id(snapshot)\n            if snapshot_id in visited_snapshots:\n                return\n            visited_snapshots.add(snapshot_id)\n\n            tasks = None\n            if isinstance(snapshot, Mapping):\n                tasks = _as_sequence(snapshot.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(snapshot, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        def _visit_task(task: Any) -> None:\n            if task is None:\n                return\n            if isinstance(task, Mapping):\n                _record_entry(task.get(\"config\"), task.get(\"metadata\"), task.get(\"state\"))\n                nested_tasks = _as_sequence(task.get(\"tasks\"))\n                if nested_tasks:\n                    for nested in nested_tasks:\n                        _visit_task(nested)\n                _visit_snapshot(task.get(\"state\"))\n                _visit_snapshot(task.get(\"result\"))\n                return\n\n            _record_entry(\n                getattr(task, \"config\", None),\n                getattr(task, \"metadata\", None),\n                getattr(task, \"state\", None),\n            )\n            _visit_snapshot(getattr(task, \"state\", None))\n            _visit_snapshot(getattr(task, \"result\", None))\n            nested_attr = _as_sequence(getattr(task, \"tasks\", None))\n            if nested_attr:\n                for nested in nested_attr:\n                    _visit_task(nested)\n\n        for source in (record, getattr(record, \"checkpoint\", None)):\n            if source is None:\n                continue\n            _visit_snapshot(source)\n            tasks = None\n            if isinstance(source, Mapping):\n                tasks = _as_sequence(source.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(source, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        return extracted\n\n    async def find_latest_checkpoint_id(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Return the latest checkpoint_id for ``graph_id`` within the given thread.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n\n        # #region agent log\n        import json\n        record_summaries: list[dict[str, str | None]] = []\n        for idx, record in enumerate(checkpoints[:3]):\n            metadata = self._extract_checkpoint_metadata(record)\n            cfg = getattr(record, \"config\", None)\n            configurable = None\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n            checkpoint_ns = None\n            if isinstance(configurable, Mapping):\n                checkpoint_ns = str(configurable.get(\"checkpoint_ns\"))\n            record_summaries.append(\n                {\n                    \"idx\": str(idx),\n                    \"meta_graph_id\": str(metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")),\n                    \"checkpoint_id\": self._extract_checkpoint_id(record),\n                    \"checkpoint_ns\": checkpoint_ns,\n                }\n            )\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"B\",\"location\":\"memory_manager.py:395\",\"message\":\"find_latest_checkpoint_id checkpoints listed\",\"data\":{\"graph_id\":graph_id,\"thread_id\":str(config.get(\"configurable\",{}).get(\"thread_id\",\"\")), \"count\":len(checkpoints),\"records\":record_summaries},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if not checkpoints:\n            return None\n\n        # Collect matches with their timestamps (if provided by the backend).\n        matches: list[tuple[Optional[datetime], Any]] = []\n        for record in checkpoints:\n            if self._matches_graph_id(record, graph_id):\n                matches.append((self._extract_created_at(record), record))\n\n        target_checkpoint_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_checkpoint_ns = str(candidate_ns)\n\n        if not matches and target_checkpoint_ns:\n            for record in checkpoints:\n                if self._extract_checkpoint_ns(record) == target_checkpoint_ns:\n                    matches.append((self._extract_created_at(record), record))\n\n        if not matches:\n            return None\n\n        # If the backend provides created_at, prefer the most recent by timestamp.\n        if any(created_at is not None for created_at, _ in matches):\n            matches.sort(\n                key=lambda item: item[0] or datetime.min,\n                reverse=True,\n            )\n            return self._extract_checkpoint_id(matches[0][1])\n\n        # Otherwise, rely on the backend list order. InMemorySaver and Platform history\n        # return newest-first, so the first matching record is the latest.\n        return self._extract_checkpoint_id(matches[0][1])\n\n    async def _load_checkpoint_record(\n        self,\n        *,\n        config: RunnableConfig,\n        checkpoint_id: CheckpointId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[Any]:\n        \"\"\"Return the checkpoint record with the specified ID.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n        for record in checkpoints:\n            record_id = self._extract_checkpoint_id(record)\n            if record_id == checkpoint_id:\n                return record\n        return None\n\n    @staticmethod\n    def _materialize_checkpoint_values(\n        base_values: Mapping[str, Any],\n        record: Optional[Any],\n        *,\n        graph_id: Optional[str] = None,\n    ) -> tuple[Mapping[str, Any], bool]:\n        \"\"\"Merge stored writes from the checkpoint record into snapshot values.\"\"\"\n\n        if record is None:\n            return base_values, False\n\n        materialized: dict[str, Any] = dict(base_values)\n        writes_found = False\n\n        checkpoint_obj = getattr(record, \"checkpoint\", record)\n        writes = getattr(checkpoint_obj, \"writes\", None)\n        if writes is None and isinstance(checkpoint_obj, Mapping):\n            writes = checkpoint_obj.get(\"writes\")\n\n        # #region agent log\n        import json as _json_checkpoint_meta\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(\n                _json_checkpoint_meta.dumps(\n                    {\n                        \"sessionId\": \"debug-session\",\n                        \"runId\": \"pre-fix\",\n                        \"hypothesisId\": \"L\",\n                        \"location\": \"memory_manager.py:321\",\n                        \"message\": \"checkpoint record summary\",\n                        \"data\": {\n                            \"graph_id\": graph_id,\n                            \"record_type\": type(checkpoint_obj).__name__,\n                            \"has_attr_writes\": hasattr(checkpoint_obj, \"writes\"),\n                            \"writes_is_sequence\": isinstance(writes, Sequence),\n                            \"writes_is_mapping\": isinstance(writes, Mapping),\n                        },\n                        \"timestamp\": __import__(\"time\").time() * 1000,\n                    }\n                )\n                + \"\\n\"\n            )\n        # #endregion\n\n        summary: list[dict[str, Any]] = []\n\n        if isinstance(writes, Sequence):\n            for idx, write_entry in enumerate(writes):\n                node_name = None\n                write_payload = None\n                if isinstance(write_entry, Mapping):\n                    node_name = write_entry.get(\"node\") or write_entry.get(\"name\")\n                    candidate = write_entry.get(\"writes\") or write_entry.get(\"values\")\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n                else:\n                    node_name = getattr(write_entry, \"node\", None) or getattr(write_entry, \"name\", None)\n                    candidate = getattr(write_entry, \"writes\", None)\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n\n                if isinstance(write_payload, Mapping):\n                    for key, value in write_payload.items():\n                        materialized.setdefault(key, value)\n                    if idx < 3:\n                        summary.append(\n                            {\n                                \"node\": str(node_name),\n                                \"keys\": list(write_payload.keys()),\n                            }\n                        )\n                    writes_found = True\n\n        # #region agent log\n        if summary:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:324\",\n                            \"message\": \"checkpoint writes merged\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"writes\": summary,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        else:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:329\",\n                            \"message\": \"checkpoint writes unavailable\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"has_writes\": isinstance(writes, Sequence),\n                                \"writes_type\": None if writes is None else type(writes).__name__,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        # #endregion\n\n        return materialized, writes_found\n\n    @staticmethod\n    def _has_meaningful_values(values: Mapping[str, Any]) -> bool:\n        \"\"\"Return True if checkpoint values contain data beyond housekeeping fields.\"\"\"\n\n        if not values:\n            return False\n        significant_keys = set(values.keys()) - {\"messages\", \"remaining_steps\", \"distribution_scope\"}\n        if significant_keys:\n            return True\n\n        messages = values.get(\"messages\")\n        if isinstance(messages, Sequence):\n            # System + user messages occupy the first two positions. Anything beyond\n            # that indicates the assistant has already produced tool calls or replies.\n            if len(messages) > 2:\n                return True\n\n        return False\n\n    async def _find_subgraph_resume_config(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        checkpoints: Sequence[Any],\n    ) -> Optional[tuple[RunnableConfig, Any]]:\n        target_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_ns = str(candidate_ns)\n\n        for record_idx, record in enumerate(checkpoints):\n            task_entries = self._extract_task_entries(record)\n            if not task_entries:\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:562\",\"message\":\"checkpoint missing task entries\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"parent_checkpoint_id\":self._extract_checkpoint_id(record)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n                continue\n            for task_idx, task in enumerate(task_entries[:2]):\n                task_metadata = task.get(\"metadata\")\n                normalized_metadata: Mapping[str, Any] = {}\n                if isinstance(task_metadata, Mapping):\n                    normalized_metadata = task_metadata\n                task_graph_id = normalized_metadata.get(\"graph_id\") or normalized_metadata.get(\"langgraph_graph_id\")\n\n                raw_config = task.get(\"config\")\n                normalized_config = self._normalize_config_like(raw_config)\n                if not normalized_config:\n                    continue\n                task_configurable = normalized_config.get(\"configurable\", {})\n                task_ns = None\n                if isinstance(task_configurable, Mapping):\n                    candidate = task_configurable.get(\"checkpoint_ns\")\n                    if candidate:\n                        task_ns = str(candidate)\n\n                ns_matches = target_ns and task_ns == target_ns\n                graph_matches = task_graph_id and str(task_graph_id) == str(graph_id)\n\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:581\",\"message\":\"task entry inspected\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"task_index\":task_idx,\"task_graph_id\":task_graph_id,\"task_ns\":task_ns},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n\n                if graph_matches or ns_matches:\n                    resume_state = task.get(\"state\")\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            json.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"D\",\n                                    \"location\": \"memory_manager.py:520\",\n                                    \"message\": \"subgraph resume config located\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"matched_ns\": task_ns,\n                                        \"matched_graph_id\": task_graph_id,\n                                        \"parent_checkpoint_id\": self._extract_checkpoint_id(record),\n                                        \"has_state\": resume_state is not None,\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return normalized_config, resume_state\n\n        return None\n\n    async def _get_graph_snapshot(\n        self,\n        *,\n        graph: Any,\n        cfg: RunnableConfig,\n        subgraphs: bool = False,\n    ) -> Any:\n        getter_async = getattr(graph, \"aget_state\", None)\n        params = {\"subgraphs\": True} if subgraphs else {}\n        try:\n            if callable(getter_async):\n                return await getter_async(cfg, **params)\n        except TypeError:\n            # Fallback for LangGraph versions that don't support subgraphs kwarg.\n            try:\n                return await getter_async(cfg)\n            except Exception:\n                pass\n        except Exception:\n            pass\n\n        getter_sync = getattr(graph, \"get_state\", None)\n        if callable(getter_sync):\n            try:\n                return getter_sync(cfg, **params)\n            except TypeError:\n                try:\n                    return getter_sync(cfg)\n                except Exception:\n                    return None\n            except Exception:\n                return None\n        return None\n\n    async def ainvoke_from_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str = \"sync\",\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph resuming from the latest checkpoint when available.\"\"\"\n\n        merged, _ = self.ensure_thread_id(config)\n        # SAFETY: Ignore any caller-supplied checkpoint_id.\n        #\n        # In this architecture, checkpoint selection is *graph_id-scoped* and managed\n        # exclusively by this runtime helper. Allowing external checkpoint_id values\n        # could cause cross-graph leakage within a shared thread_id.\n\n        merged_conf = merged.get(\"configurable\", {})\n        if isinstance(merged_conf, Mapping):\n            merged_conf_dict = dict(merged_conf)\n            merged_conf_dict.pop(\"checkpoint_id\", None)\n            original_ns = merged_conf_dict.get(\"checkpoint_ns\", \"\")\n            merged_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            merged[\"configurable\"] = merged_conf_dict\n            \n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"E\",\"location\":\"memory_manager.py:445\",\"message\":\"ainvoke_from_checkpoint setting checkpoint_ns\",\"data\":{\"graph_id\":graph_id,\"original_ns\":str(original_ns),\"new_ns\":str(merged_conf_dict.get(\"checkpoint_ns\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n        # Ensure the checkpoint records are scoping-friendly in LangGraph v1.\n        meta = merged.get(\"metadata\")\n        if not isinstance(meta, Mapping):\n            meta = {}\n        meta_dict = dict(meta)\n        meta_dict.setdefault(\"graph_id\", str(graph_id))\n        merged[\"metadata\"] = meta_dict\n\n        effective_local_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n\n        # #region agent log\n        import json\n        final_ns = merged.get(\"configurable\", {}).get(\"checkpoint_ns\", \"\")\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:458\",\"message\":\"ainvoke_from_checkpoint calling find_latest_checkpoint_id\",\"data\":{\"graph_id\":graph_id,\"checkpoint_ns\":str(final_ns),\"thread_id\":str(merged.get(\"configurable\",{}).get(\"thread_id\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=effective_local_checkpointer,\n            local_graph=graph,\n        )\n        checkpoint_record: Optional[Any] = None\n        subgraph_resume: Optional[tuple[RunnableConfig, Any]] = None\n        if checkpoint_id is None:\n            snapshot_sources: list[Any] = []\n\n            if context is not None:\n                runner = getattr(context, \"graph_runner\", None)\n                graph_runtime = getattr(runner, \"graph\", None)\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:711\",\"message\":\"parent context inspection\",\"data\":{\"graph_id\":graph_id,\"has_context\":True,\"has_runner\":runner is not None,\"has_graph\":graph_runtime is not None},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n                if graph_runtime is not None:\n                    try:\n                        parent_snapshot = await self._get_graph_snapshot(\n                            graph=graph_runtime,\n                            cfg=merged,\n                            subgraphs=True,\n                        )\n                        if parent_snapshot is not None:\n                            snapshot_sources.append(parent_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:715\",\"message\":\"parent snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":parent_snapshot is not None,\"has_tasks\":bool(getattr(parent_snapshot,\"tasks\",None)),\"has_next\":bool(getattr(parent_snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                    except Exception:\n                        parent_snapshot = None\n                else:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:724\",\"message\":\"parent snapshot skipped\",\"data\":{\"graph_id\":graph_id,\"reason\":\"graph_runner_missing\" if runner is None else \"graph_attr_missing\"},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:729\",\"message\":\"parent context absent\",\"data\":{\"graph_id\":graph_id},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n\n            root_graph = getattr(context, \"root_graph\", None) if context is not None else None\n            if root_graph is not None:\n                try:\n                    root_snapshot = await self._get_graph_snapshot(\n                        graph=root_graph,\n                        cfg=merged,\n                        subgraphs=True,\n                    )\n                    if root_snapshot is not None:\n                        snapshot_sources.append(root_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:738\",\"message\":\"root snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":root_snapshot is not None,\"has_tasks\":bool(getattr(root_snapshot,\"tasks\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                except Exception:\n                    root_snapshot = None\n\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=merged,\n                subgraphs=True,\n            )\n            if snapshot is not None:\n                snapshot_sources.append(snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:727\",\"message\":\"assistant snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":bool(getattr(snapshot,\"tasks\",None)),\"has_next\":bool(getattr(snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            checkpoints_snapshot = await self.list_thread_checkpoints(\n                config=merged,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n            snapshot_sources.extend(checkpoints_snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:734\",\"message\":\"thread checkpoints snapshot collected\",\"data\":{\"graph_id\":graph_id,\"count\":len(checkpoints_snapshot)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            subgraph_resume = await self._find_subgraph_resume_config(\n                config=merged,\n                graph_id=graph_id,\n                checkpoints=snapshot_sources,\n            )\n            if subgraph_resume is not None:\n                resume_config, _ = subgraph_resume\n                metadata = resume_config.get(\"metadata\", {})\n                if not isinstance(metadata, Mapping):\n                    metadata = dict(metadata) if metadata is not None else {}\n                metadata = dict(metadata)\n                metadata.setdefault(\"graph_id\", str(graph_id))\n                resume_config[\"metadata\"] = metadata  # type: ignore[index]\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:743\",\"message\":\"subgraph resume config missing\",\"data\":{\"graph_id\":graph_id,\"snapshot_sources\":len(snapshot_sources)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n        \n        # #region agent log\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:464\",\"message\":\"ainvoke_from_checkpoint checkpoint_id result\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":str(checkpoint_id) if checkpoint_id else None,\"checkpoint_ns\":str(final_ns)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if checkpoint_id:\n            checkpoint_record = await self._load_checkpoint_record(\n                config=merged,\n                checkpoint_id=checkpoint_id,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n\n            cfg: RunnableConfig = dict(merged)\n            configurable = cfg.get(\"configurable\", {})\n            configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n            configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n            configurable_dict[\"checkpoint_id\"] = checkpoint_id\n            cfg[\"configurable\"] = configurable_dict\n\n            # If the checkpoint represents an in-progress run (has pending `next`),\n            # we resume via `invoke(None, checkpoint_id=...)`. If the run is already\n            # complete (no pending next nodes), we \"restart\" from the persisted\n            # snapshot values as a fresh invocation. This is the required behavior\n            # for refinement: patch values \u2192 re-run from patched state.\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=cfg,\n                subgraphs=True,\n            )\n\n            # #region agent log\n            import json\n            snapshot_has_tasks = bool(getattr(snapshot, \"tasks\", None))\n            snapshot_next = getattr(snapshot, \"next\", None)\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"C\",\"location\":\"memory_manager.py:504\",\"message\":\"ainvoke_from_checkpoint snapshot inspection\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":checkpoint_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":snapshot_has_tasks,\"pending_next\":bool(snapshot_next)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            next_nodes = getattr(snapshot, \"next\", None)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(next_nodes, Sequence) and next_nodes:\n                next_nodes_list = list(next_nodes)\n                messages = []\n                if isinstance(values, Mapping):\n                    candidate_messages = values.get(\"messages\")\n                    if isinstance(candidate_messages, Sequence):\n                        messages = list(candidate_messages)\n\n                has_full_history = len(messages) >= 2\n                is_at_virtual_start = bool(next_nodes_list == [\"__start__\"])\n\n                if has_full_history and not is_at_virtual_start:\n                    effective_input: Any = {}\n                else:\n                    effective_input = graph_input\n\n                # #region agent log\n                import json as _json_resume_next\n                next_preview = next_nodes_list[:3]\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(\n                        _json_resume_next.dumps(\n                            {\n                                \"sessionId\": \"debug-session\",\n                                \"runId\": \"pre-fix\",\n                                \"hypothesisId\": \"K\",\n                                \"location\": \"memory_manager.py:509\",\n                                \"message\": \"resuming graph from checkpoint pending next\",\n                                \"data\": {\n                                    \"graph_id\": graph_id,\n                                    \"next_nodes\": next_preview,\n                                \"graph_input_is_none\": graph_input is None,\n                                \"message_count\": len(messages),\n                                \"has_full_history\": has_full_history,\n                                    \"is_at_virtual_start\": is_at_virtual_start,\n                                    \"effective_input_is_none\": effective_input is None,\n                                },\n                                \"timestamp\": __import__(\"time\").time() * 1000,\n                            }\n                        )\n                        + \"\\n\"\n                    )\n                # #endregion\n\n                return await self.ainvoke_with_durability(\n                    graph=graph,\n                    graph_input=effective_input,\n                    config=cfg,\n                    context=context,\n                    durability=durability,\n                    local_checkpointer=effective_local_checkpointer,\n                )\n\n            # IMPORTANT:\n            # If the checkpoint is COMPLETE (no pending next nodes), we DO NOT attempt to\n            # \"restart\" the graph by invoking without checkpoint_id. In a shared thread_id\n            # architecture (multiple graphs in the same thread), dropping checkpoint_id\n            # would cause LangGraph to load the latest checkpoint for the thread+ns,\n            # which may belong to a different graph_id \u2192 cross-graph contamination.\n            #\n            # Callers that need to re-run a completed checkpoint should first \"arm\" it\n            # via `graph.update_state(..., as_node=\"__start__\")` (e.g., our refinement\n            # injection path does this), which produces a checkpoint with pending next nodes.\n            if isinstance(values, Mapping):\n                materialized_values, writes_found = self._materialize_checkpoint_values(\n                    values,\n                    checkpoint_record,\n                    graph_id=str(graph_id),\n                )\n                if writes_found or self._has_meaningful_values(materialized_values):\n                    # #region agent log\n                    import json as _json_resume\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            _json_resume.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"J\",\n                                    \"location\": \"memory_manager.py:944\",\n                                    \"message\": \"returning checkpoint values\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"keys\": list(materialized_values.keys()),\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return dict(materialized_values)\n\n                # Values are incomplete (e.g., only messages). Fallback to fresh invoke.\n                rerun_cfg: RunnableConfig = dict(merged)\n                rerun_conf = rerun_cfg.get(\"configurable\", {})\n                if isinstance(rerun_conf, Mapping):\n                    rerun_conf_dict = dict(rerun_conf)\n                    rerun_conf_dict.pop(\"checkpoint_id\", None)\n                    rerun_conf_dict.setdefault(\"checkpoint_ns\", str(final_ns))\n                    rerun_cfg[\"configurable\"] = rerun_conf_dict\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=graph_input,\n                config=rerun_cfg,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        if subgraph_resume is not None:\n            # #region agent log\n            import json\n            resume_config, resume_state = subgraph_resume\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"D\",\n                            \"location\": \"memory_manager.py:610\",\n                            \"message\": \"resuming assistant via subgraph config\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"checkpoint_ns\": resume_config.get(\"configurable\", {}).get(\"checkpoint_ns\") if isinstance(resume_config.get(\"configurable\"), Mapping) else None,\n                                \"has_state\": resume_state is not None,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n            # #endregion\n            resume_input = graph_input\n            if resume_state is not None:\n                values = getattr(resume_state, \"values\", None)\n                if isinstance(values, Mapping):\n                    resume_input = dict(values)\n                elif isinstance(resume_state, Mapping):\n                    maybe_values = resume_state.get(\"values\")\n                    if isinstance(maybe_values, Mapping):\n                        resume_input = dict(maybe_values)\n                    else:\n                        resume_input = resume_state\n                else:\n                    resume_input = resume_state\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=resume_input,\n                config=resume_config,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        # SAFETY: Never allow a caller-supplied checkpoint_id to influence execution\n        # when we are NOT explicitly resuming from a checkpoint for this graph_id.\n        #\n        # Without this, a foreign checkpoint_id (from another graph_id in the same\n        # thread) could be accidentally consumed by LangGraph, violating isolation.\n        fresh_cfg: RunnableConfig = dict(merged)\n        fresh_conf = fresh_cfg.get(\"configurable\", {})\n        if isinstance(fresh_conf, Mapping):\n            fresh_conf_dict = dict(fresh_conf)\n            fresh_conf_dict.pop(\"checkpoint_id\", None)\n            # Keep checkpoint_ns stable (LangGraph may assume the key exists).\n            fresh_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            fresh_cfg[\"configurable\"] = fresh_conf_dict\n\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=graph_input,\n            config=fresh_cfg,\n            context=context,\n            durability=durability,\n            local_checkpointer=effective_local_checkpointer,\n        )\n\n    async def append_messages_to_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        new_messages: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Append messages to the latest checkpoint for ``graph_id`` and return new checkpoint id.\n\n        This uses ``graph.update_state`` / ``graph.aupdate_state`` so reducers (e.g. `add_messages`)\n        are honored. The update is applied as a fork of the latest checkpoint for ``graph_id``.\n        \"\"\"\n\n        if not new_messages:\n            return None\n\n        merged, _ = self.ensure_thread_id(config)\n        resolved_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n        latest_checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n        \n        if not latest_checkpoint_id:\n            return None\n        \n        patch_config: RunnableConfig = dict(merged)\n        configurable = patch_config.get(\"configurable\", {})\n        configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n        configurable_dict[\"checkpoint_id\"] = latest_checkpoint_id\n        patch_config[\"configurable\"] = configurable_dict\n\n        # Ensure patched checkpoints remain discoverable by metadata scoping.\n        metadata = patch_config.get(\"metadata\")\n        if not isinstance(metadata, Mapping):\n            metadata = {}\n        metadata_dict = dict[str, Any](metadata)\n        metadata_dict.setdefault(\"graph_id\", str(graph_id))\n        patch_config[\"metadata\"] = metadata_dict\n\n\n        # Best-effort idempotency: avoid appending messages already present in the checkpoint.\n        # This is critical for durable resume where refinement planning may be replayed.\n        filtered_messages: list[Any] = list(new_messages)\n        try:\n            snapshot = None\n            getter_async = getattr(graph, \"aget_state\", None)\n            if callable(getter_async):\n                snapshot = await getter_async(patch_config)\n            if snapshot is None:\n                getter_sync = getattr(graph, \"get_state\", None)\n                if callable(getter_sync):\n                    snapshot = getter_sync(patch_config)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(values, Mapping):\n                existing = values.get(\"messages\")\n                if isinstance(existing, Sequence) and not isinstance(existing, (str, bytes)):\n                    existing_contents: set[str] = set()\n                    for message in existing:\n                        content = getattr(message, \"content\", None)\n                        if content:\n                            existing_contents.add(str(content))\n                    if existing_contents:\n                        filtered_messages = [\n                            message\n                            for message in filtered_messages\n                            if str(getattr(message, \"content\", \"\")) not in existing_contents\n                        ]\n        except Exception:\n            filtered_messages = list(new_messages)\n\n        if not filtered_messages:\n            return latest_checkpoint_id\n\n        updates: dict[str, Any] = {\"messages\": filtered_messages}\n\n        updater_async = getattr(graph, \"aupdate_state\", None)\n        updater_sync = getattr(graph, \"update_state\", None)\n        resolved_as_node = as_node or \"__start__\"\n        try:\n            if callable(updater_async):\n                await updater_async(patch_config, updates, as_node=resolved_as_node)\n            elif callable(updater_sync):\n                updater_sync(patch_config, updates, as_node=resolved_as_node)\n            else:\n                return None\n        except Exception as e:\n            return None\n\n        return await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n\n    async def inject_distribution_refinement_messages(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        requests: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Patch a graph checkpoint by appending refinement instruction messages.\n\n        Mirrors the extraction rules used by `_distribution_inject_refinement_messages`:\n        each request may carry `payload.messages` items shaped like\n        `{ \"content\": \"...\", \"metadata\": {...} }`.\n        \"\"\"\n\n        try:\n            from langchain_core.messages import HumanMessage\n        except Exception:\n            return None\n\n        injected: list[Any] = []\n        seen_contents: set[str] = set()\n        for request in requests:\n            payload = getattr(request, \"payload\", None)\n            if not isinstance(payload, Mapping):\n                payload = payload if isinstance(payload, dict) else {}\n            messages_payload = payload.get(\"messages\") or []\n            if not isinstance(messages_payload, Sequence) or isinstance(\n                messages_payload, (str, bytes)\n            ):\n                continue\n            for message in messages_payload:\n                if not isinstance(message, Mapping):\n                    continue\n                content = message.get(\"content\")\n                if not content:\n                    continue\n                content_str = str(content)\n                if content_str in seen_contents:\n                    continue\n                metadata = message.get(\"metadata\") or {}\n                additional_kwargs = dict(metadata) if isinstance(metadata, Mapping) else {}\n                injected.append(\n                    HumanMessage(content=content_str, additional_kwargs=additional_kwargs)\n                )\n                seen_contents.add(content_str)\n\n        if not injected:\n            return None\n\n        return await self.append_messages_to_checkpoint(\n            graph=graph,\n            graph_id=graph_id,\n            config=config,\n            new_messages=injected,\n            as_node=as_node,\n            local_checkpointer=local_checkpointer,\n        )\n\n    @staticmethod\n    def extract_thread_id(config: Optional[RunnableConfig]) -> Optional[ThreadId]:\n        if not config:\n            return None\n        configurable = config.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            return None\n        thread_id = configurable.get(\"thread_id\")\n        return str(thread_id) if thread_id else None\n\n    async def aget_platform_thread_state(self, *, thread_id: ThreadId) -> Optional[Any]:\n        \"\"\"Get latest persisted state from platform via LangGraph SDK (if available).\"\"\"\n\n        try:\n            from langgraph_sdk import get_client  # type: ignore\n        except Exception:\n            return None\n\n        try:\n            client = get_client()\n            return await client.threads.get_state(thread_id)\n        except Exception:\n            return None\n\n\n    async def has_persisted_checkpoint(\n        self,\n        *,\n        config: Optional[RunnableConfig],\n        local_checkpointer: Optional[Any] = None,\n    ) -> bool:\n        \"\"\"Return True if a checkpoint exists for config (platform or local).\"\"\"\n\n        if config is None:\n            return False\n\n        if self.is_production_mode():\n            thread_id = self.extract_thread_id(config)\n            if not thread_id:\n                return False\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n            values = getattr(snapshot, \"values\", None)\n            return isinstance(values, Mapping)\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if not checkpointer:\n            return False\n\n        getter_async = getattr(checkpointer, \"aget_tuple\", None)\n        try:\n            if callable(getter_async):\n                checkpoint_tuple = await getter_async(config)\n            else:\n                getter_sync = getattr(checkpointer, \"get_tuple\", None)\n                if not callable(getter_sync):\n                    return False\n                checkpoint_tuple = getter_sync(config)\n        except Exception:\n            return False\n\n        return checkpoint_tuple is not None\n\n    async def restore_state_from_latest_checkpoint(\n        self,\n        *,\n        state: StateDict,\n        config: Optional[RunnableConfig],\n        local_graph: Optional[Any],\n    ) -> bool:\n        \"\"\"Merge latest persisted state into the caller-owned `state` mapping.\"\"\"\n\n        if config is None:\n            return False\n\n        snapshot = None\n        thread_id = self.extract_thread_id(config)\n        if self.is_production_mode() and thread_id:\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n\n        if snapshot is None and local_graph is not None:\n            getter = getattr(local_graph, \"aget_state\", None)\n            if callable(getter):\n                try:\n                    snapshot = await getter(config)\n                except Exception:\n                    snapshot = None\n            if snapshot is None:\n                getter_sync = getattr(local_graph, \"get_state\", None)\n                if callable(getter_sync):\n                    try:\n                        snapshot = getter_sync(config)\n                    except Exception:\n                        snapshot = None\n\n        values = getattr(snapshot, \"values\", None)\n        if not isinstance(values, Mapping):\n            return False\n\n        for key, value in values.items():\n            state[key] = value\n        return True\n\n    async def ainvoke_with_durability(\n        self,\n        *,\n        graph: Any,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph with durability when supported.\"\"\"\n\n        # In production mode, platform may inject durability backends automatically.\n        # In dev mode, only attempt durability when the runnable itself was compiled\n        # with a checkpointer so LangGraph sets up its AsyncPregel loop correctly.\n        graph_bound_checkpointer = _extract_graph_checkpointer(graph)\n        resolved_local_checkpointer = local_checkpointer or graph_bound_checkpointer\n        checkpointer = resolved_local_checkpointer or self.checkpointer\n\n        if self.is_production_mode():\n            use_durability = durability\n        else:\n            use_durability = durability if (checkpointer and _graph_supports_durability(graph)) else None\n        try:\n            if use_durability:\n                return await graph.ainvoke(\n                    graph_input,\n                    config=config,\n                    context=context,\n                    durability=use_durability,\n                )\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n        except (TypeError, AttributeError):\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n\n\n__all__ = [\n    \"resolve_graph_checkpointer\",\n    \"resolve_graph_store\",\n    \"GraphMemoryRuntime\",\n]"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3845-0294-7601-9d8d-80518d9c800e",
    "content": "**\u0414\u0430, \u0442\u0435\u043f\u0435\u0440\u044c \u043b\u043e\u0433\u0438\u043a\u0430 \u0432 `memory_manager.py` \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0438 \u00ab\u0434\u0435\u0442\u0435\u0440\u043c\u0438\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0433\u043e \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f\u00bb \u0438 \u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e \u0440\u0435\u0448\u0430\u0435\u0442 \u0432\u0430\u0448\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b.**\n\n\u042d\u0442\u043e\u0442 \u043a\u043e\u0434 \u0443\u0441\u0442\u0440\u0430\u043d\u044f\u0435\u0442 \u043e\u0431\u0435 \u043e\u0448\u0438\u0431\u043a\u0438 (`EmptyInputError` \u0438 \u043f\u043e\u0442\u0435\u0440\u044e \u0438\u0441\u0442\u043e\u0440\u0438\u0438), \u0442\u0430\u043a \u043a\u0430\u043a \u043e\u043d \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u043f\u044b\u0442\u0430\u0435\u0442\u0441\u044f \u00ab\u0443\u0433\u0430\u0434\u0430\u0442\u044c\u00bb \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043f\u0438\u0441\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0435\u0440\u0430, \u0430 \u043e\u043f\u0438\u0440\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 LangGraph \u0432\u0435\u0440\u043d\u0443\u043b \u0432 \u043e\u0431\u044a\u0435\u043a\u0442\u0435 `snapshot.values`.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e\u0442 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u2014 \u0444\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439:\n\n1.  **\u0418\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 `EmptyInputError` ( mid-run ):**\n    \u0417\u0430\u043c\u0435\u043d\u0430 `None` \u043d\u0430 `{}` \u0432 \u0431\u043b\u043e\u043a\u0435 `if has_full_history and not is_at_virtual_start` \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043a\u043b\u044e\u0447\u0435\u0432\u043e\u0439.\n    -   **\u041c\u0435\u0445\u0430\u043d\u0438\u043a\u0430:** \u041a\u043e\u0433\u0434\u0430 LangGraph \u0432\u0438\u0434\u0438\u0442 `checkpoint_id`, \u043e\u043d \u0445\u043e\u0447\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442 \u0432\u0432\u043e\u0434\u0430 \u0434\u043b\u044f \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u043a\u0430\u043d\u0430\u043b\u043e\u0432 \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0435. \u041f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 `{}` (\u043f\u0443\u0441\u0442\u043e\u0433\u043e \u0441\u043b\u043e\u0432\u0430\u0440\u044f) \u0443\u0434\u043e\u0432\u043b\u0435\u0442\u0432\u043e\u0440\u044f\u0435\u0442 \u044d\u0442\u043e \u0442\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u0435, \u043d\u043e, \u0431\u043b\u0430\u0433\u043e\u0434\u0430\u0440\u044f \u0440\u0435\u0434\u0443\u0441\u0435\u0440\u0443 `add_messages`, **\u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442** \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u044e. \u0413\u0440\u0430\u0444 \u043f\u0440\u043e\u0441\u0442\u043e \u00ab\u043f\u0440\u043e\u0441\u044b\u043f\u0430\u0435\u0442\u0441\u044f\u00bb \u0438 \u0432\u0438\u0434\u0438\u0442 \u0441\u0432\u043e\u0438 \u0441\u0442\u0430\u0440\u044b\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f.\n\n2.  **\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0432 Graph 4 (Assistant):**\n    \u0412\u044b \u0442\u0435\u043f\u0435\u0440\u044c \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442\u0435 `len(messages) >= 2`.\n    -   \u0415\u0441\u043b\u0438 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0443\u0436\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u043b `SystemMessage` \u0438 `HumanMessage` (\u0434\u043b\u0438\u043d\u0430 2), `has_full_history` \u0441\u0442\u0430\u043d\u0435\u0442 `True`.\n    -   \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u043f\u043e\u0439\u043c\u0435\u0442, \u0447\u0442\u043e \u044d\u0442\u043e \u00ab\u0436\u0438\u0432\u043e\u0439\u00bb \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441, \u0438 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0441\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0442\u044c `checkpoint_id`. \u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442 \u0440\u0430\u0431\u043e\u0442\u0443, \u0438\u043c\u0435\u044f \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0443.\n\n3.  **\u041a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0439 \u0437\u0430\u043f\u0443\u0441\u043a Refinement (\u0421\u0443\u0434\u0435\u0439\u0441\u0442\u0432\u043e):**\n    \u0415\u0441\u043b\u0438 \u0432\u044b \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u0435\u0440\u0435\u0441\u0442\u0430\u0432\u0438\u043b\u0438 \u0433\u0440\u0430\u0444 \u043d\u0430 `__start__` \u0447\u0435\u0440\u0435\u0437 `update_state` (\u0432\u0430\u0448 \u043b\u043e\u0433 `is_at_virtual_start: true`):\n    -   \u0421\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0432\u0435\u0442\u043a\u0430 `else: effective_input = graph_input`.\n    -   LangGraph \u043f\u043e\u043b\u0443\u0447\u0438\u0442 \u043d\u043e\u0432\u044b\u0439 \u0432\u0432\u043e\u0434 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043f\u0440\u0430\u0432\u043a\u0438 \u0441\u0443\u0434\u044c\u0438) \u0438 \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442 \u0435\u0433\u043e \u043f\u043e\u0432\u0435\u0440\u0445 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0439 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0435. \u042d\u0442\u043e \u0438\u043c\u0435\u043d\u043d\u043e \u0442\u043e, \u0447\u0442\u043e \u043d\u0443\u0436\u043d\u043e \u0434\u043b\u044f \u0446\u0438\u043a\u043b\u0430 \u0434\u043e\u0443\u0447\u0438\u0432\u0430\u043d\u0438\u044f.\n\n4.  **\u0423\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u0435 Gemini Error:**\n    \u041f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u0432\u044b \u0442\u0435\u043f\u0435\u0440\u044c \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0435 \u043b\u0438\u0431\u043e \u043f\u043e\u043b\u043d\u044b\u0439 `graph_input` (\u043f\u0440\u0438 \u0441\u0442\u0430\u0440\u0442\u0435), \u043b\u0438\u0431\u043e `{}` (\u0432 \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u0435), Gemini \u0432\u0441\u0435\u0433\u0434\u0430 \u0431\u0443\u0434\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u0432\u0430\u043b\u0438\u0434\u043d\u044b\u0439 \u043c\u0430\u0441\u0441\u0438\u0432 `contents`. \u0412\u044b \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u0441\u043e\u0437\u0434\u0430\u0435\u0442\u0435 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044e \u00ab\u043f\u0443\u0441\u0442\u043e\u0433\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0430\u00bb \u043f\u043e\u0441\u043b\u0435 \u043b\u043e\u0436\u043d\u043e\u0433\u043e \u0441\u0431\u0440\u043e\u0441\u0430 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430.\n\n### \u0420\u0430\u0437\u0431\u043e\u0440 \u0432\u0430\u0448\u0435\u0433\u043e \u043a\u043e\u0434\u0430 (~\u043b\u0438\u043d\u0438\u0438 510-545):\n\n```python\n# snapshot.values \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0430\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 \u0431\u0430\u0437\u044b\nhas_full_history = len(messages) >= 2\nis_at_virtual_start = bool(next_nodes_list == [\"__start__\"])\n\nif has_full_history and not is_at_virtual_start:\n    effective_input: Any = {} # \u0420\u0435\u0448\u0430\u0435\u0442 EmptyInputError, \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u0438\u0441\u0442\u043e\u0440\u0438\u044e\nelse:\n    effective_input = graph_input # \u0418\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0441\u0442\u0430\u0440\u0442 \u0438\u043b\u0438 refinement\n```\n\n**\u0418\u0442\u043e\u0433:** \u042d\u0442\u043e \u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043d\u0430\u0438\u0431\u043e\u043b\u0435\u0435 \u043d\u0430\u0434\u0435\u0436\u043d\u044b\u043c \u0434\u043b\u044f 4-\u0443\u0440\u043e\u0432\u043d\u0435\u0432\u043e\u0439 \u0430\u0440\u0445\u0438\u0442\u0435\u043a\u0442\u0443\u0440\u044b. \u041e\u043d\u043e \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442, \u0447\u0442\u043e \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 (Graph 4) \u043d\u0438\u043a\u043e\u0433\u0434\u0430 \u043d\u0435 \u043e\u043a\u0430\u0436\u0435\u0442\u0441\u044f \u0432 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0438 \u00ab\u043f\u0443\u0441\u0442\u043e\u0433\u043e \u0432\u0432\u043e\u0434\u0430\u00bb, \u043f\u0440\u0438 \u044d\u0442\u043e\u043c \u0435\u0433\u043e \u043f\u0430\u043c\u044f\u0442\u044c (\u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f) \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f \u0432 \u0446\u0435\u043b\u043e\u0441\u0442\u0438 \u043d\u0430 \u043f\u0440\u043e\u0442\u044f\u0436\u0435\u043d\u0438\u0438 \u0432\u0441\u0435\u0439 \u0436\u0438\u0437\u043d\u0438 \u043d\u0438\u0442\u0438.\n\n**Relevant docs:**\n- [Time Travel: Resume from Checkpoint](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)\n- [Persistence and State Values](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)\n- [LangGraph Errors: EmptyInputError](https://docs.langchain.com/langsmith/use-threads#empty-thread)"
  },
  {
    "role": "user",
    "id": "628ddfc4-3ef9-4506-96d9-e75dd2ff3818",
    "content": "\u0441\u0435\u0439\u0447\u0430\u0441 \u043f\u0440\u0438 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 assistant \u0433\u0440\u0430\u0444\u0430 \u0438\u0441\u0442\u043e\u0440\u0438\u044f massages \u043f\u0443\u0441\u0442\u0430\u044f, \u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0430\n\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:a4c2594d-8233-42f2-6314-52928cc1a9c1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766175427105.054}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766175427105.8618}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:a4c2594d-8233-42f2-6314-52928cc1a9c1\", \"new_ns\": \"user_preferences:a4c2594d-8233-42f2-6314-52928cc1a9c1\"}, \"timestamp\": 1766175427105.944}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:a4c2594d-8233-42f2-6314-52928cc1a9c1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175427105.996}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175427106.354}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175427106.404}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175427106.4902}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175427106.546}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175427106.596}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766175427106.85}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175427107.445}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175427107.501}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766175427107.5908}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:a4c2594d-8233-42f2-6314-52928cc1a9c1\"}, \"timestamp\": 1766175427107.632}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766175434501.2878}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c\", \"new_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c\"}, \"timestamp\": 1766175434507.261}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175434507.3228}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175434507.5981}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175434507.638}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175434507.7498}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175434507.8188}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175434507.8772}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766175434508.17}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175434508.226}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175434508.316}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766175434508.363}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c\"}, \"timestamp\": 1766175434508.4001}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c|graph:4e828c78-0605-07c0-f539-8ba58c0c5530\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766175434742.3308}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175434742.484}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c|graph:4e828c78-0605-07c0-f539-8ba58c0c5530\", \"new_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c|graph:4e828c78-0605-07c0-f539-8ba58c0c5530\"}, \"timestamp\": 1766175434742.5898}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c|graph:4e828c78-0605-07c0-f539-8ba58c0c5530\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175434742.6418}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175434742.952}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766175434743.0}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175434743.0752}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766175434743.317}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175434743.4182}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766175434743.463}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:da15932e-03db-8893-fecb-438bc342587c|graph:4e828c78-0605-07c0-f539-8ba58c0c5530\"}, \"timestamp\": 1766175434743.505}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766175447817.425}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1\"}, \"timestamp\": 1766175447891.614}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175447891.797}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175447892.4749}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175447892.533}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175447892.617}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175447892.677}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175447892.7358}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766175447893.047}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175447893.091}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175447893.129}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766175447893.165}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1\"}, \"timestamp\": 1766175447893.196}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2\"}, \"timestamp\": 1766175447951.712}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175447951.853}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175447952.568}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175447952.624}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175447952.691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175447952.738}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175447952.786}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766175447953.05}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175447953.096}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175447953.133}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766175447953.169}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2\"}, \"timestamp\": 1766175447953.2002}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3\"}, \"timestamp\": 1766175448009.4832}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175448009.6672}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175448010.298}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175448010.347}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175448010.4119}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175448010.46}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175448010.5479}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766175448010.8162}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175448010.867}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175448010.915}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766175448010.967}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3\"}, \"timestamp\": 1766175448011.0027}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4\"}, \"timestamp\": 1766175448068.661}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175448068.811}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175448069.448}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175448069.501}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175448069.588}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175448069.642}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175448069.945}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766175448070.188}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175448070.236}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175448070.294}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766175448070.3362}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4\"}, \"timestamp\": 1766175448070.385}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175448646.095}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175448646.187}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\"}, \"timestamp\": 1766175448646.2432}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175448646.2898}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175448646.595}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766175448646.824}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175448646.901}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766175448647.161}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175448647.219}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766175448647.2522}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\"}, \"timestamp\": 1766175448647.282}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175448680.031}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175448680.137}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\"}, \"timestamp\": 1766175448680.2349}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175448680.285}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175448680.746}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766175448680.789}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175448680.8691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766175448681.1252}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175448681.1719}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766175448681.222}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\"}, \"timestamp\": 1766175448681.273}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175448714.4429}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175448714.5479}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\"}, \"timestamp\": 1766175448714.596}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175448714.663}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175448715.0002}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766175448715.043}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175448715.104}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766175448715.344}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175448715.3909}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766175448715.426}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\"}, \"timestamp\": 1766175448715.4592}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4|4|graph:e6afc6f6-c699-4324-8925-a7baeb298366\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175448749.0771}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175448749.196}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4|4|graph:e6afc6f6-c699-4324-8925-a7baeb298366\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4|4|graph:e6afc6f6-c699-4324-8925-a7baeb298366\"}, \"timestamp\": 1766175448749.2568}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4|4|graph:e6afc6f6-c699-4324-8925-a7baeb298366\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175448749.304}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175448749.6409}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766175448749.6829}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175448749.76}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766175448749.9949}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175448750.041}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766175448750.076}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:4|4|graph:e6afc6f6-c699-4324-8925-a7baeb298366\"}, \"timestamp\": 1766175448750.1208}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175461680.5862}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175461680.6873}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\"}, \"timestamp\": 1766175461680.757}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175461680.813}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd17b-dd28-67ec-8000-cb43be6c110b\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd17b-dd28-61a2-bfff-0586acc80abf\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\"}]}, \"timestamp\": 1766175461681.6143}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd17b-dd28-67ec-8000-cb43be6c110b\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:3|3|graph:6c617266-f7c2-a77f-2950-c4efc0dbf48d\"}, \"timestamp\": 1766175461681.679}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd17b-dd28-67ec-8000-cb43be6c110b\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766175461682.2961}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"message_count\": 1, \"has_full_history\": false, \"is_at_virtual_start\": false, \"effective_input_is_none\": false}, \"timestamp\": 1766175461682.344}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175474476.375}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175474476.5508}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\"}, \"timestamp\": 1766175474476.9458}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175474477.0}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd17b-dcd5-611e-8000-7cce7672e789\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd17b-dcd4-6ab6-bfff-47b23ef769ae\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\"}]}, \"timestamp\": 1766175474477.534}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd17b-dcd5-611e-8000-7cce7672e789\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:2|2|graph:6375d550-5c0e-aff6-d976-47977156a396\"}, \"timestamp\": 1766175474477.6057}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": \"1f0dd17b-dcd5-611e-8000-7cce7672e789\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766175474478.1812}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"message_count\": 1, \"has_full_history\": false, \"is_at_virtual_start\": false, \"effective_input_is_none\": false}, \"timestamp\": 1766175474478.229}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175484200.5442}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175484200.711}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\", \"new_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\"}, \"timestamp\": 1766175484201.185}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\"}, \"timestamp\": 1766175484201.256}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:9426d87e\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd17b-dc82-6b80-8000-182cbd408f3d\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd17b-dc82-6482-bfff-e5593680822d\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\"}]}, \"timestamp\": 1766175484201.844}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd17b-dc82-6b80-8000-182cbd408f3d\", \"checkpoint_ns\": \"wide_funnel:5d7c3bf2-1ee7-2c5c-4a9e-72be54c1c578|worker:1|1|graph:8778c9a4-9a1b-e184-d84b-d28b7edaf046\"}, \"timestamp\": 1766175484201.9192}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": \"1f0dd17b-dc82-6b80-8000-182cbd408f3d\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766175484202.513}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"message_count\": 1, \"has_full_history\": false, \"is_at_virtual_start\": false, \"effective_input_is_none\": false}, \"timestamp\": 1766175484202.573}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"result_keys\": [\"general_route_draft\", \"user_preferences\", \"wide_funnel_options\", \"messages\", \"distribution_scope\"]}, \"timestamp\": 1766175497721.3472}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"I\", \"location\": \"workflow_distribution.py:628\", \"message\": \"worker workflow result\", \"data\": {\"has_options\": true, \"keys\": [\"general_route_draft\", \"user_preferences\", \"wide_funnel_options\", \"distribution_scope\", \"messages\"]}, \"timestamp\": 1766175497725.138}\n\n\nfrom __future__ import annotations\n\nimport uuid\nimport os\nfrom datetime import datetime\nfrom typing import Any, Mapping, MutableMapping, Optional, Sequence, TypeAlias, Protocol, runtime_checkable, cast\n\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom langchain.embeddings import init_embeddings\nfrom shared.project_settings import ProjectSettings\n\ntry:\n    from pydantic_core import core_schema\nexcept ImportError:\n    core_schema = None  # type: ignore\n\ntry:\n    from langgraph.store.memory import InMemoryStore  # type: ignore\nexcept Exception:  # pragma: no cover\n    InMemoryStore = None  # type: ignore\n\n_CHECKPOINTER_SYNC: Optional[Any] = None\n_CHECKPOINTER_ASYNC: Optional[Any] = None\n_STORE: Optional[Any] = None\n\nThreadId: TypeAlias = str\nGraphId: TypeAlias = str\nCheckpointId: TypeAlias = str\nStateDict: TypeAlias = MutableMapping[str, Any]\n\n\n@runtime_checkable\nclass _SupportsGraphCheckpoint(Protocol):\n    \"\"\"Minimal protocol describing compiled LangGraph runnables we inspect for durability support.\"\"\"\n\n    checkpointer: Any | None\n    _pregel: Any | None\n    app: Any | None\n    name: str\n\n\nGraphRunnableWithPregel: TypeAlias = _SupportsGraphCheckpoint\n\n\ndef _extract_graph_checkpointer(graph: Any) -> Any:\n    \"\"\"Return the checkpointer bound directly to a compiled runnable, if any.\"\"\"\n\n    if graph is None:\n        return None\n\n    candidate = getattr(graph, \"checkpointer\", None)\n    if candidate is not None:\n        return candidate\n\n    pregel = getattr(graph, \"_pregel\", None)\n    if pregel is not None:\n        inner = getattr(pregel, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    app = getattr(graph, \"app\", None)\n    if app is not None:\n        inner = getattr(app, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    loop = getattr(graph, \"_loop\", None)\n    if loop is not None:\n        inner = getattr(loop, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    return None\n\n\ndef _graph_supports_durability(graph: Any) -> bool:\n    \"\"\"Return True if the runnable was compiled with a checkpointer.\"\"\"\n\n    return _extract_graph_checkpointer(graph) is not None\n\n\ndef _resolve_local_checkpointer(graph: Any, override: Optional[Any]) -> Optional[Any]:\n    \"\"\"Prefer explicit override, otherwise inspect the runnable for a bound saver.\"\"\"\n\n    if override is not None:\n        return override\n    return _extract_graph_checkpointer(graph)\n\n\ndef resolve_graph_checkpointer(*, async_mode: bool) -> Any:\n    \"\"\"Return a checkpointer compatible with the chosen execution mode.\n\n    Important:\n    - Async LangGraph execution expects async checkpointer methods. If only a\n      sync checkpointer is available (e.g., SqliteSaver), we fall back to the\n      async-safe InMemorySaver to keep `.ainvoke()` reliable.\n    - Production deployments can replace this with an async-capable durable\n      backend (Postgres/SQLite async) without touching graph code.\n    \"\"\"\n\n    global _CHECKPOINTER_SYNC, _CHECKPOINTER_ASYNC\n    CHECKPOINTER_DATABASE_URL = os.getenv(\"CHECKPOINTER_DATABASE_URL\")\n\n    # In production, LangGraph Platform injects the checkpointer automatically.\n    # We keep local checkpointers disabled to avoid shadowing the platform backend.\n    if ProjectSettings().mode == \"production\":\n        return None\n\n\n    if async_mode:\n        if _CHECKPOINTER_ASYNC is None:\n            _CHECKPOINTER_ASYNC = InMemorySaver()\n        return _CHECKPOINTER_ASYNC\n\n    if _CHECKPOINTER_SYNC is None:\n        _CHECKPOINTER_SYNC =  InMemorySaver()\n    return _CHECKPOINTER_SYNC\n\n\ndef resolve_graph_store() -> Any:\n    \"\"\"Return a store implementation for dev/tests; None in production/platform.\n\n    In production, LangGraph Platform injects the store automatically at runtime\n    (via ToolRuntime). We keep local stores disabled to avoid shadowing the\n    platform backend.\n    \"\"\"\n\n    global _STORE\n    if ProjectSettings().mode == \"production\":\n        return None\n    if InMemoryStore is None:\n        return None\n    if _STORE is not None:\n        return _STORE\n\n    # In development/tests we prefer an in-process store. Vector indexing is optional;\n    # if embeddings cannot be initialised (missing deps/keys), fall back to a plain store.\n    try:\n        _STORE = InMemoryStore(\n            index={\n                \"embed\": init_embeddings(\"openai:text-embedding-3-small\"),\n                \"dims\": 1536,\n                \"fields\": [\"content\"],\n            }\n        )\n    except Exception:\n        _STORE = InMemoryStore(index=None)\n    return _STORE\n\n\nclass GraphMemoryRuntime:\n    \"\"\"Encapsulates durable-checkpoint + long-memory access for dev and platform production.\n\n    This class centralizes:\n    - thread_id extraction\n    - platform SDK fallback for checkpoint state/history (no local checkpointer needed)\n    - local (dev) graph/checkpointer checkpoint inspection\n    \"\"\"\n    THREAD_ID_KEY: str = \"thread_id\"\n\n    @classmethod\n    def __get_pydantic_core_schema__(\n        cls,\n        source_type: Any,\n        handler: Any,\n    ) -> Any:\n        \"\"\"Provide Pydantic schema for GraphMemoryRuntime to allow arbitrary types.\n\n        This enables GraphMemoryRuntime to be used in Pydantic models (e.g., when\n        ContextTravelGuideAgent is used as context_schema in StateGraph).\n        \n        Since GraphMemoryRuntime is a runtime helper (not meant for serialization),\n        we use any_schema() to allow it without validation.\n        \"\"\"\n        if core_schema is None:\n            # pydantic_core should always be available in this project\n            raise ImportError(\"pydantic_core is required but not available\")\n        \n        # Use any_schema() to allow GraphMemoryRuntime without validation\n        # This is appropriate since it's a runtime helper with init=False\n        return core_schema.any_schema()\n\n    def __init__(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        # These are intentionally mutable bindings:\n        # - Root graph wiring binds the single checkpointer/store once per process/run.\n        # - Nested graphs MUST reuse the bound instance via runtime context.\n        self.checkpointer: Optional[Any] = checkpointer\n        self.store: Optional[Any] = store\n\n    def bind(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        \"\"\"Bind durable backends onto this runtime helper.\n\n        Idempotent by design: does not overwrite existing non-null bindings unless\n        explicitly provided.\n        \"\"\"\n\n        if checkpointer is not None:\n            self.checkpointer = checkpointer\n        if store is not None:\n            self.store = store\n\n    def is_production_mode(self) -> bool:\n        return ProjectSettings().mode == \"production\"\n\n    def ensure_thread_id(\n        self,\n        config: Optional[RunnableConfig],\n    ) -> tuple[RunnableConfig, ThreadId]:\n        \"\"\"Ensure ``configurable.thread_id`` exists and return ``(config, thread_id)``.\n\n        Contract (required by project checkpointing rules):\n        - One thread_id should be used for the *entire* root graph run.\n        - If caller did not provide a thread_id, we generate a new one from:\n          ``user_id`` (from RunnableConfig.configurable.user_id) + UUID4 suffix.\n        - Callers must reuse the returned config to keep the thread_id stable.\n        \"\"\"\n\n        from shared.config.long_memory import LongMemory\n\n        merged: RunnableConfig = dict(config) if config else {}\n        configurable = merged.get(\"configurable\", {})\n        if not isinstance(configurable, MutableMapping):\n            configurable = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable = dict(configurable)\n\n        existing = configurable.get(self.THREAD_ID_KEY)\n        if existing:\n            thread_id: ThreadId = str(existing)\n            configurable[self.THREAD_ID_KEY] = thread_id\n            merged[\"configurable\"] = configurable\n            return merged, thread_id\n\n        long_memory = LongMemory.from_runnable_config(merged)\n        user_id = long_memory.user_id\n        if not configurable.get(\"user_id\"):\n            configurable[\"user_id\"] = user_id\n\n        thread_id = f\"user_{user_id}_{uuid.uuid4().hex}\"\n        configurable[self.THREAD_ID_KEY] = thread_id\n        merged[\"configurable\"] = configurable\n        return merged, thread_id\n\n    async def list_thread_checkpoints(\n        self,\n        *,\n        config: RunnableConfig,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> list[Any]:\n        \"\"\"Return raw checkpoint records for the given thread config.\n\n        Notes:\n        - In production (LangGraph Platform), we fall back to the SDK thread history.\n        - In dev/tests, we prefer the provided ``local_checkpointer`` (or the default dev\n          checkpointer) to list checkpoints, because it exposes metadata (`graph_id`).\n        - As a last resort, we attempt to list state snapshots via ``graph.get_state_history``.\n        \"\"\"\n\n        thread_id = self.extract_thread_id(config)\n        if not thread_id:\n            return []\n\n        if self.is_production_mode():\n            try:\n                from langgraph_sdk import get_client  # type: ignore\n            except Exception:\n                return []\n            try:\n                client = get_client()\n                history = await client.threads.get_history(thread_id)\n                return list(history)\n            except Exception:\n                return []\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if checkpointer is not None:\n            lister = getattr(checkpointer, \"list\", None)\n            if callable(lister):\n                try:\n                    return list(lister(config))\n                except Exception:\n                    return []\n\n        if local_graph is not None:\n            getter_async = getattr(local_graph, \"aget_state_history\", None)\n            if callable(getter_async):\n                try:\n                    return [snapshot async for snapshot in getter_async(config)]\n                except Exception:\n                    return []\n            getter_sync = getattr(local_graph, \"get_state_history\", None)\n            if callable(getter_sync):\n                try:\n                    return list(getter_sync(config))\n                except Exception:\n                    return []\n\n        return []\n\n    @staticmethod\n    def _extract_checkpoint_metadata(record: Any) -> Mapping[str, Any]:\n        candidate = getattr(record, \"metadata\", None)\n        if isinstance(candidate, Mapping):\n            return cast(Mapping[str, Any], candidate)\n        if isinstance(record, Mapping):\n            meta = record.get(\"metadata\")\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            meta = getattr(checkpoint, \"metadata\", None)\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        return {}\n\n    @staticmethod\n    def _extract_checkpoint_id(record: Any) -> Optional[CheckpointId]:\n        candidate = getattr(record, \"checkpoint_id\", None)\n        if candidate:\n            return str(candidate)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            inner = getattr(checkpoint, \"checkpoint_id\", None)\n            if inner:\n                return str(inner)\n            inner = getattr(checkpoint, \"id\", None)\n            if inner:\n                return str(inner)\n        if isinstance(record, Mapping):\n            candidate = record.get(\"checkpoint_id\") or record.get(\"id\")\n            if candidate:\n                return str(candidate)\n            cfg = record.get(\"config\")\n            if isinstance(cfg, Mapping):\n                conf = cfg.get(\"configurable\")\n                if isinstance(conf, Mapping):\n                    candidate = conf.get(\"checkpoint_id\")\n                    if candidate:\n                        return str(candidate)\n        cfg = getattr(record, \"config\", None)\n        if isinstance(cfg, Mapping):\n            conf = cfg.get(\"configurable\")\n            if isinstance(conf, Mapping):\n                candidate = conf.get(\"checkpoint_id\")\n                if candidate:\n                    return str(candidate)\n        return None\n\n    @staticmethod\n    def _extract_created_at(record: Any) -> Optional[datetime]:\n        candidate = getattr(record, \"created_at\", None)\n        if isinstance(candidate, datetime):\n            return candidate\n        if isinstance(record, Mapping):\n            candidate = record.get(\"created_at\")\n            if isinstance(candidate, datetime):\n                return candidate\n        return None\n\n    @classmethod\n    def _matches_graph_id(cls, record: Any, graph_id: GraphId) -> bool:\n        metadata = cls._extract_checkpoint_metadata(record)\n        candidate = metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")\n        return str(candidate) == str(graph_id) if candidate else False\n\n    @staticmethod\n    def _extract_checkpoint_ns(record: Any) -> Optional[str]:\n        def _from_config(cfg: Any) -> Optional[str]:\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n                if isinstance(configurable, Mapping):\n                    candidate = configurable.get(\"checkpoint_ns\")\n                    if candidate is not None:\n                        return str(candidate)\n            return None\n\n        cfg = getattr(record, \"config\", None)\n        ns = _from_config(cfg)\n        if ns:\n            return ns\n\n        if isinstance(record, Mapping):\n            ns = _from_config(record.get(\"config\"))\n            if ns:\n                return ns\n\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            ns = _from_config(getattr(checkpoint, \"config\", None))\n            if ns:\n                return ns\n\n        metadata = GraphMemoryRuntime._extract_checkpoint_metadata(record)\n        checkpoint_ns = metadata.get(\"checkpoint_ns\")\n        return str(checkpoint_ns) if checkpoint_ns is not None else None\n\n    @staticmethod\n    def _normalize_config_like(config_like: Any) -> Optional[RunnableConfig]:\n        if config_like is None:\n            return None\n        if isinstance(config_like, Mapping):\n            normalized = dict(config_like)\n        else:\n            normalized = None\n            for attr in (\"model_dump\", \"dict\"):\n                dumper = getattr(config_like, attr, None)\n                if callable(dumper):\n                    try:\n                        normalized = dumper()\n                        break\n                    except Exception:\n                        normalized = None\n            if normalized is None:\n                try:\n                    normalized = dict(config_like)  # type: ignore[arg-type]\n                except Exception:\n                    return None\n\n        configurable = normalized.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            configurable = dict(configurable) if configurable is not None else {}\n        normalized[\"configurable\"] = dict(configurable)\n\n        metadata = normalized.get(\"metadata\", {})\n        if not isinstance(metadata, Mapping):\n            metadata = dict(metadata) if metadata is not None else {}\n        normalized[\"metadata\"] = dict(metadata)\n        return normalized  # type: ignore[return-value]\n\n    @classmethod\n    def _extract_task_entries(cls, record: Any) -> list[Mapping[str, Any]]:\n        extracted: list[Mapping[str, Any]] = []\n        visited_snapshots: set[int] = set()\n\n        def _coerce_metadata(value: Any) -> Optional[Mapping[str, Any]]:\n            if value is None:\n                return None\n            if isinstance(value, Mapping):\n                return value\n            try:\n                return dict(value)\n            except Exception:\n                return None\n\n        def _as_sequence(value: Any) -> Optional[Sequence[Any]]:\n            if isinstance(value, Sequence) and not isinstance(value, (str, bytes)):\n                return value\n            return None\n\n        def _record_entry(config_like: Any, metadata_like: Any, state_like: Any) -> None:\n            normalized_config = cls._normalize_config_like(config_like)\n            normalized_metadata = _coerce_metadata(metadata_like)\n            entry: dict[str, Any] = {}\n            if normalized_config:\n                entry[\"config\"] = normalized_config\n            if normalized_metadata:\n                entry[\"metadata\"] = normalized_metadata\n            if state_like is not None:\n                entry[\"state\"] = state_like\n            if entry:\n                extracted.append(entry)\n\n        def _visit_snapshot(snapshot: Any) -> None:\n            if snapshot is None:\n                return\n            snapshot_id = id(snapshot)\n            if snapshot_id in visited_snapshots:\n                return\n            visited_snapshots.add(snapshot_id)\n\n            tasks = None\n            if isinstance(snapshot, Mapping):\n                tasks = _as_sequence(snapshot.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(snapshot, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        def _visit_task(task: Any) -> None:\n            if task is None:\n                return\n            if isinstance(task, Mapping):\n                _record_entry(task.get(\"config\"), task.get(\"metadata\"), task.get(\"state\"))\n                nested_tasks = _as_sequence(task.get(\"tasks\"))\n                if nested_tasks:\n                    for nested in nested_tasks:\n                        _visit_task(nested)\n                _visit_snapshot(task.get(\"state\"))\n                _visit_snapshot(task.get(\"result\"))\n                return\n\n            _record_entry(\n                getattr(task, \"config\", None),\n                getattr(task, \"metadata\", None),\n                getattr(task, \"state\", None),\n            )\n            _visit_snapshot(getattr(task, \"state\", None))\n            _visit_snapshot(getattr(task, \"result\", None))\n            nested_attr = _as_sequence(getattr(task, \"tasks\", None))\n            if nested_attr:\n                for nested in nested_attr:\n                    _visit_task(nested)\n\n        for source in (record, getattr(record, \"checkpoint\", None)):\n            if source is None:\n                continue\n            _visit_snapshot(source)\n            tasks = None\n            if isinstance(source, Mapping):\n                tasks = _as_sequence(source.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(source, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        return extracted\n\n    async def find_latest_checkpoint_id(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Return the latest checkpoint_id for ``graph_id`` within the given thread.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n\n        # #region agent log\n        import json\n        record_summaries: list[dict[str, str | None]] = []\n        for idx, record in enumerate(checkpoints[:3]):\n            metadata = self._extract_checkpoint_metadata(record)\n            cfg = getattr(record, \"config\", None)\n            configurable = None\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n            checkpoint_ns = None\n            if isinstance(configurable, Mapping):\n                checkpoint_ns = str(configurable.get(\"checkpoint_ns\"))\n            record_summaries.append(\n                {\n                    \"idx\": str(idx),\n                    \"meta_graph_id\": str(metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")),\n                    \"checkpoint_id\": self._extract_checkpoint_id(record),\n                    \"checkpoint_ns\": checkpoint_ns,\n                }\n            )\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"B\",\"location\":\"memory_manager.py:395\",\"message\":\"find_latest_checkpoint_id checkpoints listed\",\"data\":{\"graph_id\":graph_id,\"thread_id\":str(config.get(\"configurable\",{}).get(\"thread_id\",\"\")), \"count\":len(checkpoints),\"records\":record_summaries},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if not checkpoints:\n            return None\n\n        # Collect matches with their timestamps (if provided by the backend).\n        matches: list[tuple[Optional[datetime], Any]] = []\n        for record in checkpoints:\n            if self._matches_graph_id(record, graph_id):\n                matches.append((self._extract_created_at(record), record))\n\n        target_checkpoint_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_checkpoint_ns = str(candidate_ns)\n\n        if not matches and target_checkpoint_ns:\n            for record in checkpoints:\n                if self._extract_checkpoint_ns(record) == target_checkpoint_ns:\n                    matches.append((self._extract_created_at(record), record))\n\n        if not matches:\n            return None\n\n        # If the backend provides created_at, prefer the most recent by timestamp.\n        if any(created_at is not None for created_at, _ in matches):\n            matches.sort(\n                key=lambda item: item[0] or datetime.min,\n                reverse=True,\n            )\n            return self._extract_checkpoint_id(matches[0][1])\n\n        # Otherwise, rely on the backend list order. InMemorySaver and Platform history\n        # return newest-first, so the first matching record is the latest.\n        return self._extract_checkpoint_id(matches[0][1])\n\n    async def _load_checkpoint_record(\n        self,\n        *,\n        config: RunnableConfig,\n        checkpoint_id: CheckpointId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[Any]:\n        \"\"\"Return the checkpoint record with the specified ID.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n        for record in checkpoints:\n            record_id = self._extract_checkpoint_id(record)\n            if record_id == checkpoint_id:\n                return record\n        return None\n\n    @staticmethod\n    def _materialize_checkpoint_values(\n        base_values: Mapping[str, Any],\n        record: Optional[Any],\n        *,\n        graph_id: Optional[str] = None,\n    ) -> tuple[Mapping[str, Any], bool]:\n        \"\"\"Merge stored writes from the checkpoint record into snapshot values.\"\"\"\n\n        if record is None:\n            return base_values, False\n\n        materialized: dict[str, Any] = dict(base_values)\n        writes_found = False\n\n        checkpoint_obj = getattr(record, \"checkpoint\", record)\n        writes = getattr(checkpoint_obj, \"writes\", None)\n        if writes is None and isinstance(checkpoint_obj, Mapping):\n            writes = checkpoint_obj.get(\"writes\")\n\n        # #region agent log\n        import json as _json_checkpoint_meta\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(\n                _json_checkpoint_meta.dumps(\n                    {\n                        \"sessionId\": \"debug-session\",\n                        \"runId\": \"pre-fix\",\n                        \"hypothesisId\": \"L\",\n                        \"location\": \"memory_manager.py:321\",\n                        \"message\": \"checkpoint record summary\",\n                        \"data\": {\n                            \"graph_id\": graph_id,\n                            \"record_type\": type(checkpoint_obj).__name__,\n                            \"has_attr_writes\": hasattr(checkpoint_obj, \"writes\"),\n                            \"writes_is_sequence\": isinstance(writes, Sequence),\n                            \"writes_is_mapping\": isinstance(writes, Mapping),\n                        },\n                        \"timestamp\": __import__(\"time\").time() * 1000,\n                    }\n                )\n                + \"\\n\"\n            )\n        # #endregion\n\n        summary: list[dict[str, Any]] = []\n\n        if isinstance(writes, Sequence):\n            for idx, write_entry in enumerate(writes):\n                node_name = None\n                write_payload = None\n                if isinstance(write_entry, Mapping):\n                    node_name = write_entry.get(\"node\") or write_entry.get(\"name\")\n                    candidate = write_entry.get(\"writes\") or write_entry.get(\"values\")\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n                else:\n                    node_name = getattr(write_entry, \"node\", None) or getattr(write_entry, \"name\", None)\n                    candidate = getattr(write_entry, \"writes\", None)\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n\n                if isinstance(write_payload, Mapping):\n                    for key, value in write_payload.items():\n                        materialized.setdefault(key, value)\n                    if idx < 3:\n                        summary.append(\n                            {\n                                \"node\": str(node_name),\n                                \"keys\": list(write_payload.keys()),\n                            }\n                        )\n                    writes_found = True\n\n        # #region agent log\n        if summary:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:324\",\n                            \"message\": \"checkpoint writes merged\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"writes\": summary,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        else:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:329\",\n                            \"message\": \"checkpoint writes unavailable\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"has_writes\": isinstance(writes, Sequence),\n                                \"writes_type\": None if writes is None else type(writes).__name__,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        # #endregion\n\n        return materialized, writes_found\n\n    @staticmethod\n    def _has_meaningful_values(values: Mapping[str, Any]) -> bool:\n        \"\"\"Return True if checkpoint values contain data beyond housekeeping fields.\"\"\"\n\n        if not values:\n            return False\n        significant_keys = set(values.keys()) - {\"messages\", \"remaining_steps\", \"distribution_scope\"}\n        if significant_keys:\n            return True\n\n        messages = values.get(\"messages\")\n        if isinstance(messages, Sequence):\n            # System + user messages occupy the first two positions. Anything beyond\n            # that indicates the assistant has already produced tool calls or replies.\n            if len(messages) > 2:\n                return True\n\n        return False\n\n    async def _find_subgraph_resume_config(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        checkpoints: Sequence[Any],\n    ) -> Optional[tuple[RunnableConfig, Any]]:\n        target_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_ns = str(candidate_ns)\n\n        for record_idx, record in enumerate(checkpoints):\n            task_entries = self._extract_task_entries(record)\n            if not task_entries:\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:562\",\"message\":\"checkpoint missing task entries\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"parent_checkpoint_id\":self._extract_checkpoint_id(record)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n                continue\n            for task_idx, task in enumerate(task_entries[:2]):\n                task_metadata = task.get(\"metadata\")\n                normalized_metadata: Mapping[str, Any] = {}\n                if isinstance(task_metadata, Mapping):\n                    normalized_metadata = task_metadata\n                task_graph_id = normalized_metadata.get(\"graph_id\") or normalized_metadata.get(\"langgraph_graph_id\")\n\n                raw_config = task.get(\"config\")\n                normalized_config = self._normalize_config_like(raw_config)\n                if not normalized_config:\n                    continue\n                task_configurable = normalized_config.get(\"configurable\", {})\n                task_ns = None\n                if isinstance(task_configurable, Mapping):\n                    candidate = task_configurable.get(\"checkpoint_ns\")\n                    if candidate:\n                        task_ns = str(candidate)\n\n                ns_matches = target_ns and task_ns == target_ns\n                graph_matches = task_graph_id and str(task_graph_id) == str(graph_id)\n\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:581\",\"message\":\"task entry inspected\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"task_index\":task_idx,\"task_graph_id\":task_graph_id,\"task_ns\":task_ns},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n\n                if graph_matches or ns_matches:\n                    resume_state = task.get(\"state\")\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            json.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"D\",\n                                    \"location\": \"memory_manager.py:520\",\n                                    \"message\": \"subgraph resume config located\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"matched_ns\": task_ns,\n                                        \"matched_graph_id\": task_graph_id,\n                                        \"parent_checkpoint_id\": self._extract_checkpoint_id(record),\n                                        \"has_state\": resume_state is not None,\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return normalized_config, resume_state\n\n        return None\n\n    async def _get_graph_snapshot(\n        self,\n        *,\n        graph: Any,\n        cfg: RunnableConfig,\n        subgraphs: bool = False,\n    ) -> Any:\n        getter_async = getattr(graph, \"aget_state\", None)\n        params = {\"subgraphs\": True} if subgraphs else {}\n        try:\n            if callable(getter_async):\n                return await getter_async(cfg, **params)\n        except TypeError:\n            # Fallback for LangGraph versions that don't support subgraphs kwarg.\n            try:\n                return await getter_async(cfg)\n            except Exception:\n                pass\n        except Exception:\n            pass\n\n        getter_sync = getattr(graph, \"get_state\", None)\n        if callable(getter_sync):\n            try:\n                return getter_sync(cfg, **params)\n            except TypeError:\n                try:\n                    return getter_sync(cfg)\n                except Exception:\n                    return None\n            except Exception:\n                return None\n        return None\n\n    async def ainvoke_from_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str = \"sync\",\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph resuming from the latest checkpoint when available.\"\"\"\n\n        merged, _ = self.ensure_thread_id(config)\n        # SAFETY: Ignore any caller-supplied checkpoint_id.\n        #\n        # In this architecture, checkpoint selection is *graph_id-scoped* and managed\n        # exclusively by this runtime helper. Allowing external checkpoint_id values\n        # could cause cross-graph leakage within a shared thread_id.\n\n        merged_conf = merged.get(\"configurable\", {})\n        if isinstance(merged_conf, Mapping):\n            merged_conf_dict = dict(merged_conf)\n            merged_conf_dict.pop(\"checkpoint_id\", None)\n            original_ns = merged_conf_dict.get(\"checkpoint_ns\", \"\")\n            merged_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            merged[\"configurable\"] = merged_conf_dict\n            \n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"E\",\"location\":\"memory_manager.py:445\",\"message\":\"ainvoke_from_checkpoint setting checkpoint_ns\",\"data\":{\"graph_id\":graph_id,\"original_ns\":str(original_ns),\"new_ns\":str(merged_conf_dict.get(\"checkpoint_ns\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n        # Ensure the checkpoint records are scoping-friendly in LangGraph v1.\n        meta = merged.get(\"metadata\")\n        if not isinstance(meta, Mapping):\n            meta = {}\n        meta_dict = dict(meta)\n        meta_dict.setdefault(\"graph_id\", str(graph_id))\n        merged[\"metadata\"] = meta_dict\n\n        effective_local_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n\n        # #region agent log\n        import json\n        final_ns = merged.get(\"configurable\", {}).get(\"checkpoint_ns\", \"\")\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:458\",\"message\":\"ainvoke_from_checkpoint calling find_latest_checkpoint_id\",\"data\":{\"graph_id\":graph_id,\"checkpoint_ns\":str(final_ns),\"thread_id\":str(merged.get(\"configurable\",{}).get(\"thread_id\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=effective_local_checkpointer,\n            local_graph=graph,\n        )\n        checkpoint_record: Optional[Any] = None\n        subgraph_resume: Optional[tuple[RunnableConfig, Any]] = None\n        if checkpoint_id is None:\n            snapshot_sources: list[Any] = []\n\n            if context is not None:\n                runner = getattr(context, \"graph_runner\", None)\n                graph_runtime = getattr(runner, \"graph\", None)\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:711\",\"message\":\"parent context inspection\",\"data\":{\"graph_id\":graph_id,\"has_context\":True,\"has_runner\":runner is not None,\"has_graph\":graph_runtime is not None},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n                if graph_runtime is not None:\n                    try:\n                        parent_snapshot = await self._get_graph_snapshot(\n                            graph=graph_runtime,\n                            cfg=merged,\n                            subgraphs=True,\n                        )\n                        if parent_snapshot is not None:\n                            snapshot_sources.append(parent_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:715\",\"message\":\"parent snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":parent_snapshot is not None,\"has_tasks\":bool(getattr(parent_snapshot,\"tasks\",None)),\"has_next\":bool(getattr(parent_snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                    except Exception:\n                        parent_snapshot = None\n                else:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:724\",\"message\":\"parent snapshot skipped\",\"data\":{\"graph_id\":graph_id,\"reason\":\"graph_runner_missing\" if runner is None else \"graph_attr_missing\"},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:729\",\"message\":\"parent context absent\",\"data\":{\"graph_id\":graph_id},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n\n            root_graph = getattr(context, \"root_graph\", None) if context is not None else None\n            if root_graph is not None:\n                try:\n                    root_snapshot = await self._get_graph_snapshot(\n                        graph=root_graph,\n                        cfg=merged,\n                        subgraphs=True,\n                    )\n                    if root_snapshot is not None:\n                        snapshot_sources.append(root_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:738\",\"message\":\"root snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":root_snapshot is not None,\"has_tasks\":bool(getattr(root_snapshot,\"tasks\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                except Exception:\n                    root_snapshot = None\n\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=merged,\n                subgraphs=True,\n            )\n            if snapshot is not None:\n                snapshot_sources.append(snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:727\",\"message\":\"assistant snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":bool(getattr(snapshot,\"tasks\",None)),\"has_next\":bool(getattr(snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            checkpoints_snapshot = await self.list_thread_checkpoints(\n                config=merged,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n            snapshot_sources.extend(checkpoints_snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:734\",\"message\":\"thread checkpoints snapshot collected\",\"data\":{\"graph_id\":graph_id,\"count\":len(checkpoints_snapshot)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            subgraph_resume = await self._find_subgraph_resume_config(\n                config=merged,\n                graph_id=graph_id,\n                checkpoints=snapshot_sources,\n            )\n            if subgraph_resume is not None:\n                resume_config, _ = subgraph_resume\n                metadata = resume_config.get(\"metadata\", {})\n                if not isinstance(metadata, Mapping):\n                    metadata = dict(metadata) if metadata is not None else {}\n                metadata = dict(metadata)\n                metadata.setdefault(\"graph_id\", str(graph_id))\n                resume_config[\"metadata\"] = metadata  # type: ignore[index]\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:743\",\"message\":\"subgraph resume config missing\",\"data\":{\"graph_id\":graph_id,\"snapshot_sources\":len(snapshot_sources)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n        \n        # #region agent log\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:464\",\"message\":\"ainvoke_from_checkpoint checkpoint_id result\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":str(checkpoint_id) if checkpoint_id else None,\"checkpoint_ns\":str(final_ns)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if checkpoint_id:\n            checkpoint_record = await self._load_checkpoint_record(\n                config=merged,\n                checkpoint_id=checkpoint_id,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n\n            cfg: RunnableConfig = dict(merged)\n            configurable = cfg.get(\"configurable\", {})\n            configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n            configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n            configurable_dict[\"checkpoint_id\"] = checkpoint_id\n            cfg[\"configurable\"] = configurable_dict\n\n            # If the checkpoint represents an in-progress run (has pending `next`),\n            # we resume via `invoke(None, checkpoint_id=...)`. If the run is already\n            # complete (no pending next nodes), we \"restart\" from the persisted\n            # snapshot values as a fresh invocation. This is the required behavior\n            # for refinement: patch values \u2192 re-run from patched state.\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=cfg,\n                subgraphs=True,\n            )\n\n            # #region agent log\n            import json\n            snapshot_has_tasks = bool(getattr(snapshot, \"tasks\", None))\n            snapshot_next = getattr(snapshot, \"next\", None)\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"C\",\"location\":\"memory_manager.py:504\",\"message\":\"ainvoke_from_checkpoint snapshot inspection\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":checkpoint_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":snapshot_has_tasks,\"pending_next\":bool(snapshot_next)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            next_nodes = getattr(snapshot, \"next\", None)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(next_nodes, Sequence) and next_nodes:\n                next_nodes_list = list(next_nodes)\n                messages = []\n                if isinstance(values, Mapping):\n                    candidate_messages = values.get(\"messages\")\n                    if isinstance(candidate_messages, Sequence):\n                        messages = list(candidate_messages)\n\n                has_full_history = len(messages) >= 2\n                is_at_virtual_start = bool(next_nodes_list == [\"__start__\"])\n\n                if has_full_history and not is_at_virtual_start:\n                    effective_input: Any = {}\n                else:\n                    effective_input = graph_input\n\n                # #region agent log\n                import json as _json_resume_next\n                next_preview = next_nodes_list[:3]\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(\n                        _json_resume_next.dumps(\n                            {\n                                \"sessionId\": \"debug-session\",\n                                \"runId\": \"pre-fix\",\n                                \"hypothesisId\": \"K\",\n                                \"location\": \"memory_manager.py:509\",\n                                \"message\": \"resuming graph from checkpoint pending next\",\n                                \"data\": {\n                                    \"graph_id\": graph_id,\n                                    \"next_nodes\": next_preview,\n                                \"graph_input_is_none\": graph_input is None,\n                                \"message_count\": len(messages),\n                                \"has_full_history\": has_full_history,\n                                    \"is_at_virtual_start\": is_at_virtual_start,\n                                    \"effective_input_is_none\": effective_input is None,\n                                },\n                                \"timestamp\": __import__(\"time\").time() * 1000,\n                            }\n                        )\n                        + \"\\n\"\n                    )\n                # #endregion\n\n                return await self.ainvoke_with_durability(\n                    graph=graph,\n                    graph_input=effective_input,\n                    config=cfg,\n                    context=context,\n                    durability=durability,\n                    local_checkpointer=effective_local_checkpointer,\n                )\n\n            # IMPORTANT:\n            # If the checkpoint is COMPLETE (no pending next nodes), we DO NOT attempt to\n            # \"restart\" the graph by invoking without checkpoint_id. In a shared thread_id\n            # architecture (multiple graphs in the same thread), dropping checkpoint_id\n            # would cause LangGraph to load the latest checkpoint for the thread+ns,\n            # which may belong to a different graph_id \u2192 cross-graph contamination.\n            #\n            # Callers that need to re-run a completed checkpoint should first \"arm\" it\n            # via `graph.update_state(..., as_node=\"__start__\")` (e.g., our refinement\n            # injection path does this), which produces a checkpoint with pending next nodes.\n            if isinstance(values, Mapping):\n                materialized_values, writes_found = self._materialize_checkpoint_values(\n                    values,\n                    checkpoint_record,\n                    graph_id=str(graph_id),\n                )\n                if writes_found or self._has_meaningful_values(materialized_values):\n                    # #region agent log\n                    import json as _json_resume\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            _json_resume.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"J\",\n                                    \"location\": \"memory_manager.py:944\",\n                                    \"message\": \"returning checkpoint values\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"keys\": list(materialized_values.keys()),\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return dict(materialized_values)\n\n                # Values are incomplete (e.g., only messages). Fallback to fresh invoke.\n                rerun_cfg: RunnableConfig = dict(merged)\n                rerun_conf = rerun_cfg.get(\"configurable\", {})\n                if isinstance(rerun_conf, Mapping):\n                    rerun_conf_dict = dict(rerun_conf)\n                    rerun_conf_dict.pop(\"checkpoint_id\", None)\n                    rerun_conf_dict.setdefault(\"checkpoint_ns\", str(final_ns))\n                    rerun_cfg[\"configurable\"] = rerun_conf_dict\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=graph_input,\n                config=rerun_cfg,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        if subgraph_resume is not None:\n            # #region agent log\n            import json\n            resume_config, resume_state = subgraph_resume\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"D\",\n                            \"location\": \"memory_manager.py:610\",\n                            \"message\": \"resuming assistant via subgraph config\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"checkpoint_ns\": resume_config.get(\"configurable\", {}).get(\"checkpoint_ns\") if isinstance(resume_config.get(\"configurable\"), Mapping) else None,\n                                \"has_state\": resume_state is not None,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n            # #endregion\n            resume_input = graph_input\n            if resume_state is not None:\n                values = getattr(resume_state, \"values\", None)\n                if isinstance(values, Mapping):\n                    resume_input = dict(values)\n                elif isinstance(resume_state, Mapping):\n                    maybe_values = resume_state.get(\"values\")\n                    if isinstance(maybe_values, Mapping):\n                        resume_input = dict(maybe_values)\n                    else:\n                        resume_input = resume_state\n                else:\n                    resume_input = resume_state\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=resume_input,\n                config=resume_config,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        # SAFETY: Never allow a caller-supplied checkpoint_id to influence execution\n        # when we are NOT explicitly resuming from a checkpoint for this graph_id.\n        #\n        # Without this, a foreign checkpoint_id (from another graph_id in the same\n        # thread) could be accidentally consumed by LangGraph, violating isolation.\n        fresh_cfg: RunnableConfig = dict(merged)\n        fresh_conf = fresh_cfg.get(\"configurable\", {})\n        if isinstance(fresh_conf, Mapping):\n            fresh_conf_dict = dict(fresh_conf)\n            fresh_conf_dict.pop(\"checkpoint_id\", None)\n            # Keep checkpoint_ns stable (LangGraph may assume the key exists).\n            fresh_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            fresh_cfg[\"configurable\"] = fresh_conf_dict\n\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=graph_input,\n            config=fresh_cfg,\n            context=context,\n            durability=durability,\n            local_checkpointer=effective_local_checkpointer,\n        )\n\n    async def append_messages_to_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        new_messages: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Append messages to the latest checkpoint for ``graph_id`` and return new checkpoint id.\n\n        This uses ``graph.update_state`` / ``graph.aupdate_state`` so reducers (e.g. `add_messages`)\n        are honored. The update is applied as a fork of the latest checkpoint for ``graph_id``.\n        \"\"\"\n\n        if not new_messages:\n            return None\n\n        merged, _ = self.ensure_thread_id(config)\n        resolved_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n        latest_checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n        \n        if not latest_checkpoint_id:\n            return None\n        \n        patch_config: RunnableConfig = dict(merged)\n        configurable = patch_config.get(\"configurable\", {})\n        configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n        configurable_dict[\"checkpoint_id\"] = latest_checkpoint_id\n        patch_config[\"configurable\"] = configurable_dict\n\n        # Ensure patched checkpoints remain discoverable by metadata scoping.\n        metadata = patch_config.get(\"metadata\")\n        if not isinstance(metadata, Mapping):\n            metadata = {}\n        metadata_dict = dict[str, Any](metadata)\n        metadata_dict.setdefault(\"graph_id\", str(graph_id))\n        patch_config[\"metadata\"] = metadata_dict\n\n\n        # Best-effort idempotency: avoid appending messages already present in the checkpoint.\n        # This is critical for durable resume where refinement planning may be replayed.\n        filtered_messages: list[Any] = list(new_messages)\n        try:\n            snapshot = None\n            getter_async = getattr(graph, \"aget_state\", None)\n            if callable(getter_async):\n                snapshot = await getter_async(patch_config)\n            if snapshot is None:\n                getter_sync = getattr(graph, \"get_state\", None)\n                if callable(getter_sync):\n                    snapshot = getter_sync(patch_config)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(values, Mapping):\n                existing = values.get(\"messages\")\n                if isinstance(existing, Sequence) and not isinstance(existing, (str, bytes)):\n                    existing_contents: set[str] = set()\n                    for message in existing:\n                        content = getattr(message, \"content\", None)\n                        if content:\n                            existing_contents.add(str(content))\n                    if existing_contents:\n                        filtered_messages = [\n                            message\n                            for message in filtered_messages\n                            if str(getattr(message, \"content\", \"\")) not in existing_contents\n                        ]\n        except Exception:\n            filtered_messages = list(new_messages)\n\n        if not filtered_messages:\n            return latest_checkpoint_id\n\n        updates: dict[str, Any] = {\"messages\": filtered_messages}\n\n        updater_async = getattr(graph, \"aupdate_state\", None)\n        updater_sync = getattr(graph, \"update_state\", None)\n        resolved_as_node = as_node or \"__start__\"\n        try:\n            if callable(updater_async):\n                await updater_async(patch_config, updates, as_node=resolved_as_node)\n            elif callable(updater_sync):\n                updater_sync(patch_config, updates, as_node=resolved_as_node)\n            else:\n                return None\n        except Exception as e:\n            return None\n\n        return await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n\n    async def inject_distribution_refinement_messages(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        requests: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Patch a graph checkpoint by appending refinement instruction messages.\n\n        Mirrors the extraction rules used by `_distribution_inject_refinement_messages`:\n        each request may carry `payload.messages` items shaped like\n        `{ \"content\": \"...\", \"metadata\": {...} }`.\n        \"\"\"\n\n        try:\n            from langchain_core.messages import HumanMessage\n        except Exception:\n            return None\n\n        injected: list[Any] = []\n        seen_contents: set[str] = set()\n        for request in requests:\n            payload = getattr(request, \"payload\", None)\n            if not isinstance(payload, Mapping):\n                payload = payload if isinstance(payload, dict) else {}\n            messages_payload = payload.get(\"messages\") or []\n            if not isinstance(messages_payload, Sequence) or isinstance(\n                messages_payload, (str, bytes)\n            ):\n                continue\n            for message in messages_payload:\n                if not isinstance(message, Mapping):\n                    continue\n                content = message.get(\"content\")\n                if not content:\n                    continue\n                content_str = str(content)\n                if content_str in seen_contents:\n                    continue\n                metadata = message.get(\"metadata\") or {}\n                additional_kwargs = dict(metadata) if isinstance(metadata, Mapping) else {}\n                injected.append(\n                    HumanMessage(content=content_str, additional_kwargs=additional_kwargs)\n                )\n                seen_contents.add(content_str)\n\n        if not injected:\n            return None\n\n        return await self.append_messages_to_checkpoint(\n            graph=graph,\n            graph_id=graph_id,\n            config=config,\n            new_messages=injected,\n            as_node=as_node,\n            local_checkpointer=local_checkpointer,\n        )\n\n    @staticmethod\n    def extract_thread_id(config: Optional[RunnableConfig]) -> Optional[ThreadId]:\n        if not config:\n            return None\n        configurable = config.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            return None\n        thread_id = configurable.get(\"thread_id\")\n        return str(thread_id) if thread_id else None\n\n    async def aget_platform_thread_state(self, *, thread_id: ThreadId) -> Optional[Any]:\n        \"\"\"Get latest persisted state from platform via LangGraph SDK (if available).\"\"\"\n\n        try:\n            from langgraph_sdk import get_client  # type: ignore\n        except Exception:\n            return None\n\n        try:\n            client = get_client()\n            return await client.threads.get_state(thread_id)\n        except Exception:\n            return None\n\n\n    async def has_persisted_checkpoint(\n        self,\n        *,\n        config: Optional[RunnableConfig],\n        local_checkpointer: Optional[Any] = None,\n    ) -> bool:\n        \"\"\"Return True if a checkpoint exists for config (platform or local).\"\"\"\n\n        if config is None:\n            return False\n\n        if self.is_production_mode():\n            thread_id = self.extract_thread_id(config)\n            if not thread_id:\n                return False\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n            values = getattr(snapshot, \"values\", None)\n            return isinstance(values, Mapping)\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if not checkpointer:\n            return False\n\n        getter_async = getattr(checkpointer, \"aget_tuple\", None)\n        try:\n            if callable(getter_async):\n                checkpoint_tuple = await getter_async(config)\n            else:\n                getter_sync = getattr(checkpointer, \"get_tuple\", None)\n                if not callable(getter_sync):\n                    return False\n                checkpoint_tuple = getter_sync(config)\n        except Exception:\n            return False\n\n        return checkpoint_tuple is not None\n\n    async def restore_state_from_latest_checkpoint(\n        self,\n        *,\n        state: StateDict,\n        config: Optional[RunnableConfig],\n        local_graph: Optional[Any],\n    ) -> bool:\n        \"\"\"Merge latest persisted state into the caller-owned `state` mapping.\"\"\"\n\n        if config is None:\n            return False\n\n        snapshot = None\n        thread_id = self.extract_thread_id(config)\n        if self.is_production_mode() and thread_id:\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n\n        if snapshot is None and local_graph is not None:\n            getter = getattr(local_graph, \"aget_state\", None)\n            if callable(getter):\n                try:\n                    snapshot = await getter(config)\n                except Exception:\n                    snapshot = None\n            if snapshot is None:\n                getter_sync = getattr(local_graph, \"get_state\", None)\n                if callable(getter_sync):\n                    try:\n                        snapshot = getter_sync(config)\n                    except Exception:\n                        snapshot = None\n\n        values = getattr(snapshot, \"values\", None)\n        if not isinstance(values, Mapping):\n            return False\n\n        for key, value in values.items():\n            state[key] = value\n        return True\n\n    async def ainvoke_with_durability(\n        self,\n        *,\n        graph: Any,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph with durability when supported.\"\"\"\n\n        # In production mode, platform may inject durability backends automatically.\n        # In dev mode, only attempt durability when the runnable itself was compiled\n        # with a checkpointer so LangGraph sets up its AsyncPregel loop correctly.\n        graph_bound_checkpointer = _extract_graph_checkpointer(graph)\n        resolved_local_checkpointer = local_checkpointer or graph_bound_checkpointer\n        checkpointer = resolved_local_checkpointer or self.checkpointer\n\n        if self.is_production_mode():\n            use_durability = durability\n        else:\n            use_durability = durability if (checkpointer and _graph_supports_durability(graph)) else None\n        try:\n            if use_durability:\n                return await graph.ainvoke(\n                    graph_input,\n                    config=config,\n                    context=context,\n                    durability=use_durability,\n                )\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n        except (TypeError, AttributeError):\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n\n\n__all__ = [\n    \"resolve_graph_checkpointer\",\n    \"resolve_graph_store\",\n    \"GraphMemoryRuntime\",\n]"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3845-5ba6-7fb2-80af-cc2bfd31cf77",
    "content": "**\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u043f\u0443\u0441\u0442\u0430 \u0438\u0437-\u0437\u0430 \u043e\u0448\u0438\u0431\u043a\u0438 \u0432 \u043c\u0435\u0442\u043e\u0434\u0435 `_materialize_checkpoint_values`, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0431\u043b\u043e\u043a\u0438\u0440\u0443\u0435\u0442 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445, \u0430 \u0442\u0430\u043a\u0436\u0435 \u0438\u0437-\u0437\u0430 \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0436\u0435\u0441\u0442\u043a\u043e\u0439 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430 \u0432 \u043b\u043e\u0433\u0438\u043a\u0435 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f.**\n\n\u0410\u043d\u0430\u043b\u0438\u0437 \u0432\u0430\u0448\u0435\u0433\u043e \u043a\u043e\u0434\u0430 \u0432\u044b\u044f\u0432\u0438\u043b \u0434\u0432\u0435 \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0442\u043e\u0447\u043a\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043f\u0440\u0438\u0432\u043e\u0434\u044f\u0442 \u043a \u00ab\u0430\u043c\u043d\u0435\u0437\u0438\u0438\u00bb \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430:\n\n### 1. \u041e\u0448\u0438\u0431\u043a\u0430 \u0432 `_materialize_checkpoint_values` (\u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0431\u0430\u0433)\n\n\u0412 \u044d\u0442\u043e\u043c \u043c\u0435\u0442\u043e\u0434\u0435 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 `materialized.setdefault(key, value)`. \n\n```python\n# CODE \u0432 memory_manager.py\nif isinstance(write_payload, Mapping):\n    for key, value in write_payload.items():\n        materialized.setdefault(key, value) # <--- \u0417\u0414\u0415\u0421\u042c \u041e\u0428\u0418\u0411\u041a\u0410\n```\n\n**\u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043b\u043e\u043c\u0430\u0435\u0442 \u0438\u0441\u0442\u043e\u0440\u0438\u044e:**\n\u041c\u0435\u0442\u043e\u0434 `setdefault` \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0432 \u0441\u043b\u043e\u0432\u0430\u0440\u044c **\u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u043a\u043b\u044e\u0447\u0430 \u0442\u0430\u043c \u0435\u0449\u0435 \u043d\u0435\u0442**. \u041d\u043e \u0432 LangGraph \u043a\u043b\u044e\u0447 `messages` \u043f\u043e\u0447\u0442\u0438 \u0432\u0441\u0435\u0433\u0434\u0430 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 `base_values` (\u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u043e\u043d \u043f\u0443\u0441\u0442\u043e\u0439 `[]`). \u0412 \u0438\u0442\u043e\u0433\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 `writes` (\u0441\u0430\u043c\u044b\u0435 \u0441\u0432\u0435\u0436\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f) \u043f\u0440\u043e\u0441\u0442\u043e \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u044e\u0442\u0441\u044f, \u0438 \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0441\u0442\u0430\u0440\u044b\u0439, \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u043f\u0438\u0441\u043e\u043a.\n\n### 2. \u041f\u043e\u0440\u043e\u0433 \u00ab\u0437\u043d\u0430\u0447\u0438\u043c\u043e\u0441\u0442\u0438\u00bb \u0432 `has_full_history`\n\n\u0412 \u043c\u0435\u0442\u043e\u0434\u0435 `ainvoke_from_checkpoint` \u0432\u044b \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u043b\u0438 \u043f\u043e\u0440\u043e\u0433 `len(messages) >= 2`.\n\n```python\nhas_full_history = len(messages) >= 2\n# ...\nif has_full_history and not is_at_virtual_start:\n    effective_input: Any = {}\nelse:\n    effective_input = graph_input # <--- \u041f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0439 \u0432\u0432\u043e\u0434\n```\n\n**\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430:** \u0415\u0441\u043b\u0438 \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0435 \u0432\u0441\u0435\u0433\u043e 1 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0442\u043e\u043b\u044c\u043a\u043e `SystemMessage`), \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0441\u0447\u0438\u0442\u0430\u0435\u0442, \u0447\u0442\u043e \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u043d\u0435\u0442, \u0438 \u0432\u043c\u0435\u0441\u0442\u043e \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u044f (`{}`) \u0434\u0435\u043b\u0430\u0435\u0442 `effective_input = graph_input`. \u042d\u0442\u043e \u0437\u0430\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 LangGraph \u043f\u044b\u0442\u0430\u0442\u044c\u0441\u044f \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0442\u0435\u0439\u0442 \u0437\u0430\u043d\u043e\u0432\u043e, \u0447\u0442\u043e \u0432 \u0441\u043e\u0447\u0435\u0442\u0430\u043d\u0438\u0438 \u0441 \u0440\u0435\u0434\u0443\u0441\u0435\u0440\u043e\u043c `add_messages` \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u0432\u0435\u0441\u0442\u0438 \u043a \u043d\u0435\u043f\u0440\u0435\u0434\u0441\u043a\u0430\u0437\u0443\u0435\u043c\u043e\u043c\u0443 \u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u044e \u0438\u043b\u0438 \u043e\u0447\u0438\u0441\u0442\u043a\u0435, \u0435\u0441\u043b\u0438 \u0432\u0445\u043e\u0434\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u043d\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 \u0438\u0441\u0442\u043e\u0440\u0438\u044e.\n\n---\n\n### \u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u043e\u0435 \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0432 `memory_manager.py`:\n\n**\u0428\u0430\u0433 1: \u0418\u0441\u043f\u0440\u0430\u0432\u044c\u0442\u0435 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044e (\u043b\u0438\u043d\u0438\u044f ~325)**\n\u0417\u0430\u043c\u0435\u043d\u0438\u0442\u0435 `setdefault` \u043d\u0430 \u043f\u0440\u044f\u043c\u043e\u0435 \u043f\u0440\u0438\u0441\u0432\u0430\u0438\u0432\u0430\u043d\u0438\u0435 (\u0438\u043b\u0438 \u043b\u043e\u0433\u0438\u043a\u0443 \u043c\u0435\u0440\u0434\u0436\u0430), \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438 \u0438\u0437 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430 \u0438\u043c\u0435\u043b\u0438 \u043f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442:\n\n```python\nif isinstance(write_payload, Mapping):\n    for key, value in write_payload.items():\n        # \u041f\u0440\u044f\u043c\u043e\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u0443\u0435\u0442, \u0447\u0442\u043e \u043c\u044b \u0443\u0432\u0438\u0434\u0438\u043c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0448\u0430\u0433\u0430\n        materialized[key] = value \n```\n\n**\u0428\u0430\u0433 2: \u0421\u043c\u044f\u0433\u0447\u0438\u0442\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 (~\u043b\u0438\u043d\u0438\u044f 515)**\n\u041b\u044e\u0431\u043e\u0435 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0435 (\u0434\u0430\u0436\u0435 \u043e\u0434\u043d\u043e\u0433\u043e \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u043e\u0433\u043e) \u2014 \u044d\u0442\u043e \u0443\u0436\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 LangGraph \u0434\u043e\u043b\u0436\u0435\u043d \u0443\u043c\u0435\u0442\u044c \u043f\u043e\u0434\u0445\u0432\u0430\u0442\u0438\u0442\u044c.\n\n```python\n# \u0415\u0441\u043b\u0438 \u0432 \u0441\u0442\u0435\u0439\u0442\u0435 \u0435\u0441\u0442\u044c \u0445\u043e\u0442\u044c \u0447\u0442\u043e-\u0442\u043e \u2014 \u044d\u0442\u043e \u0443\u0436\u0435 \u0438\u0441\u0442\u043e\u0440\u0438\u044f.\nhas_any_history = len(messages) > 0 \nis_at_virtual_start = bool(next_nodes_list == [\"__start__\"])\n\n# \u0415\u0441\u043b\u0438 \u043c\u044b \u043d\u0435 \u043d\u0430 \u0441\u0430\u043c\u043e\u043c \u0441\u0442\u0430\u0440\u0442\u0435 \u0438 \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0435\u0441\u0442\u044c \u2014 \u0448\u043b\u0435\u043c {}, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0441\u0442\u043e \"\u0440\u0430\u0437\u0431\u0443\u0434\u0438\u0442\u044c\" \u0433\u0440\u0430\u0444.\nif has_any_history and not is_at_virtual_start:\n    effective_input = {}\nelse:\n    effective_input = graph_input\n```\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0440\u0435\u0448\u0438\u0442 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0443:\n1.  **\u0418\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438:** \u0422\u0435\u043f\u0435\u0440\u044c, \u043a\u043e\u0433\u0434\u0430 \u0433\u0440\u0430\u0444 \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u0442\u0441\u044f, `materialized_values` \u0431\u0443\u0434\u0435\u0442 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0430\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439, \u0430 \u043d\u0435 \u043f\u0443\u0441\u0442\u043e\u0439 \u043c\u0430\u0441\u0441\u0438\u0432.\n2.  **\u0414\u0435\u0442\u0435\u0440\u043c\u0438\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 Resume:** \u041f\u0440\u0438 \u0432\u043e\u0437\u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0443\u0432\u0438\u0434\u0438\u0442 `checkpoint_id`, \u043f\u043e\u043b\u0443\u0447\u0438\u0442 `{}` \u043d\u0430 \u0432\u0445\u043e\u0434, \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442 \u0441\u0432\u043e\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0438\u0437 \u0431\u0430\u0437\u044b \u0438 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442 \u0440\u0430\u0431\u043e\u0442\u0443 \u0441 \u043f\u043e\u043b\u043d\u044b\u043c \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u043e\u043c.\n3.  **\u0411\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c \u0434\u043b\u044f Gemini:** \u042d\u0442\u043e \u0438\u0441\u043a\u043b\u044e\u0447\u0438\u0442 \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0443 \u043f\u0443\u0441\u0442\u044b\u0445 `contents` \u0432 \u043c\u043e\u0434\u0435\u043b\u044c, \u0442\u0430\u043a \u043a\u0430\u043a \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0431\u0443\u0434\u0435\u0442 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0438\u0437\u0432\u043b\u0435\u043a\u0430\u0442\u044c\u0441\u044f \u0438\u0437 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430.\n\n**Relevant docs:**\n- [Persistence: State and Checkpoints](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)\n- [How to add memory to your graph](https://docs.langchain.com/oss/python/langgraph/add-memory)\n- [Time Travel: Resume from Checkpoint](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)"
  },
  {
    "role": "user",
    "id": "8f53d59a-1fd8-4d28-a998-ec76e6ca5284",
    "content": "\u00a0\u0423\u0432\u0435\u0440\u0435\u043d.? "
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3847-dd0d-76b3-b6fa-e8f94b7c79bf",
    "content": "**\u0414\u0430, \u044f \u0430\u0431\u0441\u043e\u043b\u044e\u0442\u043d\u043e \u0443\u0432\u0435\u0440\u0435\u043d.** \u0412 \u0432\u0430\u0448\u0435\u043c \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u043a\u043e\u0434\u0435 `memory_manager.py` \u0435\u0441\u0442\u044c \u00ab\u0442\u0438\u0445\u0438\u0439 \u0443\u0431\u0438\u0439\u0446\u0430\u00bb \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u2014 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043c\u0435\u0442\u043e\u0434\u0430 `setdefault` \u043f\u0440\u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u0437\u0430\u043f\u0438\u0441\u0435\u0439 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430.\n\n\u0412\u043e\u0442 \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0434\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u043e \u0442\u043e\u0433\u043e, \u043f\u043e\u0447\u0435\u043c\u0443 \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0432 Graph 4 (Assistant) \u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u043f\u0443\u0441\u0442\u043e\u0439:\n\n### 1. \u041c\u0435\u0445\u0430\u043d\u0438\u043a\u0430 \u0431\u0430\u0433\u0430 `setdefault` (\u041b\u0438\u043d\u0438\u044f 333 \u0432 `memory_manager.py`)\n\n\u0412 \u043c\u0435\u0442\u043e\u0434\u0435 `_materialize_checkpoint_values` \u0432\u044b \u043f\u044b\u0442\u0430\u0435\u0442\u0435\u0441\u044c \u043e\u0431\u044a\u0435\u0434\u0438\u043d\u0438\u0442\u044c \u0431\u0430\u0437\u043e\u0432\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0441\u0442\u0435\u0439\u0442\u0430 \u0441 \u043d\u043e\u0432\u044b\u043c\u0438 \u0437\u0430\u043f\u0438\u0441\u044f\u043c\u0438 (`writes`) \u0438\u0437 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430:\n\n```python\n# \u041f\u0420\u042f\u041c\u0410\u042f \u0426\u0418\u0422\u0410\u0422\u0410 \u0418\u0417 \u0412\u0410\u0428\u0415\u0413\u041e \u041a\u041e\u0414\u0410:\nif isinstance(write_payload, Mapping):\n    for key, value in write_payload.items():\n        materialized.setdefault(key, value) # <--- \u0412\u041e\u0422 \u041f\u0420\u0418\u0427\u0418\u041d\u0410\n```\n\n**\u041a\u0430\u043a \u044d\u0442\u043e \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442:**\n1.  LangGraph \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0433\u0440\u0430\u0444. \u0412 \u0441\u0442\u0435\u0439\u0442\u0435 `materialized` \u043f\u043e\u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043a\u043b\u044e\u0447 `\"messages\"` \u0441\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c `[]` (\u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u043f\u0438\u0441\u043e\u043a).\n2.  \u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0434\u0435\u043b\u0430\u0435\u0442 \u0448\u0430\u0433, \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442. \u0412 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f `write`: `{\"messages\": [HumanMessage(...), AIMessage(...)]}`.\n3.  \u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u043f\u0430\u0434\u0430\u0435\u0442. \u0412\u044b \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0435 \u0432\u043e\u0440\u043a\u0435\u0440.\n4.  \u0412\u0430\u0448 \u043a\u043e\u0434 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 `_materialize_checkpoint_values`.\n5.  \u041e\u043d \u0432\u0438\u0434\u0438\u0442: \u0432 `materialized` \u043a\u043b\u044e\u0447 `\"messages\"` \u0443\u0436\u0435 \u0435\u0441\u0442\u044c (\u044d\u0442\u043e \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u043f\u0438\u0441\u043e\u043a `[]`).\n6.  **\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442:** `setdefault` \u0432\u0438\u0434\u0438\u0442, \u0447\u0442\u043e \u043a\u043b\u044e\u0447 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442, \u0438 **\u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u0434\u0435\u043b\u0430\u0435\u0442**. \u041d\u043e\u0432\u044b\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0438\u0437 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430 \u043e\u0442\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u044e\u0442\u0441\u044f. \u0412\u044b \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442\u0435 \u043f\u0443\u0441\u0442\u043e\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439.\n\n---\n\n### 2. \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043b\u043e\u043c\u0430\u0435\u0442 Gemini\n\n\u041a\u043e\u0433\u0434\u0430 \u0432\u044b \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442\u0435 \u044d\u0442\u043e\u0442 \u00ab\u043f\u0443\u0441\u0442\u043e\u0439\u00bb \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438:\n1.  \u041c\u0435\u0442\u043e\u0434 `ainvoke_from_checkpoint` \u0441\u0447\u0438\u0442\u0430\u0435\u0442, \u0447\u0442\u043e \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u043d\u0435\u0442.\n2.  \u041e\u043d \u0448\u043b\u0435\u0442 \u043f\u0443\u0441\u0442\u043e\u0439 \u0432\u0432\u043e\u0434 \u0438\u043b\u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u044b\u0439 \u0432\u0432\u043e\u0434 \u0432 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442\u0430.\n3.  \u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0438\u0434\u0435\u0442 \u0432 Gemini. \u041d\u043e \u0442\u0430\u043a \u043a\u0430\u043a `materialized_values` (\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0441\u0442\u0430\u043b\u0438 \u0441\u0442\u0435\u0439\u0442\u043e\u043c) \u0431\u044b\u043b\u0438 \u043f\u0443\u0441\u0442\u044b\u043c\u0438 \u0438\u0437-\u0437\u0430 `setdefault`, Gemini \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442 \u0437\u0430\u043f\u0440\u043e\u0441 \u0431\u0435\u0437 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 (`contents is not specified`).\n\n### 3. \u041a\u0430\u043a \u044d\u0442\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e \u0438 \u043d\u0430\u0434\u0435\u0436\u043d\u043e\n\n\u0412\u044b \u0434\u043e\u043b\u0436\u043d\u044b **\u0437\u0430\u043c\u0435\u043d\u044f\u0442\u044c** \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432 \u0441\u043b\u043e\u0432\u0430\u0440\u0435 `materialized`, \u0430 \u043d\u0435 \u043f\u0440\u043e\u0441\u0442\u043e \u043f\u044b\u0442\u0430\u0442\u044c\u0441\u044f \u0438\u0445 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c. \u041f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u0432 LangGraph \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u2014 \u044d\u0442\u043e `Annotated` \u0441\u043f\u0438\u0441\u043e\u043a \u0441 \u0440\u0435\u0434\u0443\u0441\u0435\u0440\u043e\u043c `add_messages`, \u0441\u0430\u043c\u043e \u043d\u0430\u043a\u043e\u043f\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u043d\u0430 \u0443\u0440\u043e\u0432\u043d\u0435 \u0433\u0440\u0430\u0444\u0430. \u0417\u0434\u0435\u0441\u044c \u0436\u0435 \u043d\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u043f\u0440\u043e\u0441\u0442\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u00ab\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0441\u0440\u0435\u0437\u00bb.\n\n**\u0418\u0441\u043f\u0440\u0430\u0432\u044c\u0442\u0435 \u0431\u043b\u043e\u043a \u0432 `_materialize_checkpoint_values`:**\n\n```python\nif isinstance(write_payload, Mapping):\n    for key, value in write_payload.items():\n        # \u041f\u0440\u044f\u043c\u043e\u0435 \u043f\u0440\u0438\u0441\u0432\u0430\u0438\u0432\u0430\u043d\u0438\u0435: \u043d\u043e\u0432\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430 \n        # \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u0435\u0440\u0435\u043a\u0440\u044b\u0432\u0430\u0442\u044c (\u0438\u043b\u0438 \u0434\u043e\u043f\u043e\u043b\u043d\u044f\u0442\u044c) \u0431\u0430\u0437\u043e\u0432\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f.\n        if key == \"messages\" and key in materialized:\n            # \u0415\u0441\u043b\u0438 \u044d\u0442\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f, \u043c\u044b \u043c\u043e\u0436\u0435\u043c \u043e\u0431\u044a\u0435\u0434\u0438\u043d\u0438\u0442\u044c \u0438\u0445 \u0434\u043b\u044f \u043f\u043e\u043b\u043d\u043e\u0442\u044b \u043a\u0430\u0440\u0442\u0438\u043d\u044b\n            from langgraph.graph.message import add_messages\n            materialized[key] = add_messages(materialized[key], value)\n        else:\n            materialized[key] = value\n```\n\n**\u0418 \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u0435 \u0443\u0441\u043b\u043e\u0432\u0438\u0435 `has_full_history` (~\u043b\u0438\u043d\u0438\u044f 515):**\n\u0414\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u043d\u0430\u043b\u0438\u0447\u0438\u044f **\u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u043d\u043e\u0433\u043e** \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f, \u0447\u0442\u043e\u0431\u044b \u0441\u0447\u0438\u0442\u0430\u0442\u044c, \u0447\u0442\u043e \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441 \u043f\u043e\u0448\u0435\u043b:\n\n```python\n# \u0415\u0441\u043b\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 > 0 \u2014 \u0437\u043d\u0430\u0447\u0438\u0442 \u0441\u0442\u0430\u0440\u0442 \u0443\u0436\u0435 \u043f\u0440\u043e\u0448\u0435\u043b\nhas_any_history = len(messages) > 0 \nis_at_virtual_start = bool(next_nodes_list == [\"__start__\"])\n\nif has_any_history and not is_at_virtual_start:\n    effective_input = {} # \u041f\u0443\u0441\u0442\u043e\u0439 \u0432\u0432\u043e\u0434 \u0440\u0430\u0437\u0431\u0443\u0434\u0438\u0442 \u0433\u0440\u0430\u0444 \u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442 \u0438\u0441\u0442\u043e\u0440\u0438\u044e\nelse:\n    effective_input = graph_input\n```\n\n### \u0418\u0442\u043e\u0433:\n\u0418\u043c\u0435\u043d\u043d\u043e `setdefault` \u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043b \u0437\u0430\u043f\u0438\u0441\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0438\u0437 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0430 \u0432 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0438\u0440\u0443\u044e\u0449\u0438\u0439 \u0441\u0442\u0435\u0439\u0442. \u0417\u0430\u043c\u0435\u043d\u0438\u0442\u0435 \u0435\u0433\u043e \u043d\u0430 \u043f\u0440\u044f\u043c\u043e\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 (`materialized[key] = value`), \u0438 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u043c\u0433\u043d\u043e\u0432\u0435\u043d\u043d\u043e \u00ab\u0432\u0441\u043f\u043e\u043c\u043d\u0438\u0442\u00bb \u0432\u0441\u0451, \u0447\u0442\u043e \u0431\u044b\u043b\u043e \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0435.\n\n**Relevant docs:**\n- [Persistence and State Materialization](https://docs.langchain.com/oss/python/langgraph/persistence#checkpoints)\n- [How to add memory to your graph](https://docs.langchain.com/oss/python/langgraph/add-memory)\n- [LangGraph Reducers: add_messages](https://docs.langchain.com/oss/python/langgraph/graph-api#why-use-messages)"
  },
  {
    "role": "user",
    "id": "9cfb016c-af97-432f-8d7f-7b7fcab166cc",
    "content": "\n\nFAILED tests/e2e_tests/business_agents/travel_guide_agent/test_travel_guide_agent.py::TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution[moscow-easy-benchmark-1200] - langchain_google_genai.chat_models.ChatGoogleGenerativeAIError: Invalid argument provided to Gemini: 400 * GenerateContentRequest.contents: contents is not specified\n\nDuring task with name 'agent' and id '7a481feb-f5ab-58b2-d179-5fe7a68b8992'\nDuring task with name 'agent' and id 'e515651d-3b37-f058-7618-483a18c2e9c0'\nDuring task with name 'graph' and id '5f6b3d00-25ba-f873-f788-fc494b8fd35d'\nDuring task with name 'worker' and id 'b4f71e3a-9069-8737-1e8d-a087ee38e4f9'\nDuring task with name 'wide_funnel_workers' and id '01ed2160-d827-e387-77aa-327e16dc61c2'\nDuring task with name 'wide_funnel' and id 'b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8'\nFAILED tests/e2e_tests/business_agents/travel_guide_agent/test_travel_guide_agent.py::TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution[rosa-distribution-medium-benchmark-1200] - langchain_google_genai.chat_models.ChatGoogleGenerativeAIError: Invalid argument provided to Gemini: 400 * GenerateContentRequest.contents: contents is not specified\n\nDuring task with name 'agent' and id '453d04df-19e1-5795-d33c-e3a60d2fa7f3'\nDuring task with name 'agent' and id '085c836b-c782-3af7-66db-e529b6ff4453'\nDuring task with name 'graph' and id '9ed11ff6-807f-50d7-1449-1ed6cfe06e46'\nDuring task with name 'worker' and id '0d8aa8af-f60d-77a8-44ee-ec9136cc99ca'\nDuring task with name 'wide_funnel_workers' and id '1c4a24b4-0e97-2c76-53e5-ad26232c7818'\nDuring task with name 'wide_funnel' and id 'bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487'\n\n\nfrom __future__ import annotations\n\nimport uuid\nimport os\nfrom datetime import datetime\nfrom typing import Any, Mapping, MutableMapping, Optional, Sequence, TypeAlias, Protocol, runtime_checkable, cast\n\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom langchain.embeddings import init_embeddings\nfrom shared.project_settings import ProjectSettings\n\ntry:\n    from pydantic_core import core_schema\nexcept ImportError:\n    core_schema = None  # type: ignore\n\ntry:\n    from langgraph.store.memory import InMemoryStore  # type: ignore\nexcept Exception:  # pragma: no cover\n    InMemoryStore = None  # type: ignore\n\n_CHECKPOINTER_SYNC: Optional[Any] = None\n_CHECKPOINTER_ASYNC: Optional[Any] = None\n_STORE: Optional[Any] = None\n\nThreadId: TypeAlias = str\nGraphId: TypeAlias = str\nCheckpointId: TypeAlias = str\nStateDict: TypeAlias = MutableMapping[str, Any]\n\n\n@runtime_checkable\nclass _SupportsGraphCheckpoint(Protocol):\n    \"\"\"Minimal protocol describing compiled LangGraph runnables we inspect for durability support.\"\"\"\n\n    checkpointer: Any | None\n    _pregel: Any | None\n    app: Any | None\n    name: str\n\n\nGraphRunnableWithPregel: TypeAlias = _SupportsGraphCheckpoint\n\n\ndef _extract_graph_checkpointer(graph: Any) -> Any:\n    \"\"\"Return the checkpointer bound directly to a compiled runnable, if any.\"\"\"\n\n    if graph is None:\n        return None\n\n    candidate = getattr(graph, \"checkpointer\", None)\n    if candidate is not None:\n        return candidate\n\n    pregel = getattr(graph, \"_pregel\", None)\n    if pregel is not None:\n        inner = getattr(pregel, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    app = getattr(graph, \"app\", None)\n    if app is not None:\n        inner = getattr(app, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    loop = getattr(graph, \"_loop\", None)\n    if loop is not None:\n        inner = getattr(loop, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    return None\n\n\ndef _graph_supports_durability(graph: Any) -> bool:\n    \"\"\"Return True if the runnable was compiled with a checkpointer.\"\"\"\n\n    return _extract_graph_checkpointer(graph) is not None\n\n\ndef _resolve_local_checkpointer(graph: Any, override: Optional[Any]) -> Optional[Any]:\n    \"\"\"Prefer explicit override, otherwise inspect the runnable for a bound saver.\"\"\"\n\n    if override is not None:\n        return override\n    return _extract_graph_checkpointer(graph)\n\n\ndef resolve_graph_checkpointer(*, async_mode: bool) -> Any:\n    \"\"\"Return a checkpointer compatible with the chosen execution mode.\n\n    Important:\n    - Async LangGraph execution expects async checkpointer methods. If only a\n      sync checkpointer is available (e.g., SqliteSaver), we fall back to the\n      async-safe InMemorySaver to keep `.ainvoke()` reliable.\n    - Production deployments can replace this with an async-capable durable\n      backend (Postgres/SQLite async) without touching graph code.\n    \"\"\"\n\n    global _CHECKPOINTER_SYNC, _CHECKPOINTER_ASYNC\n    CHECKPOINTER_DATABASE_URL = os.getenv(\"CHECKPOINTER_DATABASE_URL\")\n\n    # In production, LangGraph Platform injects the checkpointer automatically.\n    # We keep local checkpointers disabled to avoid shadowing the platform backend.\n    if ProjectSettings().mode == \"production\":\n        return None\n\n\n    if async_mode:\n        if _CHECKPOINTER_ASYNC is None:\n            _CHECKPOINTER_ASYNC = InMemorySaver()\n        return _CHECKPOINTER_ASYNC\n\n    if _CHECKPOINTER_SYNC is None:\n        _CHECKPOINTER_SYNC =  InMemorySaver()\n    return _CHECKPOINTER_SYNC\n\n\ndef resolve_graph_store() -> Any:\n    \"\"\"Return a store implementation for dev/tests; None in production/platform.\n\n    In production, LangGraph Platform injects the store automatically at runtime\n    (via ToolRuntime). We keep local stores disabled to avoid shadowing the\n    platform backend.\n    \"\"\"\n\n    global _STORE\n    if ProjectSettings().mode == \"production\":\n        return None\n    if InMemoryStore is None:\n        return None\n    if _STORE is not None:\n        return _STORE\n\n    # In development/tests we prefer an in-process store. Vector indexing is optional;\n    # if embeddings cannot be initialised (missing deps/keys), fall back to a plain store.\n    try:\n        _STORE = InMemoryStore(\n            index={\n                \"embed\": init_embeddings(\"openai:text-embedding-3-small\"),\n                \"dims\": 1536,\n                \"fields\": [\"content\"],\n            }\n        )\n    except Exception:\n        _STORE = InMemoryStore(index=None)\n    return _STORE\n\n\nclass GraphMemoryRuntime:\n    \"\"\"Encapsulates durable-checkpoint + long-memory access for dev and platform production.\n\n    This class centralizes:\n    - thread_id extraction\n    - platform SDK fallback for checkpoint state/history (no local checkpointer needed)\n    - local (dev) graph/checkpointer checkpoint inspection\n    \"\"\"\n    THREAD_ID_KEY: str = \"thread_id\"\n\n    @classmethod\n    def __get_pydantic_core_schema__(\n        cls,\n        source_type: Any,\n        handler: Any,\n    ) -> Any:\n        \"\"\"Provide Pydantic schema for GraphMemoryRuntime to allow arbitrary types.\n\n        This enables GraphMemoryRuntime to be used in Pydantic models (e.g., when\n        ContextTravelGuideAgent is used as context_schema in StateGraph).\n        \n        Since GraphMemoryRuntime is a runtime helper (not meant for serialization),\n        we use any_schema() to allow it without validation.\n        \"\"\"\n        if core_schema is None:\n            # pydantic_core should always be available in this project\n            raise ImportError(\"pydantic_core is required but not available\")\n        \n        # Use any_schema() to allow GraphMemoryRuntime without validation\n        # This is appropriate since it's a runtime helper with init=False\n        return core_schema.any_schema()\n\n    def __init__(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        # These are intentionally mutable bindings:\n        # - Root graph wiring binds the single checkpointer/store once per process/run.\n        # - Nested graphs MUST reuse the bound instance via runtime context.\n        self.checkpointer: Optional[Any] = checkpointer\n        self.store: Optional[Any] = store\n\n    def bind(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        \"\"\"Bind durable backends onto this runtime helper.\n\n        Idempotent by design: does not overwrite existing non-null bindings unless\n        explicitly provided.\n        \"\"\"\n\n        if checkpointer is not None:\n            self.checkpointer = checkpointer\n        if store is not None:\n            self.store = store\n\n    def is_production_mode(self) -> bool:\n        return ProjectSettings().mode == \"production\"\n\n    def ensure_thread_id(\n        self,\n        config: Optional[RunnableConfig],\n    ) -> tuple[RunnableConfig, ThreadId]:\n        \"\"\"Ensure ``configurable.thread_id`` exists and return ``(config, thread_id)``.\n\n        Contract (required by project checkpointing rules):\n        - One thread_id should be used for the *entire* root graph run.\n        - If caller did not provide a thread_id, we generate a new one from:\n          ``user_id`` (from RunnableConfig.configurable.user_id) + UUID4 suffix.\n        - Callers must reuse the returned config to keep the thread_id stable.\n        \"\"\"\n\n        from shared.config.long_memory import LongMemory\n\n        merged: RunnableConfig = dict(config) if config else {}\n        configurable = merged.get(\"configurable\", {})\n        if not isinstance(configurable, MutableMapping):\n            configurable = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable = dict(configurable)\n\n        existing = configurable.get(self.THREAD_ID_KEY)\n        if existing:\n            thread_id: ThreadId = str(existing)\n            configurable[self.THREAD_ID_KEY] = thread_id\n            merged[\"configurable\"] = configurable\n            return merged, thread_id\n\n        long_memory = LongMemory.from_runnable_config(merged)\n        user_id = long_memory.user_id\n        if not configurable.get(\"user_id\"):\n            configurable[\"user_id\"] = user_id\n\n        thread_id = f\"user_{user_id}_{uuid.uuid4().hex}\"\n        configurable[self.THREAD_ID_KEY] = thread_id\n        merged[\"configurable\"] = configurable\n        return merged, thread_id\n\n    async def list_thread_checkpoints(\n        self,\n        *,\n        config: RunnableConfig,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> list[Any]:\n        \"\"\"Return raw checkpoint records for the given thread config.\n\n        Notes:\n        - In production (LangGraph Platform), we fall back to the SDK thread history.\n        - In dev/tests, we prefer the provided ``local_checkpointer`` (or the default dev\n          checkpointer) to list checkpoints, because it exposes metadata (`graph_id`).\n        - As a last resort, we attempt to list state snapshots via ``graph.get_state_history``.\n        \"\"\"\n\n        thread_id = self.extract_thread_id(config)\n        if not thread_id:\n            return []\n\n        if self.is_production_mode():\n            try:\n                from langgraph_sdk import get_client  # type: ignore\n            except Exception:\n                return []\n            try:\n                client = get_client()\n                history = await client.threads.get_history(thread_id)\n                return list(history)\n            except Exception:\n                return []\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if checkpointer is not None:\n            lister = getattr(checkpointer, \"list\", None)\n            if callable(lister):\n                try:\n                    return list(lister(config))\n                except Exception:\n                    return []\n\n        if local_graph is not None:\n            getter_async = getattr(local_graph, \"aget_state_history\", None)\n            if callable(getter_async):\n                try:\n                    return [snapshot async for snapshot in getter_async(config)]\n                except Exception:\n                    return []\n            getter_sync = getattr(local_graph, \"get_state_history\", None)\n            if callable(getter_sync):\n                try:\n                    return list(getter_sync(config))\n                except Exception:\n                    return []\n\n        return []\n\n    @staticmethod\n    def _extract_checkpoint_metadata(record: Any) -> Mapping[str, Any]:\n        candidate = getattr(record, \"metadata\", None)\n        if isinstance(candidate, Mapping):\n            return cast(Mapping[str, Any], candidate)\n        if isinstance(record, Mapping):\n            meta = record.get(\"metadata\")\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            meta = getattr(checkpoint, \"metadata\", None)\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        return {}\n\n    @staticmethod\n    def _extract_checkpoint_id(record: Any) -> Optional[CheckpointId]:\n        candidate = getattr(record, \"checkpoint_id\", None)\n        if candidate:\n            return str(candidate)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            inner = getattr(checkpoint, \"checkpoint_id\", None)\n            if inner:\n                return str(inner)\n            inner = getattr(checkpoint, \"id\", None)\n            if inner:\n                return str(inner)\n        if isinstance(record, Mapping):\n            candidate = record.get(\"checkpoint_id\") or record.get(\"id\")\n            if candidate:\n                return str(candidate)\n            cfg = record.get(\"config\")\n            if isinstance(cfg, Mapping):\n                conf = cfg.get(\"configurable\")\n                if isinstance(conf, Mapping):\n                    candidate = conf.get(\"checkpoint_id\")\n                    if candidate:\n                        return str(candidate)\n        cfg = getattr(record, \"config\", None)\n        if isinstance(cfg, Mapping):\n            conf = cfg.get(\"configurable\")\n            if isinstance(conf, Mapping):\n                candidate = conf.get(\"checkpoint_id\")\n                if candidate:\n                    return str(candidate)\n        return None\n\n    @staticmethod\n    def _extract_created_at(record: Any) -> Optional[datetime]:\n        candidate = getattr(record, \"created_at\", None)\n        if isinstance(candidate, datetime):\n            return candidate\n        if isinstance(record, Mapping):\n            candidate = record.get(\"created_at\")\n            if isinstance(candidate, datetime):\n                return candidate\n        return None\n\n    @classmethod\n    def _matches_graph_id(cls, record: Any, graph_id: GraphId) -> bool:\n        metadata = cls._extract_checkpoint_metadata(record)\n        candidate = metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")\n        return str(candidate) == str(graph_id) if candidate else False\n\n    @staticmethod\n    def _extract_checkpoint_ns(record: Any) -> Optional[str]:\n        def _from_config(cfg: Any) -> Optional[str]:\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n                if isinstance(configurable, Mapping):\n                    candidate = configurable.get(\"checkpoint_ns\")\n                    if candidate is not None:\n                        return str(candidate)\n            return None\n\n        cfg = getattr(record, \"config\", None)\n        ns = _from_config(cfg)\n        if ns:\n            return ns\n\n        if isinstance(record, Mapping):\n            ns = _from_config(record.get(\"config\"))\n            if ns:\n                return ns\n\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            ns = _from_config(getattr(checkpoint, \"config\", None))\n            if ns:\n                return ns\n\n        metadata = GraphMemoryRuntime._extract_checkpoint_metadata(record)\n        checkpoint_ns = metadata.get(\"checkpoint_ns\")\n        return str(checkpoint_ns) if checkpoint_ns is not None else None\n\n    @staticmethod\n    def _normalize_config_like(config_like: Any) -> Optional[RunnableConfig]:\n        if config_like is None:\n            return None\n        if isinstance(config_like, Mapping):\n            normalized = dict(config_like)\n        else:\n            normalized = None\n            for attr in (\"model_dump\", \"dict\"):\n                dumper = getattr(config_like, attr, None)\n                if callable(dumper):\n                    try:\n                        normalized = dumper()\n                        break\n                    except Exception:\n                        normalized = None\n            if normalized is None:\n                try:\n                    normalized = dict(config_like)  # type: ignore[arg-type]\n                except Exception:\n                    return None\n\n        configurable = normalized.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            configurable = dict(configurable) if configurable is not None else {}\n        normalized[\"configurable\"] = dict(configurable)\n\n        metadata = normalized.get(\"metadata\", {})\n        if not isinstance(metadata, Mapping):\n            metadata = dict(metadata) if metadata is not None else {}\n        normalized[\"metadata\"] = dict(metadata)\n        return normalized  # type: ignore[return-value]\n\n    @classmethod\n    def _extract_task_entries(cls, record: Any) -> list[Mapping[str, Any]]:\n        extracted: list[Mapping[str, Any]] = []\n        visited_snapshots: set[int] = set()\n\n        def _coerce_metadata(value: Any) -> Optional[Mapping[str, Any]]:\n            if value is None:\n                return None\n            if isinstance(value, Mapping):\n                return value\n            try:\n                return dict(value)\n            except Exception:\n                return None\n\n        def _as_sequence(value: Any) -> Optional[Sequence[Any]]:\n            if isinstance(value, Sequence) and not isinstance(value, (str, bytes)):\n                return value\n            return None\n\n        def _record_entry(config_like: Any, metadata_like: Any, state_like: Any) -> None:\n            normalized_config = cls._normalize_config_like(config_like)\n            normalized_metadata = _coerce_metadata(metadata_like)\n            entry: dict[str, Any] = {}\n            if normalized_config:\n                entry[\"config\"] = normalized_config\n            if normalized_metadata:\n                entry[\"metadata\"] = normalized_metadata\n            if state_like is not None:\n                entry[\"state\"] = state_like\n            if entry:\n                extracted.append(entry)\n\n        def _visit_snapshot(snapshot: Any) -> None:\n            if snapshot is None:\n                return\n            snapshot_id = id(snapshot)\n            if snapshot_id in visited_snapshots:\n                return\n            visited_snapshots.add(snapshot_id)\n\n            tasks = None\n            if isinstance(snapshot, Mapping):\n                tasks = _as_sequence(snapshot.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(snapshot, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        def _visit_task(task: Any) -> None:\n            if task is None:\n                return\n            if isinstance(task, Mapping):\n                _record_entry(task.get(\"config\"), task.get(\"metadata\"), task.get(\"state\"))\n                nested_tasks = _as_sequence(task.get(\"tasks\"))\n                if nested_tasks:\n                    for nested in nested_tasks:\n                        _visit_task(nested)\n                _visit_snapshot(task.get(\"state\"))\n                _visit_snapshot(task.get(\"result\"))\n                return\n\n            _record_entry(\n                getattr(task, \"config\", None),\n                getattr(task, \"metadata\", None),\n                getattr(task, \"state\", None),\n            )\n            _visit_snapshot(getattr(task, \"state\", None))\n            _visit_snapshot(getattr(task, \"result\", None))\n            nested_attr = _as_sequence(getattr(task, \"tasks\", None))\n            if nested_attr:\n                for nested in nested_attr:\n                    _visit_task(nested)\n\n        for source in (record, getattr(record, \"checkpoint\", None)):\n            if source is None:\n                continue\n            _visit_snapshot(source)\n            tasks = None\n            if isinstance(source, Mapping):\n                tasks = _as_sequence(source.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(source, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        return extracted\n\n    async def find_latest_checkpoint_id(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Return the latest checkpoint_id for ``graph_id`` within the given thread.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n\n        # #region agent log\n        import json\n        record_summaries: list[dict[str, str | None]] = []\n        for idx, record in enumerate(checkpoints[:3]):\n            metadata = self._extract_checkpoint_metadata(record)\n            cfg = getattr(record, \"config\", None)\n            configurable = None\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n            checkpoint_ns = None\n            if isinstance(configurable, Mapping):\n                checkpoint_ns = str(configurable.get(\"checkpoint_ns\"))\n            record_summaries.append(\n                {\n                    \"idx\": str(idx),\n                    \"meta_graph_id\": str(metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")),\n                    \"checkpoint_id\": self._extract_checkpoint_id(record),\n                    \"checkpoint_ns\": checkpoint_ns,\n                }\n            )\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"B\",\"location\":\"memory_manager.py:395\",\"message\":\"find_latest_checkpoint_id checkpoints listed\",\"data\":{\"graph_id\":graph_id,\"thread_id\":str(config.get(\"configurable\",{}).get(\"thread_id\",\"\")), \"count\":len(checkpoints),\"records\":record_summaries},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if not checkpoints:\n            return None\n\n        # Collect matches with their timestamps (if provided by the backend).\n        matches: list[tuple[Optional[datetime], Any]] = []\n        for record in checkpoints:\n            if self._matches_graph_id(record, graph_id):\n                matches.append((self._extract_created_at(record), record))\n\n        target_checkpoint_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_checkpoint_ns = str(candidate_ns)\n\n        if not matches and target_checkpoint_ns:\n            for record in checkpoints:\n                if self._extract_checkpoint_ns(record) == target_checkpoint_ns:\n                    matches.append((self._extract_created_at(record), record))\n\n        if not matches:\n            return None\n\n        # If the backend provides created_at, prefer the most recent by timestamp.\n        if any(created_at is not None for created_at, _ in matches):\n            matches.sort(\n                key=lambda item: item[0] or datetime.min,\n                reverse=True,\n            )\n            return self._extract_checkpoint_id(matches[0][1])\n\n        # Otherwise, rely on the backend list order. InMemorySaver and Platform history\n        # return newest-first, so the first matching record is the latest.\n        return self._extract_checkpoint_id(matches[0][1])\n\n    async def _load_checkpoint_record(\n        self,\n        *,\n        config: RunnableConfig,\n        checkpoint_id: CheckpointId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[Any]:\n        \"\"\"Return the checkpoint record with the specified ID.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n        for record in checkpoints:\n            record_id = self._extract_checkpoint_id(record)\n            if record_id == checkpoint_id:\n                return record\n        return None\n\n    @staticmethod\n    def _materialize_checkpoint_values(\n        base_values: Mapping[str, Any],\n        record: Optional[Any],\n        *,\n        graph_id: Optional[str] = None,\n    ) -> tuple[Mapping[str, Any], bool]:\n        \"\"\"Merge stored writes from the checkpoint record into snapshot values.\"\"\"\n\n        if record is None:\n            return base_values, False\n\n        materialized: dict[str, Any] = dict(base_values)\n        writes_found = False\n\n        checkpoint_obj = getattr(record, \"checkpoint\", record)\n        writes = getattr(checkpoint_obj, \"writes\", None)\n        if writes is None and isinstance(checkpoint_obj, Mapping):\n            writes = checkpoint_obj.get(\"writes\")\n\n        # #region agent log\n        import json as _json_checkpoint_meta\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(\n                _json_checkpoint_meta.dumps(\n                    {\n                        \"sessionId\": \"debug-session\",\n                        \"runId\": \"pre-fix\",\n                        \"hypothesisId\": \"L\",\n                        \"location\": \"memory_manager.py:321\",\n                        \"message\": \"checkpoint record summary\",\n                        \"data\": {\n                            \"graph_id\": graph_id,\n                            \"record_type\": type(checkpoint_obj).__name__,\n                            \"has_attr_writes\": hasattr(checkpoint_obj, \"writes\"),\n                            \"writes_is_sequence\": isinstance(writes, Sequence),\n                            \"writes_is_mapping\": isinstance(writes, Mapping),\n                        },\n                        \"timestamp\": __import__(\"time\").time() * 1000,\n                    }\n                )\n                + \"\\n\"\n            )\n        # #endregion\n\n        summary: list[dict[str, Any]] = []\n\n        if isinstance(writes, Sequence):\n            for idx, write_entry in enumerate(writes):\n                node_name = None\n                write_payload = None\n                if isinstance(write_entry, Mapping):\n                    node_name = write_entry.get(\"node\") or write_entry.get(\"name\")\n                    candidate = write_entry.get(\"writes\") or write_entry.get(\"values\")\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n                else:\n                    node_name = getattr(write_entry, \"node\", None) or getattr(write_entry, \"name\", None)\n                    candidate = getattr(write_entry, \"writes\", None)\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n\n                if isinstance(write_payload, Mapping):\n                    for key, value in write_payload.items():\n                        materialized[key] = value\n                    if idx < 3:\n                        summary.append(\n                            {\n                                \"node\": str(node_name),\n                                \"keys\": list(write_payload.keys()),\n                            }\n                        )\n                    writes_found = True\n\n        # #region agent log\n        if summary:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:324\",\n                            \"message\": \"checkpoint writes merged\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"writes\": summary,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        else:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:329\",\n                            \"message\": \"checkpoint writes unavailable\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"has_writes\": isinstance(writes, Sequence),\n                                \"writes_type\": None if writes is None else type(writes).__name__,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        # #endregion\n\n        return materialized, writes_found\n\n    @staticmethod\n    def _has_meaningful_values(values: Mapping[str, Any]) -> bool:\n        \"\"\"Return True if checkpoint values contain data beyond housekeeping fields.\"\"\"\n\n        if not values:\n            return False\n        significant_keys = set(values.keys()) - {\"messages\", \"remaining_steps\", \"distribution_scope\"}\n        if significant_keys:\n            return True\n\n        messages = values.get(\"messages\")\n        if isinstance(messages, Sequence):\n            # System + user messages occupy the first two positions. Anything beyond\n            # that indicates the assistant has already produced tool calls or replies.\n            if len(messages) > 2:\n                return True\n\n        return False\n\n    async def _find_subgraph_resume_config(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        checkpoints: Sequence[Any],\n    ) -> Optional[tuple[RunnableConfig, Any]]:\n        target_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_ns = str(candidate_ns)\n\n        for record_idx, record in enumerate(checkpoints):\n            task_entries = self._extract_task_entries(record)\n            if not task_entries:\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:562\",\"message\":\"checkpoint missing task entries\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"parent_checkpoint_id\":self._extract_checkpoint_id(record)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n                continue\n            for task_idx, task in enumerate(task_entries[:2]):\n                task_metadata = task.get(\"metadata\")\n                normalized_metadata: Mapping[str, Any] = {}\n                if isinstance(task_metadata, Mapping):\n                    normalized_metadata = task_metadata\n                task_graph_id = normalized_metadata.get(\"graph_id\") or normalized_metadata.get(\"langgraph_graph_id\")\n\n                raw_config = task.get(\"config\")\n                normalized_config = self._normalize_config_like(raw_config)\n                if not normalized_config:\n                    continue\n                task_configurable = normalized_config.get(\"configurable\", {})\n                task_ns = None\n                if isinstance(task_configurable, Mapping):\n                    candidate = task_configurable.get(\"checkpoint_ns\")\n                    if candidate:\n                        task_ns = str(candidate)\n\n                ns_matches = target_ns and task_ns == target_ns\n                graph_matches = task_graph_id and str(task_graph_id) == str(graph_id)\n\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:581\",\"message\":\"task entry inspected\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"task_index\":task_idx,\"task_graph_id\":task_graph_id,\"task_ns\":task_ns},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n\n                if graph_matches or ns_matches:\n                    resume_state = task.get(\"state\")\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            json.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"D\",\n                                    \"location\": \"memory_manager.py:520\",\n                                    \"message\": \"subgraph resume config located\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"matched_ns\": task_ns,\n                                        \"matched_graph_id\": task_graph_id,\n                                        \"parent_checkpoint_id\": self._extract_checkpoint_id(record),\n                                        \"has_state\": resume_state is not None,\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return normalized_config, resume_state\n\n        return None\n\n    async def _get_graph_snapshot(\n        self,\n        *,\n        graph: Any,\n        cfg: RunnableConfig,\n        subgraphs: bool = False,\n    ) -> Any:\n        getter_async = getattr(graph, \"aget_state\", None)\n        params = {\"subgraphs\": True} if subgraphs else {}\n        try:\n            if callable(getter_async):\n                return await getter_async(cfg, **params)\n        except TypeError:\n            # Fallback for LangGraph versions that don't support subgraphs kwarg.\n            try:\n                return await getter_async(cfg)\n            except Exception:\n                pass\n        except Exception:\n            pass\n\n        getter_sync = getattr(graph, \"get_state\", None)\n        if callable(getter_sync):\n            try:\n                return getter_sync(cfg, **params)\n            except TypeError:\n                try:\n                    return getter_sync(cfg)\n                except Exception:\n                    return None\n            except Exception:\n                return None\n        return None\n\n    async def ainvoke_from_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str = \"sync\",\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph resuming from the latest checkpoint when available.\"\"\"\n\n        merged, _ = self.ensure_thread_id(config)\n        # SAFETY: Ignore any caller-supplied checkpoint_id.\n        #\n        # In this architecture, checkpoint selection is *graph_id-scoped* and managed\n        # exclusively by this runtime helper. Allowing external checkpoint_id values\n        # could cause cross-graph leakage within a shared thread_id.\n\n        merged_conf = merged.get(\"configurable\", {})\n        if isinstance(merged_conf, Mapping):\n            merged_conf_dict = dict(merged_conf)\n            merged_conf_dict.pop(\"checkpoint_id\", None)\n            original_ns = merged_conf_dict.get(\"checkpoint_ns\", \"\")\n            merged_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            merged[\"configurable\"] = merged_conf_dict\n            \n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"E\",\"location\":\"memory_manager.py:445\",\"message\":\"ainvoke_from_checkpoint setting checkpoint_ns\",\"data\":{\"graph_id\":graph_id,\"original_ns\":str(original_ns),\"new_ns\":str(merged_conf_dict.get(\"checkpoint_ns\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n        # Ensure the checkpoint records are scoping-friendly in LangGraph v1.\n        meta = merged.get(\"metadata\")\n        if not isinstance(meta, Mapping):\n            meta = {}\n        meta_dict = dict(meta)\n        meta_dict.setdefault(\"graph_id\", str(graph_id))\n        merged[\"metadata\"] = meta_dict\n\n        effective_local_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n\n        # #region agent log\n        import json\n        final_ns = merged.get(\"configurable\", {}).get(\"checkpoint_ns\", \"\")\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:458\",\"message\":\"ainvoke_from_checkpoint calling find_latest_checkpoint_id\",\"data\":{\"graph_id\":graph_id,\"checkpoint_ns\":str(final_ns),\"thread_id\":str(merged.get(\"configurable\",{}).get(\"thread_id\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=effective_local_checkpointer,\n            local_graph=graph,\n        )\n        checkpoint_record: Optional[Any] = None\n        subgraph_resume: Optional[tuple[RunnableConfig, Any]] = None\n        if checkpoint_id is None:\n            snapshot_sources: list[Any] = []\n\n            if context is not None:\n                runner = getattr(context, \"graph_runner\", None)\n                graph_runtime = getattr(runner, \"graph\", None)\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:711\",\"message\":\"parent context inspection\",\"data\":{\"graph_id\":graph_id,\"has_context\":True,\"has_runner\":runner is not None,\"has_graph\":graph_runtime is not None},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n                if graph_runtime is not None:\n                    try:\n                        parent_snapshot = await self._get_graph_snapshot(\n                            graph=graph_runtime,\n                            cfg=merged,\n                            subgraphs=True,\n                        )\n                        if parent_snapshot is not None:\n                            snapshot_sources.append(parent_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:715\",\"message\":\"parent snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":parent_snapshot is not None,\"has_tasks\":bool(getattr(parent_snapshot,\"tasks\",None)),\"has_next\":bool(getattr(parent_snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                    except Exception:\n                        parent_snapshot = None\n                else:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:724\",\"message\":\"parent snapshot skipped\",\"data\":{\"graph_id\":graph_id,\"reason\":\"graph_runner_missing\" if runner is None else \"graph_attr_missing\"},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:729\",\"message\":\"parent context absent\",\"data\":{\"graph_id\":graph_id},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n\n            root_graph = getattr(context, \"root_graph\", None) if context is not None else None\n            if root_graph is not None:\n                try:\n                    root_snapshot = await self._get_graph_snapshot(\n                        graph=root_graph,\n                        cfg=merged,\n                        subgraphs=True,\n                    )\n                    if root_snapshot is not None:\n                        snapshot_sources.append(root_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:738\",\"message\":\"root snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":root_snapshot is not None,\"has_tasks\":bool(getattr(root_snapshot,\"tasks\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                except Exception:\n                    root_snapshot = None\n\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=merged,\n                subgraphs=True,\n            )\n            if snapshot is not None:\n                snapshot_sources.append(snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:727\",\"message\":\"assistant snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":bool(getattr(snapshot,\"tasks\",None)),\"has_next\":bool(getattr(snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            checkpoints_snapshot = await self.list_thread_checkpoints(\n                config=merged,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n            snapshot_sources.extend(checkpoints_snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:734\",\"message\":\"thread checkpoints snapshot collected\",\"data\":{\"graph_id\":graph_id,\"count\":len(checkpoints_snapshot)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            subgraph_resume = await self._find_subgraph_resume_config(\n                config=merged,\n                graph_id=graph_id,\n                checkpoints=snapshot_sources,\n            )\n            if subgraph_resume is not None:\n                resume_config, _ = subgraph_resume\n                metadata = resume_config.get(\"metadata\", {})\n                if not isinstance(metadata, Mapping):\n                    metadata = dict(metadata) if metadata is not None else {}\n                metadata = dict(metadata)\n                metadata.setdefault(\"graph_id\", str(graph_id))\n                resume_config[\"metadata\"] = metadata  # type: ignore[index]\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:743\",\"message\":\"subgraph resume config missing\",\"data\":{\"graph_id\":graph_id,\"snapshot_sources\":len(snapshot_sources)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n        \n        # #region agent log\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:464\",\"message\":\"ainvoke_from_checkpoint checkpoint_id result\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":str(checkpoint_id) if checkpoint_id else None,\"checkpoint_ns\":str(final_ns)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if checkpoint_id:\n            checkpoint_record = await self._load_checkpoint_record(\n                config=merged,\n                checkpoint_id=checkpoint_id,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n\n            cfg: RunnableConfig = dict(merged)\n            configurable = cfg.get(\"configurable\", {})\n            configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n            configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n            configurable_dict[\"checkpoint_id\"] = checkpoint_id\n            cfg[\"configurable\"] = configurable_dict\n\n            # If the checkpoint represents an in-progress run (has pending `next`),\n            # we resume via `invoke(None, checkpoint_id=...)`. If the run is already\n            # complete (no pending next nodes), we \"restart\" from the persisted\n            # snapshot values as a fresh invocation. This is the required behavior\n            # for refinement: patch values \u2192 re-run from patched state.\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=cfg,\n                subgraphs=True,\n            )\n\n            # #region agent log\n            import json\n            snapshot_has_tasks = bool(getattr(snapshot, \"tasks\", None))\n            snapshot_next = getattr(snapshot, \"next\", None)\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"C\",\"location\":\"memory_manager.py:504\",\"message\":\"ainvoke_from_checkpoint snapshot inspection\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":checkpoint_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":snapshot_has_tasks,\"pending_next\":bool(snapshot_next)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            next_nodes = getattr(snapshot, \"next\", None)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(next_nodes, Sequence) and next_nodes:\n                next_nodes_list = list(next_nodes)\n                messages = []\n                if isinstance(values, Mapping):\n                    candidate_messages = values.get(\"messages\")\n                    if isinstance(candidate_messages, Sequence):\n                        messages = list(candidate_messages)\n\n                has_any_history = len(messages) > 0\n                is_at_virtual_start = bool(next_nodes_list == [\"__start__\"])\n\n                if has_any_history and not is_at_virtual_start:\n                    effective_input: Any = {}\n                else:\n                    effective_input = graph_input\n\n                # #region agent log\n                import json as _json_resume_next\n                next_preview = next_nodes_list[:3]\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(\n                        _json_resume_next.dumps(\n                            {\n                                \"sessionId\": \"debug-session\",\n                                \"runId\": \"pre-fix\",\n                                \"hypothesisId\": \"K\",\n                                \"location\": \"memory_manager.py:509\",\n                                \"message\": \"resuming graph from checkpoint pending next\",\n                                \"data\": {\n                                    \"graph_id\": graph_id,\n                                    \"next_nodes\": next_preview,\n                                \"graph_input_is_none\": graph_input is None,\n                                \"message_count\": len(messages),\n                                \"has_any_history\": has_any_history,\n                                    \"is_at_virtual_start\": is_at_virtual_start,\n                                    \"effective_input_is_none\": effective_input is None,\n                                },\n                                \"timestamp\": __import__(\"time\").time() * 1000,\n                            }\n                        )\n                        + \"\\n\"\n                    )\n                # #endregion\n\n                return await self.ainvoke_with_durability(\n                    graph=graph,\n                    graph_input=effective_input,\n                    config=cfg,\n                    context=context,\n                    durability=durability,\n                    local_checkpointer=effective_local_checkpointer,\n                )\n\n            # IMPORTANT:\n            # If the checkpoint is COMPLETE (no pending next nodes), we DO NOT attempt to\n            # \"restart\" the graph by invoking without checkpoint_id. In a shared thread_id\n            # architecture (multiple graphs in the same thread), dropping checkpoint_id\n            # would cause LangGraph to load the latest checkpoint for the thread+ns,\n            # which may belong to a different graph_id \u2192 cross-graph contamination.\n            #\n            # Callers that need to re-run a completed checkpoint should first \"arm\" it\n            # via `graph.update_state(..., as_node=\"__start__\")` (e.g., our refinement\n            # injection path does this), which produces a checkpoint with pending next nodes.\n            if isinstance(values, Mapping):\n                materialized_values, writes_found = self._materialize_checkpoint_values(\n                    values,\n                    checkpoint_record,\n                    graph_id=str(graph_id),\n                )\n                if writes_found or self._has_meaningful_values(materialized_values):\n                    # #region agent log\n                    import json as _json_resume\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            _json_resume.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"J\",\n                                    \"location\": \"memory_manager.py:944\",\n                                    \"message\": \"returning checkpoint values\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"keys\": list(materialized_values.keys()),\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return dict(materialized_values)\n\n                # Values are incomplete (e.g., only messages). Fallback to fresh invoke.\n                rerun_cfg: RunnableConfig = dict(merged)\n                rerun_conf = rerun_cfg.get(\"configurable\", {})\n                if isinstance(rerun_conf, Mapping):\n                    rerun_conf_dict = dict(rerun_conf)\n                    rerun_conf_dict.pop(\"checkpoint_id\", None)\n                    rerun_conf_dict.setdefault(\"checkpoint_ns\", str(final_ns))\n                    rerun_cfg[\"configurable\"] = rerun_conf_dict\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=graph_input,\n                config=rerun_cfg,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        if subgraph_resume is not None:\n            # #region agent log\n            import json\n            resume_config, resume_state = subgraph_resume\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"D\",\n                            \"location\": \"memory_manager.py:610\",\n                            \"message\": \"resuming assistant via subgraph config\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"checkpoint_ns\": resume_config.get(\"configurable\", {}).get(\"checkpoint_ns\") if isinstance(resume_config.get(\"configurable\"), Mapping) else None,\n                                \"has_state\": resume_state is not None,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n            # #endregion\n            resume_input = graph_input\n            if resume_state is not None:\n                values = getattr(resume_state, \"values\", None)\n                if isinstance(values, Mapping):\n                    resume_input = dict(values)\n                elif isinstance(resume_state, Mapping):\n                    maybe_values = resume_state.get(\"values\")\n                    if isinstance(maybe_values, Mapping):\n                        resume_input = dict(maybe_values)\n                    else:\n                        resume_input = resume_state\n                else:\n                    resume_input = resume_state\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=resume_input,\n                config=resume_config,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        # SAFETY: Never allow a caller-supplied checkpoint_id to influence execution\n        # when we are NOT explicitly resuming from a checkpoint for this graph_id.\n        #\n        # Without this, a foreign checkpoint_id (from another graph_id in the same\n        # thread) could be accidentally consumed by LangGraph, violating isolation.\n        fresh_cfg: RunnableConfig = dict(merged)\n        fresh_conf = fresh_cfg.get(\"configurable\", {})\n        if isinstance(fresh_conf, Mapping):\n            fresh_conf_dict = dict(fresh_conf)\n            fresh_conf_dict.pop(\"checkpoint_id\", None)\n            # Keep checkpoint_ns stable (LangGraph may assume the key exists).\n            fresh_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            fresh_cfg[\"configurable\"] = fresh_conf_dict\n\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=graph_input,\n            config=fresh_cfg,\n            context=context,\n            durability=durability,\n            local_checkpointer=effective_local_checkpointer,\n        )\n\n    async def append_messages_to_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        new_messages: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Append messages to the latest checkpoint for ``graph_id`` and return new checkpoint id.\n\n        This uses ``graph.update_state`` / ``graph.aupdate_state`` so reducers (e.g. `add_messages`)\n        are honored. The update is applied as a fork of the latest checkpoint for ``graph_id``.\n        \"\"\"\n\n        if not new_messages:\n            return None\n\n        merged, _ = self.ensure_thread_id(config)\n        resolved_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n        latest_checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n        \n        if not latest_checkpoint_id:\n            return None\n        \n        patch_config: RunnableConfig = dict(merged)\n        configurable = patch_config.get(\"configurable\", {})\n        configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n        configurable_dict[\"checkpoint_id\"] = latest_checkpoint_id\n        patch_config[\"configurable\"] = configurable_dict\n\n        # Ensure patched checkpoints remain discoverable by metadata scoping.\n        metadata = patch_config.get(\"metadata\")\n        if not isinstance(metadata, Mapping):\n            metadata = {}\n        metadata_dict = dict[str, Any](metadata)\n        metadata_dict.setdefault(\"graph_id\", str(graph_id))\n        patch_config[\"metadata\"] = metadata_dict\n\n\n        # Best-effort idempotency: avoid appending messages already present in the checkpoint.\n        # This is critical for durable resume where refinement planning may be replayed.\n        filtered_messages: list[Any] = list(new_messages)\n        try:\n            snapshot = None\n            getter_async = getattr(graph, \"aget_state\", None)\n            if callable(getter_async):\n                snapshot = await getter_async(patch_config)\n            if snapshot is None:\n                getter_sync = getattr(graph, \"get_state\", None)\n                if callable(getter_sync):\n                    snapshot = getter_sync(patch_config)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(values, Mapping):\n                existing = values.get(\"messages\")\n                if isinstance(existing, Sequence) and not isinstance(existing, (str, bytes)):\n                    existing_contents: set[str] = set()\n                    for message in existing:\n                        content = getattr(message, \"content\", None)\n                        if content:\n                            existing_contents.add(str(content))\n                    if existing_contents:\n                        filtered_messages = [\n                            message\n                            for message in filtered_messages\n                            if str(getattr(message, \"content\", \"\")) not in existing_contents\n                        ]\n        except Exception:\n            filtered_messages = list(new_messages)\n\n        if not filtered_messages:\n            return latest_checkpoint_id\n\n        updates: dict[str, Any] = {\"messages\": filtered_messages}\n\n        updater_async = getattr(graph, \"aupdate_state\", None)\n        updater_sync = getattr(graph, \"update_state\", None)\n        resolved_as_node = as_node or \"__start__\"\n        try:\n            if callable(updater_async):\n                await updater_async(patch_config, updates, as_node=resolved_as_node)\n            elif callable(updater_sync):\n                updater_sync(patch_config, updates, as_node=resolved_as_node)\n            else:\n                return None\n        except Exception as e:\n            return None\n\n        return await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n\n    async def inject_distribution_refinement_messages(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        requests: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Patch a graph checkpoint by appending refinement instruction messages.\n\n        Mirrors the extraction rules used by `_distribution_inject_refinement_messages`:\n        each request may carry `payload.messages` items shaped like\n        `{ \"content\": \"...\", \"metadata\": {...} }`.\n        \"\"\"\n\n        try:\n            from langchain_core.messages import HumanMessage\n        except Exception:\n            return None\n\n        injected: list[Any] = []\n        seen_contents: set[str] = set()\n        for request in requests:\n            payload = getattr(request, \"payload\", None)\n            if not isinstance(payload, Mapping):\n                payload = payload if isinstance(payload, dict) else {}\n            messages_payload = payload.get(\"messages\") or []\n            if not isinstance(messages_payload, Sequence) or isinstance(\n                messages_payload, (str, bytes)\n            ):\n                continue\n            for message in messages_payload:\n                if not isinstance(message, Mapping):\n                    continue\n                content = message.get(\"content\")\n                if not content:\n                    continue\n                content_str = str(content)\n                if content_str in seen_contents:\n                    continue\n                metadata = message.get(\"metadata\") or {}\n                additional_kwargs = dict(metadata) if isinstance(metadata, Mapping) else {}\n                injected.append(\n                    HumanMessage(content=content_str, additional_kwargs=additional_kwargs)\n                )\n                seen_contents.add(content_str)\n\n        if not injected:\n            return None\n\n        return await self.append_messages_to_checkpoint(\n            graph=graph,\n            graph_id=graph_id,\n            config=config,\n            new_messages=injected,\n            as_node=as_node,\n            local_checkpointer=local_checkpointer,\n        )\n\n    @staticmethod\n    def extract_thread_id(config: Optional[RunnableConfig]) -> Optional[ThreadId]:\n        if not config:\n            return None\n        configurable = config.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            return None\n        thread_id = configurable.get(\"thread_id\")\n        return str(thread_id) if thread_id else None\n\n    async def aget_platform_thread_state(self, *, thread_id: ThreadId) -> Optional[Any]:\n        \"\"\"Get latest persisted state from platform via LangGraph SDK (if available).\"\"\"\n\n        try:\n            from langgraph_sdk import get_client  # type: ignore\n        except Exception:\n            return None\n\n        try:\n            client = get_client()\n            return await client.threads.get_state(thread_id)\n        except Exception:\n            return None\n\n\n    async def has_persisted_checkpoint(\n        self,\n        *,\n        config: Optional[RunnableConfig],\n        local_checkpointer: Optional[Any] = None,\n    ) -> bool:\n        \"\"\"Return True if a checkpoint exists for config (platform or local).\"\"\"\n\n        if config is None:\n            return False\n\n        if self.is_production_mode():\n            thread_id = self.extract_thread_id(config)\n            if not thread_id:\n                return False\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n            values = getattr(snapshot, \"values\", None)\n            return isinstance(values, Mapping)\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if not checkpointer:\n            return False\n\n        getter_async = getattr(checkpointer, \"aget_tuple\", None)\n        try:\n            if callable(getter_async):\n                checkpoint_tuple = await getter_async(config)\n            else:\n                getter_sync = getattr(checkpointer, \"get_tuple\", None)\n                if not callable(getter_sync):\n                    return False\n                checkpoint_tuple = getter_sync(config)\n        except Exception:\n            return False\n\n        return checkpoint_tuple is not None\n\n    async def restore_state_from_latest_checkpoint(\n        self,\n        *,\n        state: StateDict,\n        config: Optional[RunnableConfig],\n        local_graph: Optional[Any],\n    ) -> bool:\n        \"\"\"Merge latest persisted state into the caller-owned `state` mapping.\"\"\"\n\n        if config is None:\n            return False\n\n        snapshot = None\n        thread_id = self.extract_thread_id(config)\n        if self.is_production_mode() and thread_id:\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n\n        if snapshot is None and local_graph is not None:\n            getter = getattr(local_graph, \"aget_state\", None)\n            if callable(getter):\n                try:\n                    snapshot = await getter(config)\n                except Exception:\n                    snapshot = None\n            if snapshot is None:\n                getter_sync = getattr(local_graph, \"get_state\", None)\n                if callable(getter_sync):\n                    try:\n                        snapshot = getter_sync(config)\n                    except Exception:\n                        snapshot = None\n\n        values = getattr(snapshot, \"values\", None)\n        if not isinstance(values, Mapping):\n            return False\n\n        for key, value in values.items():\n            state[key] = value\n        return True\n\n    async def ainvoke_with_durability(\n        self,\n        *,\n        graph: Any,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph with durability when supported.\"\"\"\n\n        # In production mode, platform may inject durability backends automatically.\n        # In dev mode, only attempt durability when the runnable itself was compiled\n        # with a checkpointer so LangGraph sets up its AsyncPregel loop correctly.\n        graph_bound_checkpointer = _extract_graph_checkpointer(graph)\n        resolved_local_checkpointer = local_checkpointer or graph_bound_checkpointer\n        checkpointer = resolved_local_checkpointer or self.checkpointer\n\n        if self.is_production_mode():\n            use_durability = durability\n        else:\n            use_durability = durability if (checkpointer and _graph_supports_durability(graph)) else None\n        try:\n            if use_durability:\n                return await graph.ainvoke(\n                    graph_input,\n                    config=config,\n                    context=context,\n                    durability=use_durability,\n                )\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n        except (TypeError, AttributeError):\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n\n\n__all__ = [\n    \"resolve_graph_checkpointer\",\n    \"resolve_graph_store\",\n    \"GraphMemoryRuntime\",\n]\n\n\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:a910f951-bdf0-70ae-f446-9713bf0f5a2f\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766175753508.469}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766175753508.594}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:a910f951-bdf0-70ae-f446-9713bf0f5a2f\", \"new_ns\": \"user_preferences:a910f951-bdf0-70ae-f446-9713bf0f5a2f\"}, \"timestamp\": 1766175753508.6458}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:a910f951-bdf0-70ae-f446-9713bf0f5a2f\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175753508.6829}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175753508.99}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175753509.027}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175753509.099}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175753509.144}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175753509.1838}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766175753509.418}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175753509.55}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175753509.5898}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766175753509.651}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:a910f951-bdf0-70ae-f446-9713bf0f5a2f\"}, \"timestamp\": 1766175753509.6829}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766175760219.512}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8\", \"new_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8\"}, \"timestamp\": 1766175760226.577}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175760226.686}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175760227.0479}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175760227.118}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175760227.2}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175760227.2551}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175760227.331}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766175760227.704}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175760227.7961}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175760227.8918}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766175760227.958}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8\"}, \"timestamp\": 1766175760228.0012}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8|graph:bdc9350f-c2ac-64cd-64cb-5d6eb8a6f799\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766175760608.344}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175760608.489}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8|graph:bdc9350f-c2ac-64cd-64cb-5d6eb8a6f799\", \"new_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8|graph:bdc9350f-c2ac-64cd-64cb-5d6eb8a6f799\"}, \"timestamp\": 1766175760609.091}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8|graph:bdc9350f-c2ac-64cd-64cb-5d6eb8a6f799\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175760609.3308}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175760610.24}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766175760610.373}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175760610.774}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766175760611.2112}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175760611.325}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766175760611.382}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8|graph:bdc9350f-c2ac-64cd-64cb-5d6eb8a6f799\"}, \"timestamp\": 1766175760611.421}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766175782283.0012}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1\"}, \"timestamp\": 1766175782359.921}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175782360.063}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175782360.416}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175782360.482}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175782360.612}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175782360.678}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175782360.7668}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766175782361.082}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175782361.1292}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175782361.168}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766175782361.2349}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1\"}, \"timestamp\": 1766175782361.2969}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2\"}, \"timestamp\": 1766175782420.819}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175782421.0342}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175782421.671}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175782421.74}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175782421.9202}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175782422.012}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175782422.112}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766175782422.4373}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175782422.5017}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175782422.582}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766175782422.6548}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2\"}, \"timestamp\": 1766175782422.7268}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3\"}, \"timestamp\": 1766175782483.857}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175782484.14}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175782484.791}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175782484.8481}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175782484.92}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175782484.9702}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175782485.066}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766175782485.316}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175782485.365}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175782485.407}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766175782485.444}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3\"}, \"timestamp\": 1766175782485.4773}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4\"}, \"timestamp\": 1766175782548.3257}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175782548.4731}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175782549.233}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175782549.936}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175782550.257}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175782552.8362}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175782553.107}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766175782553.642}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175782553.8262}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175782553.8982}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766175782553.954}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4\"}, \"timestamp\": 1766175782554.001}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1|1|graph:5a9e31ba-dacc-ebc4-f8d6-3d5991e716bf\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175783181.654}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175783181.755}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1|1|graph:5a9e31ba-dacc-ebc4-f8d6-3d5991e716bf\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1|1|graph:5a9e31ba-dacc-ebc4-f8d6-3d5991e716bf\"}, \"timestamp\": 1766175783181.812}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1|1|graph:5a9e31ba-dacc-ebc4-f8d6-3d5991e716bf\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175783181.86}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175783182.176}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766175783182.272}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175783182.33}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766175783182.5679}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175783182.612}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766175783182.642}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1|1|graph:5a9e31ba-dacc-ebc4-f8d6-3d5991e716bf\"}, \"timestamp\": 1766175783182.6702}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2|2|graph:fafc0492-8449-48a4-b4f7-fa07a74a703a\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175783215.6438}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175783215.752}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2|2|graph:fafc0492-8449-48a4-b4f7-fa07a74a703a\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2|2|graph:fafc0492-8449-48a4-b4f7-fa07a74a703a\"}, \"timestamp\": 1766175783215.8022}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2|2|graph:fafc0492-8449-48a4-b4f7-fa07a74a703a\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175783215.842}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175783216.1702}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766175783216.21}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175783216.384}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766175783216.695}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175783216.7502}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766175783216.79}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2|2|graph:fafc0492-8449-48a4-b4f7-fa07a74a703a\"}, \"timestamp\": 1766175783216.823}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175783250.3892}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175783250.4802}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\"}, \"timestamp\": 1766175783250.531}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175783250.575}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175783250.897}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766175783250.939}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175783251.0027}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766175783251.2388}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175783251.2869}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766175783251.424}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\"}, \"timestamp\": 1766175783251.48}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4|4|graph:babfe482-3e36-c1db-af69-77c456175ec7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175783285.5898}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175783285.723}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4|4|graph:babfe482-3e36-c1db-af69-77c456175ec7\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4|4|graph:babfe482-3e36-c1db-af69-77c456175ec7\"}, \"timestamp\": 1766175783285.7778}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4|4|graph:babfe482-3e36-c1db-af69-77c456175ec7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175783285.822}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175783286.177}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766175783286.22}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175783286.2861}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766175783286.534}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175783286.5842}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766175783286.6208}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4|4|graph:babfe482-3e36-c1db-af69-77c456175ec7\"}, \"timestamp\": 1766175783286.654}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175792653.587}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175792653.7139}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\"}, \"timestamp\": 1766175792653.9321}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175792654.0107}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd188-538b-6266-8000-dd680fc39f53\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd188-538a-6b4a-bfff-04bafa864ce5\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\"}]}, \"timestamp\": 1766175792654.763}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd188-538b-6266-8000-dd680fc39f53\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\"}, \"timestamp\": 1766175792654.888}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd188-538b-6266-8000-dd680fc39f53\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766175792655.621}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"message_count\": 1, \"has_any_history\": true, \"is_at_virtual_start\": false, \"effective_input_is_none\": false}, \"timestamp\": 1766175792655.675}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:8f12ebf9-33a3-f44c-76df-d2b363cc3c77\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766175801673.1829}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766175801673.322}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:8f12ebf9-33a3-f44c-76df-d2b363cc3c77\", \"new_ns\": \"user_preferences:8f12ebf9-33a3-f44c-76df-d2b363cc3c77\"}, \"timestamp\": 1766175801673.739}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:8f12ebf9-33a3-f44c-76df-d2b363cc3c77\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175801673.781}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175801674.093}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175801674.133}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175801674.2}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175801674.247}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175801674.293}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766175801674.534}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175801674.5798}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175801674.619}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766175801674.7122}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:8f12ebf9-33a3-f44c-76df-d2b363cc3c77\"}, \"timestamp\": 1766175801674.798}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766175809564.0479}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e\", \"new_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e\"}, \"timestamp\": 1766175809568.8489}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175809569.0242}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175809569.444}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175809569.553}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175809569.663}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175809569.723}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175809569.7798}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766175809570.0747}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175809570.129}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175809570.175}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766175809570.218}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e\"}, \"timestamp\": 1766175809570.2568}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e|graph:847fb670-cf83-df97-a944-e6d78db9aab5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766175809790.312}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175809790.468}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e|graph:847fb670-cf83-df97-a944-e6d78db9aab5\", \"new_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e|graph:847fb670-cf83-df97-a944-e6d78db9aab5\"}, \"timestamp\": 1766175809790.5337}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e|graph:847fb670-cf83-df97-a944-e6d78db9aab5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175809790.5889}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175809790.899}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766175809790.9429}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175809791.0159}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766175809791.2642}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175809791.317}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766175809791.3652}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e|graph:847fb670-cf83-df97-a944-e6d78db9aab5\"}, \"timestamp\": 1766175809791.4163}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766175825741.7622}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1\"}, \"timestamp\": 1766175825906.595}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175825907.692}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175825908.152}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175825908.2183}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175825908.395}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175825908.47}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175825908.519}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766175825908.7888}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175825908.8818}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175825908.9392}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766175825908.997}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1\"}, \"timestamp\": 1766175825909.035}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2\"}, \"timestamp\": 1766175826010.461}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826010.582}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826010.872}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826010.9219}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826010.994}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826011.0469}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826011.0989}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766175826011.345}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826011.393}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826011.4329}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826011.472}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2\"}, \"timestamp\": 1766175826011.508}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3\"}, \"timestamp\": 1766175826079.8591}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826079.9712}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826080.251}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826080.295}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826080.3608}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826080.42}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826080.474}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766175826080.7139}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826080.7612}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826080.802}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826080.8489}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3\"}, \"timestamp\": 1766175826080.8918}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4\"}, \"timestamp\": 1766175826141.9321}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826142.04}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826142.319}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826142.3638}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826142.432}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826142.483}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826142.5322}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766175826142.7698}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826142.815}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826142.991}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826143.064}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4\"}, \"timestamp\": 1766175826143.1072}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5\"}, \"timestamp\": 1766175826204.938}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826205.045}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826205.374}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826205.508}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826205.597}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826205.65}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826205.699}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"count\": 0}, \"timestamp\": 1766175826206.023}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826206.0808}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826206.12}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826206.155}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5\"}, \"timestamp\": 1766175826206.1848}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6\"}, \"timestamp\": 1766175826271.292}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826271.4282}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826271.9949}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826272.0918}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826272.1812}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826272.2393}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826272.2913}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"count\": 0}, \"timestamp\": 1766175826272.591}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826272.64}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826272.681}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826272.7207}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6\"}, \"timestamp\": 1766175826272.7559}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7\"}, \"timestamp\": 1766175826334.109}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826334.2122}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826334.722}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826334.797}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826334.8748}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826334.9277}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826334.978}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"count\": 0}, \"timestamp\": 1766175826335.2478}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826335.298}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826335.336}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826335.372}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7\"}, \"timestamp\": 1766175826335.403}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8\"}, \"timestamp\": 1766175826399.531}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826399.699}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826400.0352}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826400.0808}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826400.1548}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826400.203}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826400.2559}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"count\": 0}, \"timestamp\": 1766175826400.5032}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826400.565}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826400.606}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826400.6492}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8\"}, \"timestamp\": 1766175826400.679}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9\"}, \"timestamp\": 1766175826462.1692}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826462.281}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826462.555}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826462.5962}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826462.7148}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826462.896}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826462.969}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"count\": 0}, \"timestamp\": 1766175826463.307}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826463.377}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826463.427}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826463.467}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9\"}, \"timestamp\": 1766175826463.54}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10\"}, \"timestamp\": 1766175826525.44}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826525.524}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826525.852}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826525.902}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826525.972}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826526.022}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826526.0688}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"count\": 0}, \"timestamp\": 1766175826526.318}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826526.3691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826526.409}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826526.447}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10\"}, \"timestamp\": 1766175826526.479}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11\"}, \"timestamp\": 1766175826590.624}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826590.8533}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826591.4712}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826591.574}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826591.668}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826591.729}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826591.776}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"count\": 0}, \"timestamp\": 1766175826592.0442}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826592.0962}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826592.134}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826592.178}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11\"}, \"timestamp\": 1766175826592.216}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12\"}, \"timestamp\": 1766175826654.303}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826654.431}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826654.766}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826654.8127}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826654.889}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826654.936}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826654.9802}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"count\": 0}, \"timestamp\": 1766175826655.2288}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826655.2751}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826655.3118}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826655.345}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12\"}, \"timestamp\": 1766175826655.374}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1|1|graph:20860a7c-c072-b9c4-ee53-266d297ed75c\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829462.016}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829462.131}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1|1|graph:20860a7c-c072-b9c4-ee53-266d297ed75c\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1|1|graph:20860a7c-c072-b9c4-ee53-266d297ed75c\"}, \"timestamp\": 1766175829462.182}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1|1|graph:20860a7c-c072-b9c4-ee53-266d297ed75c\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829462.2239}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829462.523}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766175829462.562}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829462.625}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766175829462.856}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829462.901}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829462.934}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1|1|graph:20860a7c-c072-b9c4-ee53-266d297ed75c\"}, \"timestamp\": 1766175829463.084}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2|2|graph:48c95253-1184-f904-3be9-6422f4694a4d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829498.2222}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829498.335}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2|2|graph:48c95253-1184-f904-3be9-6422f4694a4d\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2|2|graph:48c95253-1184-f904-3be9-6422f4694a4d\"}, \"timestamp\": 1766175829498.4907}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2|2|graph:48c95253-1184-f904-3be9-6422f4694a4d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829498.558}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829498.893}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766175829498.946}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829499.014}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766175829499.3347}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829499.4}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829499.4402}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2|2|graph:48c95253-1184-f904-3be9-6422f4694a4d\"}, \"timestamp\": 1766175829499.5342}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829537.039}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829537.189}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\"}, \"timestamp\": 1766175829537.2422}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829537.2942}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829537.606}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766175829537.644}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829537.7222}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766175829537.963}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829538.008}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829538.041}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\"}, \"timestamp\": 1766175829538.115}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4|4|graph:3b86c69b-49a7-627e-ef13-c6de60417f83\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829573.036}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829573.154}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4|4|graph:3b86c69b-49a7-627e-ef13-c6de60417f83\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4|4|graph:3b86c69b-49a7-627e-ef13-c6de60417f83\"}, \"timestamp\": 1766175829573.205}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4|4|graph:3b86c69b-49a7-627e-ef13-c6de60417f83\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829573.246}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829573.5513}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766175829573.591}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829573.663}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766175829573.9}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829573.943}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829573.974}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4|4|graph:3b86c69b-49a7-627e-ef13-c6de60417f83\"}, \"timestamp\": 1766175829574.039}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5|5|graph:5a9d64e1-629c-0534-060a-764177cc1bed\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829608.306}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829608.413}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5|5|graph:5a9d64e1-629c-0534-060a-764177cc1bed\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5|5|graph:5a9d64e1-629c-0534-060a-764177cc1bed\"}, \"timestamp\": 1766175829608.4639}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5|5|graph:5a9d64e1-629c-0534-060a-764177cc1bed\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829608.5042}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829608.854}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\"}, \"timestamp\": 1766175829608.9878}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829609.066}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"count\": 0}, \"timestamp\": 1766175829609.312}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829609.3672}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829609.4102}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5|5|graph:5a9d64e1-629c-0534-060a-764177cc1bed\"}, \"timestamp\": 1766175829609.4502}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6|6|graph:45996b70-de95-42ea-9405-16dccab99ef3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829644.0972}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829644.198}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6|6|graph:45996b70-de95-42ea-9405-16dccab99ef3\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6|6|graph:45996b70-de95-42ea-9405-16dccab99ef3\"}, \"timestamp\": 1766175829644.2517}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6|6|graph:45996b70-de95-42ea-9405-16dccab99ef3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829644.2969}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829644.616}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\"}, \"timestamp\": 1766175829644.658}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829644.722}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"count\": 0}, \"timestamp\": 1766175829644.9639}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829645.012}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829645.048}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6|6|graph:45996b70-de95-42ea-9405-16dccab99ef3\"}, \"timestamp\": 1766175829645.082}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829679.663}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829679.79}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\"}, \"timestamp\": 1766175829679.8457}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829679.893}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829680.29}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\"}, \"timestamp\": 1766175829680.346}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829680.4658}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"count\": 0}, \"timestamp\": 1766175829680.773}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829680.827}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829680.866}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\"}, \"timestamp\": 1766175829680.902}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8|8|graph:4e1534cc-7eaf-928a-94c0-a61fcf68e656\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829715.302}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829715.401}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8|8|graph:4e1534cc-7eaf-928a-94c0-a61fcf68e656\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8|8|graph:4e1534cc-7eaf-928a-94c0-a61fcf68e656\"}, \"timestamp\": 1766175829715.4639}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8|8|graph:4e1534cc-7eaf-928a-94c0-a61fcf68e656\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829715.5142}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829715.8179}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\"}, \"timestamp\": 1766175829715.856}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829715.953}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"count\": 0}, \"timestamp\": 1766175829716.2139}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829716.2659}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829716.3123}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8|8|graph:4e1534cc-7eaf-928a-94c0-a61fcf68e656\"}, \"timestamp\": 1766175829716.362}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9|9|graph:ffedd1ea-b76d-f200-99f6-07893eee71a4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829750.988}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829751.1182}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9|9|graph:ffedd1ea-b76d-f200-99f6-07893eee71a4\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9|9|graph:ffedd1ea-b76d-f200-99f6-07893eee71a4\"}, \"timestamp\": 1766175829751.1748}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9|9|graph:ffedd1ea-b76d-f200-99f6-07893eee71a4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829751.221}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829751.7122}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\"}, \"timestamp\": 1766175829751.7979}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829751.8809}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"count\": 0}, \"timestamp\": 1766175829752.2222}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829752.306}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829752.352}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9|9|graph:ffedd1ea-b76d-f200-99f6-07893eee71a4\"}, \"timestamp\": 1766175829752.4512}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10|10|graph:64a7967f-54d3-a5dd-8745-ba2230078ff2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829787.3162}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829787.4292}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10|10|graph:64a7967f-54d3-a5dd-8745-ba2230078ff2\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10|10|graph:64a7967f-54d3-a5dd-8745-ba2230078ff2\"}, \"timestamp\": 1766175829787.4802}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10|10|graph:64a7967f-54d3-a5dd-8745-ba2230078ff2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829787.522}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829787.831}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\"}, \"timestamp\": 1766175829788.279}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829788.435}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"count\": 0}, \"timestamp\": 1766175829788.759}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829788.8132}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829788.854}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10|10|graph:64a7967f-54d3-a5dd-8745-ba2230078ff2\"}, \"timestamp\": 1766175829788.9868}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11|11|graph:6a06ff10-6d57-9f6f-ce57-fabd981521c9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829826.721}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829826.8318}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11|11|graph:6a06ff10-6d57-9f6f-ce57-fabd981521c9\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11|11|graph:6a06ff10-6d57-9f6f-ce57-fabd981521c9\"}, \"timestamp\": 1766175829826.887}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11|11|graph:6a06ff10-6d57-9f6f-ce57-fabd981521c9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829826.932}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829827.362}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\"}, \"timestamp\": 1766175829827.425}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829827.51}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"count\": 0}, \"timestamp\": 1766175829827.751}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829827.801}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829827.837}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11|11|graph:6a06ff10-6d57-9f6f-ce57-fabd981521c9\"}, \"timestamp\": 1766175829827.871}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12|12|graph:6c587f9e-f347-8243-2281-73be93b0a09b\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829865.545}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829865.664}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12|12|graph:6c587f9e-f347-8243-2281-73be93b0a09b\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12|12|graph:6c587f9e-f347-8243-2281-73be93b0a09b\"}, \"timestamp\": 1766175829865.8171}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12|12|graph:6c587f9e-f347-8243-2281-73be93b0a09b\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829865.903}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829866.291}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\"}, \"timestamp\": 1766175829866.34}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829866.4119}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"count\": 0}, \"timestamp\": 1766175829866.658}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829866.725}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829866.77}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12|12|graph:6c587f9e-f347-8243-2281-73be93b0a09b\"}, \"timestamp\": 1766175829866.817}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175848160.7449}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175848161.1929}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\"}, \"timestamp\": 1766175848161.255}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175848161.3008}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_id\": \"1f0dd18a-0e54-616e-8000-a26b51dcfcba\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_id\": \"1f0dd18a-0e53-6a8e-bfff-067592f9a9c5\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\"}]}, \"timestamp\": 1766175848161.818}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_id\": \"1f0dd18a-0e54-616e-8000-a26b51dcfcba\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\"}, \"timestamp\": 1766175848161.885}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_id\": \"1f0dd18a-0e54-616e-8000-a26b51dcfcba\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766175848162.5103}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"message_count\": 1, \"has_any_history\": true, \"is_at_virtual_start\": false, \"effective_input_is_none\": false}, \"timestamp\": 1766175848162.556}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175848196.11}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175848196.237}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\"}, \"timestamp\": 1766175848196.291}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175848196.3333}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd18a-0cf7-6bae-8000-2cf5b56b6780\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd18a-0cf7-64ba-bfff-1586c3d4a7d2\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\"}]}, \"timestamp\": 1766175848196.8179}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd18a-0cf7-6bae-8000-2cf5b56b6780\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\"}, \"timestamp\": 1766175848196.885}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd18a-0cf7-6bae-8000-2cf5b56b6780\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766175848197.4568}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"message_count\": 1, \"has_any_history\": true, \"is_at_virtual_start\": false, \"effective_input_is_none\": false}, \"timestamp\": 1766175848197.5}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:13\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:13\"}, \"timestamp\": 1766175852699.0918}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:13\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175852699.2322}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175852699.852}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175852699.896}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175852699.96}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175852700.0078}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175852700.0562}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"count\": 0}, \"timestamp\": 1766175852700.292}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175852700.334}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175852700.372}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"snapshot_sources\": 3}, \"timestamp\": 1766175852700.406}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:13\"}, \"timestamp\": 1766175852700.437}\n"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b3849-f999-7253-ae99-01076aa889f0",
    "content": "**\u041f\u0440\u0438\u0447\u0438\u043d\u0430 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u043e\u0448\u0438\u0431\u043e\u043a `EmptyInputError` \u0438 `contents is not specified` \u0432 \u0442\u043e\u043c, \u0447\u0442\u043e \u0432\u0430\u0448 \u043f\u043e\u0440\u043e\u0433 \u00ab\u043d\u0430\u043b\u0438\u0447\u0438\u044f \u0438\u0441\u0442\u043e\u0440\u0438\u0438\u00bb \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u043d\u0438\u0437\u043e\u043a, \u0430 \u043c\u0435\u0442\u043e\u0434 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0432\u0441\u0451 \u0435\u0449\u0451 \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442\u044c \u043a \u043f\u043e\u0442\u0435\u0440\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u0438\u0437-\u0437\u0430 \u043a\u043e\u043d\u0444\u043b\u0438\u043a\u0442\u0430 \u0441 \u0440\u0435\u0434\u0443\u0441\u0435\u0440\u0430\u043c\u0438.**\n\n\u0412\u043e\u0442 \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u0437\u0431\u043e\u0440 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 \u043b\u043e\u0433\u043e\u0432 `DEBUG`:\n\n### 1. \u041f\u043e\u0447\u0435\u043c\u0443 Gemini \u0432\u0441\u0451 \u0435\u0449\u0451 \u043f\u0443\u0441\u0442\u043e\u0439 (`contents is not specified`)\n\u0412 \u043b\u043e\u0433\u0435 \u0434\u043b\u044f `worker=3` \u043c\u044b \u0432\u0438\u0434\u0438\u043c:\n-   `\"message_count\": 1`\n-   `\"has_any_history\": true`\n-   `\"is_at_virtual_start\": false`\n-   **\u0421\u043b\u0435\u0434\u0441\u0442\u0432\u0438\u0435:** `effective_input` \u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0441\u044f `{}`.\n\n**\u0412 \u0447\u0435\u043c \u043b\u043e\u0432\u0443\u0448\u043a\u0430:** \u0414\u043b\u044f ReAct-\u0430\u0433\u0435\u043d\u0442\u0430 (Graph 4) \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043e\u0434\u043d\u043e\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f (\u043e\u0431\u044b\u0447\u043d\u043e \u044d\u0442\u043e `SystemMessage`, \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u0439 \u0432 \u0433\u0440\u0430\u0444) \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u0434\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b. \u041c\u043e\u0434\u0435\u043b\u044c Gemini \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u043a\u0430\u043a \u043c\u0438\u043d\u0438\u043c\u0443\u043c \u043e\u0434\u043d\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f (`HumanMessage`). \n\u041a\u043e\u0433\u0434\u0430 \u0432\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0442\u0435 `{}`, \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u043f\u0440\u043e\u0441\u044b\u043f\u0430\u0435\u0442\u0441\u044f, \u0432\u0438\u0434\u0438\u0442 \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u0443\u044e \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044e, \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u0435\u0451 \u0432 Gemini \u0431\u0435\u0437 \u0432\u043e\u043f\u0440\u043e\u0441\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u2014 \u0438 Gemini \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0443 400, \u0442\u0430\u043a \u043a\u0430\u043a \u00ab\u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u00bb.\n\n### 2. \u041f\u043e\u0447\u0435\u043c\u0443 `EmptyInputError` \u0432\u0441\u0451 \u0435\u0449\u0451 \u0432\u043e\u0437\u043d\u0438\u043a\u0430\u0435\u0442\n\u042d\u0442\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u0432 \u043b\u043e\u0433\u0435 `rosa-distribution` \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442, \u0447\u0442\u043e LangGraph \u043d\u0435 \u0441\u043c\u043e\u0433 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0445\u043e\u0434\u043d\u044b\u0435 \u043a\u0430\u043d\u0430\u043b\u044b. \u0414\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u0432\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u043b\u0438 `{}`, \u0432 \u0441\u043b\u043e\u0436\u043d\u044b\u0445 \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0445 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430\u0445 \u044d\u0442\u043e\u0433\u043e \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e, \u0435\u0441\u043b\u0438 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442 \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u00ab\u043d\u043e\u0432\u044b\u043c\u00bb \u0434\u043b\u044f \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430.\n\n---\n\n### \u041e\u043a\u043e\u043d\u0447\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435 (\u041e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u044b\u0439 \u0444\u0438\u043a\u0441)\n\n\u0412\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u043f\u043e\u0434\u043d\u044f\u0442\u044c \u043f\u043e\u0440\u043e\u0433 \u00ab\u0437\u043d\u0430\u0447\u0438\u043c\u043e\u0441\u0442\u0438\u00bb \u0438\u0441\u0442\u043e\u0440\u0438\u0438. \u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u00ab\u043d\u0430\u0447\u0430\u0432\u0448\u0438\u043c \u0440\u0430\u0431\u043e\u0442\u0443\u00bb \u0442\u043e\u043b\u044c\u043a\u043e \u0442\u043e\u0433\u0434\u0430, \u043a\u043e\u0433\u0434\u0430 \u0443 \u043d\u0435\u0433\u043e \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0435\u0441\u0442\u044c \u0438 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u0430\u044f \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f, \u0438 \u0432\u0430\u0448 \u0432\u0432\u043e\u0434 (\u043c\u0438\u043d\u0438\u043c\u0443\u043c 2 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f).\n\n**\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u0435 \u043b\u043e\u0433\u0438\u043a\u0443 \u0432 `memory_manager.py` (\u043c\u0435\u0442\u043e\u0434 `ainvoke_from_checkpoint`):**\n\n```python\n# \u041b\u0438\u043d\u0438\u044f ~515\nmessages = []\nif isinstance(values, Mapping):\n    candidate_messages = values.get(\"messages\")\n    if isinstance(candidate_messages, Sequence):\n        messages = list(candidate_messages)\n\n# \u041e\u0420\u0413\u0410\u041d\u0418\u0427\u041d\u042b\u0419 \u0424\u0418\u041a\u0421:\n# 1. \u0421\u0447\u0438\u0442\u0430\u0435\u043c, \u0447\u0442\u043e \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u0415\u0421\u0422\u042c, \u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u0442\u0430\u043c >= 2 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 (System + Human).\n# 2. \u0415\u0441\u043b\u0438 \u0442\u0430\u043c 0 \u0438\u043b\u0438 1 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435, \u0437\u043d\u0430\u0447\u0438\u0442 \u0432\u0432\u043e\u0434 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0435\u0449\u0435 \u043d\u0435 \u0431\u044b\u043b \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d.\nhas_history_with_input = len(messages) >= 2 \nis_at_virtual_start = bool(next_nodes_list == [\"__start__\"])\n\n# \u041c\u044b \u0448\u043b\u0435\u043c {} \u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0432\u0432\u043e\u0434 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0423\u0416\u0415 \u0432 \u0447\u0435\u043a\u043f\u043e\u0438\u043d\u0442\u0435.\nif has_history_with_input and not is_at_virtual_start:\n    effective_input = {} \nelse:\n    # \u0412 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0445 \u0441\u043b\u0443\u0447\u0430\u044f\u0445 \u0448\u043b\u0435\u043c \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 graph_input, \n    # \u0447\u0442\u043e\u0431\u044b \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0442\u0435\u0439\u0442 \u0438\u043b\u0438 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0435\u0433\u043e.\n    effective_input = graph_input\n```\n\n### 3. \u0418\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 (\u041b\u0438\u043d\u0438\u044f ~333)\n\u0412\u044b \u0437\u0430\u043c\u0435\u043d\u0438\u043b\u0438 `setdefault` \u043d\u0430 \u043f\u0440\u044f\u043c\u043e\u0435 \u043f\u0440\u0438\u0441\u0432\u0430\u0438\u0432\u0430\u043d\u0438\u0435 `materialized[key] = value`, \u0447\u0442\u043e \u0445\u043e\u0440\u043e\u0448\u043e. \u041d\u043e \u0434\u043b\u044f \u043a\u043b\u044e\u0447\u0430 `messages` \u044d\u0442\u043e \u0432\u0441\u0451 \u0440\u0430\u0432\u043d\u043e \u043e\u043f\u0430\u0441\u043d\u043e, \u0442\u0430\u043a \u043a\u0430\u043a \u043c\u043e\u0436\u0435\u0442 \u0437\u0430\u0442\u0435\u0440\u0435\u0442\u044c \u0447\u0430\u0441\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u0438. \u041e\u0434\u043d\u0430\u043a\u043e \u0432 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0435 `ainvoke` \u044d\u0442\u043e \u043c\u0435\u043d\u0435\u0435 \u043a\u0440\u0438\u0442\u0438\u0447\u043d\u043e, \u0447\u0435\u043c \u043f\u043e\u0440\u043e\u0433 \u0438\u0441\u0442\u043e\u0440\u0438\u0438.\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0440\u0435\u0448\u0438\u0442 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0443:\n1.  **\u0414\u043b\u044f Gemini:** \u0422\u0435\u043f\u0435\u0440\u044c, \u0435\u0441\u043b\u0438 \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0442\u043e\u043b\u044c\u043a\u043e `SystemMessage` (len=1), \u0441\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 `else` \u0438 \u0431\u0443\u0434\u0435\u0442 \u043f\u0435\u0440\u0435\u0434\u0430\u043d `graph_input`. \u042d\u0442\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442 `HumanMessage` \u0432 \u0441\u0442\u0435\u0439\u0442, \u0438 Gemini \u043f\u043e\u043b\u0443\u0447\u0438\u0442 \u0432\u0430\u043b\u0438\u0434\u043d\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441.\n2.  **\u0414\u043b\u044f `EmptyInputError`:** \u041f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 \u043f\u043e\u043b\u043d\u043e\u0433\u043e `graph_input` \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u0432\u0441\u0435 \u043a\u0430\u043d\u0430\u043b\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043e\u0436\u0438\u0434\u0430\u0435\u0442 \u0443\u0437\u0435\u043b `__start__` \u0438\u043b\u0438 `agent`.\n3.  **\u0414\u043b\u044f \u0438\u0441\u0442\u043e\u0440\u0438\u0438:** \u0415\u0441\u043b\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0443\u0436\u0435 \u043c\u043d\u043e\u0433\u043e (len >= 2), \u043c\u044b \u0448\u043b\u0435\u043c `{}`, \u0438 LangGraph \u043f\u0440\u043e\u0441\u0442\u043e \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0435\u0442 \u0446\u0435\u043f\u043e\u0447\u043a\u0443 \u0438\u0437 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445.\n\n**\u0418\u0442\u043e\u0433:** \u0412\u0430\u0448\u0430 \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0441\u0447\u0438\u0442\u0430\u043b\u0430 \u00ab\u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u043e\u043c\u00bb \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0442\u0435\u0445\u043d\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u043e\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f. \u041f\u043e\u0434\u043d\u0438\u043c\u0438\u0442\u0435 \u043f\u043e\u0440\u043e\u0433 \u0434\u043e 2 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439, \u0438 \u0430\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u043e\u0431\u0440\u0435\u0442\u0435\u0442 \u0441\u0442\u0430\u0431\u0438\u043b\u044c\u043d\u0443\u044e \u043f\u0430\u043c\u044f\u0442\u044c \u0438 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0439 \u0432\u0432\u043e\u0434.\n\n**Relevant docs:**\n- [Time Travel: Resume from Checkpoint](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)\n- [Google Gemini Tool Calling Requirements](https://docs.langchain.com/oss/python/langchain/models)\n- [LangGraph Errors: EmptyInputError](https://docs.langchain.com/langsmith/use-threads#empty-thread)"
  },
  {
    "role": "user",
    "id": "ed16611b-c82d-4de4-9516-da3d49cd86f8",
    "content": "\n\nFAILED tests/e2e_tests/business_agents/travel_guide_agent/test_travel_guide_agent.py::TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution[moscow-easy-benchmark-1200] - langchain_google_genai.chat_models.ChatGoogleGenerativeAIError: Invalid argument provided to Gemini: 400 * GenerateContentRequest.contents: contents is not specified\n\nDuring task with name 'agent' and id '7a481feb-f5ab-58b2-d179-5fe7a68b8992'\nDuring task with name 'agent' and id 'e515651d-3b37-f058-7618-483a18c2e9c0'\nDuring task with name 'graph' and id '5f6b3d00-25ba-f873-f788-fc494b8fd35d'\nDuring task with name 'worker' and id 'b4f71e3a-9069-8737-1e8d-a087ee38e4f9'\nDuring task with name 'wide_funnel_workers' and id '01ed2160-d827-e387-77aa-327e16dc61c2'\nDuring task with name 'wide_funnel' and id 'b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8'\nFAILED tests/e2e_tests/business_agents/travel_guide_agent/test_travel_guide_agent.py::TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution[rosa-distribution-medium-benchmark-1200] - langchain_google_genai.chat_models.ChatGoogleGenerativeAIError: Invalid argument provided to Gemini: 400 * GenerateContentRequest.contents: contents is not specified\n\nDuring task with name 'agent' and id '453d04df-19e1-5795-d33c-e3a60d2fa7f3'\nDuring task with name 'agent' and id '085c836b-c782-3af7-66db-e529b6ff4453'\nDuring task with name 'graph' and id '9ed11ff6-807f-50d7-1449-1ed6cfe06e46'\nDuring task with name 'worker' and id '0d8aa8af-f60d-77a8-44ee-ec9136cc99ca'\nDuring task with name 'wide_funnel_workers' and id '1c4a24b4-0e97-2c76-53e5-ad26232c7818'\nDuring task with name 'wide_funnel' and id 'bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487'\n\n\nfrom __future__ import annotations\n\nimport uuid\nimport os\nfrom datetime import datetime\nfrom typing import Any, Mapping, MutableMapping, Optional, Sequence, TypeAlias, Protocol, runtime_checkable, cast\n\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.checkpoint.memory import InMemorySaver\nfrom langchain.embeddings import init_embeddings\nfrom shared.project_settings import ProjectSettings\n\ntry:\n    from pydantic_core import core_schema\nexcept ImportError:\n    core_schema = None  # type: ignore\n\ntry:\n    from langgraph.store.memory import InMemoryStore  # type: ignore\nexcept Exception:  # pragma: no cover\n    InMemoryStore = None  # type: ignore\n\n_CHECKPOINTER_SYNC: Optional[Any] = None\n_CHECKPOINTER_ASYNC: Optional[Any] = None\n_STORE: Optional[Any] = None\n\nThreadId: TypeAlias = str\nGraphId: TypeAlias = str\nCheckpointId: TypeAlias = str\nStateDict: TypeAlias = MutableMapping[str, Any]\n\n\n@runtime_checkable\nclass _SupportsGraphCheckpoint(Protocol):\n    \"\"\"Minimal protocol describing compiled LangGraph runnables we inspect for durability support.\"\"\"\n\n    checkpointer: Any | None\n    _pregel: Any | None\n    app: Any | None\n    name: str\n\n\nGraphRunnableWithPregel: TypeAlias = _SupportsGraphCheckpoint\n\n\ndef _extract_graph_checkpointer(graph: Any) -> Any:\n    \"\"\"Return the checkpointer bound directly to a compiled runnable, if any.\"\"\"\n\n    if graph is None:\n        return None\n\n    candidate = getattr(graph, \"checkpointer\", None)\n    if candidate is not None:\n        return candidate\n\n    pregel = getattr(graph, \"_pregel\", None)\n    if pregel is not None:\n        inner = getattr(pregel, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    app = getattr(graph, \"app\", None)\n    if app is not None:\n        inner = getattr(app, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    loop = getattr(graph, \"_loop\", None)\n    if loop is not None:\n        inner = getattr(loop, \"checkpointer\", None)\n        if inner is not None:\n            return inner\n\n    return None\n\n\ndef _graph_supports_durability(graph: Any) -> bool:\n    \"\"\"Return True if the runnable was compiled with a checkpointer.\"\"\"\n\n    return _extract_graph_checkpointer(graph) is not None\n\n\ndef _resolve_local_checkpointer(graph: Any, override: Optional[Any]) -> Optional[Any]:\n    \"\"\"Prefer explicit override, otherwise inspect the runnable for a bound saver.\"\"\"\n\n    if override is not None:\n        return override\n    return _extract_graph_checkpointer(graph)\n\n\ndef resolve_graph_checkpointer(*, async_mode: bool) -> Any:\n    \"\"\"Return a checkpointer compatible with the chosen execution mode.\n\n    Important:\n    - Async LangGraph execution expects async checkpointer methods. If only a\n      sync checkpointer is available (e.g., SqliteSaver), we fall back to the\n      async-safe InMemorySaver to keep `.ainvoke()` reliable.\n    - Production deployments can replace this with an async-capable durable\n      backend (Postgres/SQLite async) without touching graph code.\n    \"\"\"\n\n    global _CHECKPOINTER_SYNC, _CHECKPOINTER_ASYNC\n    CHECKPOINTER_DATABASE_URL = os.getenv(\"CHECKPOINTER_DATABASE_URL\")\n\n    # In production, LangGraph Platform injects the checkpointer automatically.\n    # We keep local checkpointers disabled to avoid shadowing the platform backend.\n    if ProjectSettings().mode == \"production\":\n        return None\n\n\n    if async_mode:\n        if _CHECKPOINTER_ASYNC is None:\n            _CHECKPOINTER_ASYNC = InMemorySaver()\n        return _CHECKPOINTER_ASYNC\n\n    if _CHECKPOINTER_SYNC is None:\n        _CHECKPOINTER_SYNC =  InMemorySaver()\n    return _CHECKPOINTER_SYNC\n\n\ndef resolve_graph_store() -> Any:\n    \"\"\"Return a store implementation for dev/tests; None in production/platform.\n\n    In production, LangGraph Platform injects the store automatically at runtime\n    (via ToolRuntime). We keep local stores disabled to avoid shadowing the\n    platform backend.\n    \"\"\"\n\n    global _STORE\n    if ProjectSettings().mode == \"production\":\n        return None\n    if InMemoryStore is None:\n        return None\n    if _STORE is not None:\n        return _STORE\n\n    # In development/tests we prefer an in-process store. Vector indexing is optional;\n    # if embeddings cannot be initialised (missing deps/keys), fall back to a plain store.\n    try:\n        _STORE = InMemoryStore(\n            index={\n                \"embed\": init_embeddings(\"openai:text-embedding-3-small\"),\n                \"dims\": 1536,\n                \"fields\": [\"content\"],\n            }\n        )\n    except Exception:\n        _STORE = InMemoryStore(index=None)\n    return _STORE\n\n\nclass GraphMemoryRuntime:\n    \"\"\"Encapsulates durable-checkpoint + long-memory access for dev and platform production.\n\n    This class centralizes:\n    - thread_id extraction\n    - platform SDK fallback for checkpoint state/history (no local checkpointer needed)\n    - local (dev) graph/checkpointer checkpoint inspection\n    \"\"\"\n    THREAD_ID_KEY: str = \"thread_id\"\n\n    @classmethod\n    def __get_pydantic_core_schema__(\n        cls,\n        source_type: Any,\n        handler: Any,\n    ) -> Any:\n        \"\"\"Provide Pydantic schema for GraphMemoryRuntime to allow arbitrary types.\n\n        This enables GraphMemoryRuntime to be used in Pydantic models (e.g., when\n        ContextTravelGuideAgent is used as context_schema in StateGraph).\n        \n        Since GraphMemoryRuntime is a runtime helper (not meant for serialization),\n        we use any_schema() to allow it without validation.\n        \"\"\"\n        if core_schema is None:\n            # pydantic_core should always be available in this project\n            raise ImportError(\"pydantic_core is required but not available\")\n        \n        # Use any_schema() to allow GraphMemoryRuntime without validation\n        # This is appropriate since it's a runtime helper with init=False\n        return core_schema.any_schema()\n\n    def __init__(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        # These are intentionally mutable bindings:\n        # - Root graph wiring binds the single checkpointer/store once per process/run.\n        # - Nested graphs MUST reuse the bound instance via runtime context.\n        self.checkpointer: Optional[Any] = checkpointer\n        self.store: Optional[Any] = store\n\n    def bind(\n        self,\n        *,\n        checkpointer: Optional[Any] = None,\n        store: Optional[Any] = None,\n    ) -> None:\n        \"\"\"Bind durable backends onto this runtime helper.\n\n        Idempotent by design: does not overwrite existing non-null bindings unless\n        explicitly provided.\n        \"\"\"\n\n        if checkpointer is not None:\n            self.checkpointer = checkpointer\n        if store is not None:\n            self.store = store\n\n    def is_production_mode(self) -> bool:\n        return ProjectSettings().mode == \"production\"\n\n    def ensure_thread_id(\n        self,\n        config: Optional[RunnableConfig],\n    ) -> tuple[RunnableConfig, ThreadId]:\n        \"\"\"Ensure ``configurable.thread_id`` exists and return ``(config, thread_id)``.\n\n        Contract (required by project checkpointing rules):\n        - One thread_id should be used for the *entire* root graph run.\n        - If caller did not provide a thread_id, we generate a new one from:\n          ``user_id`` (from RunnableConfig.configurable.user_id) + UUID4 suffix.\n        - Callers must reuse the returned config to keep the thread_id stable.\n        \"\"\"\n\n        from shared.config.long_memory import LongMemory\n\n        merged: RunnableConfig = dict(config) if config else {}\n        configurable = merged.get(\"configurable\", {})\n        if not isinstance(configurable, MutableMapping):\n            configurable = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable = dict(configurable)\n\n        existing = configurable.get(self.THREAD_ID_KEY)\n        if existing:\n            thread_id: ThreadId = str(existing)\n            configurable[self.THREAD_ID_KEY] = thread_id\n            merged[\"configurable\"] = configurable\n            return merged, thread_id\n\n        long_memory = LongMemory.from_runnable_config(merged)\n        user_id = long_memory.user_id\n        if not configurable.get(\"user_id\"):\n            configurable[\"user_id\"] = user_id\n\n        thread_id = f\"user_{user_id}_{uuid.uuid4().hex}\"\n        configurable[self.THREAD_ID_KEY] = thread_id\n        merged[\"configurable\"] = configurable\n        return merged, thread_id\n\n    async def list_thread_checkpoints(\n        self,\n        *,\n        config: RunnableConfig,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> list[Any]:\n        \"\"\"Return raw checkpoint records for the given thread config.\n\n        Notes:\n        - In production (LangGraph Platform), we fall back to the SDK thread history.\n        - In dev/tests, we prefer the provided ``local_checkpointer`` (or the default dev\n          checkpointer) to list checkpoints, because it exposes metadata (`graph_id`).\n        - As a last resort, we attempt to list state snapshots via ``graph.get_state_history``.\n        \"\"\"\n\n        thread_id = self.extract_thread_id(config)\n        if not thread_id:\n            return []\n\n        if self.is_production_mode():\n            try:\n                from langgraph_sdk import get_client  # type: ignore\n            except Exception:\n                return []\n            try:\n                client = get_client()\n                history = await client.threads.get_history(thread_id)\n                return list(history)\n            except Exception:\n                return []\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if checkpointer is not None:\n            lister = getattr(checkpointer, \"list\", None)\n            if callable(lister):\n                try:\n                    return list(lister(config))\n                except Exception:\n                    return []\n\n        if local_graph is not None:\n            getter_async = getattr(local_graph, \"aget_state_history\", None)\n            if callable(getter_async):\n                try:\n                    return [snapshot async for snapshot in getter_async(config)]\n                except Exception:\n                    return []\n            getter_sync = getattr(local_graph, \"get_state_history\", None)\n            if callable(getter_sync):\n                try:\n                    return list(getter_sync(config))\n                except Exception:\n                    return []\n\n        return []\n\n    @staticmethod\n    def _extract_checkpoint_metadata(record: Any) -> Mapping[str, Any]:\n        candidate = getattr(record, \"metadata\", None)\n        if isinstance(candidate, Mapping):\n            return cast(Mapping[str, Any], candidate)\n        if isinstance(record, Mapping):\n            meta = record.get(\"metadata\")\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            meta = getattr(checkpoint, \"metadata\", None)\n            if isinstance(meta, Mapping):\n                return cast(Mapping[str, Any], meta)\n        return {}\n\n    @staticmethod\n    def _extract_checkpoint_id(record: Any) -> Optional[CheckpointId]:\n        candidate = getattr(record, \"checkpoint_id\", None)\n        if candidate:\n            return str(candidate)\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            inner = getattr(checkpoint, \"checkpoint_id\", None)\n            if inner:\n                return str(inner)\n            inner = getattr(checkpoint, \"id\", None)\n            if inner:\n                return str(inner)\n        if isinstance(record, Mapping):\n            candidate = record.get(\"checkpoint_id\") or record.get(\"id\")\n            if candidate:\n                return str(candidate)\n            cfg = record.get(\"config\")\n            if isinstance(cfg, Mapping):\n                conf = cfg.get(\"configurable\")\n                if isinstance(conf, Mapping):\n                    candidate = conf.get(\"checkpoint_id\")\n                    if candidate:\n                        return str(candidate)\n        cfg = getattr(record, \"config\", None)\n        if isinstance(cfg, Mapping):\n            conf = cfg.get(\"configurable\")\n            if isinstance(conf, Mapping):\n                candidate = conf.get(\"checkpoint_id\")\n                if candidate:\n                    return str(candidate)\n        return None\n\n    @staticmethod\n    def _extract_created_at(record: Any) -> Optional[datetime]:\n        candidate = getattr(record, \"created_at\", None)\n        if isinstance(candidate, datetime):\n            return candidate\n        if isinstance(record, Mapping):\n            candidate = record.get(\"created_at\")\n            if isinstance(candidate, datetime):\n                return candidate\n        return None\n\n    @classmethod\n    def _matches_graph_id(cls, record: Any, graph_id: GraphId) -> bool:\n        metadata = cls._extract_checkpoint_metadata(record)\n        candidate = metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")\n        return str(candidate) == str(graph_id) if candidate else False\n\n    @staticmethod\n    def _extract_checkpoint_ns(record: Any) -> Optional[str]:\n        def _from_config(cfg: Any) -> Optional[str]:\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n                if isinstance(configurable, Mapping):\n                    candidate = configurable.get(\"checkpoint_ns\")\n                    if candidate is not None:\n                        return str(candidate)\n            return None\n\n        cfg = getattr(record, \"config\", None)\n        ns = _from_config(cfg)\n        if ns:\n            return ns\n\n        if isinstance(record, Mapping):\n            ns = _from_config(record.get(\"config\"))\n            if ns:\n                return ns\n\n        checkpoint = getattr(record, \"checkpoint\", None)\n        if checkpoint is not None:\n            ns = _from_config(getattr(checkpoint, \"config\", None))\n            if ns:\n                return ns\n\n        metadata = GraphMemoryRuntime._extract_checkpoint_metadata(record)\n        checkpoint_ns = metadata.get(\"checkpoint_ns\")\n        return str(checkpoint_ns) if checkpoint_ns is not None else None\n\n    @staticmethod\n    def _normalize_config_like(config_like: Any) -> Optional[RunnableConfig]:\n        if config_like is None:\n            return None\n        if isinstance(config_like, Mapping):\n            normalized = dict(config_like)\n        else:\n            normalized = None\n            for attr in (\"model_dump\", \"dict\"):\n                dumper = getattr(config_like, attr, None)\n                if callable(dumper):\n                    try:\n                        normalized = dumper()\n                        break\n                    except Exception:\n                        normalized = None\n            if normalized is None:\n                try:\n                    normalized = dict(config_like)  # type: ignore[arg-type]\n                except Exception:\n                    return None\n\n        configurable = normalized.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            configurable = dict(configurable) if configurable is not None else {}\n        normalized[\"configurable\"] = dict(configurable)\n\n        metadata = normalized.get(\"metadata\", {})\n        if not isinstance(metadata, Mapping):\n            metadata = dict(metadata) if metadata is not None else {}\n        normalized[\"metadata\"] = dict(metadata)\n        return normalized  # type: ignore[return-value]\n\n    @classmethod\n    def _extract_task_entries(cls, record: Any) -> list[Mapping[str, Any]]:\n        extracted: list[Mapping[str, Any]] = []\n        visited_snapshots: set[int] = set()\n\n        def _coerce_metadata(value: Any) -> Optional[Mapping[str, Any]]:\n            if value is None:\n                return None\n            if isinstance(value, Mapping):\n                return value\n            try:\n                return dict(value)\n            except Exception:\n                return None\n\n        def _as_sequence(value: Any) -> Optional[Sequence[Any]]:\n            if isinstance(value, Sequence) and not isinstance(value, (str, bytes)):\n                return value\n            return None\n\n        def _record_entry(config_like: Any, metadata_like: Any, state_like: Any) -> None:\n            normalized_config = cls._normalize_config_like(config_like)\n            normalized_metadata = _coerce_metadata(metadata_like)\n            entry: dict[str, Any] = {}\n            if normalized_config:\n                entry[\"config\"] = normalized_config\n            if normalized_metadata:\n                entry[\"metadata\"] = normalized_metadata\n            if state_like is not None:\n                entry[\"state\"] = state_like\n            if entry:\n                extracted.append(entry)\n\n        def _visit_snapshot(snapshot: Any) -> None:\n            if snapshot is None:\n                return\n            snapshot_id = id(snapshot)\n            if snapshot_id in visited_snapshots:\n                return\n            visited_snapshots.add(snapshot_id)\n\n            tasks = None\n            if isinstance(snapshot, Mapping):\n                tasks = _as_sequence(snapshot.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(snapshot, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        def _visit_task(task: Any) -> None:\n            if task is None:\n                return\n            if isinstance(task, Mapping):\n                _record_entry(task.get(\"config\"), task.get(\"metadata\"), task.get(\"state\"))\n                nested_tasks = _as_sequence(task.get(\"tasks\"))\n                if nested_tasks:\n                    for nested in nested_tasks:\n                        _visit_task(nested)\n                _visit_snapshot(task.get(\"state\"))\n                _visit_snapshot(task.get(\"result\"))\n                return\n\n            _record_entry(\n                getattr(task, \"config\", None),\n                getattr(task, \"metadata\", None),\n                getattr(task, \"state\", None),\n            )\n            _visit_snapshot(getattr(task, \"state\", None))\n            _visit_snapshot(getattr(task, \"result\", None))\n            nested_attr = _as_sequence(getattr(task, \"tasks\", None))\n            if nested_attr:\n                for nested in nested_attr:\n                    _visit_task(nested)\n\n        for source in (record, getattr(record, \"checkpoint\", None)):\n            if source is None:\n                continue\n            _visit_snapshot(source)\n            tasks = None\n            if isinstance(source, Mapping):\n                tasks = _as_sequence(source.get(\"tasks\"))\n            else:\n                tasks = _as_sequence(getattr(source, \"tasks\", None))\n            if tasks:\n                for task in tasks:\n                    _visit_task(task)\n\n        return extracted\n\n    async def find_latest_checkpoint_id(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Return the latest checkpoint_id for ``graph_id`` within the given thread.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n\n        # #region agent log\n        import json\n        record_summaries: list[dict[str, str | None]] = []\n        for idx, record in enumerate(checkpoints[:3]):\n            metadata = self._extract_checkpoint_metadata(record)\n            cfg = getattr(record, \"config\", None)\n            configurable = None\n            if isinstance(cfg, Mapping):\n                configurable = cfg.get(\"configurable\")\n            checkpoint_ns = None\n            if isinstance(configurable, Mapping):\n                checkpoint_ns = str(configurable.get(\"checkpoint_ns\"))\n            record_summaries.append(\n                {\n                    \"idx\": str(idx),\n                    \"meta_graph_id\": str(metadata.get(\"graph_id\") or metadata.get(\"langgraph_graph_id\")),\n                    \"checkpoint_id\": self._extract_checkpoint_id(record),\n                    \"checkpoint_ns\": checkpoint_ns,\n                }\n            )\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"B\",\"location\":\"memory_manager.py:395\",\"message\":\"find_latest_checkpoint_id checkpoints listed\",\"data\":{\"graph_id\":graph_id,\"thread_id\":str(config.get(\"configurable\",{}).get(\"thread_id\",\"\")), \"count\":len(checkpoints),\"records\":record_summaries},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if not checkpoints:\n            return None\n\n        # Collect matches with their timestamps (if provided by the backend).\n        matches: list[tuple[Optional[datetime], Any]] = []\n        for record in checkpoints:\n            if self._matches_graph_id(record, graph_id):\n                matches.append((self._extract_created_at(record), record))\n\n        target_checkpoint_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_checkpoint_ns = str(candidate_ns)\n\n        if not matches and target_checkpoint_ns:\n            for record in checkpoints:\n                if self._extract_checkpoint_ns(record) == target_checkpoint_ns:\n                    matches.append((self._extract_created_at(record), record))\n\n        if not matches:\n            return None\n\n        # If the backend provides created_at, prefer the most recent by timestamp.\n        if any(created_at is not None for created_at, _ in matches):\n            matches.sort(\n                key=lambda item: item[0] or datetime.min,\n                reverse=True,\n            )\n            return self._extract_checkpoint_id(matches[0][1])\n\n        # Otherwise, rely on the backend list order. InMemorySaver and Platform history\n        # return newest-first, so the first matching record is the latest.\n        return self._extract_checkpoint_id(matches[0][1])\n\n    async def _load_checkpoint_record(\n        self,\n        *,\n        config: RunnableConfig,\n        checkpoint_id: CheckpointId,\n        local_checkpointer: Optional[Any] = None,\n        local_graph: Optional[Any] = None,\n    ) -> Optional[Any]:\n        \"\"\"Return the checkpoint record with the specified ID.\"\"\"\n\n        checkpoints = await self.list_thread_checkpoints(\n            config=config,\n            local_checkpointer=local_checkpointer,\n            local_graph=local_graph,\n        )\n        for record in checkpoints:\n            record_id = self._extract_checkpoint_id(record)\n            if record_id == checkpoint_id:\n                return record\n        return None\n\n    @staticmethod\n    def _materialize_checkpoint_values(\n        base_values: Mapping[str, Any],\n        record: Optional[Any],\n        *,\n        graph_id: Optional[str] = None,\n    ) -> tuple[Mapping[str, Any], bool]:\n        \"\"\"Merge stored writes from the checkpoint record into snapshot values.\"\"\"\n\n        if record is None:\n            return base_values, False\n\n        materialized: dict[str, Any] = dict(base_values)\n        writes_found = False\n\n        checkpoint_obj = getattr(record, \"checkpoint\", record)\n        writes = getattr(checkpoint_obj, \"writes\", None)\n        if writes is None and isinstance(checkpoint_obj, Mapping):\n            writes = checkpoint_obj.get(\"writes\")\n\n        # #region agent log\n        import json as _json_checkpoint_meta\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(\n                _json_checkpoint_meta.dumps(\n                    {\n                        \"sessionId\": \"debug-session\",\n                        \"runId\": \"pre-fix\",\n                        \"hypothesisId\": \"L\",\n                        \"location\": \"memory_manager.py:321\",\n                        \"message\": \"checkpoint record summary\",\n                        \"data\": {\n                            \"graph_id\": graph_id,\n                            \"record_type\": type(checkpoint_obj).__name__,\n                            \"has_attr_writes\": hasattr(checkpoint_obj, \"writes\"),\n                            \"writes_is_sequence\": isinstance(writes, Sequence),\n                            \"writes_is_mapping\": isinstance(writes, Mapping),\n                        },\n                        \"timestamp\": __import__(\"time\").time() * 1000,\n                    }\n                )\n                + \"\\n\"\n            )\n        # #endregion\n\n        summary: list[dict[str, Any]] = []\n\n        if isinstance(writes, Sequence):\n            for idx, write_entry in enumerate(writes):\n                node_name = None\n                write_payload = None\n                if isinstance(write_entry, Mapping):\n                    node_name = write_entry.get(\"node\") or write_entry.get(\"name\")\n                    candidate = write_entry.get(\"writes\") or write_entry.get(\"values\")\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n                else:\n                    node_name = getattr(write_entry, \"node\", None) or getattr(write_entry, \"name\", None)\n                    candidate = getattr(write_entry, \"writes\", None)\n                    if isinstance(candidate, Mapping):\n                        write_payload = candidate\n\n                if isinstance(write_payload, Mapping):\n                    for key, value in write_payload.items():\n                        materialized[key] = value\n                    if idx < 3:\n                        summary.append(\n                            {\n                                \"node\": str(node_name),\n                                \"keys\": list(write_payload.keys()),\n                            }\n                        )\n                    writes_found = True\n\n        # #region agent log\n        if summary:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:324\",\n                            \"message\": \"checkpoint writes merged\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"writes\": summary,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        else:\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"J\",\n                            \"location\": \"memory_manager.py:329\",\n                            \"message\": \"checkpoint writes unavailable\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"has_writes\": isinstance(writes, Sequence),\n                                \"writes_type\": None if writes is None else type(writes).__name__,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n        # #endregion\n\n        return materialized, writes_found\n\n    @staticmethod\n    def _has_meaningful_values(values: Mapping[str, Any]) -> bool:\n        \"\"\"Return True if checkpoint values contain data beyond housekeeping fields.\"\"\"\n\n        if not values:\n            return False\n        significant_keys = set(values.keys()) - {\"messages\", \"remaining_steps\", \"distribution_scope\"}\n        if significant_keys:\n            return True\n\n        messages = values.get(\"messages\")\n        if isinstance(messages, Sequence):\n            # System + user messages occupy the first two positions. Anything beyond\n            # that indicates the assistant has already produced tool calls or replies.\n            if len(messages) > 2:\n                return True\n\n        return False\n\n    async def _find_subgraph_resume_config(\n        self,\n        *,\n        config: RunnableConfig,\n        graph_id: GraphId,\n        checkpoints: Sequence[Any],\n    ) -> Optional[tuple[RunnableConfig, Any]]:\n        target_ns: Optional[str] = None\n        configurable = config.get(\"configurable\", {})\n        if isinstance(configurable, Mapping):\n            candidate_ns = configurable.get(\"checkpoint_ns\")\n            if candidate_ns:\n                target_ns = str(candidate_ns)\n\n        for record_idx, record in enumerate(checkpoints):\n            task_entries = self._extract_task_entries(record)\n            if not task_entries:\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:562\",\"message\":\"checkpoint missing task entries\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"parent_checkpoint_id\":self._extract_checkpoint_id(record)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n                continue\n            for task_idx, task in enumerate(task_entries[:2]):\n                task_metadata = task.get(\"metadata\")\n                normalized_metadata: Mapping[str, Any] = {}\n                if isinstance(task_metadata, Mapping):\n                    normalized_metadata = task_metadata\n                task_graph_id = normalized_metadata.get(\"graph_id\") or normalized_metadata.get(\"langgraph_graph_id\")\n\n                raw_config = task.get(\"config\")\n                normalized_config = self._normalize_config_like(raw_config)\n                if not normalized_config:\n                    continue\n                task_configurable = normalized_config.get(\"configurable\", {})\n                task_ns = None\n                if isinstance(task_configurable, Mapping):\n                    candidate = task_configurable.get(\"checkpoint_ns\")\n                    if candidate:\n                        task_ns = str(candidate)\n\n                ns_matches = target_ns and task_ns == target_ns\n                graph_matches = task_graph_id and str(task_graph_id) == str(graph_id)\n\n                if record_idx < 2:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"H\",\"location\":\"memory_manager.py:581\",\"message\":\"task entry inspected\",\"data\":{\"graph_id\":graph_id,\"record_index\":record_idx,\"task_index\":task_idx,\"task_graph_id\":task_graph_id,\"task_ns\":task_ns},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n\n                if graph_matches or ns_matches:\n                    resume_state = task.get(\"state\")\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            json.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"D\",\n                                    \"location\": \"memory_manager.py:520\",\n                                    \"message\": \"subgraph resume config located\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"matched_ns\": task_ns,\n                                        \"matched_graph_id\": task_graph_id,\n                                        \"parent_checkpoint_id\": self._extract_checkpoint_id(record),\n                                        \"has_state\": resume_state is not None,\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return normalized_config, resume_state\n\n        return None\n\n    async def _get_graph_snapshot(\n        self,\n        *,\n        graph: Any,\n        cfg: RunnableConfig,\n        subgraphs: bool = False,\n    ) -> Any:\n        getter_async = getattr(graph, \"aget_state\", None)\n        params = {\"subgraphs\": True} if subgraphs else {}\n        try:\n            if callable(getter_async):\n                return await getter_async(cfg, **params)\n        except TypeError:\n            # Fallback for LangGraph versions that don't support subgraphs kwarg.\n            try:\n                return await getter_async(cfg)\n            except Exception:\n                pass\n        except Exception:\n            pass\n\n        getter_sync = getattr(graph, \"get_state\", None)\n        if callable(getter_sync):\n            try:\n                return getter_sync(cfg, **params)\n            except TypeError:\n                try:\n                    return getter_sync(cfg)\n                except Exception:\n                    return None\n            except Exception:\n                return None\n        return None\n\n    async def ainvoke_from_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str = \"sync\",\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph resuming from the latest checkpoint when available.\"\"\"\n\n        merged, _ = self.ensure_thread_id(config)\n        # SAFETY: Ignore any caller-supplied checkpoint_id.\n        #\n        # In this architecture, checkpoint selection is *graph_id-scoped* and managed\n        # exclusively by this runtime helper. Allowing external checkpoint_id values\n        # could cause cross-graph leakage within a shared thread_id.\n\n        merged_conf = merged.get(\"configurable\", {})\n        if isinstance(merged_conf, Mapping):\n            merged_conf_dict = dict(merged_conf)\n            merged_conf_dict.pop(\"checkpoint_id\", None)\n            original_ns = merged_conf_dict.get(\"checkpoint_ns\", \"\")\n            merged_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            merged[\"configurable\"] = merged_conf_dict\n            \n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"E\",\"location\":\"memory_manager.py:445\",\"message\":\"ainvoke_from_checkpoint setting checkpoint_ns\",\"data\":{\"graph_id\":graph_id,\"original_ns\":str(original_ns),\"new_ns\":str(merged_conf_dict.get(\"checkpoint_ns\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n        # Ensure the checkpoint records are scoping-friendly in LangGraph v1.\n        meta = merged.get(\"metadata\")\n        if not isinstance(meta, Mapping):\n            meta = {}\n        meta_dict = dict(meta)\n        meta_dict.setdefault(\"graph_id\", str(graph_id))\n        merged[\"metadata\"] = meta_dict\n\n        effective_local_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n\n        # #region agent log\n        import json\n        final_ns = merged.get(\"configurable\", {}).get(\"checkpoint_ns\", \"\")\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:458\",\"message\":\"ainvoke_from_checkpoint calling find_latest_checkpoint_id\",\"data\":{\"graph_id\":graph_id,\"checkpoint_ns\":str(final_ns),\"thread_id\":str(merged.get(\"configurable\",{}).get(\"thread_id\",\"\"))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=effective_local_checkpointer,\n            local_graph=graph,\n        )\n        checkpoint_record: Optional[Any] = None\n        subgraph_resume: Optional[tuple[RunnableConfig, Any]] = None\n        if checkpoint_id is None:\n            snapshot_sources: list[Any] = []\n\n            if context is not None:\n                runner = getattr(context, \"graph_runner\", None)\n                graph_runtime = getattr(runner, \"graph\", None)\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:711\",\"message\":\"parent context inspection\",\"data\":{\"graph_id\":graph_id,\"has_context\":True,\"has_runner\":runner is not None,\"has_graph\":graph_runtime is not None},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n                if graph_runtime is not None:\n                    try:\n                        parent_snapshot = await self._get_graph_snapshot(\n                            graph=graph_runtime,\n                            cfg=merged,\n                            subgraphs=True,\n                        )\n                        if parent_snapshot is not None:\n                            snapshot_sources.append(parent_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:715\",\"message\":\"parent snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":parent_snapshot is not None,\"has_tasks\":bool(getattr(parent_snapshot,\"tasks\",None)),\"has_next\":bool(getattr(parent_snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                    except Exception:\n                        parent_snapshot = None\n                else:\n                    # #region agent log\n                    import json\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:724\",\"message\":\"parent snapshot skipped\",\"data\":{\"graph_id\":graph_id,\"reason\":\"graph_runner_missing\" if runner is None else \"graph_attr_missing\"},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                    # #endregion\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:729\",\"message\":\"parent context absent\",\"data\":{\"graph_id\":graph_id},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n\n            root_graph = getattr(context, \"root_graph\", None) if context is not None else None\n            if root_graph is not None:\n                try:\n                    root_snapshot = await self._get_graph_snapshot(\n                        graph=root_graph,\n                        cfg=merged,\n                        subgraphs=True,\n                    )\n                    if root_snapshot is not None:\n                        snapshot_sources.append(root_snapshot)\n                        # #region agent log\n                        import json\n                        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"G\",\"location\":\"memory_manager.py:738\",\"message\":\"root snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":root_snapshot is not None,\"has_tasks\":bool(getattr(root_snapshot,\"tasks\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                        # #endregion\n                except Exception:\n                    root_snapshot = None\n\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=merged,\n                subgraphs=True,\n            )\n            if snapshot is not None:\n                snapshot_sources.append(snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:727\",\"message\":\"assistant snapshot inspected\",\"data\":{\"graph_id\":graph_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":bool(getattr(snapshot,\"tasks\",None)),\"has_next\":bool(getattr(snapshot,\"next\",None))},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            checkpoints_snapshot = await self.list_thread_checkpoints(\n                config=merged,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n            snapshot_sources.extend(checkpoints_snapshot)\n            # #region agent log\n            import json\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:734\",\"message\":\"thread checkpoints snapshot collected\",\"data\":{\"graph_id\":graph_id,\"count\":len(checkpoints_snapshot)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            subgraph_resume = await self._find_subgraph_resume_config(\n                config=merged,\n                graph_id=graph_id,\n                checkpoints=snapshot_sources,\n            )\n            if subgraph_resume is not None:\n                resume_config, _ = subgraph_resume\n                metadata = resume_config.get(\"metadata\", {})\n                if not isinstance(metadata, Mapping):\n                    metadata = dict(metadata) if metadata is not None else {}\n                metadata = dict(metadata)\n                metadata.setdefault(\"graph_id\", str(graph_id))\n                resume_config[\"metadata\"] = metadata  # type: ignore[index]\n            else:\n                # #region agent log\n                import json\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"F\",\"location\":\"memory_manager.py:743\",\"message\":\"subgraph resume config missing\",\"data\":{\"graph_id\":graph_id,\"snapshot_sources\":len(snapshot_sources)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n                # #endregion\n        \n        # #region agent log\n        with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n            f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"A\",\"location\":\"memory_manager.py:464\",\"message\":\"ainvoke_from_checkpoint checkpoint_id result\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":str(checkpoint_id) if checkpoint_id else None,\"checkpoint_ns\":str(final_ns)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n        # #endregion\n\n        if checkpoint_id:\n            checkpoint_record = await self._load_checkpoint_record(\n                config=merged,\n                checkpoint_id=checkpoint_id,\n                local_checkpointer=effective_local_checkpointer,\n                local_graph=graph,\n            )\n\n            cfg: RunnableConfig = dict(merged)\n            configurable = cfg.get(\"configurable\", {})\n            configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n            configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n            configurable_dict[\"checkpoint_id\"] = checkpoint_id\n            cfg[\"configurable\"] = configurable_dict\n\n            # If the checkpoint represents an in-progress run (has pending `next`),\n            # we resume via `invoke(None, checkpoint_id=...)`. If the run is already\n            # complete (no pending next nodes), we \"restart\" from the persisted\n            # snapshot values as a fresh invocation. This is the required behavior\n            # for refinement: patch values \u2192 re-run from patched state.\n            snapshot = await self._get_graph_snapshot(\n                graph=graph,\n                cfg=cfg,\n                subgraphs=True,\n            )\n\n            # #region agent log\n            import json\n            snapshot_has_tasks = bool(getattr(snapshot, \"tasks\", None))\n            snapshot_next = getattr(snapshot, \"next\", None)\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(json.dumps({\"sessionId\":\"debug-session\",\"runId\":\"pre-fix\",\"hypothesisId\":\"C\",\"location\":\"memory_manager.py:504\",\"message\":\"ainvoke_from_checkpoint snapshot inspection\",\"data\":{\"graph_id\":graph_id,\"checkpoint_id\":checkpoint_id,\"snapshot_present\":snapshot is not None,\"has_tasks\":snapshot_has_tasks,\"pending_next\":bool(snapshot_next)},\"timestamp\":__import__(\"time\").time()*1000})+\"\\n\")\n            # #endregion\n\n            next_nodes = getattr(snapshot, \"next\", None)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(next_nodes, Sequence) and next_nodes:\n                next_nodes_list = list(next_nodes)\n                messages = []\n                if isinstance(values, Mapping):\n                    candidate_messages = values.get(\"messages\")\n                    if isinstance(candidate_messages, Sequence):\n                        messages = list(candidate_messages)\n\n                has_any_history = len(messages) > 0\n                is_at_virtual_start = bool(next_nodes_list == [\"__start__\"])\n\n                if has_any_history and not is_at_virtual_start:\n                    effective_input: Any = {}\n                else:\n                    effective_input = graph_input\n\n                # #region agent log\n                import json as _json_resume_next\n                next_preview = next_nodes_list[:3]\n                with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                    f.write(\n                        _json_resume_next.dumps(\n                            {\n                                \"sessionId\": \"debug-session\",\n                                \"runId\": \"pre-fix\",\n                                \"hypothesisId\": \"K\",\n                                \"location\": \"memory_manager.py:509\",\n                                \"message\": \"resuming graph from checkpoint pending next\",\n                                \"data\": {\n                                    \"graph_id\": graph_id,\n                                    \"next_nodes\": next_preview,\n                                \"graph_input_is_none\": graph_input is None,\n                                \"message_count\": len(messages),\n                                \"has_any_history\": has_any_history,\n                                    \"is_at_virtual_start\": is_at_virtual_start,\n                                    \"effective_input_is_none\": effective_input is None,\n                                },\n                                \"timestamp\": __import__(\"time\").time() * 1000,\n                            }\n                        )\n                        + \"\\n\"\n                    )\n                # #endregion\n\n                return await self.ainvoke_with_durability(\n                    graph=graph,\n                    graph_input=effective_input,\n                    config=cfg,\n                    context=context,\n                    durability=durability,\n                    local_checkpointer=effective_local_checkpointer,\n                )\n\n            # IMPORTANT:\n            # If the checkpoint is COMPLETE (no pending next nodes), we DO NOT attempt to\n            # \"restart\" the graph by invoking without checkpoint_id. In a shared thread_id\n            # architecture (multiple graphs in the same thread), dropping checkpoint_id\n            # would cause LangGraph to load the latest checkpoint for the thread+ns,\n            # which may belong to a different graph_id \u2192 cross-graph contamination.\n            #\n            # Callers that need to re-run a completed checkpoint should first \"arm\" it\n            # via `graph.update_state(..., as_node=\"__start__\")` (e.g., our refinement\n            # injection path does this), which produces a checkpoint with pending next nodes.\n            if isinstance(values, Mapping):\n                materialized_values, writes_found = self._materialize_checkpoint_values(\n                    values,\n                    checkpoint_record,\n                    graph_id=str(graph_id),\n                )\n                if writes_found or self._has_meaningful_values(materialized_values):\n                    # #region agent log\n                    import json as _json_resume\n                    with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                        f.write(\n                            _json_resume.dumps(\n                                {\n                                    \"sessionId\": \"debug-session\",\n                                    \"runId\": \"pre-fix\",\n                                    \"hypothesisId\": \"J\",\n                                    \"location\": \"memory_manager.py:944\",\n                                    \"message\": \"returning checkpoint values\",\n                                    \"data\": {\n                                        \"graph_id\": graph_id,\n                                        \"keys\": list(materialized_values.keys()),\n                                    },\n                                    \"timestamp\": __import__(\"time\").time() * 1000,\n                                }\n                            )\n                            + \"\\n\"\n                        )\n                    # #endregion\n                    return dict(materialized_values)\n\n                # Values are incomplete (e.g., only messages). Fallback to fresh invoke.\n                rerun_cfg: RunnableConfig = dict(merged)\n                rerun_conf = rerun_cfg.get(\"configurable\", {})\n                if isinstance(rerun_conf, Mapping):\n                    rerun_conf_dict = dict(rerun_conf)\n                    rerun_conf_dict.pop(\"checkpoint_id\", None)\n                    rerun_conf_dict.setdefault(\"checkpoint_ns\", str(final_ns))\n                    rerun_cfg[\"configurable\"] = rerun_conf_dict\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=graph_input,\n                config=rerun_cfg,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        if subgraph_resume is not None:\n            # #region agent log\n            import json\n            resume_config, resume_state = subgraph_resume\n            with open(\"/Users/skylarpro/magxtrip_test/MagixTrip_LLM_core/.cursor/debug.log\", \"a\") as f:\n                f.write(\n                    json.dumps(\n                        {\n                            \"sessionId\": \"debug-session\",\n                            \"runId\": \"pre-fix\",\n                            \"hypothesisId\": \"D\",\n                            \"location\": \"memory_manager.py:610\",\n                            \"message\": \"resuming assistant via subgraph config\",\n                            \"data\": {\n                                \"graph_id\": graph_id,\n                                \"checkpoint_ns\": resume_config.get(\"configurable\", {}).get(\"checkpoint_ns\") if isinstance(resume_config.get(\"configurable\"), Mapping) else None,\n                                \"has_state\": resume_state is not None,\n                            },\n                            \"timestamp\": __import__(\"time\").time() * 1000,\n                        }\n                    )\n                    + \"\\n\"\n                )\n            # #endregion\n            resume_input = graph_input\n            if resume_state is not None:\n                values = getattr(resume_state, \"values\", None)\n                if isinstance(values, Mapping):\n                    resume_input = dict(values)\n                elif isinstance(resume_state, Mapping):\n                    maybe_values = resume_state.get(\"values\")\n                    if isinstance(maybe_values, Mapping):\n                        resume_input = dict(maybe_values)\n                    else:\n                        resume_input = resume_state\n                else:\n                    resume_input = resume_state\n\n            return await self.ainvoke_with_durability(\n                graph=graph,\n                graph_input=resume_input,\n                config=resume_config,\n                context=context,\n                durability=durability,\n                local_checkpointer=effective_local_checkpointer,\n            )\n\n        # SAFETY: Never allow a caller-supplied checkpoint_id to influence execution\n        # when we are NOT explicitly resuming from a checkpoint for this graph_id.\n        #\n        # Without this, a foreign checkpoint_id (from another graph_id in the same\n        # thread) could be accidentally consumed by LangGraph, violating isolation.\n        fresh_cfg: RunnableConfig = dict(merged)\n        fresh_conf = fresh_cfg.get(\"configurable\", {})\n        if isinstance(fresh_conf, Mapping):\n            fresh_conf_dict = dict(fresh_conf)\n            fresh_conf_dict.pop(\"checkpoint_id\", None)\n            # Keep checkpoint_ns stable (LangGraph may assume the key exists).\n            fresh_conf_dict.setdefault(\"checkpoint_ns\", \"\")\n            fresh_cfg[\"configurable\"] = fresh_conf_dict\n\n        return await self.ainvoke_with_durability(\n            graph=graph,\n            graph_input=graph_input,\n            config=fresh_cfg,\n            context=context,\n            durability=durability,\n            local_checkpointer=effective_local_checkpointer,\n        )\n\n    async def append_messages_to_checkpoint(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        new_messages: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Append messages to the latest checkpoint for ``graph_id`` and return new checkpoint id.\n\n        This uses ``graph.update_state`` / ``graph.aupdate_state`` so reducers (e.g. `add_messages`)\n        are honored. The update is applied as a fork of the latest checkpoint for ``graph_id``.\n        \"\"\"\n\n        if not new_messages:\n            return None\n\n        merged, _ = self.ensure_thread_id(config)\n        resolved_checkpointer = _resolve_local_checkpointer(graph, local_checkpointer)\n        latest_checkpoint_id = await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n        \n        if not latest_checkpoint_id:\n            return None\n        \n        patch_config: RunnableConfig = dict(merged)\n        configurable = patch_config.get(\"configurable\", {})\n        configurable_dict = dict(configurable) if isinstance(configurable, Mapping) else {}\n        configurable_dict.setdefault(\"checkpoint_ns\", \"\")\n        configurable_dict[\"checkpoint_id\"] = latest_checkpoint_id\n        patch_config[\"configurable\"] = configurable_dict\n\n        # Ensure patched checkpoints remain discoverable by metadata scoping.\n        metadata = patch_config.get(\"metadata\")\n        if not isinstance(metadata, Mapping):\n            metadata = {}\n        metadata_dict = dict[str, Any](metadata)\n        metadata_dict.setdefault(\"graph_id\", str(graph_id))\n        patch_config[\"metadata\"] = metadata_dict\n\n\n        # Best-effort idempotency: avoid appending messages already present in the checkpoint.\n        # This is critical for durable resume where refinement planning may be replayed.\n        filtered_messages: list[Any] = list(new_messages)\n        try:\n            snapshot = None\n            getter_async = getattr(graph, \"aget_state\", None)\n            if callable(getter_async):\n                snapshot = await getter_async(patch_config)\n            if snapshot is None:\n                getter_sync = getattr(graph, \"get_state\", None)\n                if callable(getter_sync):\n                    snapshot = getter_sync(patch_config)\n            values = getattr(snapshot, \"values\", None)\n            if isinstance(values, Mapping):\n                existing = values.get(\"messages\")\n                if isinstance(existing, Sequence) and not isinstance(existing, (str, bytes)):\n                    existing_contents: set[str] = set()\n                    for message in existing:\n                        content = getattr(message, \"content\", None)\n                        if content:\n                            existing_contents.add(str(content))\n                    if existing_contents:\n                        filtered_messages = [\n                            message\n                            for message in filtered_messages\n                            if str(getattr(message, \"content\", \"\")) not in existing_contents\n                        ]\n        except Exception:\n            filtered_messages = list(new_messages)\n\n        if not filtered_messages:\n            return latest_checkpoint_id\n\n        updates: dict[str, Any] = {\"messages\": filtered_messages}\n\n        updater_async = getattr(graph, \"aupdate_state\", None)\n        updater_sync = getattr(graph, \"update_state\", None)\n        resolved_as_node = as_node or \"__start__\"\n        try:\n            if callable(updater_async):\n                await updater_async(patch_config, updates, as_node=resolved_as_node)\n            elif callable(updater_sync):\n                updater_sync(patch_config, updates, as_node=resolved_as_node)\n            else:\n                return None\n        except Exception as e:\n            return None\n\n        return await self.find_latest_checkpoint_id(\n            config=merged,\n            graph_id=graph_id,\n            local_checkpointer=resolved_checkpointer,\n            local_graph=graph,\n        )\n\n    async def inject_distribution_refinement_messages(\n        self,\n        *,\n        graph: Any,\n        graph_id: GraphId,\n        config: Optional[RunnableConfig],\n        requests: Sequence[Any],\n        as_node: Optional[str] = None,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Optional[CheckpointId]:\n        \"\"\"Patch a graph checkpoint by appending refinement instruction messages.\n\n        Mirrors the extraction rules used by `_distribution_inject_refinement_messages`:\n        each request may carry `payload.messages` items shaped like\n        `{ \"content\": \"...\", \"metadata\": {...} }`.\n        \"\"\"\n\n        try:\n            from langchain_core.messages import HumanMessage\n        except Exception:\n            return None\n\n        injected: list[Any] = []\n        seen_contents: set[str] = set()\n        for request in requests:\n            payload = getattr(request, \"payload\", None)\n            if not isinstance(payload, Mapping):\n                payload = payload if isinstance(payload, dict) else {}\n            messages_payload = payload.get(\"messages\") or []\n            if not isinstance(messages_payload, Sequence) or isinstance(\n                messages_payload, (str, bytes)\n            ):\n                continue\n            for message in messages_payload:\n                if not isinstance(message, Mapping):\n                    continue\n                content = message.get(\"content\")\n                if not content:\n                    continue\n                content_str = str(content)\n                if content_str in seen_contents:\n                    continue\n                metadata = message.get(\"metadata\") or {}\n                additional_kwargs = dict(metadata) if isinstance(metadata, Mapping) else {}\n                injected.append(\n                    HumanMessage(content=content_str, additional_kwargs=additional_kwargs)\n                )\n                seen_contents.add(content_str)\n\n        if not injected:\n            return None\n\n        return await self.append_messages_to_checkpoint(\n            graph=graph,\n            graph_id=graph_id,\n            config=config,\n            new_messages=injected,\n            as_node=as_node,\n            local_checkpointer=local_checkpointer,\n        )\n\n    @staticmethod\n    def extract_thread_id(config: Optional[RunnableConfig]) -> Optional[ThreadId]:\n        if not config:\n            return None\n        configurable = config.get(\"configurable\", {})\n        if not isinstance(configurable, Mapping):\n            return None\n        thread_id = configurable.get(\"thread_id\")\n        return str(thread_id) if thread_id else None\n\n    async def aget_platform_thread_state(self, *, thread_id: ThreadId) -> Optional[Any]:\n        \"\"\"Get latest persisted state from platform via LangGraph SDK (if available).\"\"\"\n\n        try:\n            from langgraph_sdk import get_client  # type: ignore\n        except Exception:\n            return None\n\n        try:\n            client = get_client()\n            return await client.threads.get_state(thread_id)\n        except Exception:\n            return None\n\n\n    async def has_persisted_checkpoint(\n        self,\n        *,\n        config: Optional[RunnableConfig],\n        local_checkpointer: Optional[Any] = None,\n    ) -> bool:\n        \"\"\"Return True if a checkpoint exists for config (platform or local).\"\"\"\n\n        if config is None:\n            return False\n\n        if self.is_production_mode():\n            thread_id = self.extract_thread_id(config)\n            if not thread_id:\n                return False\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n            values = getattr(snapshot, \"values\", None)\n            return isinstance(values, Mapping)\n\n        checkpointer = local_checkpointer or self.checkpointer\n        if not checkpointer:\n            return False\n\n        getter_async = getattr(checkpointer, \"aget_tuple\", None)\n        try:\n            if callable(getter_async):\n                checkpoint_tuple = await getter_async(config)\n            else:\n                getter_sync = getattr(checkpointer, \"get_tuple\", None)\n                if not callable(getter_sync):\n                    return False\n                checkpoint_tuple = getter_sync(config)\n        except Exception:\n            return False\n\n        return checkpoint_tuple is not None\n\n    async def restore_state_from_latest_checkpoint(\n        self,\n        *,\n        state: StateDict,\n        config: Optional[RunnableConfig],\n        local_graph: Optional[Any],\n    ) -> bool:\n        \"\"\"Merge latest persisted state into the caller-owned `state` mapping.\"\"\"\n\n        if config is None:\n            return False\n\n        snapshot = None\n        thread_id = self.extract_thread_id(config)\n        if self.is_production_mode() and thread_id:\n            snapshot = await self.aget_platform_thread_state(thread_id=thread_id)\n\n        if snapshot is None and local_graph is not None:\n            getter = getattr(local_graph, \"aget_state\", None)\n            if callable(getter):\n                try:\n                    snapshot = await getter(config)\n                except Exception:\n                    snapshot = None\n            if snapshot is None:\n                getter_sync = getattr(local_graph, \"get_state\", None)\n                if callable(getter_sync):\n                    try:\n                        snapshot = getter_sync(config)\n                    except Exception:\n                        snapshot = None\n\n        values = getattr(snapshot, \"values\", None)\n        if not isinstance(values, Mapping):\n            return False\n\n        for key, value in values.items():\n            state[key] = value\n        return True\n\n    async def ainvoke_with_durability(\n        self,\n        *,\n        graph: Any,\n        graph_input: Any,\n        config: Optional[RunnableConfig],\n        context: Optional[Any],\n        durability: str,\n        local_checkpointer: Optional[Any] = None,\n    ) -> Mapping[str, Any]:\n        \"\"\"Invoke a compiled graph with durability when supported.\"\"\"\n\n        # In production mode, platform may inject durability backends automatically.\n        # In dev mode, only attempt durability when the runnable itself was compiled\n        # with a checkpointer so LangGraph sets up its AsyncPregel loop correctly.\n        graph_bound_checkpointer = _extract_graph_checkpointer(graph)\n        resolved_local_checkpointer = local_checkpointer or graph_bound_checkpointer\n        checkpointer = resolved_local_checkpointer or self.checkpointer\n\n        if self.is_production_mode():\n            use_durability = durability\n        else:\n            use_durability = durability if (checkpointer and _graph_supports_durability(graph)) else None\n        try:\n            if use_durability:\n                return await graph.ainvoke(\n                    graph_input,\n                    config=config,\n                    context=context,\n                    durability=use_durability,\n                )\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n        except (TypeError, AttributeError):\n            return await graph.ainvoke(\n                graph_input,\n                config=config,\n                context=context,\n            )\n\n\n__all__ = [\n    \"resolve_graph_checkpointer\",\n    \"resolve_graph_store\",\n    \"GraphMemoryRuntime\",\n]\n\n\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:a910f951-bdf0-70ae-f446-9713bf0f5a2f\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766175753508.469}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766175753508.594}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:a910f951-bdf0-70ae-f446-9713bf0f5a2f\", \"new_ns\": \"user_preferences:a910f951-bdf0-70ae-f446-9713bf0f5a2f\"}, \"timestamp\": 1766175753508.6458}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:a910f951-bdf0-70ae-f446-9713bf0f5a2f\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175753508.6829}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175753508.99}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175753509.027}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175753509.099}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175753509.144}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175753509.1838}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766175753509.418}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175753509.55}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175753509.5898}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766175753509.651}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:a910f951-bdf0-70ae-f446-9713bf0f5a2f\"}, \"timestamp\": 1766175753509.6829}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766175760219.512}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8\", \"new_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8\"}, \"timestamp\": 1766175760226.577}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175760226.686}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175760227.0479}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175760227.118}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175760227.2}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175760227.2551}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175760227.331}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766175760227.704}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175760227.7961}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175760227.8918}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766175760227.958}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8\"}, \"timestamp\": 1766175760228.0012}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8|graph:bdc9350f-c2ac-64cd-64cb-5d6eb8a6f799\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766175760608.344}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175760608.489}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8|graph:bdc9350f-c2ac-64cd-64cb-5d6eb8a6f799\", \"new_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8|graph:bdc9350f-c2ac-64cd-64cb-5d6eb8a6f799\"}, \"timestamp\": 1766175760609.091}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8|graph:bdc9350f-c2ac-64cd-64cb-5d6eb8a6f799\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175760609.3308}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175760610.24}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766175760610.373}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175760610.774}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766175760611.2112}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175760611.325}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766175760611.382}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:a3becfb3-310b-9a31-1cc6-d896d1d327e8|graph:bdc9350f-c2ac-64cd-64cb-5d6eb8a6f799\"}, \"timestamp\": 1766175760611.421}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766175782283.0012}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1\"}, \"timestamp\": 1766175782359.921}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175782360.063}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175782360.416}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175782360.482}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175782360.612}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175782360.678}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175782360.7668}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766175782361.082}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175782361.1292}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175782361.168}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766175782361.2349}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1\"}, \"timestamp\": 1766175782361.2969}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2\"}, \"timestamp\": 1766175782420.819}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175782421.0342}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175782421.671}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175782421.74}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175782421.9202}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175782422.012}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175782422.112}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766175782422.4373}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175782422.5017}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175782422.582}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766175782422.6548}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2\"}, \"timestamp\": 1766175782422.7268}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3\"}, \"timestamp\": 1766175782483.857}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175782484.14}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175782484.791}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175782484.8481}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175782484.92}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175782484.9702}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175782485.066}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766175782485.316}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175782485.365}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175782485.407}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766175782485.444}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3\"}, \"timestamp\": 1766175782485.4773}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4\"}, \"timestamp\": 1766175782548.3257}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175782548.4731}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175782549.233}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175782549.936}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175782550.257}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175782552.8362}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175782553.107}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766175782553.642}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175782553.8262}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175782553.8982}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766175782553.954}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4\"}, \"timestamp\": 1766175782554.001}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1|1|graph:5a9e31ba-dacc-ebc4-f8d6-3d5991e716bf\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175783181.654}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175783181.755}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1|1|graph:5a9e31ba-dacc-ebc4-f8d6-3d5991e716bf\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1|1|graph:5a9e31ba-dacc-ebc4-f8d6-3d5991e716bf\"}, \"timestamp\": 1766175783181.812}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1|1|graph:5a9e31ba-dacc-ebc4-f8d6-3d5991e716bf\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175783181.86}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175783182.176}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766175783182.272}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175783182.33}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766175783182.5679}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175783182.612}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766175783182.642}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:1|1|graph:5a9e31ba-dacc-ebc4-f8d6-3d5991e716bf\"}, \"timestamp\": 1766175783182.6702}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2|2|graph:fafc0492-8449-48a4-b4f7-fa07a74a703a\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175783215.6438}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175783215.752}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2|2|graph:fafc0492-8449-48a4-b4f7-fa07a74a703a\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2|2|graph:fafc0492-8449-48a4-b4f7-fa07a74a703a\"}, \"timestamp\": 1766175783215.8022}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2|2|graph:fafc0492-8449-48a4-b4f7-fa07a74a703a\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175783215.842}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175783216.1702}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766175783216.21}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175783216.384}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766175783216.695}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175783216.7502}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766175783216.79}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:2|2|graph:fafc0492-8449-48a4-b4f7-fa07a74a703a\"}, \"timestamp\": 1766175783216.823}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175783250.3892}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175783250.4802}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\"}, \"timestamp\": 1766175783250.531}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175783250.575}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175783250.897}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766175783250.939}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175783251.0027}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766175783251.2388}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175783251.2869}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766175783251.424}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\"}, \"timestamp\": 1766175783251.48}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4|4|graph:babfe482-3e36-c1db-af69-77c456175ec7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175783285.5898}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175783285.723}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4|4|graph:babfe482-3e36-c1db-af69-77c456175ec7\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4|4|graph:babfe482-3e36-c1db-af69-77c456175ec7\"}, \"timestamp\": 1766175783285.7778}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4|4|graph:babfe482-3e36-c1db-af69-77c456175ec7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175783285.822}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175783286.177}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766175783286.22}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175783286.2861}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766175783286.534}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175783286.5842}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766175783286.6208}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:4|4|graph:babfe482-3e36-c1db-af69-77c456175ec7\"}, \"timestamp\": 1766175783286.654}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175792653.587}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175792653.7139}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\", \"new_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\"}, \"timestamp\": 1766175792653.9321}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\"}, \"timestamp\": 1766175792654.0107}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:98100d30\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd188-538b-6266-8000-dd680fc39f53\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd188-538a-6b4a-bfff-04bafa864ce5\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\"}]}, \"timestamp\": 1766175792654.763}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd188-538b-6266-8000-dd680fc39f53\", \"checkpoint_ns\": \"wide_funnel:b3938be7-c1a5-90cf-d52f-d2b54bd5a5c8|worker:3|3|graph:5f6b3d00-25ba-f873-f788-fc494b8fd35d\"}, \"timestamp\": 1766175792654.888}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd188-538b-6266-8000-dd680fc39f53\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766175792655.621}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"message_count\": 1, \"has_any_history\": true, \"is_at_virtual_start\": false, \"effective_input_is_none\": false}, \"timestamp\": 1766175792655.675}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:8f12ebf9-33a3-f44c-76df-d2b363cc3c77\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"user_preferences\"}, \"timestamp\": 1766175801673.1829}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_graph_runner\": true, \"has_runner_graph\": true}, \"timestamp\": 1766175801673.322}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"original_ns\": \"user_preferences:8f12ebf9-33a3-f44c-76df-d2b363cc3c77\", \"new_ns\": \"user_preferences:8f12ebf9-33a3-f44c-76df-d2b363cc3c77\"}, \"timestamp\": 1766175801673.739}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_ns\": \"user_preferences:8f12ebf9-33a3-f44c-76df-d2b363cc3c77\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175801673.781}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175801674.093}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175801674.133}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175801674.2}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175801674.247}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175801674.293}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"count\": 0}, \"timestamp\": 1766175801674.534}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175801674.5798}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175801674.619}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"snapshot_sources\": 3}, \"timestamp\": 1766175801674.7122}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"checkpoint_id\": null, \"checkpoint_ns\": \"user_preferences:8f12ebf9-33a3-f44c-76df-d2b363cc3c77\"}, \"timestamp\": 1766175801674.798}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"user_preferences_assistant_graph::step=user_preferences\", \"result_keys\": [\"messages\", \"user_preferences\"]}, \"timestamp\": 1766175809564.0479}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"original_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e\", \"new_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e\"}, \"timestamp\": 1766175809568.8489}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175809569.0242}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175809569.444}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175809569.553}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175809569.663}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175809569.723}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175809569.7798}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766175809570.0747}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175809570.129}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175809570.175}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"snapshot_sources\": 3}, \"timestamp\": 1766175809570.218}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_agent_judge_workflow::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e\"}, \"timestamp\": 1766175809570.2568}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e|graph:847fb670-cf83-df97-a944-e6d78db9aab5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"route_drafting\"}, \"timestamp\": 1766175809790.312}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175809790.468}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"original_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e|graph:847fb670-cf83-df97-a944-e6d78db9aab5\", \"new_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e|graph:847fb670-cf83-df97-a944-e6d78db9aab5\"}, \"timestamp\": 1766175809790.5337}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e|graph:847fb670-cf83-df97-a944-e6d78db9aab5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175809790.5889}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175809790.899}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\"}, \"timestamp\": 1766175809790.9429}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175809791.0159}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"count\": 0}, \"timestamp\": 1766175809791.2642}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175809791.317}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"snapshot_sources\": 1}, \"timestamp\": 1766175809791.3652}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"checkpoint_id\": null, \"checkpoint_ns\": \"route_drafting:2e90c283-11df-0472-7d7d-f53599ac557e|graph:847fb670-cf83-df97-a944-e6d78db9aab5\"}, \"timestamp\": 1766175809791.4163}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:617\", \"message\": \"_invoke_graph_from_checkpoint exit\", \"data\": {\"graph_id\": \"route_drafting_assistant_graph::step=route_drafting\", \"result_keys\": [\"user_preferences\", \"general_route_draft\", \"messages\"]}, \"timestamp\": 1766175825741.7622}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1\"}, \"timestamp\": 1766175825906.595}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175825907.692}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175825908.152}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175825908.2183}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175825908.395}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175825908.47}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175825908.519}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766175825908.7888}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175825908.8818}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175825908.9392}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"snapshot_sources\": 3}, \"timestamp\": 1766175825908.997}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1\"}, \"timestamp\": 1766175825909.035}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2\"}, \"timestamp\": 1766175826010.461}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826010.582}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826010.872}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826010.9219}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826010.994}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826011.0469}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826011.0989}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766175826011.345}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826011.393}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826011.4329}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826011.472}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2\"}, \"timestamp\": 1766175826011.508}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3\"}, \"timestamp\": 1766175826079.8591}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826079.9712}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826080.251}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826080.295}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826080.3608}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826080.42}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826080.474}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766175826080.7139}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826080.7612}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826080.802}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826080.8489}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3\"}, \"timestamp\": 1766175826080.8918}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4\"}, \"timestamp\": 1766175826141.9321}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826142.04}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826142.319}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826142.3638}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826142.432}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826142.483}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826142.5322}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766175826142.7698}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826142.815}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826142.991}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826143.064}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4\"}, \"timestamp\": 1766175826143.1072}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5\"}, \"timestamp\": 1766175826204.938}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826205.045}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826205.374}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826205.508}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826205.597}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826205.65}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826205.699}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"count\": 0}, \"timestamp\": 1766175826206.023}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826206.0808}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826206.12}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826206.155}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=5\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5\"}, \"timestamp\": 1766175826206.1848}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6\"}, \"timestamp\": 1766175826271.292}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826271.4282}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826271.9949}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826272.0918}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826272.1812}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826272.2393}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826272.2913}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"count\": 0}, \"timestamp\": 1766175826272.591}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826272.64}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826272.681}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826272.7207}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=6\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6\"}, \"timestamp\": 1766175826272.7559}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7\"}, \"timestamp\": 1766175826334.109}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826334.2122}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826334.722}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826334.797}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826334.8748}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826334.9277}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826334.978}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"count\": 0}, \"timestamp\": 1766175826335.2478}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826335.298}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826335.336}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826335.372}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7\"}, \"timestamp\": 1766175826335.403}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8\"}, \"timestamp\": 1766175826399.531}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826399.699}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826400.0352}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826400.0808}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826400.1548}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826400.203}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826400.2559}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"count\": 0}, \"timestamp\": 1766175826400.5032}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826400.565}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826400.606}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826400.6492}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=8\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8\"}, \"timestamp\": 1766175826400.679}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9\"}, \"timestamp\": 1766175826462.1692}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826462.281}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826462.555}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826462.5962}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826462.7148}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826462.896}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826462.969}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"count\": 0}, \"timestamp\": 1766175826463.307}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826463.377}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826463.427}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826463.467}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=9\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9\"}, \"timestamp\": 1766175826463.54}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10\"}, \"timestamp\": 1766175826525.44}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826525.524}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826525.852}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826525.902}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826525.972}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826526.022}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826526.0688}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"count\": 0}, \"timestamp\": 1766175826526.318}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826526.3691}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826526.409}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826526.447}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=10\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10\"}, \"timestamp\": 1766175826526.479}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11\"}, \"timestamp\": 1766175826590.624}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826590.8533}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826591.4712}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826591.574}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826591.668}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826591.729}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826591.776}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"count\": 0}, \"timestamp\": 1766175826592.0442}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826592.0962}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826592.134}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826592.178}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=11\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11\"}, \"timestamp\": 1766175826592.216}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12\"}, \"timestamp\": 1766175826654.303}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175826654.431}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175826654.766}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175826654.8127}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826654.889}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175826654.936}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175826654.9802}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"count\": 0}, \"timestamp\": 1766175826655.2288}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826655.2751}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175826655.3118}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"snapshot_sources\": 3}, \"timestamp\": 1766175826655.345}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=12\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12\"}, \"timestamp\": 1766175826655.374}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1|1|graph:20860a7c-c072-b9c4-ee53-266d297ed75c\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829462.016}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829462.131}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1|1|graph:20860a7c-c072-b9c4-ee53-266d297ed75c\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1|1|graph:20860a7c-c072-b9c4-ee53-266d297ed75c\"}, \"timestamp\": 1766175829462.182}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1|1|graph:20860a7c-c072-b9c4-ee53-266d297ed75c\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829462.2239}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829462.523}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\"}, \"timestamp\": 1766175829462.562}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829462.625}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"count\": 0}, \"timestamp\": 1766175829462.856}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829462.901}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829462.934}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=1\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:1|1|graph:20860a7c-c072-b9c4-ee53-266d297ed75c\"}, \"timestamp\": 1766175829463.084}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2|2|graph:48c95253-1184-f904-3be9-6422f4694a4d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829498.2222}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829498.335}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2|2|graph:48c95253-1184-f904-3be9-6422f4694a4d\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2|2|graph:48c95253-1184-f904-3be9-6422f4694a4d\"}, \"timestamp\": 1766175829498.4907}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2|2|graph:48c95253-1184-f904-3be9-6422f4694a4d\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829498.558}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829498.893}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\"}, \"timestamp\": 1766175829498.946}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829499.014}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"count\": 0}, \"timestamp\": 1766175829499.3347}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829499.4}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829499.4402}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=2\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:2|2|graph:48c95253-1184-f904-3be9-6422f4694a4d\"}, \"timestamp\": 1766175829499.5342}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829537.039}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829537.189}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\"}, \"timestamp\": 1766175829537.2422}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829537.2942}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829537.606}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\"}, \"timestamp\": 1766175829537.644}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829537.7222}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"count\": 0}, \"timestamp\": 1766175829537.963}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829538.008}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829538.041}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\"}, \"timestamp\": 1766175829538.115}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4|4|graph:3b86c69b-49a7-627e-ef13-c6de60417f83\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829573.036}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829573.154}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4|4|graph:3b86c69b-49a7-627e-ef13-c6de60417f83\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4|4|graph:3b86c69b-49a7-627e-ef13-c6de60417f83\"}, \"timestamp\": 1766175829573.205}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4|4|graph:3b86c69b-49a7-627e-ef13-c6de60417f83\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829573.246}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829573.5513}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\"}, \"timestamp\": 1766175829573.591}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829573.663}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"count\": 0}, \"timestamp\": 1766175829573.9}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829573.943}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829573.974}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=4\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:4|4|graph:3b86c69b-49a7-627e-ef13-c6de60417f83\"}, \"timestamp\": 1766175829574.039}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5|5|graph:5a9d64e1-629c-0534-060a-764177cc1bed\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829608.306}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829608.413}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5|5|graph:5a9d64e1-629c-0534-060a-764177cc1bed\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5|5|graph:5a9d64e1-629c-0534-060a-764177cc1bed\"}, \"timestamp\": 1766175829608.4639}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5|5|graph:5a9d64e1-629c-0534-060a-764177cc1bed\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829608.5042}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829608.854}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\"}, \"timestamp\": 1766175829608.9878}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829609.066}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"count\": 0}, \"timestamp\": 1766175829609.312}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829609.3672}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829609.4102}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=5\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:5|5|graph:5a9d64e1-629c-0534-060a-764177cc1bed\"}, \"timestamp\": 1766175829609.4502}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6|6|graph:45996b70-de95-42ea-9405-16dccab99ef3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829644.0972}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829644.198}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6|6|graph:45996b70-de95-42ea-9405-16dccab99ef3\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6|6|graph:45996b70-de95-42ea-9405-16dccab99ef3\"}, \"timestamp\": 1766175829644.2517}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6|6|graph:45996b70-de95-42ea-9405-16dccab99ef3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829644.2969}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829644.616}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\"}, \"timestamp\": 1766175829644.658}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829644.722}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"count\": 0}, \"timestamp\": 1766175829644.9639}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829645.012}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829645.048}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=6\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:6|6|graph:45996b70-de95-42ea-9405-16dccab99ef3\"}, \"timestamp\": 1766175829645.082}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829679.663}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829679.79}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\"}, \"timestamp\": 1766175829679.8457}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829679.893}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829680.29}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\"}, \"timestamp\": 1766175829680.346}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829680.4658}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"count\": 0}, \"timestamp\": 1766175829680.773}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829680.827}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829680.866}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\"}, \"timestamp\": 1766175829680.902}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8|8|graph:4e1534cc-7eaf-928a-94c0-a61fcf68e656\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829715.302}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829715.401}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8|8|graph:4e1534cc-7eaf-928a-94c0-a61fcf68e656\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8|8|graph:4e1534cc-7eaf-928a-94c0-a61fcf68e656\"}, \"timestamp\": 1766175829715.4639}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8|8|graph:4e1534cc-7eaf-928a-94c0-a61fcf68e656\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829715.5142}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829715.8179}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\"}, \"timestamp\": 1766175829715.856}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829715.953}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"count\": 0}, \"timestamp\": 1766175829716.2139}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829716.2659}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829716.3123}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=8\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:8|8|graph:4e1534cc-7eaf-928a-94c0-a61fcf68e656\"}, \"timestamp\": 1766175829716.362}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9|9|graph:ffedd1ea-b76d-f200-99f6-07893eee71a4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829750.988}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829751.1182}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9|9|graph:ffedd1ea-b76d-f200-99f6-07893eee71a4\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9|9|graph:ffedd1ea-b76d-f200-99f6-07893eee71a4\"}, \"timestamp\": 1766175829751.1748}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9|9|graph:ffedd1ea-b76d-f200-99f6-07893eee71a4\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829751.221}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829751.7122}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\"}, \"timestamp\": 1766175829751.7979}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829751.8809}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"count\": 0}, \"timestamp\": 1766175829752.2222}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829752.306}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829752.352}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=9\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:9|9|graph:ffedd1ea-b76d-f200-99f6-07893eee71a4\"}, \"timestamp\": 1766175829752.4512}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10|10|graph:64a7967f-54d3-a5dd-8745-ba2230078ff2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829787.3162}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829787.4292}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10|10|graph:64a7967f-54d3-a5dd-8745-ba2230078ff2\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10|10|graph:64a7967f-54d3-a5dd-8745-ba2230078ff2\"}, \"timestamp\": 1766175829787.4802}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10|10|graph:64a7967f-54d3-a5dd-8745-ba2230078ff2\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829787.522}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829787.831}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\"}, \"timestamp\": 1766175829788.279}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829788.435}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"count\": 0}, \"timestamp\": 1766175829788.759}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829788.8132}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829788.854}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=10\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:10|10|graph:64a7967f-54d3-a5dd-8745-ba2230078ff2\"}, \"timestamp\": 1766175829788.9868}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11|11|graph:6a06ff10-6d57-9f6f-ce57-fabd981521c9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829826.721}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829826.8318}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11|11|graph:6a06ff10-6d57-9f6f-ce57-fabd981521c9\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11|11|graph:6a06ff10-6d57-9f6f-ce57-fabd981521c9\"}, \"timestamp\": 1766175829826.887}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11|11|graph:6a06ff10-6d57-9f6f-ce57-fabd981521c9\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829826.932}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829827.362}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\"}, \"timestamp\": 1766175829827.425}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829827.51}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"count\": 0}, \"timestamp\": 1766175829827.751}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829827.801}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829827.837}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=11\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:11|11|graph:6a06ff10-6d57-9f6f-ce57-fabd981521c9\"}, \"timestamp\": 1766175829827.871}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12|12|graph:6c587f9e-f347-8243-2281-73be93b0a09b\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175829865.545}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175829865.664}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12|12|graph:6c587f9e-f347-8243-2281-73be93b0a09b\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12|12|graph:6c587f9e-f347-8243-2281-73be93b0a09b\"}, \"timestamp\": 1766175829865.8171}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12|12|graph:6c587f9e-f347-8243-2281-73be93b0a09b\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175829865.903}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175829866.291}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:729\", \"message\": \"parent context absent\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\"}, \"timestamp\": 1766175829866.34}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175829866.4119}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"count\": 0}, \"timestamp\": 1766175829866.658}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175829866.725}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"snapshot_sources\": 1}, \"timestamp\": 1766175829866.77}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=12\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:12|12|graph:6c587f9e-f347-8243-2281-73be93b0a09b\"}, \"timestamp\": 1766175829866.817}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175848160.7449}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175848161.1929}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\"}, \"timestamp\": 1766175848161.255}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175848161.3008}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_id\": \"1f0dd18a-0e54-616e-8000-a26b51dcfcba\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=7\", \"checkpoint_id\": \"1f0dd18a-0e53-6a8e-bfff-067592f9a9c5\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\"}]}, \"timestamp\": 1766175848161.818}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_id\": \"1f0dd18a-0e54-616e-8000-a26b51dcfcba\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:7|7|graph:0e5b43fd-7bc4-7333-d913-c8bbaadb91a8\"}, \"timestamp\": 1766175848161.885}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"checkpoint_id\": \"1f0dd18a-0e54-616e-8000-a26b51dcfcba\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766175848162.5103}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=7\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"message_count\": 1, \"has_any_history\": true, \"is_at_virtual_start\": false, \"effective_input_is_none\": false}, \"timestamp\": 1766175848162.556}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"agent.py:607\", \"message\": \"_invoke_graph_from_checkpoint entry\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"step_config_key\": \"wide_funnel\"}, \"timestamp\": 1766175848196.11}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"agent.py:620\", \"message\": \"assistant context snapshot access\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"has_context\": false, \"has_graph_runner\": false, \"has_runner_graph\": false}, \"timestamp\": 1766175848196.237}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\"}, \"timestamp\": 1766175848196.291}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175848196.3333}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 2, \"records\": [{\"idx\": \"0\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd18a-0cf7-6bae-8000-2cf5b56b6780\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\"}, {\"idx\": \"1\", \"meta_graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd18a-0cf7-64ba-bfff-1586c3d4a7d2\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\"}]}, \"timestamp\": 1766175848196.8179}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd18a-0cf7-6bae-8000-2cf5b56b6780\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:3|3|graph:9ed11ff6-807f-50d7-1449-1ed6cfe06e46\"}, \"timestamp\": 1766175848196.885}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"C\", \"location\": \"memory_manager.py:504\", \"message\": \"ainvoke_from_checkpoint snapshot inspection\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"checkpoint_id\": \"1f0dd18a-0cf7-6bae-8000-2cf5b56b6780\", \"snapshot_present\": true, \"has_tasks\": true, \"pending_next\": true}, \"timestamp\": 1766175848197.4568}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"K\", \"location\": \"memory_manager.py:509\", \"message\": \"resuming graph from checkpoint pending next\", \"data\": {\"graph_id\": \"wide_funnel_assistant_graph::step=wide_funnel::worker=3\", \"next_nodes\": [\"agent\"], \"graph_input_is_none\": false, \"message_count\": 1, \"has_any_history\": true, \"is_at_virtual_start\": false, \"effective_input_is_none\": false}, \"timestamp\": 1766175848197.5}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"E\", \"location\": \"memory_manager.py:445\", \"message\": \"ainvoke_from_checkpoint setting checkpoint_ns\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"original_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:13\", \"new_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:13\"}, \"timestamp\": 1766175852699.0918}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:458\", \"message\": \"ainvoke_from_checkpoint calling find_latest_checkpoint_id\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:13\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\"}, \"timestamp\": 1766175852699.2322}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"B\", \"location\": \"memory_manager.py:395\", \"message\": \"find_latest_checkpoint_id checkpoints listed\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"thread_id\": \"e2e-test:TestE2ETravelGuideAgent::test_ainvoke_full_graph_execution:5e659cfe\", \"count\": 0, \"records\": []}, \"timestamp\": 1766175852699.852}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:711\", \"message\": \"parent context inspection\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"has_context\": true, \"has_runner\": true, \"has_graph\": true}, \"timestamp\": 1766175852699.896}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:715\", \"message\": \"parent snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175852699.96}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"G\", \"location\": \"memory_manager.py:738\", \"message\": \"root snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"snapshot_present\": true, \"has_tasks\": false}, \"timestamp\": 1766175852700.0078}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:727\", \"message\": \"assistant snapshot inspected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"snapshot_present\": true, \"has_tasks\": false, \"has_next\": false}, \"timestamp\": 1766175852700.0562}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:734\", \"message\": \"thread checkpoints snapshot collected\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"count\": 0}, \"timestamp\": 1766175852700.292}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"record_index\": 0, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175852700.334}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"H\", \"location\": \"memory_manager.py:562\", \"message\": \"checkpoint missing task entries\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"record_index\": 1, \"parent_checkpoint_id\": null}, \"timestamp\": 1766175852700.372}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"F\", \"location\": \"memory_manager.py:743\", \"message\": \"subgraph resume config missing\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"snapshot_sources\": 3}, \"timestamp\": 1766175852700.406}\n{\"sessionId\": \"debug-session\", \"runId\": \"pre-fix\", \"hypothesisId\": \"A\", \"location\": \"memory_manager.py:464\", \"message\": \"ainvoke_from_checkpoint checkpoint_id result\", \"data\": {\"graph_id\": \"wide_funnel_agent_judge_workflow::step=wide_funnel::worker=13\", \"checkpoint_id\": null, \"checkpoint_ns\": \"wide_funnel:bc1e71ef-e1f2-fb2c-7349-1ad5a6a66487|worker:13\"}, \"timestamp\": 1766175852700.437}\n"
  },
  {
    "role": "assistant",
    "id": "lc_run--019b384d-4050-7822-848d-f3de622f3be5",
    "content": "**\u041f\u0440\u0438\u0447\u0438\u043d\u0430 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b \u2014 \u00ab\u043f\u0435\u0440\u0435\u0437\u0430\u0442\u0438\u0440\u0430\u043d\u0438\u0435\u00bb \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0432 \u043c\u0435\u0442\u043e\u0434\u0435 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0438 \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u043d\u0438\u0437\u043a\u0438\u0439 \u043f\u043e\u0440\u043e\u0433 \u0434\u0435\u0442\u0435\u043a\u0446\u0438\u0438 \u0438\u0441\u0442\u043e\u0440\u0438\u0438, \u0447\u0442\u043e \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435 \u043f\u0443\u0441\u0442\u043e\u0433\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0432 Gemini.**\n\n\u0410\u043d\u0430\u043b\u0438\u0437 \u0432\u0430\u0448\u0438\u0445 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 \u043b\u043e\u0433\u043e\u0432 \u0438 \u043a\u043e\u0434\u0430 \u0432\u044b\u044f\u0432\u0438\u043b \u0434\u0432\u0430 \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0431\u0430\u0433\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u044e\u0442 \u0432 \u043f\u0430\u0440\u0435:\n\n### 1. \u041f\u043e\u0442\u0435\u0440\u044f \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u043f\u0440\u0438 \u043c\u0435\u0440\u0434\u0436\u0435 (\u041b\u0438\u043d\u0438\u044f 325 \u0432 `memory_manager.py`)\n\n\u0412 \u043c\u0435\u0442\u043e\u0434\u0435 `_materialize_checkpoint_values` \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 \u043f\u0440\u044f\u043c\u043e\u0435 \u043f\u0440\u0438\u0441\u0432\u0430\u0438\u0432\u0430\u043d\u0438\u0435:\n```python\nif isinstance(write_payload, Mapping):\n    for key, value in write_payload.items():\n        materialized[key] = value # <--- \u041a\u0420\u0418\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0419 \u0411\u0410\u0413\n```\n**\u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u043b\u043e\u043c\u0430\u0435\u0442 \u0432\u0441\u0451:**\n\u0412 LangGraph `messages` \u2014 \u044d\u0442\u043e \u0441\u043f\u0438\u0441\u043e\u043a. \u041a\u043e\u0433\u0434\u0430 \u0443\u0437\u0435\u043b \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043d\u043e\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435, \u043e\u043d \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 `{\"messages\": [new_msg]}`. \u0412\u0430\u0448\u0435 \u043f\u0440\u0438\u0441\u0432\u0430\u0438\u0432\u0430\u043d\u0438\u0435 `materialized[\"messages\"] = [new_msg]` **\u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0432\u0441\u044e \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0443\u044e \u0438\u0441\u0442\u043e\u0440\u0438\u044e** \u0438 \u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435. \u042d\u0442\u043e \u043e\u0431\u044a\u044f\u0441\u043d\u044f\u0435\u0442, \u043f\u043e\u0447\u0435\u043c\u0443 \u0432 \u043b\u043e\u0433\u0430\u0445 `message_count: 1`.\n\n### 2. \u041e\u0448\u0438\u0431\u043a\u0430 Gemini `contents is not specified`\n\n\u042d\u0442\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u2014 \u043f\u0440\u044f\u043c\u043e\u0435 \u0441\u043b\u0435\u0434\u0441\u0442\u0432\u0438\u0435 \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u0431\u0430\u0433\u0430.\n1.  \u0418\u0437-\u0437\u0430 \u0431\u0430\u0433\u0430 \u21161 \u0432 \u0441\u0442\u0435\u0439\u0442\u0435 \u043e\u0441\u0442\u0430\u0435\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e 1 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 (\u043e\u0431\u044b\u0447\u043d\u043e \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0439 \u043f\u0440\u043e\u043c\u043f\u0442).\n2.  \u0412\u0430\u0448 \u043a\u043e\u0434 \u0432\u0438\u0434\u0438\u0442 `message_count: 1`, \u0441\u0447\u0438\u0442\u0430\u0435\u0442 \u0447\u0442\u043e `has_any_history: true`.\n3.  \u041f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u044d\u0442\u043e \u043d\u0435 \u0441\u0442\u0430\u0440\u0442, \u043e\u043d \u0432\u044b\u0431\u0438\u0440\u0430\u0435\u0442 `effective_input: {}`.\n4.  **\u0418\u0442\u043e\u0433:** \u0412 Gemini \u0443\u0445\u043e\u0434\u0438\u0442 \u0437\u0430\u043f\u0440\u043e\u0441, \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u0439 **\u0442\u043e\u043b\u044c\u043a\u043e \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0439 \u043f\u0440\u043e\u043c\u043f\u0442** \u0431\u0435\u0437 \u0432\u043e\u043f\u0440\u043e\u0441\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f. Gemini (Google) \u0441\u0447\u0438\u0442\u0430\u0435\u0442 \u0442\u0430\u043a\u043e\u0439 \u0437\u0430\u043f\u0440\u043e\u0441 \u043f\u0443\u0441\u0442\u044b\u043c \u0438 \u0432\u044b\u0434\u0430\u0435\u0442 `400 contents is not specified`.\n\n---\n\n### \u041a\u0430\u043a \u044d\u0442\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043e\u0440\u0433\u0430\u043d\u0438\u0447\u043d\u043e (\u0414\u0432\u0430 \u0448\u0430\u0433\u0430)\n\n#### \u0428\u0430\u0433 1: \u0418\u0441\u043f\u0440\u0430\u0432\u044c\u0442\u0435 \u043c\u0435\u0440\u0434\u0436 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0432 `memory_manager.py`\n\u0412\u043c\u0435\u0441\u0442\u043e \u0437\u0430\u043c\u0435\u043d\u044b \u0441\u043f\u0438\u0441\u043a\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439, \u0438\u0445 \u043d\u0443\u0436\u043d\u043e \u043e\u0431\u044a\u0435\u0434\u0438\u043d\u044f\u0442\u044c (\u0438\u043c\u0438\u0442\u0438\u0440\u0443\u044f \u0440\u0430\u0431\u043e\u0442\u0443 \u0440\u0435\u0434\u0443\u0441\u0435\u0440\u0430 `add_messages`):\n\n```python\n# \u041c\u0435\u0442\u043e\u0434 _materialize_checkpoint_values\nif isinstance(write_payload, Mapping):\n    for key, value in write_payload.items():\n        if key == \"messages\" and key in materialized:\n            # \u0412\u0430\u0436\u043d\u043e: \u043e\u0431\u044a\u0435\u0434\u0438\u043d\u044f\u0435\u043c, \u0430 \u043d\u0435 \u0437\u0430\u043c\u0435\u043d\u044f\u0435\u043c!\n            from langgraph.graph.message import add_messages\n            materialized[key] = add_messages(materialized[key], value)\n        else:\n            materialized[key] = value\n```\n\n#### \u0428\u0430\u0433 2: \u041f\u043e\u0434\u043d\u0438\u043c\u0438\u0442\u0435 \u043f\u043e\u0440\u043e\u0433 \"\u043f\u043e\u043b\u043d\u043e\u0442\u044b\" \u0438\u0441\u0442\u043e\u0440\u0438\u0438\n\u0410\u0441\u0441\u0438\u0441\u0442\u0435\u043d\u0442 \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443 \u0431\u0435\u0437 \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0432\u0432\u043e\u0434\u0430 (`input={}`) \u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u043e\u043d \u0443\u0436\u0435 \"\u0443\u0441\u043b\u044b\u0448\u0430\u043b\" \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f (\u0442.\u0435. \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u043c\u0438\u043d\u0438\u043c\u0443\u043c 2 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f: System + User).\n\n```python\n# \u041c\u0435\u0442\u043e\u0434 ainvoke_from_checkpoint (~\u043b\u0438\u043d\u0438\u044f 515)\n# \u0421\u0447\u0438\u0442\u0430\u0435\u043c \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u043f\u043e\u043b\u043d\u043e\u0439 \u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u0442\u0430\u043c >= 2 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439\nhas_full_history = len(messages) >= 2 \nis_at_virtual_start = bool(next_nodes_list == [\"__start__\"])\n\n# \u0428\u043b\u0435\u043c {}, \u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e UserMessage \u0443\u0436\u0435 \u0432 \u0431\u0430\u0437\u0435.\n# \u0415\u0441\u043b\u0438 \u0442\u0430\u043c 0 \u0438\u043b\u0438 1 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 - \u043d\u0430\u043c \u041d\u0423\u0416\u0415\u041d graph_input, \u0447\u0442\u043e\u0431\u044b \u043d\u0435 \u043f\u043e\u0442\u0435\u0440\u044f\u0442\u044c \u0432\u043e\u043f\u0440\u043e\u0441.\nif has_full_history and not is_at_virtual_start:\n    effective_input = {}\nelse:\n    effective_input = graph_input\n```\n\n### \u041f\u043e\u0447\u0435\u043c\u0443 \u044d\u0442\u043e \u0440\u0435\u0448\u0438\u0442 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0443:\n1.  **\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f:** \u0411\u0430\u0433 \u0441 `materialized[key] = value` \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0441\u0442\u0438\u0440\u0430\u0442\u044c \u0441\u0442\u0430\u0440\u044b\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f.\n2.  **Gemini \u043f\u043e\u043b\u0443\u0447\u0438\u0442 \u0434\u0430\u043d\u043d\u044b\u0435:** \u0414\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u0432\u043e\u0440\u043a\u0435\u0440 \u0443\u043f\u0430\u043b \u043d\u0430 \u0441\u0430\u043c\u043e\u043c \u0441\u0442\u0430\u0440\u0442\u0435, \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0443\u0432\u0438\u0434\u0438\u0442 `len < 2` \u0438 \u043f\u0435\u0440\u0435\u0434\u0430\u0441\u0442 `graph_input`, \u0434\u043e\u0441\u0442\u0440\u043e\u0438\u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0434\u043e \u0432\u0430\u043b\u0438\u0434\u043d\u043e\u0433\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f.\n3.  **\u0423\u0439\u0434\u0435\u0442 `EmptyInputError`:** \u041f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 `graph_input` \u043f\u0440\u0438 \u043c\u0430\u043b\u043e\u043c \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u0442 \u043a\u0430\u043d\u0430\u043b\u044b.\n\n**Relevant docs:**\n- [LangGraph Reducers: add_messages](https://docs.langchain.com/oss/python/langgraph/graph-api#why-use-messages)\n- [Google Gemini: GenerateContentRequest Requirements](https://docs.langchain.com/oss/python/langchain/models)\n- [Time Travel: Resume Execution](https://docs.langchain.com/oss/python/langgraph/use-time-travel#4-resume-execution-from-the-checkpoint)"
  }
]