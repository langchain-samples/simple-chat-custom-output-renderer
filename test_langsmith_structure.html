<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test LangSmith Structure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #0f172a;
            min-height: 100vh;
            display: flex;
            padding: 20px;
            gap: 20px;
        }

        .panel {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .control-panel {
            background: #1e293b;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #334155;
        }

        h1 {
            color: #f1f5f9;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .info {
            background: #1e3a5f;
            border: 1px solid #2563eb;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 20px;
            color: #93c5fd;
            font-size: 13px;
            line-height: 1.5;
        }

        .test-case {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .test-case:hover {
            border-color: #667eea;
            background: #1e293b;
        }

        .test-case-title {
            color: #f1f5f9;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .test-case-desc {
            color: #94a3b8;
            font-size: 12px;
        }

        iframe {
            flex: 1;
            border: 1px solid #334155;
            border-radius: 10px;
            background: #0f172a;
        }
    </style>
</head>
<body>
    <div class="panel">
        <div class="control-panel">
            <h1>Test Official LangSmith Structure</h1>

            <div class="info">
                Click on test cases below to see how the renderer handles the official LangSmith postMessage structure. The 'data' field contains the output (full conversation).
            </div>

            <div class="test-case" onclick="sendTest1()">
                <div class="test-case-title">1. Simple String Output</div>
                <div class="test-case-desc">data: string (simple text response)</div>
            </div>

            <div class="test-case" onclick="sendTest2()">
                <div class="test-case-title">2. Single Message</div>
                <div class="test-case-desc">data: single message object</div>
            </div>

            <div class="test-case" onclick="sendTest3()">
                <div class="test-case-title">3. Conversation with Tool Calls</div>
                <div class="test-case-desc">data: array with user, assistant, tool messages</div>
            </div>

            <div class="test-case" onclick="sendTest4()">
                <div class="test-case-title">4. Multi-Turn Conversation</div>
                <div class="test-case-desc">data: array with multiple back-and-forth messages</div>
            </div>

            <div class="test-case" onclick="sendTest5()">
                <div class="test-case-title">5. Generic Object Output</div>
                <div class="test-case-desc">data: structured object (fallback to JSON display)</div>
            </div>
        </div>
    </div>

    <div class="panel">
        <iframe id="rendererFrame" src="index_chat.html"></iframe>
    </div>

    <script>
        const iframe = document.getElementById('rendererFrame');

        function sendMessage(message) {
            console.log('Sending test message:', message);
            iframe.contentWindow.postMessage(message, '*');
        }

        function sendTest1() {
            // Simple string output
            sendMessage({
                type: 'output',
                data: 'LangChain is a framework for developing applications powered by language models. It provides tools for building with LLMs.',
                metadata: {}
            });
        }

        function sendTest2() {
            // Single complete conversation (user + assistant)
            sendMessage({
                type: 'output',
                data: [
                    {
                        role: 'user',
                        id: 'msg-122',
                        content: 'What is LangChain?'
                    },
                    {
                        role: 'assistant',
                        id: 'msg-123',
                        content: 'LangChain is a framework for developing applications powered by language models.'
                    }
                ],
                metadata: {}
            });
        }

        function sendTest3() {
            // Full conversation with tool calls
            sendMessage({
                type: 'output',
                data: [
                    {
                        role: 'user',
                        id: 'msg-455',
                        content: 'Can you find me tutorials on LangGraph?'
                    },
                    {
                        role: 'assistant',
                        id: 'msg-456',
                        tool_calls: [
                            {
                                id: 'call_001',
                                type: 'function',
                                function: {
                                    name: 'SearchDocsByLangChain',
                                    arguments: '{"query": "LangGraph tutorials", "page_size": 5}'
                                }
                            }
                        ]
                    },
                    {
                        role: 'tool',
                        id: 'msg-457',
                        name: 'SearchDocsByLangChain',
                        content: '{"results": [{"title": "LangGraph Tutorial", "url": "https://docs.langchain.com/langgraph", "content": "Learn how to build stateful agents with LangGraph..."}]}'
                    },
                    {
                        role: 'assistant',
                        id: 'msg-458',
                        content: 'I found a great tutorial on LangGraph that covers building stateful agents. You can check it out at https://docs.langchain.com/langgraph'
                    }
                ],
                metadata: {}
            });
        }

        function sendTest4() {
            // Multi-turn conversation
            sendMessage({
                type: 'output',
                data: [
                    {
                        role: 'user',
                        id: 'msg-201',
                        content: 'What is LangChain?'
                    },
                    {
                        role: 'assistant',
                        id: 'msg-202',
                        content: 'LangChain is a framework for developing applications powered by language models.'
                    },
                    {
                        role: 'user',
                        id: 'msg-203',
                        content: 'And what about LangGraph?'
                    },
                    {
                        role: 'assistant',
                        id: 'msg-204',
                        content: 'LangGraph is a library for building stateful, multi-actor applications with LLMs. It extends LangChain with graph-based workflow capabilities.'
                    }
                ],
                metadata: {}
            });
        }

        function sendTest5() {
            // Generic structured object (not standard message format)
            sendMessage({
                type: 'output',
                data: {
                    answer: 'The capital of France is Paris.',
                    confidence: 0.95,
                    sources: ['Wikipedia', 'Encyclopedia'],
                    metadata: {
                        language: 'en',
                        timestamp: '2025-12-20T09:00:00Z'
                    }
                },
                metadata: {}
            });
        }

        // Auto-load first test after iframe loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('Auto-loading test 2...');
                sendTest2();
            }, 1000);
        });
    </script>
</body>
</html>
